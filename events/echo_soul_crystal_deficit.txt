#Soul Crystal Deficit
namespace = soul_deficit

situation_event = {
	id = soul_deficit.1
	title = soul_deficit.1.name
	desc = soul_deficit.1.desc
	picture = GFX_evt_decryption
	show_sound = event_bad_omen
	is_triggered_only = yes
	situation = this

	abort_trigger = {
		situation_progress >= 100
	}

	immediate = {
		owner = {
			ordered_owned_planet = {
				limit = {
					OR = {
						num_districts = {
							type = district_farming
							value >= 4
						}
						num_districts = {
							type = district_farming_uncapped
							value >= 4
						}
						num_districts = {
							type = district_rw_farming
							value >= 1
						}
					}
				}
				position = 0
				order_by = value:farming_districts_value
				save_event_target_as = looted_planet
			}
		}
	}

	option = {
		name = deficit.1.A
		trigger = {
			owner = {
				is_lithoid_empire = no
				num_buildings = {
					type = building_clone_vats
					disabled = no
					value > 0
				}
			}
		}
		owner = {
			custom_tooltip = deficit.1.A.tooltip
			add_resource = {
				food = 100
				mult = value:num_active_buildings|BUILDING|building_clone_vats|
			}
			hidden_effect = {
				every_owned_planet = {
					limit = { has_active_building = building_clone_vats }
					ruin_building = building_clone_vats
				}
			}
		}
	}
	option = {
		name = deficit.1.B
		trigger = {
			owner = {
				num_buildings = {
					type = building_bio_reactor
					disabled = no
					value > 0
				}
			}
		}
		owner = {
			custom_tooltip = deficit.1.B.tooltip
			add_resource = {
				food = 100
				mult = value:num_active_buildings|BUILDING|building_bio_reactor|
			}
			hidden_effect = {
				every_owned_planet = {
					limit = { has_active_building = building_bio_reactor }
					while = { #each planet can have multiple
						limit = { has_active_building = building_bio_reactor }
						ruin_building = building_bio_reactor
					}
				}
			}
		}
	}
	option = {
		name = deficit.100.B
		trigger = {
			exists = event_target:looted_planet
		}
		owner = {
			add_resource = {
				food = 500
				mult = event_target:looted_planet.value:farming_districts_value
			}
		}
		event_target:looted_planet = {
			add_planet_devastation = 50
		}
	}
	option = {
		name = deficit.100.C
	}
}


situation_event = {
	id = soul_deficit.2
	title = BANKRUPTCY
	desc = {
		text = deficit.2.desc
		trigger = {
			owner = { is_regular_empire = yes }
		}
	}
	desc = {
		text = deficit.2.desc.gestalt
		trigger = {
			owner = { is_gestalt = yes }
		}
	}
	picture = GFX_evt_news_room
	show_sound = event_life_support_fail
	is_triggered_only = yes
	situation = this

	option = {
		name = UNFORTUNATE

		owner = {
			add_resource = {
				food = @bailout_basic_base_amount
				mult = value:bailout_scaling_factor
			}
			country_defaulted_effect = yes
		}
	}
	after = {
		destroy_situation = this
	}
}