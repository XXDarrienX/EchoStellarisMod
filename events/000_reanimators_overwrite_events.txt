namespace = ancrel
namespace = anomaly
namespace = aquatics
namespace = distar
namespace = leviathans
namespace = necroids


country_event = {
	id = ancrel.4020
	title = "ancrel.4020.name"
	desc = "ancrel.4020.desc"
	picture = GFX_evt_space_dragon_blue
	show_sound = event_dangerous_animals
	location = FromFromFrom
	trackable = yes

	is_triggered_only = yes

	trigger = {
		from = { has_country_flag = rubricator_dragon_country }
	}

	option = {
		name = "ancrel.4020.a"
		hidden_effect = {
			if = {
				limit = {
					any_country = {
						has_event_chain = rubricator_chain_2
					}
				}
				every_playable_country = {
					limit = {
						has_event_chain = rubricator_chain_2
					}
					end_event_chain = rubricator_chain_2
					remove_point_of_interest = rubricator_dragon_poi
				}
			}
			if = {
				limit = {
					any_country = {
						has_event_chain = rubricator_chain
					}
				}
				every_playable_country = {
					limit = {
						has_event_chain = rubricator_chain
					}
					end_event_chain = rubricator_chain
					remove_point_of_interest = rubricator_coordinates_poi
				}
			}
		}
		add_relic = r_rubricator
	}
	option = {
		name = galactic_features.385.reanimated

		trigger = {
			is_reanimator_empire = yes
		}

		enable_special_project = {
			name = "REANIMATE_SHARD_DRAGON"
			location = fromfrom.solar_system.star
			owner = root.owner
		}
		hidden_effect = {
			if = {
				limit = {
					any_country = {
						has_event_chain = rubricator_chain_2
					}
				}
				every_playable_country = {
					limit = {
						has_event_chain = rubricator_chain_2
					}
					end_event_chain = rubricator_chain_2
					remove_point_of_interest = rubricator_dragon_poi
				}
			}
			if = {
				limit = {
					any_country = {
						has_event_chain = rubricator_chain
					}
				}
				every_playable_country = {
					limit = {
						has_event_chain = rubricator_chain
					}
					end_event_chain = rubricator_chain
					remove_point_of_interest = rubricator_coordinates_poi
				}
			}
		}
		add_relic = r_rubricator
	}
}

country_event = {
	id = anomaly.79
	title = "anomaly.75.name"
	desc = "anomaly.79.desc"
	picture = GFX_evt_mining_station
	#show_sound = event_scanner
	location = event_target:rock_brain

	is_triggered_only = yes

	option = {
		name = anomaly.79.a
		add_modifier = {
			modifier = rock_brain_decoding
			days = -1
		}
	}

	option = {
		name = galactic_features.385.reanimated
		ai_chance = {
			factor = 100
		}
		trigger = {
			is_reanimator_empire = yes
		}

		add_modifier = {
			modifier = rock_brain_decoding
			days = -1
		}

		event_target:rock_brain = {
			enable_special_project = {
				name = "REANIMATE_ROCK_BRAIN"
				location = this
				owner = root
			}
		}
	}
}

ship_event = {
	id = anomaly.2520
	title = "anomaly.2520.name"
	desc = "anomaly.2520.desc"
	picture = GFX_evt_alien_wildlife
	show_sound = event_ship_bridge
	location = FROM
	trackable = yes

	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.2 days = 30 } }
	}

	option = {
		trigger = { owner = { NOT = { has_civic = civic_machine_terminator } } }
		name = FASCINATING
		from = {
			enable_special_project = {
				name = "GIGANTIC_SKELETON_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	option = {
		trigger = { owner = { has_civic = civic_machine_terminator } }
		name = "anomaly.2520.a.term"
		from = {
			enable_special_project = {
				name = "GIGANTIC_SKELETON_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	option = {
		trigger = { owner = { is_reanimator_empire = yes } }
		name = anomaly.2520.a.rean
		from = {
			enable_special_project = {
				name = "GIGANTIC_SKELETON_RESURRECTION_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
}


country_event = {
	id = aquatics.105
	title = aquatics.105.name
	desc = {
		text = aquatics.105.desc.origin_normal
		trigger = {
			from = { has_country_flag = here_be_the_dragon@root }
			NOT = { has_ethic = ethic_gestalt_consciousness }
			is_materialist = no
		}
	}
	desc = {
		text = aquatics.105.desc.origin_materialist
		trigger = {
			from = { has_country_flag = here_be_the_dragon@root }
			is_materialist = yes
		}
	}
	desc = {
		text = aquatics.105.desc.origin_hive
		trigger = {
			from = { has_country_flag = here_be_the_dragon@root }
			is_hive_empire = yes
		}
	}
	desc = {
		text = aquatics.105.desc.origin_machine
		trigger = {
			from = { has_country_flag = here_be_the_dragon@root }
			is_machine_empire = yes
		}
	}
	desc = {
		text = aquatics.105.desc.others
		trigger = {
			NOT = { from = { has_country_flag = here_be_the_dragon@root } }
		}
	}

	picture = GFX_evt_here_be_dragons
	location = fromfrom
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	trigger = {
		from = {
			is_country_type = origin_dragon
			has_country_flag = here_be_the_dragon
		}
	}

	immediate = {
		if = {
			limit = {
				NOT = { from = { has_country_flag = here_be_the_dragon@root } }
			}
			random_country = {
				limit = { from = { has_country_flag = here_be_the_dragon@prev } }
				country_event = { id = aquatics.110 }
			}
		}
		fromfrom.solar_system = {
			save_event_target_as = dragon_system
			random_system_planet = {
				limit = {
					is_colony = yes
				}
				weights = {
					base = 1
					modifier = {
						factor = 1000
						NOT = { is_planet_class = pc_habitat }
					}
				}
				save_event_target_as = dragon_planet
			}
		}
		random_country = {
			limit = { has_country_flag = dragon_dummy_for@from }
			destroy_country = yes
		}
	}

	option = {
		name = aquatics.105.A
		trigger = { from = { has_country_flag = here_be_the_dragon@root } }
		grant_dragon_armor_effect = yes
		add_modifier = {
			modifier = slew_origin_dragon
		}
	}

	option = {
		name = aquatics.105.A
		trigger = { NOT = { from = { has_country_flag = here_be_the_dragon@root } } }
		grant_dragon_armor_effect = yes
	}

	option = {
		name = galactic_features.385.reanimated
		trigger = {
			is_reanimator_empire = yes
			from = { has_country_flag = here_be_the_dragon@root }
		}
		add_modifier = {
			modifier = slew_origin_dragon
		}
		enable_special_project = {
			name = "REANIMATE_ORIGIN_DRAGON"
			location = event_target:dragon_system.star
			owner = root
		}
	}

	option = {
		name = galactic_features.385.reanimated
		trigger = {
			is_reanimator_empire = yes
			NOT = { from = { has_country_flag = here_be_the_dragon@root } }
		}
		enable_special_project = {
			name = "REANIMATE_ORIGIN_DRAGON"
			location = event_target:dragon_system.star
			owner = root
		}
	}

	after = {
		if = {
			limit = { exists = fromfrom.leader }
			fromfrom.leader = {
				if = {
					limit = {
						leader_class = admiral
					}
					add_trait = leader_trait_dragonslayer
				}
				ELSE_IF = {
					limit = {
						leader_class = general
					}
					add_trait = leader_trait_dragonbane
				}
			}
		}
	}
}


ship_event = { #Disabled event for Reanimators
	id = distar.58
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_ship_flag = lost_amoeba_ship
	}

	immediate = {
		if = {
			limit = {
				owner = {
					is_reanimator_empire = yes
				}
				#exists = event_target:amoeba_finding_scientist
				NOT = { has_ship_flag = resurrected_once }
			}
			ship_event = { id = distar.340 }
		}
		else = {
			if = {
				limit = {
					exists = event_target:amoeba_finding_scientist
				}
				fleet.owner = { country_event = { id = distar.57 } }
			}
			set_disabled = no
			destroy_ship = this
		}
	}
}


country_event = {
	id = distar.5009
	title = distar.5009.name
	desc = distar.5009.desc
	picture = GFX_evt_voidspawn
	show_sound = event_space_whale
	location = event_target:slain_guardian_system
	trackable = yes

	is_triggered_only = yes

	trigger = {
		from = { has_country_flag = hatchling_country }
	}

	immediate = {
		set_country_flag = hatchling_killed # Achievement flag
		set_country_flag = killed_hatchling
		fromfrom.solar_system = {
			save_event_target_as = slain_guardian_system
		}
		every_playable_country = {
			limit = {
				has_event_chain = curator_poi_chain
				event_target:slain_guardian_system = {
					is_point_of_interest = {
						id = curator_poi_hatchling
						event_chain = curator_poi_chain
						owner = prev
					}
				}
			}
			remove_point_of_interest = curator_poi_hatchling
			end_curator_chain = yes
		}
	}

	option = {
		name = distar.5009.a
		event_target:hatchling_egg = {
			enable_special_project = {
				name = SHATTERED_EGG
				location = this
				owner = root
			}
		}
		if = {
			limit = {
				exists = event_target:egg_owner
				is_same_value = event_target:egg_owner
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 72
				min = 600
				max = 6000
			}
		}
		else_if = {
			limit = {
				OR = {
					NOT = {
						exists = event_target:egg_owner
					}
					AND = {
						exists = event_target:egg_owner
						is_same_value = event_target:egg_owner
					}
				}
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = distar.5009.b
		if = {
			limit = {
				exists = event_target:egg_owner
				is_same_value = event_target:egg_owner
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 72
				min = 600
				max = 6000
			}
		}
		else_if = {
			limit = {
				OR = {
					NOT = {
						exists = event_target:egg_owner
					}
					AND = {
						exists = event_target:egg_owner
						is_same_value = event_target:egg_owner
					}
				}
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
		ai_chance = {
			factor = 0
		}
	}
	# Reanimate it!
	option = {
		ai_chance = {
			factor = 100
		}

		name = galactic_features.385.reanimated

		trigger = {
			is_reanimator_empire = yes
		}

		event_target:hatchling_egg = {
			enable_special_project = {
				name = "REANIMATE_VOIDSPAWN"
				location = this
				owner = root.owner
			}
		}
	}
}

# Reanimated Voidspawn
country_event = {
	id = distar.5016
	title = "distar.218.name"
	desc = "distar.5016.desc"
	location = event_target:hatchling_egg

	is_triggered_only = yes

	picture = GFX_evt_voidspawn
	show_sound = event_space_whale

	option = {
		name = "it_hungers"

		create_fleet = {
			name = "NAME_Voidspawn"
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Voidspawn"
					design = "NAME_Voidspawn"
					prefix = no
					upgradable = no
				}
				set_location = {
					target = event_target:hatchling_egg
					distance = 0
					angle = random
				}
				set_fleet_stance = passive
			}
			settings = {
				can_upgrade = no
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
				spawn_debris = no
			}
		}
	}
}


# victorious admiral gains dragonslayer trait
country_event = {
	id = leviathans.670
	title = leviathans.670.name
	desc = {
		text = leviathans.670.desc
		trigger = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
			fromfrom = {
				exists = leader
			}
		}
	}
	desc = {
		text = leviathans.670.desc.noleader
		trigger = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
			fromfrom = {
				NOT = { exists = leader }
			}
		}
	}
	desc = {
		text = leviathans.670.desc.gesta
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
	}
	picture = GFX_evt_space_dragon
	location = fromfrom
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	trigger = {
		from = {
			is_country_type = guardian_dragon
			NOR = {
				has_country_flag = rubricator_dragon_country
				has_country_flag = here_be_the_dragon
			}
		}
		#fromfromfrom = {
		#	has_fleet_flag = dragon_fleet
		#}
	}

	immediate = {
		every_country = {
			limit = {
				is_country_type = default
				has_modifier = draconic_beats
			}
			remove_modifier = draconic_beats
		}
		fromfrom.solar_system = {
			save_event_target_as = slain_guardian_system
		}
		every_country = {
			limit = {
				is_country_type = default
				has_event_chain = curator_poi_chain
				event_target:slain_guardian_system = {
					is_point_of_interest = {
						id = curator_poi_dragon
						event_chain = curator_poi_chain
						owner = prev
					}
				}
			}
			remove_point_of_interest = curator_poi_dragon
			end_curator_chain = yes
		}
	}

	option = {
		name = leviathans.670.a
		trigger = {
			fromfrom = {
				exists = leader
			}
		}
		fromfrom = {
			leader = {
				if = {
					limit = {
						leader_class = admiral
					}
					add_trait = leader_trait_dragonslayer
				}
				ELSE_IF = {
					limit = {
						leader_class = general
					}
					add_trait = leader_trait_dragonbane
				}
			}
		}
		add_resource = { influence = 300 }
		add_relic = r_dragon_trophy
		if = { #maybe the Tiyanki accidentally killed them
			limit = { exists = capital_scope }
			capital_scope = {
				add_deposit = d_dragon_monument
			}
		}
	}

	option = {
		name = leviathans.670.a
		trigger = {
			fromfrom = {
				NOT = {
					exists = leader
				}
			}
		}
		add_resource = { influence = 300 }
		add_relic = r_dragon_trophy
		if = { #maybe the Tiyanki accidentally killed them
			limit = { exists = capital_scope }
			capital_scope = {
				add_deposit = d_dragon_monument
			}
		}
	}
	option = {
		name = galactic_features.385.reanimated

		trigger = {
			is_reanimator_empire = yes
			fromfrom = {
				exists = leader
			}
		}

		enable_special_project = {
			name = "REANIMATE_GUARDIAN_DRAGON"
			location = fromfrom.solar_system.star
			owner = root.owner
		}
		fromfrom = {
			leader = {
				if = {
					limit = {
						leader_class = admiral
					}
					add_trait = leader_trait_dragonslayer
				}
				ELSE_IF = {
					limit = {
						leader_class = general
					}
					add_trait = leader_trait_dragonbane
				}
			}
		}
		add_resource = { influence = 300 }
		add_relic = r_dragon_trophy
		if = { #maybe the Tiyanki accidentally killed them
			limit = { exists = capital_scope }
			capital_scope = {
				add_deposit = d_dragon_monument
			}
		}
	}
	option = {
		name = galactic_features.385.reanimated

		trigger = {
			is_reanimator_empire = yes
			fromfrom = {
				NOT = {
					exists = leader
				}
			}
		}

		enable_special_project = {
			name = "REANIMATE_GUARDIAN_DRAGON"
			location = fromfrom.solar_system.star
			owner = root.owner
		}

		add_resource = { influence = 300 }
		add_relic = r_dragon_trophy
		if = { #maybe the Tiyanki accidentally killed them
			limit = { exists = capital_scope }
			capital_scope = {
				add_deposit = d_dragon_monument
			}
		}
	}
}

# Undead Armies Reanimation
country_event = {
	id = leviathans.675
	title = "distar.218.name"
	desc = "leviathans.675.desc"
	location = from

	is_triggered_only = yes

	picture = GFX_evt_space_dragon
	show_sound = event_mystic_reveal

	option = {
		name = "it_hungers"

		create_fleet = {
			name = "NAME_Avice"
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Avice"
					design = "NAME_Grand_Dragon"
					prefix = no
					upgradable = no
				}
				set_location = {
					target = from
					distance = 0
					angle = random
				}
				set_fleet_stance = passive
			}
			settings = {
				can_upgrade = no
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
				spawn_debris = no
			}
		}
	}
}




#Reanimated Armies: Reanimating the enemy's army as your own
#An army has been killed in ground combat
# This = owner
# From = army
# FromFrom = opponent
# FromFromFrom = planet
country_event = {
	id = necroids.15
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
		fromfrom = {
			is_reanimator_empire = yes
		}
		from = {
			exists = species
			species = {
				is_robotic = no
			}
		}
		NOT = { is_country_type = "gate_builders" }
	}

	immediate = {
		random_list = {
			2 = { }
			1 = {
				fromfromfrom = {
					create_army = {
						owner = root.fromfrom
						type = undead_army
						species = root.from.species
					}
				}
			}
		}
	}
}

