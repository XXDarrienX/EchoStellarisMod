##############################
# Astral Rift General Events #
##############################

namespace = astral_planes

# Formless Diplomacy
country_event = {
	id = astral_planes.3050
	title = NAME_Formless
	desc = {
		trigger = {
			NOT = { is_hostile = FROM }
		}
		text = astral_planes.3050.desc
	}
	desc = {
		trigger = {
			is_hostile = FROM
		}
		text = astral_planes.3102.desc.fail
	}

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "formless_diplomacy_window"
	location = event_target:formless_capital

	picture_event_data = {
		portrait = exd4
		room = "extradimensional_formless_room"
	}

	trigger = {
		has_astral_planes_dlc = yes
		FROM = {
			is_country_type = formless
		}
		NOT = { has_country_flag = the_formless_seal_is_set }
	}

	option = {
		name = astral_planes.3050.a
		custom_tooltip = astral_planes.3050.a.tt
		trigger = {
			any_situation = {
				is_situation_type = situation_the_seal
			}
			NOT = { is_hostile = FROM }
		}
		allow = {
			has_resource = { type = astral_threads amount >= 100 }
		}
		add_resource = { astral_threads = -100 }
		hidden_effect = {
			from = {
				spawn_formless_defense_fleet = {
					FLEET_FLAG = formless_diplomacy_defense_fleet
				}
			}
		}
	}

	option = {
		name = astral_planes.3050.b
		default_hide_option = yes
	}
}

country_event = {
	id = astral_planes.3151
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = formless
		has_country_flag = formless_war_state_initiated
	}

	immediate = {
		spawn_formless_defense_fleet = {
			FLEET_FLAG = formless_defense_fleet
			FLEET_SIZE = 50
		}
		country_event = {
			id = astral_planes.3151
			days = 360
		}
	}
}