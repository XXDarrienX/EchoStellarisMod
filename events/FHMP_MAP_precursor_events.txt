#

###############################################################################
#
# Precursor Introduction Events for the additional precursor ascension perk
#
###############################################################################

namespace = MAP_precursor_events

# Ixardian Introduction
country_event = {
	id = MAP_precursor_events.5
	title = "MAP_precursor_events.5.name"
	desc = "MAP_precursor_events.5.desc"
	picture = GFX_evt_relic_world_building
	show_sound = event_default
	location = from

	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_MAP_active = yes
		is_ai = no
		NOT = { has_global_flag = ixardian_started }
	}

	immediate = {
		FHMP_MAP_Precursor_Selection_Effect = { FLAG = precursor_ixardian_1 }
		set_global_flag = ixardian_started
		set_country_flag = ixardian_intro
		if = {
			limit = {
				NOT = { has_global_flag = Precursor_Selection_installed }
			}
			set_country_flag = vultaum_intro
		}
		random_system_within_border = {
			limit = {
				NOT = {
					has_star_flag = sol_system
				}
				has_star_flag = precursor_ixardian_1
				any_system_planet = {
					has_anomaly = no
					NOT = { exists = archaeological_site }
					NOT = { has_planet_flag = suppress_archaeological_sites }
					is_star = no
					FHMP_is_valid_precursor_planet = yes
				}
			}
			set_star_flag = first_ixardian_site@root
			random_system_planet = {
				limit = {
					has_anomaly = no
					NOT = { exists = archaeological_site }
					NOT = { has_planet_flag = suppress_archaeological_sites }
					is_star = no
					FHMP_is_valid_precursor_planet = yes
				}
				save_event_target_as = MAP_ixardian_digsite
				prevent_anomaly = yes
			}
		}
	}

	option = {
		name = CURIOUS
		event_target:MAP_ixardian_digsite = {
			hidden_effect = {
				prev = { country_event = { id = story.5 days = 30 } }
				create_archaeological_site = ixardian_digsite_1
			}
		}
	}
}

# Werediran Introduction
country_event = {
	id = MAP_precursor_events.6
	title = "MAP_precursor_events.6.name"
	desc = "MAP_precursor_events.6.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_MAP_active = yes
		is_ai = no
		NOT = { has_global_flag = werediran_started }
	}

	immediate = {
		FHMP_MAP_Precursor_Selection_Effect = { FLAG = precursor_werediran_1 }
		set_global_flag = werediran_started
		set_country_flag = werediran_intro
		if = {
			limit = {
				NOT = { has_global_flag = Precursor_Selection_installed }
			}
			set_country_flag = vultaum_intro
		}
		random_system_within_border = {
			limit = {
				NOT = {
					has_star_flag = sol_system
				}
				has_star_flag = precursor_werediran_1
				any_system_planet = {
					has_anomaly = no
					NOT = { exists = archaeological_site }
					NOT = { has_planet_flag = suppress_archaeological_sites }
					is_star = no
					OR = {
						is_planet_class = pc_alpine
						is_planet_class = pc_tropical
						is_planet_class = pc_continental
					}
				}
			}
			set_star_flag = first_werediran_site@root
			random_system_planet = {
				limit = {
					has_anomaly = no
					NOT = { exists = archaeological_site }
					NOT = { has_planet_flag = suppress_archaeological_sites }
					is_star = no
					OR = {
						is_planet_class = pc_alpine
						is_planet_class = pc_tropical
						is_planet_class = pc_continental
					}
				}
				save_event_target_as = MAP_werediran_digsite
				prevent_anomaly = yes
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:MAP_werediran_digsite }
			}
			random_system_within_border = {
				limit = {
					has_star_flag = precursor_werediran_1
					any_system_planet = {
						OR = {
							is_planet_class = pc_frozen
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
				}
				random_system_planet = {
					limit = {
						OR = {
							is_planet_class = pc_frozen
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					save_event_target_as = MAP_werediran_digsite
					prevent_anomaly = yes
				}
				set_star_flag = first_werediran_site@root
			}
		}
	}

	option = {
		name = CURIOUS
		event_target:MAP_werediran_digsite = {
			hidden_effect = {
				prev = { country_event = { id = story.5 days = 30 } }
				create_archaeological_site = werediran_digsite_1
				save_global_event_target_as = werediran_planet_1
			}
		}
	}
}

# Ezentian Introduction
country_event = {
	id = MAP_precursor_events.7
	title = "MAP_precursor_events.7.name"
	desc = "MAP_precursor_events.7.desc"
	picture = GFX_evt_egg_cracked
	show_sound = event_default
	location = from

	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_MAP_active = yes
		is_ai = no
		NOT = { has_global_flag = ezentian_started }
	}

	immediate = {
		FHMP_MAP_Precursor_Selection_Effect = { FLAG = precursor_ezentian_1 }
		set_global_flag = ezentian_started
		set_country_flag = ezentian_intro
		if = {
			limit = {
				NOT = { has_global_flag = Precursor_Selection_installed }
			}
			set_country_flag = vultaum_intro
		}
		random_system_within_border = {
			limit = {
				NOT = {
					has_star_flag = sol_system
				}
				has_star_flag = precursor_ezentian_1
				any_system_planet = {
					has_anomaly = no
					NOT = { exists = archaeological_site }
					NOT = { has_planet_flag = suppress_archaeological_sites }
					OR = {
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
					}
					NOT = { has_modifier = terraforming_candidate }
				}
			}
			set_star_flag = first_ezentian_site@root
			random_system_planet = {
				limit = {
					has_anomaly = no
					NOT = { exists = archaeological_site }
					NOT = { has_planet_flag = suppress_archaeological_sites }
					OR = {
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
					}
					NOT = { has_modifier = terraforming_candidate }
				}
				save_event_target_as = MAP_ezentian_digsite
				prevent_anomaly = yes
				change_pc = pc_broken
				set_planet_flag = FHMP_ezentian_planet_1
			}
		}
	}

	option = {
		name = CURIOUS
		event_target:MAP_ezentian_digsite = {
			hidden_effect = {
				prev = { country_event = { id = story.5 days = 30 } }
				create_archaeological_site = ezentian_digsite_1
				save_global_event_target_as = ezentian_planet_1
			}
		}
	}
}