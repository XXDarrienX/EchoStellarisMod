namespace = atx

# on_entering_system
fleet_event = {
	id = akx.9200
	title = akx.9200.name
	desc = akx.9200.desc
	picture = GFX_evt_space_debris
	show_sound = event_ship_bridge
	location = event_target:horizon_pod
	trackable = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
			has_country_flag = worm_events_available
			NOT = { has_country_flag = messenger_pod_found }
		}
		from = {
			NOR = {
				has_star_flag = guardian
				has_star_flag = hostile_system
			}
		}
	}

	immediate = {
		owner = { set_country_flag = messenger_pod_found }
		create_ambient_object = {
			type = loop_debris_02_object
			location = from
		}
		last_created_ambient_object = {
			save_event_target_as = horizon_pod
		}
	}

	option = {
		name = INTERESTING
		event_target:horizon_pod = {
			enable_special_project = {
				name = MESSENGER_POD_PROJECT_1
				location = this
				owner = root.owner
			}
		}
	}
}

# on fleet entering system
fleet_event = {
	id = akx.9300
	title = akx.9300.name
	desc = akx.9300.desc
	picture = GFX_evt_metropolis
	show_sound = event_ship_bridge
	location = root

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			has_country_flag = worm_events_available
			NOT = { has_country_flag = syzygy_encountered }
			any_owned_leader = {
				leader_class = admiral
			}
		}
	}

	immediate = {
		from = { save_global_event_target_as = syzygy_system }
		owner = {
			random_owned_leader = {
				limit = {
					leader_class = admiral
				}
				save_global_event_target_as = mirrored_syzygy_admiral
			}
			set_country_flag = syzygy_encountered
		}
	}

	option = {
		name = akx.9300.a.admiralabsent
		custom_tooltip = akx.9300.a.admiralabsent.tooltip
		trigger = {
			OR = {
				NOT = { exists = leader }
				NOT = {
					leader = {
						is_same_value = event_target:mirrored_syzygy_admiral
					}
				}
			}
		}
		hidden_effect = {
			owner = { country_event = { id = akx.9310 } }
		}
	}

	option = {
		name = akx.9300.a.admiralpresent
		custom_tooltip = akx.9300.a.admiralabsent.tooltip
		trigger = {
			exists = leader
			leader = {
				is_same_value = event_target:mirrored_syzygy_admiral
			}
		}
		hidden_effect = {
			owner = { country_event = { id = akx.9310 } }
		}
	}

	option = {
		name = akx.9300.b
		hidden_effect = {
			owner = { country_event = { id = akx.9315 } }
		}
	}
}

# on fleet entering technosphere system
fleet_event = {
	id = akx.9600
	title = akx.9600.name
	desc = akx.9600.desc
	location = root
	is_triggered_only = yes
	diplomatic = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
			has_country_flag = worm_events_available
			from = {
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_country_type = guardian_sphere
					}
				}
			}
			NOR = {
				has_country_flag = retainer_conversation
				has_country_flag = retainer_first_convo_concluded
			}
		}
	}

	picture_event_data = {
		room = technosphere_room
	}

	option = {
		name = akx.9600.a
		trigger = {
			owner = {
				NOT = { has_country_flag = retainer_questioned_brief }
			}
		}
		hidden_effect = {
			owner = { set_country_flag = retainer_questioned_brief }
			fleet_event = { id = akx.9601 }
		}
	}

	option = {
		name = akx.9600.b
		trigger = {
			owner = {
				NOT = { has_country_flag = retainer_questioned_loop }
			}
		}
		hidden_effect = {
			owner = { set_country_flag = retainer_questioned_loop }
			fleet_event = { id = akx.9602 }
		}
	}

	option = {
		name = akx.9600.c
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 800 }
				resource_stockpile_compare = { resource = minerals value >= 800 }
			}
		}
		owner = {
			add_resource = {
				energy = -800
				minerals = -800
			}
		}
		hidden_effect = {
			fleet_event = { id = akx.9620 }
		}
	}

	option = {
		name = akx.9600.d
		response_text = akx.9600.d.response
		default_hide_option = yes
		hidden_effect = {
			owner = {
				remove_country_flag = retainer_conversation
				set_country_flag = retainer_first_convo_concluded
			}
		}
	}

	option = {
		name = akx.9600.e
		response_text = akx.9600.e.response
		hidden_effect = {
			owner = {
				remove_country_flag = retainer_conversation
				set_country_flag = retainer_first_convo_concluded
			}
		}
	}
}

# triggered by on_entering_system_fleet
# chance to trigger the first time a player enters a black hole system
fleet_event = {
	id = akx.9000
	title = akx.9000.name
	desc = akx.9000.desc
	picture = GFX_evt_black_hole
	show_sound = event_alien_signal
	location = event_target:horizonsignal_black_hole
	trackable = yes

	is_triggered_only = yes

	fire_only_once = yes

	trigger = {
		NOT = { has_global_flag = akx.9000.fired }
		exists = owner
		owner = {
			is_ai = no
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		from = { # solar system scope
			is_star_class = sc_black_hole
			NOT = { has_star_flag = guardian }
			has_star_flag = horizonsignal_spawn
		}
		exists = leader
		leader = {
			leader_class = scientist
		}
	}

	immediate = {
		set_global_flag = akx.9000.fired
		solar_system = {
			set_star_flag = horizonsignal_system
			random_system_planet = {
				limit = {
					is_star = yes
				}
				save_global_event_target_as = horizonsignal_black_hole
			}
			save_global_event_target_as = horizonsignal_system
		}
		owner = { observer_event = { id = observer.70 } }
	}

	option = {
		name = OK
		from = {
			random_system_planet = {
				limit = {
					is_star = yes
				}
				enable_special_project = {
					name = HORIZON_SIGNAL_PROJECT
					location = this
					owner = root.owner
				}
			}
		}
	}
}