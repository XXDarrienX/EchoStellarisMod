################################
#
# Origin Events
# Written by Henrik Thyrwall
#
###############################

namespace = origin

# Scion Tasks
event = {
	id = origin.25
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			is_ai = no
			is_subject = yes
			any_agreement = {
				agreement_preset = preset_scion
			}
		}
	}

	immediate = {
		random_playable_country = {
			limit = {
				is_ai = no
				is_subject = yes
				any_agreement = {
					agreement_preset = preset_scion
				}
			}
			random_list = {
				10 = {}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = scion_requested_leader
							NOT = {
								any_owned_leader = {
									NOR = {
										leader_class = ruler
										has_leader_flag = fe_gifted_leader
									}
									has_skill >= 5
								}
							}
						}
					}
					country_event = { id = origin.26 }
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = scion_gave_leader
					}
					country_event = { id = origin.27 }
				}
				10 = {
					modifier = {
						factor = 0
						has_country_flag = scion_gave_ships
					}
					country_event = { id = origin.28 }
				}
			}
		}
	}
}

# Reward - Resources
country_event = {
	id = origin.24
	title = TRANSMISSION
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_2 }
		}
		text = "origin.21.a.desc"
	}
	desc = {
		trigger = {
			event_target:scion_master = { has_country_flag = fallen_empire_1 }
		}
		text = "origin.21.b.desc"
	}
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
	}

	option = {
		name = origin.21.a
		locked_random_list = {
			33 = { add_resource = { alloys = 8000 } }
			33 = { add_resource = { alloys = 7000 } }
			33 = { add_resource = { alloys = 6000 } }
			33 = { add_resource = { alloys = 5000 } }
			33 = { add_resource = { alloys = 4000 } }
			33 = { add_resource = { alloys = 3000 } }
			33 = { add_resource = { consumer_goods = 8000 } }
			33 = { add_resource = { consumer_goods = 7000 } }
			33 = { add_resource = { consumer_goods = 6000 } }
			33 = { add_resource = { consumer_goods = 5000 } }
			33 = { add_resource = { consumer_goods = 4000 } }
			33 = { add_resource = { consumer_goods = 3000 } }
		}
	}
}

# Reward: Receive Leader
country_event = {
	id = origin.27
	title = TRANSMISSION
	desc = "origin.27.desc"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}
	immediate = {
		overlord = {
			save_event_target_as = scion_master
			owner_species = { save_event_target_as = fe_species }
		}
		set_timed_country_flag = {
			days = 3600
			flag = scion_gave_leader
		}
	}
	option = {
		name = origin.27.a
		response_text = origin.27.a.response
		locked_random_list = {
			10 = {
				create_leader = {
					class = admiral
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.admiral
			}
			10 = {
				create_leader = {
					class = governor
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.governor
			}
			10 = {
				create_leader = {
					class = scientist
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.scientist
			}
			10 = {
				create_leader = {
					class = general
					species = event_target:fe_species
					name = random
					skill = 7
					traits = {
						trait = random_trait
					}
					effect = {
						set_leader_flag = fe_gifted_leader
					}
				}
				custom_tooltip = origin.27.general
			}
		}
	}
	option = {
		name = origin.27.b
		response_text = origin.27.b.response
	}
}

# Reward: Receive Ships
country_event = {
	id = origin.28
	title = TRANSMISSION
	desc = "origin.28.desc"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}

	immediate = {
		overlord = { save_event_target_as = scion_master }
		set_timed_country_flag = {
			days = 1800
			flag = scion_gave_ships
		}
	}
	option = {
		name = origin.28.a
		custom_tooltip = origin.28.tooltip
		capital_scope = {
			create_fleet = {
				settings = {
					spawn_debris = no
				}
				effect = {
					set_owner = event_target:scion_master # For ship names
					while = {
						count = 1
						create_fallen_empire_large_ship = yes
					}
					while = {
						count = 3
						create_fallen_empire_small_ship = yes
					}
					set_location = {
						target = prev
						distance = 45
						angle = random
					}
					set_owner = root
					add_modifier = {
						modifier = echo_Scion_balance
						days = -1
					}
				}
			}
		}
	}
}

# FE War Intervention
event = {
	id = origin.50
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			is_ai = no
			is_at_war = yes
			is_subject = yes
			overlord = { is_at_war = no }
			any_agreement = {
				agreement_preset = preset_scion
			}
			NOT = { has_country_flag = scion_war_help }
			OR = {
				any_war = {
					any_defender = {
						is_same_value = prevprev
					}
					any_attacker = {
						OR = {
							relative_power = {
								who = prevprev
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = prevprev
								category = fleet
								value = superior
							}
						}
					}
					defender_war_exhaustion > 0.8
					attacker_war_exhaustion < 0.6
				}
				any_war = {
					any_attacker = {
						is_same_value = prevprev
					}
					any_defender = {
						OR = {
							relative_power = {
								who = prevprev
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = prevprev
								category = fleet
								value = superior
							}
						}
					}
					attacker_war_exhaustion > 0.8
					defender_war_exhaustion < 0.6
				}
			}
		}
	}

	immediate = {
		random_playable_country = {
			limit = {
				is_ai = no
				agreement_preset = preset_scion
				is_at_war = yes
				overlord = { is_at_war = no }
				NOT = { has_country_flag = scion_war_help }
				OR = {
					any_war = {
						any_defender = {
							is_same_value = prevprev
						}
						any_attacker = {
							OR = {
								relative_power = {
									who = prevprev
									category = fleet
									value = overwhelming
								}
								relative_power = {
									who = prevprev
									category = fleet
									value = superior
								}
							}
						}
						defender_war_exhaustion > 0.8
						attacker_war_exhaustion < 0.6
					}
					any_war = {
						any_attacker = {
							is_same_value = prevprev
						}
						any_defender = {
							OR = {
								relative_power = {
									who = prevprev
									category = fleet
									value = overwhelming
								}
								relative_power = {
									who = prevprev
									category = fleet
									value = superior
								}
							}
						}
						attacker_war_exhaustion > 0.8
						defender_war_exhaustion < 0.6
					}
				}
			}
			country_event = { id = origin.51 }
		}
	}
}

# Reward: Receive Temporary FE Fleet
country_event = {
	id = origin.51
	title = TRANSMISSION
	desc = "origin.51.desc"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:scion_master
		planet_background = event_target:scion_master
		graphical_culture = event_target:scion_master
		city_level = event_target:scion_master
		room = event_target:scion_master
	}
	immediate = {
		overlord = { 
			save_event_target_as = scion_master
			owner_species = { save_event_target_as = fe_species }
		}
		set_timed_country_flag = { flag = scion_war_help days = 7200 } # 20 year cooldown
	}
	option = {
		name = origin.51.a
		hidden_effect = {
			if = {
				limit = { scion_losing_defensive_war = yes }
				random_country = {
					limit = {
						NOT = { is_same_value = root}
						is_at_war = yes
						is_at_war_with = root
						scion_losing_defensive_war_combatant = yes
						OR = {
							relative_power = {
								who = root
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = root
								category = fleet
								value = superior
							}
						}
					}
					scion_fe_intervention = yes
				}
			}
			else_if = {
				limit = { scion_losing_offensive_war = yes }
				random_country = {
					limit = {
						NOT = { is_same_value = root}
						is_at_war = yes
						is_at_war_with = root
						scion_losing_offensive_war_combatant = yes
						OR = {
							relative_power = {
								who = root
								category = fleet
								value = overwhelming
							}
							relative_power = {
								who = root
								category = fleet
								value = superior
							}
						}
					}
					scion_fe_intervention = yes
				}

			}
		}
	}
}