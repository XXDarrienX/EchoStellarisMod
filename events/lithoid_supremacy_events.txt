#Lithoid Supremacy Events
namespace = lithoidsupremacy

#Event 00: Game has Lithoid Supremacy
event = {
	id = lithoidsupremacy.00
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { set_global_flag = lithoidsupremacy }
}

#Event 1: Geode world DM deficit consequences
country_event = {
	id = lithoidsupremacy.1
	hide_window = yes
	is_triggered_only = yes

	#Triggers on DM deficit (has 0 of resouce and gain is negative)
	trigger = {
		has_resource = { type = sr_dark_matter amount = 0 }
		has_monthly_income = { resource = sr_dark_matter  value < 0 }
	}

	#Causes 5 monthly devastation to owned geode worlds (That are not the Origin world)
	immediate = {
		every_owned_planet = {
			limit = {
				is_planet_class = pc_geode
				has_deposit = d_geode_world_maintenance
			}
			add_planet_devastation = 5
		}
	}
}

#Event 2: Geode World Origin Setup
planet_event = {
	id = lithoidsupremacy.2
	is_triggered_only = yes
	hide_window = yes

	pre_triggers = {
		has_owner = yes
	}

	#Checks owner has the correct origin
	trigger = {
		owner = { has_origin = origin_geode_world }
	}
	
	immediate = {
		#Set planet size as 25 (Boosted to 32 with the deposit later)
		set_planet_size = 25

		#Declare origin world
		set_planet_flag = lithoid_supremacy_geode_origin

		#Guilli's compatibility
		set_planet_flag = forbid_guillis_planet_modifiers
		
		#Create the ambient shattered section
		create_ambient_object = {
			location = this
			type = "lithoid_supremacy_geode_object"

			use_3d_location= yes

			entity_offset = 0
			entity_offset_angle = 0
			entity_offset_height = 0
			base_angle_towards = star
			entity_face_object = star

			entity_scale_to_size = no #yes
			scale = 16
			#0.5 by default
			#0.3 is under planet mesh
		}
		
		#Add Modifier
		add_modifier = { modifier = geode_world days = -1 }

		#Add Deposits
		add_deposit = d_expanded_lithosphere
		add_deposit = d_geode_world_origin_maintenance

		# Add Districts using event not deposit - Not used since it requires day 2 to trigger
		# while = {
		# 	count = 9
		# 	add_district = district_mining
		# 	add_district = district_generator
		# }

		# while = {
		# 	count = 6
		# 	add_district = district_farming
		# }
		
		#give the rare crystal tech
		owner = {
			give_technology = { message = no tech = tech_mine_rare_crystals }
		}
	}
}

#Event 3: Fix for PD Geode Origin, creates deposits if not created
country_event = {
	id = lithoidsupremacy.3
	hide_window = yes
	is_triggered_only = yes

	#Triggers on DM deficit (has 0 of resouce and gain is negative)
	trigger = {
		exists = owner
		owner = { has_origin = origin_geode_world }
		home_planet = {
			NOR = {
				has_deposit = d_expanded_lithosphere
				has_deposit = d_geode_world_origin_maintenance
			}
		}
	}

	#Causes 5 monthly devastation to owned geode worlds (That are not the Origin world)
	immediate = {
		home_planet = {
			add_deposit = d_expanded_lithosphere
			add_deposit = d_geode_world_origin_maintenance
		}
	}
}

#Event 4: Set Lithoid Empire Flag
country_event = {
	id = lithoidsupremacy.4
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		owner = {
			is_lithoid_empire = yes
		}
	}

	immediate = {
		set_country_flag = lithoidempire
	}
}

#Event 5: Add Leader Traits
country_event = {
	id = lithoidsupremacy.5
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		every_owned_leader = {
			add_leader_traits_after_modification_lithoid_supremacy = yes
			remove_leader_traits_after_modification_lithoid_supremacy = yes
	}

		every_pool_leader = {
			add_leader_traits_after_modification_lithoid_supremacy = yes
			remove_leader_traits_after_modification_lithoid_supremacy = yes
		}
	}
}

#Event 6: Pearl Born Spawn
planet_event = {
	id = lithoidsupremacy.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = { has_origin = origin_pearl_born }
	}

	immediate = { lithoid_supremacy_generate_start_pops = yes }
}

#Event 7: Switch one mining district to farming if Mossy Symbiosis/Pearl Born is present
planet_event = {
	id = lithoidsupremacy.7
	is_triggered_only = yes
	hide_window = yes

	pre_triggers = {
		has_owner = yes
	}

	#Checks owner has the correct origin/traits
	trigger = {
		owner = { 
			species = {
				OR = {
					has_trait = trait_mossy_symbiosis
					has_trait = trait_pearl_born_drone
					has_trait = trait_pearl_born_royal
				}
			} 
		}
	}
	
	immediate = {
		#Add hydrofarm to voiddwellers
		if = {
			limit = {
				is_planet_class = pc_habitat 
			}
			add_building = building_hydroponics_farm
		}
		#Swap shattered ring mining to farming
		if = {
			limit = {
				owner = {
					has_origin = origin_shattered_ring
				}
			}
			add_district = district_farming_uncapped
			remove_district = district_mining_uncapped
		}
		#Swap planet mining district to farming
		if = {
			limit = {
				is_artificial = no
			}
			add_district = district_farming
			remove_district = district_mining 
		}
		#Add spawning pool for pearlborn
		if = {
			limit = {
				owner = {
					has_origin = origin_pearl_born
				}
			}
			add_building = building_ocean_spawning_pool
		}
	}
}

#Event 8: Meteor ship Buff [Part 1]
planet_event = {
	id = lithoidsupremacy.8
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = FROM
		exists = owner

		FROM = { is_ship_size = lithoid_colonizer }
		owner = { has_origin = origin_lithoid }
		owner = { has_technology = tech_advanced_meteor_ship }

		#NOT = { has_modifier = lithoid_crater } #Planet will immediately get this modifier
	}

	immediate = {
		add_deposit = d_buried_lithoids
		set_planet_flag = advanced_meteor_colonization
	}
}

#Event 9: Meteor ship Buff [Part 2]
planet_event = {
	id = lithoidsupremacy.9
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		planet = {
			has_planet_flag = advanced_meteor_colonization
		}
	}

	immediate = {
		create_pop = { species = owner }
		remove_planet_flag = advanced_meteor_colonization
	}
}