namespace = cara

#################################
# Caravaneer Events
# scripted by Maximilian Olbers
#################################

#@fleet1dealdecay = 3600
@fleet2dealdecay = 3600
@fleet3dealdecay = 3600

# Home - Lootbox Opened, cara.310
country_event = {
	id = cara.310
	title = cara_home_lootbox.title
	desc = {
		trigger = { has_country_flag = recent_empty_lootbox }
		text = openedlootboxdesc1
	}
	desc = {
		trigger = {
			has_country_flag = recent_galatron
			NOT = { has_modifier = galatron_modifier }
		}
		text = lootbox_contents_galatron
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_a }
								text = lootbox_contents_a
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_b country_uses_consumer_goods = yes }
								text = lootbox_contents_b
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_b country_uses_consumer_goods = no }
								text = lootbox_contents_b_gest
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_c }
								text = lootbox_contents_c
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_d is_machine_empire = no }
								text = lootbox_contents_d
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_d is_machine_empire = yes }
								text = lootbox_contents_d_mach
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_e }
								text = lootbox_contents_e
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_f }
								text = lootbox_contents_f
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_g }
								text = lootbox_contents_g
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_h }
								text = lootbox_contents_h
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_i }
								text = lootbox_contents_i
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_j }
								text = lootbox_contents_j
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_k }
								text = lootbox_contents_k
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_l }
								text = lootbox_contents_l
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_m }
								text = lootbox_contents_m
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_n }
								text = lootbox_contents_n
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_mod_a }
								text = lootbox_contents_mod_a
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_mod_b }
								text = lootbox_contents_mod_b
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_mod_c }
								text = lootbox_contents_mod_c
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_mod_d }
								text = lootbox_contents_mod_d
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_mod_e }
								text = lootbox_contents_mod_e
	}
	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"
	show_sound = event_lootbox_good

	picture_event_data = {
		portrait = event_target:caravaneer_home_country.ruler
		room = caravaneer_lootbox_room
		planet_background = pc_barren_cold
	}

	immediate = {
		random_list = {
			# Galatron
			1 = {
				modifier = {
					factor = 0
					any_playable_country = {
						has_modifier = galatron_modifier
					}
				}
				set_country_flag = recent_galatron
				set_country_flag = galatron_owner
			}
			# Empty
			59 = {
				modifier = {
					factor = 0
					has_country_flag = opened_empty_lootbox
				}
				custom_tooltip = lootbox_contents_empty
				set_country_flag = opened_empty_lootbox
				set_country_flag = recent_empty_lootbox
			}
			# Regular contents
			140 = {
				random_list = {
					100 = {
						modifier = {
							factor = 0
							capital_scope = {
								OR = {
									has_modifier = ancient_trade_route
									has_modifier = ancient_trade_route_gestalt
								}
							}
						}
						set_country_flag = lootbox_contents_a
					}
					100 = { set_country_flag = lootbox_contents_b }
					100 = { set_country_flag = lootbox_contents_c }
					100 = { set_country_flag = lootbox_contents_d }
					100 = { set_country_flag = lootbox_contents_e }
					100 = {
						modifier = {
							factor = 0
							country_uses_food = no
						}
						set_country_flag = lootbox_contents_f
					}
					100 = { set_country_flag = lootbox_contents_g }
					100 = { set_country_flag = lootbox_contents_h }
					100 = { set_country_flag = lootbox_contents_i }
					100 = { set_country_flag = lootbox_contents_j }
					100 = { set_country_flag = lootbox_contents_k }
					1 = {
						modifier = {
							factor = 0
							exists = ruler
							ruler = {
								OR = {
									has_trait = leader_trait_ruler_psionic
									has_trait = leader_trait_ruler_cyborg
									has_trait = leader_trait_ruler_synthetic
									has_trait = leader_trait_ruler_machine_intelligence
								}
							}
						}
						set_country_flag = lootbox_contents_l
					}
					100 = { set_country_flag = lootbox_contents_m }
					100 = { set_country_flag = lootbox_contents_n }
					25 = { set_country_flag = lootbox_contents_mod_a }
					25 = { set_country_flag = lootbox_contents_mod_b }
					25 = { set_country_flag = lootbox_contents_mod_c }
					25 = { set_country_flag = lootbox_contents_mod_d }
					100 = {
						set_country_flag = lootbox_contents_mod_e
						modifier = {
							factor = 0
							has_ancrel = no
						}
					}
				}
			}
		}
	}

	after = {
		hidden_effect = {
			if = {
				limit = {
					check_variable = {
						which = num_lootboxes
						value <= 0
					}
				}
				set_variable = {
					which = num_lootboxes
					value = 1
				}
			}
			else = {
				change_variable = {
					which = num_lootboxes
					value = 1
				}
			}
			switch = {
				trigger = has_country_flag
				lootbox_contents_a = { remove_country_flag = lootbox_contents_a }
				lootbox_contents_b = { remove_country_flag = lootbox_contents_b }
				lootbox_contents_c = { remove_country_flag = lootbox_contents_c }
				lootbox_contents_d = { remove_country_flag = lootbox_contents_d }
				lootbox_contents_e = { remove_country_flag = lootbox_contents_e }
				lootbox_contents_f = { remove_country_flag = lootbox_contents_f }
				lootbox_contents_g = { remove_country_flag = lootbox_contents_g }
				lootbox_contents_h = { remove_country_flag = lootbox_contents_h }
				lootbox_contents_i = { remove_country_flag = lootbox_contents_i }
				lootbox_contents_j = { remove_country_flag = lootbox_contents_j }
				lootbox_contents_k = { remove_country_flag = lootbox_contents_k }
				lootbox_contents_l = { remove_country_flag = lootbox_contents_l }
				lootbox_contents_m = { remove_country_flag = lootbox_contents_m }
				lootbox_contents_n = { remove_country_flag = lootbox_contents_n }
				lootbox_contents_mod_a = { remove_country_flag = lootbox_contents_mod_a }
				lootbox_contents_mod_b = { remove_country_flag = lootbox_contents_mod_b }
				lootbox_contents_mod_c = { remove_country_flag = lootbox_contents_mod_c }
				lootbox_contents_mod_d = { remove_country_flag = lootbox_contents_mod_d }
				lootbox_contents_mod_e = { remove_country_flag = lootbox_contents_mod_e }
				lootbox_contents_p = { remove_country_flag = recent_empty_lootbox }
			}
			if = {
				limit = {
					has_country_flag = recent_galatron
					NOT = { has_modifier = galatron_modifier }
				}
				remove_country_flag = recent_galatron
				country_event = { id = cara.320 }
			}
			else = {
				cara_home_return = yes
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = OK

		hidden_effect = {
			set_timed_country_flag = {
				flag = lootboxed_recently
				days = 500
			}
			if = {
				limit = {
					has_country_flag = recent_galatron
					NOT = { has_modifier = galatron_modifier }
				}
				custom_tooltip = lootbox_contents_galatron
			}
			else_if = {
				limit = { has_country_flag = recent_empty_lootbox }
				custom_tooltip = lootbox_contents_empty
				remove_country_flag = recent_empty_lootbox
			}
			else = {
				switch = {
					trigger = has_country_flag
					lootbox_contents_a = {
						if = {
							limit = { is_gestalt = no }
							capital_scope = { add_modifier = { modifier = ancient_trade_route days = -1 } }
							tooltip = {
								capital_scope = { add_modifier = { modifier = ancient_trade_route days = -1 } }
							}
						}
						else = {
							capital_scope = { add_modifier = { modifier = ancient_trade_route_gestalt days = -1 } }
							tooltip = {
								capital_scope = { add_modifier = { modifier = ancient_trade_route_gestalt days = -1 } }
							}
						}
					}
					lootbox_contents_b = {
						if = {
							limit = { country_uses_consumer_goods = yes }
							add_monthly_resource_mult = {
								resource = consumer_goods
								value = 6
								min = 100
							}
							tooltip = {
								add_monthly_resource_mult = {
									resource = consumer_goods
									value = 6
									min = 100
								}
							}
						}
						else = {
							add_monthly_resource_mult = {
								resource = energy
								value = 9
								min = 200
							}
							tooltip = {
								add_monthly_resource_mult = {
									resource = energy
									value = 9
									min = 200
								}
							}
						}
					}
					lootbox_contents_c = {
						custom_tooltip = lootbox_contents_c.tooltip
						add_monthly_resource_mult = {
							resource = engineering_research
							value = 12
							min = 1000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = engineering_research
								value = 12
								min = 1000
							}
						}
					}
					lootbox_contents_d = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_e = {
						custom_tooltip = lootbox_contents_e.tooltip
						add_monthly_resource_mult = {
							resource = engineering_research
							value = 12
							min = 1000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = engineering_research
								value = 12
								min = 1000
							}
						}
					}
					lootbox_contents_f = {
						add_monthly_resource_mult = {
							resource = food
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = food
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_g = {
						custom_tooltip = lootbox_contents_g.tooltip
						add_monthly_resource_mult = {
							resource = society_research
							value = 12
							min = 1000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 12
								min = 1000
							}
						}
					}
					lootbox_contents_h = {
						if = {
							limit = { country_uses_consumer_goods = yes }
							add_monthly_resource_mult = {
								resource = consumer_goods
								value = 8
								min = 2000
							}
							tooltip = {
								add_monthly_resource_mult = {
									resource = consumer_goods
									value = 8
									min = 2000
								}
							}
						}
						else = {
							add_monthly_resource_mult = {
								resource = minerals
								value = 12
								min = 4000
							}
							tooltip = {
								add_monthly_resource_mult = {
									resource = minerals
									value = 12
									min = 4000
								}
							}
						}
					}
					lootbox_contents_i = {
						add_resource = { energy = 4000 }
						add_resource = { minerals = 4000 }
						tooltip = {
							add_resource = { energy = 4000 }
							add_resource = { minerals = 4000 }
						}
					}
					lootbox_contents_j = {
						add_monthly_resource_mult = {
							resource = engineering_research
							value = 25
							min = 2000
							max = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = engineering_research
								value = 25
								min = 2000
								max = 2000
							}
						}
					}
					lootbox_contents_k = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 25
							min = 1000
							max = 1000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 25
								min = 1000
								max = 1000
							}
						}
					}
					lootbox_contents_l = {
						ruler = { add_trait = leader_trait_ruler_psionic }
						tooltip = { ruler = { add_trait = leader_trait_ruler_psionic } }
					}
					lootbox_contents_m = {
						add_monthly_resource_mult = {
							resource = physics_research
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = physics_research
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_n = {
						add_monthly_resource_mult = {
							resource = alloys
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = alloys
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_mod_a = {
						add_resource = { sr_zro = 50 }
						tooltip = {
							add_resource = { sr_zro = 50 }
						}
					}
					lootbox_contents_mod_b = {
						add_resource = { exotic_gases = 200 }
						tooltip = {
							add_resource = { exotic_gases = 200 }
						}
					}
					lootbox_contents_mod_c = {
						add_resource = { rare_crystals = 200 }
						tooltip = {
							add_resource = { rare_crystals = 200 }
						}
					}
					lootbox_contents_mod_d = {
						add_resource = { volatile_motes = 200 }
						tooltip = {
							add_resource = { volatile_motes = 200 }
						}
					}
					lootbox_contents_mod_e = {
						add_resource = { minor_artifacts = 10 }
						tooltip = {
							add_resource = { minor_artifacts = 10 }
						}
					}
				}
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = cara_home_exit
		trigger = { always = no } # just here to for the X button
		default_hide_option = yes
	}
}

# Fleet 1 - Deals, cara.1200
country_event = {
	id = cara.1200
	title = cara_fleet1_deals.title
	desc = fleet1dealdesc1

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"

	picture_event_data = {
		portrait = event_target:caravaneer_fleet1_country
		room = ethic_spaceship_room
	}

	immediate = {
		cara_generate_deal1 = yes
	}

	option = {
		name = cara_fleet1_take_deal
		allow = { cara_allow_deal1 = yes }
		cara_execute_deal1 = yes
		response_text = "cara_fleet1_dealtaken"
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = fleet1getback
		response_text = fleet1getbackreply
		hidden_effect = {
			set_country_flag = cara_fleet1_getback
		}
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = cara_fleet1_exit
		default_hide_option = yes
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			remove_country_flag = fleet1dealcost1
			remove_country_flag = fleet1dealcost2
			remove_country_flag = fleet1dealcost3
			remove_country_flag = fleet1dealcost4
			remove_country_flag = fleet1dealcost5
			remove_country_flag = fleet1dealcost6
			remove_country_flag = fleet1dealcostmod1
			remove_country_flag = fleet1dealcostmod2
			remove_country_flag = fleet1dealcostmod3
			remove_country_flag = fleet1dealproduct1
			remove_country_flag = fleet1dealproduct2
			remove_country_flag = fleet1dealproduct3
			remove_country_flag = fleet1dealproduct4
			remove_country_flag = fleet1dealproduct5
			remove_country_flag = fleet1dealproduct6
			remove_country_flag = fleet1dealproduct7
			remove_country_flag = fleet1dealproductmod1
			remove_country_flag = fleet1dealproductmod2
			remove_country_flag = fleet1dealproductmod3
			remove_country_flag = fleet1dealproductmod4
			remove_country_flag = fleet1dealproductmod5
			remove_country_flag = fleet1dealproductmod6
			remove_country_flag = fleet1dealproductmod7
			remove_country_flag = fleet1dealproductmod8
		}
	}
}

# Fleet 1 - Re-offer deal, cara.1251
country_event = {
	id = cara.1251
	title = cara_fleet1_redeals.title
	desc = fleet1redealdesc1
	desc = fleet1redealdesc2
	desc = fleet1redealdesc3
	desc = fleet1redealdesc4
	desc = fleet1redealdesc5

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"

	picture_event_data = {
		portrait = event_target:caravaneer_fleet1_country
		room = ethic_spaceship_room
	}

	trigger = {
		caravaneer_fleet1_active_diplo = no
	}

	immediate = {
		remove_country_flag = cara_fleet1_getback
		cara_generate_deal1 = yes
	}

	option = {
		name = cara_fleet1_take_deal
		allow = { cara_allow_deal1 = yes }
		cara_execute_deal1 = yes
		response_text = "cara_fleet1_dealtaken"
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = cara_fleet1_exit
		default_hide_option = yes
		custom_gui = "enclave_caravaneer_option"
		hidden_effect = {
			remove_country_flag = fleet1dealcost1
			remove_country_flag = fleet1dealcost2
			remove_country_flag = fleet1dealcost3
			remove_country_flag = fleet1dealcost4
			remove_country_flag = fleet1dealcost5
			remove_country_flag = fleet1dealcost6
			remove_country_flag = fleet1dealcostmod1
			remove_country_flag = fleet1dealcostmod2
			remove_country_flag = fleet1dealcostmod3
			remove_country_flag = fleet1dealproduct1
			remove_country_flag = fleet1dealproduct2
			remove_country_flag = fleet1dealproduct3
			remove_country_flag = fleet1dealproduct4
			remove_country_flag = fleet1dealproduct5
			remove_country_flag = fleet1dealproduct6
			remove_country_flag = fleet1dealproduct7
			remove_country_flag = fleet1dealproductmod1
			remove_country_flag = fleet1dealproductmod2
			remove_country_flag = fleet1dealproductmod3
			remove_country_flag = fleet1dealproductmod4
			remove_country_flag = fleet1dealproductmod5
			remove_country_flag = fleet1dealproductmod6
			remove_country_flag = fleet1dealproductmod7
			remove_country_flag = fleet1dealproductmod8
		}
	}
}

# Fleet 2 - Deals, cara.2200
country_event = {
	id = cara.2200
	title = cara_fleet2_deals.title
	desc = {
		text = fleet2dealdesc1
		trigger = {
			has_country_flag = fleet2deal1
		}
	}
	desc = {
		text = fleet2dealdesc2
		trigger = {
			has_country_flag = fleet2deal2
		}
	}
	desc = {
		text = fleet2dealdesc3
		trigger = {
			has_country_flag = fleet2deal3
		}
	}
	desc = {
		text = fleet2dealdesc4
		trigger = {
			has_country_flag = fleet2deal4
		}
	}
	desc = {
		text = fleet2dealdesc5
		trigger = {
			has_country_flag = fleet2deal5
		}
	}
	desc = {
		text = fleet2dealdesc6
		trigger = {
			has_country_flag = fleet2deal6
		}
	}
	desc = {
		text = fleet2dealdesc7
		trigger = {
			has_country_flag = fleet2deal7
		}
	}
	desc = {
		text = fleet2dealdesc8
		trigger = {
			has_country_flag = fleet2deal8
		}
	}
	desc = {
		text = fleet2dealdesc9
		trigger = {
			has_country_flag = fleet2deal9
		}
	}
	desc = {
		text = fleet2dealdesc10
		trigger = {
			has_country_flag = fleet2deal10
		}
	}
	desc = {
		text = fleet2dealdesc11.a
		trigger = {
			has_country_flag = fleet2deal11.a
		}
	}
	desc = {
		text = fleet2dealdesc11.b
		trigger = {
			has_country_flag = fleet2deal11.b
		}
	}
	desc = {
		text = fleet2dealdesc11.c
		trigger = {
			has_country_flag = fleet2deal11.c
		}
	}
	desc = {
		text = fleet2dealdesc12
		trigger = {
			has_country_flag = fleet2deal12
		}
	}
	desc = {
		text = fleet2dealdescmod1
		trigger = {
			has_country_flag = fleet2dealmod1
		}
	}
	desc = {
		text = fleet2dealdescmod2
		trigger = {
			has_country_flag = fleet2dealmod2
		}
	}
	desc = {
		text = fleet2dealdescmod3
		trigger = {
			has_country_flag = fleet2dealmod3
		}
	}
	desc = {
		text = fleet2dealdescmod4
		trigger = {
			has_country_flag = fleet2dealmod4
		}
	}
	

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"

	picture_event_data = {
		portrait = event_target:caravaneer_fleet2_country
		room = ethic_spaceship_room
	}

	immediate = {
		cara_generate_deal2 = yes
	}

	option = {
		name = cara_fleet2_take_deal
		allow = { cara_allow_deal2 = yes }
		cara_execute_deal2 = yes
		response_text = "cara_fleet2_dealtaken"
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = fleet2getback
		response_text = fleet2getbackreply
		hidden_effect = {
			set_country_flag = cara_fleet2_getback
		}
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = cara_fleet2_exit
		hidden_effect = {
			while = { #Clear Fleet 2 deal planet flags with added failsafe
				limit = {
					any_owned_planet = {
						OR = {
							has_planet_flag = fleet2deal8planet
							has_planet_flag = fleet2deal9planet
						}
					}
				}
				random_owned_planet = {
					limit = {
						OR = {
							has_planet_flag = fleet2deal8planet
							has_planet_flag = fleet2deal9planet
						}
					}
					switch = {
						trigger = has_planet_flag
						fleet2deal8planet = { remove_planet_flag = fleet2deal8planet }
						fleet2deal9planet = { remove_planet_flag = fleet2deal9planet }
					}
				}
			}
		}
		default_hide_option = yes
		custom_gui = "enclave_caravaneer_option"
	}
}

# Fleet 2 - Re-offer deal, cara.2251
country_event = {
	id = cara.2251
	title = cara_fleet2_redeals.title
	desc = fleet2redealdesc1
	desc = fleet2redealdesc2
	desc = fleet2redealdesc3
	desc = fleet2redealdesc4
	desc = fleet2redealdesc5

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"

	picture_event_data = {
		portrait = event_target:caravaneer_fleet2_country
		room = ethic_spaceship_room
	}

	trigger = {
		caravaneer_fleet2_active_diplo = no
	}

	immediate = {
		remove_country_flag = cara_fleet2_getback
		cara_generate_deal2 = yes
		switch = {
			trigger = has_country_flag
			fleet2deal8 = {
				random_owned_planet = {
					limit = { has_planet_flag = fleet2deal8planet }
					save_event_target_as = fleet2deal8planet
				}
			}
			fleet2deal9 = {
				random_owned_planet = {
					limit = { has_planet_flag = fleet2deal9planet }
					save_event_target_as = fleet2deal9planet
				}
			}
		}
	}

	option = {
		name = cara_fleet2_take_deal
		allow = { cara_allow_deal2 = yes }
		cara_execute_deal2 = yes
		response_text = "cara_fleet2_dealtaken"
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = cara_fleet2_exit
		hidden_effect = {
			while = { #Clear Fleet 2 deal planet flags with added failsafe
				limit = {
					any_owned_planet = {
						OR = {
							has_planet_flag = fleet2deal8planet
							has_planet_flag = fleet2deal9planet
						}
					}
				}
				random_owned_planet = {
					limit = {
						OR = {
							has_planet_flag = fleet2deal8planet
							has_planet_flag = fleet2deal9planet
						}
					}
					switch = {
						trigger = has_planet_flag
						fleet2deal8planet = { remove_planet_flag = fleet2deal8planet }
						fleet2deal9planet = { remove_planet_flag = fleet2deal9planet }
					}
				}
			}
			remove_country_flag = fleet2deal1
			remove_country_flag = fleet2deal2
			remove_country_flag = fleet2deal3
			remove_country_flag = fleet2deal4
			remove_country_flag = fleet2deal5
			remove_country_flag = fleet2deal6
			remove_country_flag = fleet2deal7
			remove_country_flag = fleet2deal8
			remove_country_flag = fleet2deal9
			remove_country_flag = fleet2deal10
			remove_country_flag = fleet2deal11.a
			remove_country_flag = fleet2deal11.b
			remove_country_flag = fleet2deal11.c
			remove_country_flag = fleet2deal12
			remove_country_flag = fleet2dealmod1
			remove_country_flag = fleet2dealmod2
			remove_country_flag = fleet2dealmod3
			remove_country_flag = fleet2dealmod4
		}
		default_hide_option = yes
		custom_gui = "enclave_caravaneer_option"
	}
}

# Fleet 3 - Deals, cara.3200
country_event = {
	id = cara.3200
	title = cara_fleet3_deals.title
	desc = {
		trigger = { has_country_flag = fleet3deal1 }
		text = fleet3dealdesc1 #Selling minerals
	}
	desc = {
		trigger = { has_country_flag = fleet3deal2 }
		text = fleet3dealdesc2 #Selling Racket leader
	}
	desc = {
		trigger = { has_country_flag = fleet3deal3 is_robot_empire = yes }
		text = fleet3dealdesc3machi #Selling pops, MI
	}
	desc = {
		trigger = { has_country_flag = fleet3deal3 is_robot_empire = no }
		text = fleet3dealdesc3 #Selling pops, regular
	}
	desc = {
		trigger = { has_country_flag = fleet3deal4 }
		text = fleet3dealdesc4 #Selling alloy/gas/living metal
	}
	desc = {
		trigger = { has_country_flag = fleet3deal5 NOT = { has_ethic = ethic_gestalt_consciousness } }
		text = fleet3dealdesc5 #Selling unique building
	}
	desc = {
		trigger = { has_country_flag = fleet3deal5 has_ethic = ethic_gestalt_consciousness }
		text = fleet3dealdesc5_gesta #Selling unique building GC
	}
	desc = {
		trigger = { has_country_flag = fleet3deal6 }
		text = fleet3dealdesc6 #Selling unique ship weapons tech
	}
	desc = {
		trigger = { has_country_flag = fleet3deal7 }
		text = fleet3dealdesc7 #Selling energy mining platform "upgrade" (planetary energy deposit)
	}
	desc = {
		trigger = { has_country_flag = fleet3deal8 }
		text = fleet3dealdesc8 #Selling tech drone planet mod
	}
	desc = {
		trigger = { has_country_flag = fleet3deal9 }
		text = fleet3dealdesc9 #Selling Racket Caravan Destroyer
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod1 }
		text = fleet3dealdescmod1 #Selling munitions
	
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod2 }
		text = fleet3dealdescmod2 #Selling minerals (machine)
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod3 }
		text = fleet3dealdescmod3 #Precursor artifacts
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod4 }
		text = fleet3dealdescmod4 #Mineral Sniffer
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod5 }
		text = fleet3dealdescmod5 #Minor Artifacts
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod6 }
		text = fleet3dealdescmod6 #Scavengers
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod7 }
		text = fleet3dealdescmod7 #Intel
	}

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"

	picture_event_data = {
		portrait = event_target:caravaneer_fleet3_country
		room = ethic_spaceship_room
	}

	immediate = {
		cara_generate_deal3 = yes
	}

	option = {
		name = cara_fleet3_take_deal
		allow = { cara_allow_deal3 = yes }
		cara_execute_deal3 = yes
		response_text = "cara_fleet3_dealtaken"
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = fleet3getback
		response_text = fleet3getbackreply
		hidden_effect = {
			set_country_flag = cara_fleet3_getback
		}
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = cara_fleet3_exit
		hidden_effect = {
			while = { #Clear Fleet 3 deal planet flags with added failsafe
				limit = {
					any_planet_within_border = {
						OR = {
							has_planet_flag = fleet3deal3planet
							has_planet_flag = fleet3deal7planet
							has_planet_flag = fleet3deal8planet
						}
					}
				}
				random_planet_within_border = {
					limit = {
						OR = {
							has_planet_flag = fleet3deal3planet
							has_planet_flag = fleet3deal7planet
							has_planet_flag = fleet3deal8planet
						}
					}
					switch = {
						trigger = has_planet_flag
						fleet3deal3planet = { remove_planet_flag = fleet3deal3planet }
						fleet3deal7planet = { remove_planet_flag = fleet3deal7planet }
						fleet3deal8planet = { remove_planet_flag = fleet3deal8planet }
					}
				}
			}
		}
		default_hide_option = yes
		custom_gui = "enclave_caravaneer_option"
	}
}

# Fleet 3 - Re-offer deal, cara.3251
country_event = {
	id = cara.3251
	title = cara_fleet3_redeals.title
	desc = {
		trigger = { has_country_flag = fleet3deal1 }
		text = fleet3dealdesc1 #Selling minerals
	}
	desc = {
		trigger = { has_country_flag = fleet3deal2 }
		text = fleet3dealdesc2 #Selling Racket leader
	}
	desc = {
		trigger = { has_country_flag = fleet3deal3 is_robot_empire = yes }
		text = fleet3dealdesc3machi #Selling pops, MI
	}
	desc = {
		trigger = { has_country_flag = fleet3deal3 is_robot_empire = no }
		text = fleet3dealdesc3 #Selling pops, regular
	}
	desc = {
		trigger = { has_country_flag = fleet3deal4 }
		text = fleet3dealdesc4 #Selling alloy/gas/living metal
	}
	desc = {
		trigger = { has_country_flag = fleet3deal5 }
		text = fleet3dealdesc5 #Selling unique building
	}
	desc = {
		trigger = { has_country_flag = fleet3deal6 }
		text = fleet3dealdesc6 #Selling unique ship weapons tech
	}
	desc = {
		trigger = { has_country_flag = fleet3deal7 }
		text = fleet3dealdesc7 #Selling energy mining platform "upgrade" (planetary energy deposit)
	}
	desc = {
		trigger = { has_country_flag = fleet3deal8 }
		text = fleet3dealdesc8 #Selling tech drone planet mod
	}
	desc = {
		trigger = { has_country_flag = fleet3deal9 }
		text = fleet3dealdesc9 #Selling Racket Caravan Destroyer
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod1 }
		text = fleet3dealdescmod1 #Selling munitions
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod2 }
		text = fleet3dealdescmod2 #Selling minerals (machine)
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod3 }
		text = fleet3dealdescmod3 #Precursor artifacts
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod4 }
		text = fleet3dealdescmod4 #Mineral Sniffer
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod5 }
		text = fleet3dealdescmod5 #Minor Artifacts
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod6 }
		text = fleet3dealdescmod6 #Scavengers
	}
	desc = {
		trigger = { has_country_flag = fleet3dealmod7 }
		text = fleet3dealdescmod7 #Intel
	}

	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"

	picture_event_data = {
		portrait = event_target:caravaneer_fleet3_country
		room = ethic_spaceship_room
	}

	trigger = {
		caravaneer_fleet3_active_diplo = no
	}

	immediate = {
		remove_country_flag = cara_fleet3_getback
		switch = {
			trigger = has_country_flag
			fleet3deal3 = {
				random_owned_planet = {
					limit = { has_planet_flag = fleet3deal3planet }
					save_event_target_as = fleet3deal3planet
				}
			}
			fleet3deal7 = {
				random_planet_within_border = { #As it is placed on uninhabitable (unownable) planets
					limit = { has_planet_flag = fleet3deal7planet }
					save_event_target_as = fleet3deal7planet
				}
			}
			fleet3deal8 = {
				random_owned_planet = {
					limit = { has_planet_flag = fleet3deal8planet }
					save_event_target_as = fleet3deal8planet
				}
			}
			fleet3dealmod7 = {
				random_country = {
					limit = { has_country_flag = fleet3dealmod7country }
					save_event_target_as = fleet3dealmod7country
				}
				if = {
					limit = {
						NOT = { exists = event_target:fleet3dealmod7country }
					}
					random_relation = {
						limit = {
							is_country_type = default
							has_communications = ROOT
							ROOT = { intel = { who = PREV value < 100 } }
						}
						weights = {
							base = 1
							modifier = {
								add = 5
								any_neighbor_country = {
									is_same_value = ROOT
								}
							}
							modifier = {
								add = 10
								OR = {
									is_rival = ROOT
									ROOT = { is_rival = PREV }
								}
							}
						}
						set_timed_country_flag = { flag = fleet3dealmod7country days = @fleet3dealdecay }
						save_event_target_as = fleet3dealmod7country
					}
				}
			}
		}
		cara_generate_deal3 = yes
	}

	option = {
		name = cara_fleet3_take_deal
		allow = { cara_allow_deal3 = yes }
		cara_execute_deal3 = yes
		response_text = "cara_fleet3_dealtaken"
		custom_gui = "enclave_caravaneer_option"
	}

	option = {
		name = cara_fleet3_exit
		hidden_effect = {
			while = { #Clear Fleet 3 deal planet flags with added failsafe
				limit = {
					any_planet_within_border = {
						OR = {
							has_planet_flag = fleet3deal3planet
							has_planet_flag = fleet3deal7planet
							has_planet_flag = fleet3deal8planet
						}
					}
				}
				random_planet_within_border = {
					limit = {
						OR = {
							has_planet_flag = fleet3deal3planet
							has_planet_flag = fleet3deal7planet
							has_planet_flag = fleet3deal8planet
						}
					}
					switch = {
						trigger = has_planet_flag
						fleet3deal3planet = { remove_planet_flag = fleet3deal3planet }
						fleet3deal7planet = { remove_planet_flag = fleet3deal7planet }
						fleet3deal8planet = { remove_planet_flag = fleet3deal8planet }
					}
				}
			}
			remove_country_flag = fleet3deal1
			remove_country_flag = fleet3deal2
			remove_country_flag = fleet3deal3
			remove_country_flag = fleet3deal4
			remove_country_flag = fleet3deal5
			remove_country_flag = fleet3deal6
			remove_country_flag = fleet3deal7
			remove_country_flag = fleet3deal8
			remove_country_flag = fleet3deal9
			remove_country_flag = fleet3dealmod1
			remove_country_flag = fleet3dealmod2
			remove_country_flag = fleet3dealmod3
			remove_country_flag = fleet3dealmod4
			remove_country_flag = fleet3dealmod5
			remove_country_flag = fleet3dealmod6
			remove_country_flag = fleet3dealmod7
		}
		default_hide_option = yes
		custom_gui = "enclave_caravaneer_option"
	}
}