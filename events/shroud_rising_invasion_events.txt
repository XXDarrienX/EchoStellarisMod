###################################################

# Shroud Rising Horrror Invasion Events

# Written by LastLeviathan

###################################################

namespace = shroud_rising_invasion

###################################################
# shroud_rising_invasion.0 | Incursions begin announce
# shroud_rising_invasion.1 | (Hidden) First Incursion Spawn a Devourer of Worlds and 2 x entities
# shroud_rising_invasion.2 | (Hidden) First Incusion Spawn 3 x wandering entities
# shroud_rising_invasion.200 | (Hidden) Incursion Selector *Bi-Yearly with on-action
# shroud_rising_invasion.201 | (Hidden) Choose Cultist Raid Spawn
# shroud_rising_invasion.2011 | Raid Incursion Announce Message
# shroud_rising_invasion.2012 | Small Crusade Incursion Announce Message
# shroud_rising_invasion.20100 | (Hidden) Event for invasion if it reaches 100 devastation
# shroud_rising_invasion.20101 | Invasion Announce for owner
# shroud_rising_invasion.202 |  (Hidden)Shroud Entity Spawn
# shroud_rising_invasion.2021 | Shroud Entity Alert 
# shroud_rising_invasion.2022 | Shroud Entity Powerful Alert
# shroud_rising_invasion.203 | (Hidden)Greater Horror or Cosmic Spawn
# shroud_rising_invasion.2031 | Greater Horror Alert
# shroud_rising_invasion.2032 | Cosmic Horror Alert
# shroud_rising_invasion.100 | (Hidden) Shroud Ship Death Count
# shroud_rising_invasion.101 | (Hidden) Shroud Ship Victims
# shroud_rising_invasion.102 | (Hidden) Shroud Army Death Count
# shroud_rising_invasion.103 | (Hidden) Shroud Army Victims
# shroud_rising_invasion.104 | (Hidden) Count every colonization of Shroud Touched worlds
# shroud_rising_invasion.105 | (Hidden) Trigger ancient god spawn
# shroud_rising_invasion.106 | Ancient God Announce
# shroud_rising_invasion.107 | (Hidden) Ancient God Defeated Effects 
# shroud_rising_invasion.108 | Ancient God Defeated Announce
# shroud_rising_invasion.109 | (Hidden) Chance of Ancient God Spawning every 10 years after endgame
###################################################

###################################################
## THE EYE OF TERROR INVASIONS ####################
###################################################

namespace = shroud_rising_invasion

# desc = {
		# trigger = {
			# check_variable = {
				# which = turtle_amount
				# value < 5
			# }
		# }
		# text = "colony.9020.desc"
	# }
# shroud INVASION

# INCURSIONS BEGIN Announce
country_event = {
	id = shroud_rising_invasion.0
	title = "shroud_rising_invasion.0.name"
	desc = "shroud_rising_invasion.0.desc"
	picture = GFX_evt_space_monster_shroud
	show_sound = event_the_great_awakening
	is_triggered_only = yes
	
	
	immediate = {		
			set_global_flag = eot_incursions_start
	}
	
	option = {
		name = shroud_rising_invasion.0.a
		custom_tooltip = shroud_rising_invasion.0.a.tooltip
		begin_event_chain = {
			event_chain = "eye_of_terror_incursion_chain"
			target = ROOT
		}		
		
	}
	
	option = {
		name = shroud_rising_invasion.0.b
		custom_tooltip = shroud_rising_invasion.0.b.tooltip
		begin_event_chain = {
			event_chain = "eye_of_terror_incursion_chain"
			target = ROOT
		}		
		
	}
}


######### INVASION ############################

country_event = {
	id = shroud_rising_invasion.1	
	location = event_target:shroud_invasion_system
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {			
		# country_event = { id = shroud_rising_invasion.11 days = 120 } #spawn batch of entities after the main host
		if = {
			limit = { NOT = { exists = event_target:shroud_horror_country } }
			create_country = {
				name = "NAME_shroud_horror_country"
				type = "shroud_horrors"
				name_list = "SHROUD_HORRORS"
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
			}			
			
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_horror_country
			}
		}

		random_system = {			
			limit = { has_star_flag = shroud_invasion_target_1 }
			save_event_target_as = shroud_invasion_system
		}	

		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_horror_country				
				create_ship = {
					name = "NAME_greater_horror_hunger"
					design = "NAME_greater_horror"								
					}						
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				# is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_horror_country				
				create_ship = {
					name = "NAME_shroud_horrors_blank"
					design = "NAME_Corrupted_Avatar"								
					}				
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				# is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_horror_country				
				create_ship = {
					name = "NAME_shroud_horrors_blank"
					design = "NAME_Corrupted_Avatar"								
					}				
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		# last_created_fleet = { fleet_event = { id = shroud_rising_invasion } }
		every_country = { establish_communications_no_message = event_target:shroud_horror_country }
		
	}

	
}
	
country_event = {
	id = shroud_rising_invasion.11	
	location = event_target:shroud_invasion_system
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {		
		if = {
			limit = { NOT = { exists = event_target:shroud_cult_country } }
			create_country = {
				name = "NAME_shroud_horror_country"
				type = "shroud_entities"
				name_list = "SHROUD_HORRORS"
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
			}			
			
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_entity_country
			}
		}

		random_system = {			
			limit = { has_star_flag = shroud_invasion_target_1 }
			save_event_target_as = shroud_invasion_system
		}			
		
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				# is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_entity_country				
				create_ship = {
					name = "NAME_shroud_horrors_blank"
					design = "NAME_Corrupted_Avatar"								
					}				
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				# is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_entity_country				
				create_ship = {
					name = "NAME_shroud_horrors_blank"
					design = "NAME_Corrupted_Avatar"								
					}				
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				# is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_entity_country				
				create_ship = {
					name = "NAME_shroud_horrors_blank"
					design = "NAME_Corrupted_Avatar"								
					}				
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		# last_created_fleet = { fleet_event = { id = shroud_rising_invasion } }
		every_country = { establish_communications_no_message = event_target:shroud_entity_country }
	}

	
}	
	
	
# Colony Bombarded by horrors
planet_event = {
	id = shroud_rising_invasion.2
	title = "shroud_rising_invasion.2.name"
	desc = "shroud_rising_invasion.2.desc"
	picture = GFX_evt_shroud_city_ruins
	show_sound = event_ghost_town

	is_triggered_only = yes

	trigger = {
		planet_devastation >= 100
		FROM = { is_country_type = shroud_horrors }
	}

	
	immediate = {
		
		
		if = {
			limit = { FROM = { is_country_type = shroud_horrors } }
			every_country = {
				limit = { has_event_chain = "eye_of_terror_incursion_chain" }
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_planets"
					amount = 1
				}
			}
		}
		owner = { save_event_target_as = devour_victim }
		event_target:devour_victim ={ 
			set_country_flag = world_devoured					
				}
		random_country = {
					limit = { is_country_type = global_event }
					change_variable = {
						which = "shroud_planets"
						value = 1
					}
				}
		destroy_colony = yes
		if = {
			limit = {
				is_artificial = no
			}
			change_pc = pc_shrouded
			reset_planet = yes
			add_modifier = {
				modifier = "devoured_world"
				days = -1
			}
		}
		else_if = {
			limit = {
				is_ringworld = yes
			}
			change_pc = pc_ringworld_habitable_damaged
			reset_planet = yes
			add_modifier = {
				modifier = "devoured_world"
				days = -1
			}
		}
		else_if = {
			limit = { is_planet_class = pc_habitat }
			remove_planet = yes
		}
		
		
	}
	option = {
		name = shroud_rising_invasion.2.a
		# custom_tooltip = shroud_rising_invasion.2.a.tooltip
	}
}	



# Spawn selector event
event = {
	id = shroud_rising_invasion.200
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
	
	}
	
	immediate = {
		random_country = {
					limit = { 
						AND = { 
							is_country_type = global_event
							has_global_flag = eye_of_terror_open
						}	
					}		
			random_list = {
					# Spawn cultists
					45 = {
						country_event = { id = shroud_rising_invasion.201 days = 5 random = 40 }
					}
					# Spawn Shroud Entities
					30 = {
						country_event = { id = shroud_rising_invasion.202 days = 5 random = 40 }
					}
					# Spawn a Horror
					20 = {
						modifier = {
							factor = 0
							mid_game_years_passed <=35						
						}
						country_event = { id = shroud_rising_invasion.203 days = 5 random = 40 }
					}
					5 = {
						
					}
			}	
		}
		
	}
	
	
}


# Spawn cultists either small or large fleet
country_event = {
	id = shroud_rising_invasion.201		
	hide_window = yes
	is_triggered_only = yes	
	# fire_only_once = yes
	immediate = {
			
			create_country = {
			name = "NAME_shroud_cultist_country"
			type = shroud_cult
			name_list = "CULTISTS"
				effect = {					
					# set_graphical_culture = root.owner
				}
				
			}			
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = cultist_raid_fleet
				
			}
			random_system = {			
			limit = { has_star_flag = shroud_invasion_target_1 }
			save_event_target_as = shroud_incursion_system
			}
			
				every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
			# Chances to spawn either a normal sized fleet (20k) or a large fleet (50k)
			random_list = {		
				
				# Chance of Normal sized fleet 45k
				70 = {	
					every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2011 days = 5  } #Incursion Alert					
			
			
					}
					
					
					event_target:cultist_raid_fleet ={
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {					
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country										
									while = {
										count = 2
										create_ship = {
											name = random
											design = "NAME_Ancestral_Glory"
											graphical_culture = "pirate_01"
										}
									}		
									while = {
										count = 8
										create_ship = {
											name = random
											design = "NAME_Void_Champion"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 12
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 20
										create_ship = {
											name = random
											design = "NAME_Outrider"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "arthropoid_01"							
										}
									
									}
									while = {
										count = 3
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "molluscoid_01"					
											}
									}
									while = {
										count = 5
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "humanoid_01"					
											}
									}
									while = {
										count = 4
										create_ship = {							
												name = random
												design = "NAME_Bug_Crusher"
												graphical_culture = "molluscoid_01"				
											}
									}
									while = {
									count = 2
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_04"					
									}
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_02"						
										}
									}
									set_location = {
										target = event_target:shroud_incursion_system
										distance = 15
										angle = random
									}
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate									
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOT = { has_planet_flag = cultist_raid_target }
													num_pops > 0
												}
											}
											
											save_event_target_as = cultist_raid
										}
										event_target:cultist_raid = {
											random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 0
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 1000
												}
												save_event_target_as = cultist_raid
											}
										}
										auto_move_to_planet = {
											target = event_target:cultist_raid
											clear_auto_move_on_arrival = no
										}
								}
							}
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 3
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = random_trait
									trait = leader_trait_admiral_psionic 
								}
							}
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}
					
			
					
					
				}
				# Chance of large fleet 90k
				30 = {
					every_country = {
						limit = { 
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
							}
						}
						country_event = { id = shroud_rising_invasion.2012 days = 5  } #Incursion Alert					
			
			
					}
					
					event_target:cultist_raid_fleet = {
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {					
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country
									assign_leader = last_created_leader	
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Eternal"
											graphical_culture = "fallen_empire_04"							
										}
									}
									while = {
										count = 3
										create_ship = {
											name = random
											design = "NAME_Ancestral_Glory"
											graphical_culture = "pirate_01"
										}
									}								
									while = {
										count = 12
										create_ship = {
											name = random
											design = "NAME_Void_Champion"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 18
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 30
										create_ship = {
											name = random
											design = "NAME_Outrider"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 5
										create_ship = {							
											name = "NAME_traitor_ship"
											design = "NAME_Spearhead"
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 4
										create_ship = {							
											name = "NAME_traitor_ship"
											design = "NAME_Spearhead"
											graphical_culture = "arthropoid_01"							
										}
									
									}
									while = {
										count = 5
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "molluscoid_01"					
											}
									}
									while = {
										count = 7
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "humanoid_01"					
											}
									}
									while = {
										count = 4
										create_ship = {							
												name = random
												design = "NAME_Bug_Crusher"
												graphical_culture = "molluscoid_01"				
											}
									}
									while = {
									count = 4
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_04"					
									}
									}
									while = {
										count = 4
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_02"						
										}
									}
									set_location = {
										target = event_target:shroud_incursion_system
										distance = 15
										angle = random
									}
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner	
													NOT = { has_planet_flag = cultist_raid_target }
													num_pops > 0
												}
											}
											save_event_target_as = cultist_raid
										}
										event_target:cultist_raid = {
											random_system_planet = {
												limit = {
													exists = owner												
													num_pops > 0
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 1000
												}
												
												save_event_target_as = cultist_raid
											}
										}
										auto_move_to_planet = {
											target = event_target:cultist_raid
											clear_auto_move_on_arrival = no
										}
								}
							}
							
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 5
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = random_trait
									trait = leader_trait_admiral_psionic 
								}
							}
							
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}
				
				}
			}			
	
		}
	
}


country_event = {
	id = shroud_rising_invasion.2011
	hide_window = no 
	title = "shroud_rising_invasion.2011.name"
	desc = "shroud_rising_invasion.2011.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2011.a
		
		
	}
	
}

country_event = {
	id = shroud_rising_invasion.2012
	hide_window = no 
	title = "shroud_rising_invasion.2012.name"
	desc = "shroud_rising_invasion.2012.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2012.a
		
		
	}
	
}



# Colony Bombarded by Cultists
planet_event = {
	id = shroud_rising_invasion.20100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		planet_devastation >= 100
		FROM = { is_country_type = shroud_cult }
		NOT = { has_modifier = recent_cult_invasion }
	}

	immediate = {
		planet_event = { id = shroud_rising_invasion.20101 } 
		add_modifier = {
				modifier = "recent_cult_invasion"
				days = 730
			}
		set_planet_flag = shroud_cult_invasion
			create_species = {
					name = "NAME_shroud_cultists"
					class = random_non_machine
					name_list = "CULTISTS"
					portrait = random
					traits = random
				}
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "shroud_cultist_army"
			}
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "shroud_cultist_army"
			}	
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "shroud_cultist_army"
			}	
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "shroud_cultist_army"
			}	
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "cultist_slave_army"
			}	
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "cultist_psionic_army"
			}	
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "cultist_slave_army"
			}
			create_army = {
				name = "NAME_cultist_army"
				owner = from
				species = last_created_species
				type = "cultist_psionic_army"
			}				
			
			from = {
				create_leader = {
								class = general
								species = last_created_species
								name = random
								skill = 5
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = leader_trait_butcher
									trait = leader_trait_general_psionic 
								}
							}
				random_owned_army  = {
					limit = {NOT = { exists = leader } }						
					set_leader = last_created_leader
				}
			}
		}
	
	
	}

	
	
	
# Inform owner, if there is one that his planet is now fucked
planet_event = {
	id = shroud_rising_invasion.20101
	title = "shroud_rising_invasion.20101.name"
	desc = "shroud_rising_invasion.20101.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle	
	is_triggered_only = yes
	location = root
	
	trigger = {
		
	}
	
	immediate = {				
		owner = { save_event_target_as = cult_raid_victim }
		event_target:cult_raid_victim ={ 
			set_country_flag = had_world_invaded_by_cult					
				}
	}
	
	option = {
		name = shroud_rising_invasion.20101.a
		custom_tooltip = shroud_rising_invasion.20101.a.tooltip
		
		
	}
}



# Spawn shroud entities either a few or many
country_event = {
	id = shroud_rising_invasion.202	
	hide_window = yes
	is_triggered_only = yes	
	# fire_only_once = yes
	immediate = {
			
			create_country = {
			name = "NAME_shroud_horror_country"
			type = shroud_entities
			name_list = "SHROUD_HORRORS"
			flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}	
			}			
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_entity_fleet
			}
			random_system = {			
			limit = { has_star_flag = shroud_invasion_target_1 }
			save_event_target_as = shroud_incursion_system
			}
			
				every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
			# Chances to spawn either a normal sized fleet (20k) or a large fleet (50k)
			random_list = {		
				
				# Chance of Normal sized fleet
				60 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2021 days = 5  } #Incursion Alert					
			
			
						}					
						event_target:shroud_entity_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										# is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_blank"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500
									
									
									
									}
									
								}
								create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										# is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_blank"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500
									
									
									
									}
									
								}
								
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										# is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_blank"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500
									
									
									
									}
									
								}	
						}
							
					
					
			
					
					
				}
				
				# Chance of stronger entities
				40 = {
					every_country = {
						limit = { 
							
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
							}
										
						}
						country_event = { id = shroud_rising_invasion.2022 days = 5  } #Incursion Alert					
						}
			
											
						event_target:shroud_entity_fleet ={					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										# is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_entity_name"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500
									
									
									
									}
									
								}
								create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										# is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_entity_name"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500
									
									
									
									}
									
								}
								create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										# is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_entity_name"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500
									
									
									
									}
									
								}
								
								
								
						}
							
					}
				
				}
						
	
		
	}
}


country_event = {
	id = shroud_rising_invasion.2021
	hide_window = no 
	title = "shroud_rising_invasion.2021.name"
	desc = "shroud_rising_invasion.2021.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2021.a
		
		
	}
	
}

country_event = {
	id = shroud_rising_invasion.2022
	hide_window = no 
	title = "shroud_rising_invasion.2022.name"
	desc = "shroud_rising_invasion.2022.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2022.a
		
		
	}
	
}


# Spawn Shroud Horror
country_event = {
	id = shroud_rising_invasion.203
	hide_window = yes
	is_triggered_only = yes	
	# fire_only_once = yes
	immediate = {
			
			create_country = {
			name = "NAME_shroud_horror_country"
			type = shroud_horrors
			name_list = "SHROUD_HORRORS"
			flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}	
			}			
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_horror_fleet
			}
			random_system = {			
			limit = { has_star_flag = shroud_invasion_target_1 }
			save_event_target_as = shroud_incursion_system
			}
			
				every_country = { establish_communications_no_message = event_target:shroud_horror_fleet }
			# Chances to spawn either a greater horrror (80k) or a cosmic (150k)
			random_list = {		
				
				# Chance of Different Avatars
				20 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032 days = 5  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_desire"
											design = "NAME_horror_desire"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300
										
									
									
									
									}
								
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}								
								
								
						}
							
					
					
			
					
					
				}
				20 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032 days = 5  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_hunger"
											design = "NAME_horror_hunger"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300
										
										
									
									
									
									}
									
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}
								
						}
							
					
					
			
					
					
				}
				# Chance of stronger entities
				19 = {
					every_country = {
						limit = { 
							
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
							}
										
						}
						country_event = { id = shroud_rising_invasion.2032 days = 5  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet ={					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_whisper"
											design = "NAME_horror_whisper"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300
									
									
									
									
									}
									
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}
								
						}
							
				}
				19 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032 days = 5  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_corruption"
											design = "NAME_horror_corruption"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300
										
									
									
									
									}
								
								}
							last_created_fleet = {
								save_event_target_as = shroud_horror_fleet_name
							}
								
								
						}
							
					
					
			
					
					
				}
				# Chance of cosmic horror
				10 = {
					every_country = {
						limit = { 
							
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
								has_policy_flag = incursion_alert_none
							}
										
						}
						country_event = { id = shroud_rising_invasion.2033 days = 5  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet ={					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_cosmic_horror"
											design = "NAME_cosmic_horror"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300
										
									
									
									
									}
									
								}
								
								
						}
							
					}
					2 = {
						modifier = {
							factor = 0
							mid_game_years_passed <= 100		
							has_global_flag = ancient_god_spawned 
						}
					every_country = {
						limit = { 							
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
								has_policy_flag = incursion_alert_none								
							}
										
						}
						country_event = { id = shroud_rising_invasion.106 days = 5  } #Incursion Alert					
			
			
						}					
						country_event = { id = shroud_rising_invasion.105 }
							
					}
					
					
					
		
			}
						
	
		}
	
}

#announce greater horror
country_event = {
	id = shroud_rising_invasion.2031
	hide_window = no 
	title = "shroud_rising_invasion.2031.name"
	desc = "shroud_rising_invasion.2031.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2031.a
		
		
	}
	
}
#announce avatar
country_event = {
	id = shroud_rising_invasion.2032
	hide_window = no 
	title = "shroud_rising_invasion.2032.name"
	desc = "shroud_rising_invasion.2032.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2032.a
		
		
	}
	
}
#announce cosmic horror
country_event = {
	id = shroud_rising_invasion.2033
	hide_window = no 
	title = "shroud_rising_invasion.2033.name"
	desc = "shroud_rising_invasion.2033.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes


	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2033.a
		
		
	}
	
}




# Shroud Entities Death Count (HIDDEN)
country_event = {
	id = shroud_rising_invasion.100
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			is_country_type = shroud_entities 
			is_country_type = shroud_horrors 
			is_country_type = shroud_cult
		} 
	}

	immediate = {
		if = {
			limit = {
				OR = {
											
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
				FROM = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			FROM = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_kills_us"
					amount = 1
				}
			}
		}	
		
	}
}


# Shroud Entities Victims (HIDDEN)
country_event = {
	id = shroud_rising_invasion.101
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
					
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
		
	}

	immediate = {
		if = {
			limit = {
				OR = {
						
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
				FROM = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			FROM = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims_us"
					amount = 1
				}
			}
		}
		
		if = {
			limit = { 
				OR = {
						
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"
					NOT = { is_same_value = FROM }
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 1
				}
			}
		}
		
	}
}

# Shroud Entities Armies killed (HIDDEN)
country_event = {
	id = shroud_rising_invasion.102
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		
			from = { 
				OR = {
					army_type = shroud_cultist_army  
					army_type = shroud_horror_army_1 
					army_type = shroud_horror_army_2 
					army_type = shroud_greater_horror_army 
				} 
			}
	}

	immediate = {
		if = {
			limit = {				
				FromFrom = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			FromFrom = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_kills_us"
					amount = 1
				}
			}
		}
	
	}
}

# Shroud Entities Army Victims (HIDDEN)
country_event = {
	id = shroud_rising_invasion.103
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		fromfrom = {
		
			OR = {
						
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
		}
	}

	immediate = {
		if = {			
			limit = {				
				this = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			this  = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_army_victims"
					amount = 1
				}
			}
		}
		
		else = {
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain" 	
					NOT = { is_same_value = this }
				}	
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 1
				}
			}
		}
	
	
	}
}



# Chance of Ancient God Spawns Shroud Planets when colonized
planet_event = {
	id = shroud_rising_invasion.104
	hide_window = yes

	is_triggered_only = yes

	trigger = {	
				
		is_planet_class = pc_shroud_touched
				
			
	}

	immediate = {			
			
			random_list = {
				
				5 = { 	
					every_country = {
						limit = { is_country_type = global_event }
						country_event = { id = shroud_rising_invasion.105 days = 30 random = 100 }		
					}
				}
				
				95 = {}			
			}
		
	}
}

# Spawn Ancient God 
country_event = {
	id = shroud_rising_invasion.105
	hide_window = yes
	# fire_only_once = yes
	is_triggered_only = yes
	
	
	trigger = {
		mid_game_years_passed >= 100
		has_global_flag = eye_of_terror_open	
		NOT = { has_global_flag = ancient_god_spawned }
	}

	immediate = {				
			every_country = {
				limit = { 
					OR = {
						is_country_type = default 
						is_gestalt  = yes
						is_regular_empire = yes
						
						}
				}
				country_event = { id = shroud_rising_invasion.106 } #announce to galaxy
				add_modifier = { modifier = god_voices }
			}	
			
			# limit = { NOT = { exists = event_target:shroud_god_country } }
			create_country = {
				name = "NAME_ancient_god_name"
				type = "shroud_horrors"
				name_list = "SHROUD_HORRORS"
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
			}			
			
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_god_country
			}
			every_country = { establish_communications_no_message = event_target:shroud_god_country }

		random_system = {			
			limit = { has_star_flag = shroud_invasion_target_1 }
			save_event_target_as = shroud_invasion_system
		}	

		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_god_country				
				create_ship = {
					name = "NAME_ancient_god_ship_name"
					design = "NAME_ancient_god"								
					}						
					
				set_location = event_target:shroud_invasion_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 500
				set_fleet_flag = ancient_god		
			
			}
			
		}
				
		
	}
}

	
# Announce Ancient God Spawn
country_event = {
	id = shroud_rising_invasion.106
	hide_window = no 
	title = "shroud_rising_invasion.106.name"
	desc = "shroud_rising_invasion.106.desc"
	picture = GFX_evt_eye_of_terror_god
	show_sound = event_red_alert
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = ancient_god_spawned }
	}

	immediate = {		
		set_timed_global_flag = { flag = ancient_god_spawned days = 3600 }
	}

	option = {
		name = shroud_rising_invasion.106.a
		custom_tooltip = shroud_rising_invasion.106.a.tooltip
		
	}
	
}


# Ancient God Defeated (HIDDEN)
country_event = {
	id = shroud_rising_invasion.107
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_country_type = shroud_horrors
		fromfrom = {			
			fleet = { 
				num_ships = 0 
				has_fleet_flag = ancient_god
				}
			
		}		
	}

	immediate = {		
		set_timed_global_flag = { flag = ancient_god_defeated days = 500 }
		from = { save_event_target_as = ancient_god_destroyer }
		fromfrom = { fleet = { save_event_target_as = ancient_god } }
		fromfrom = {
			solar_system = { save_event_target_as = ancient_god_death_system }			
		}
		
		every_country = {
			limit = { 
				OR = {	
						is_regular_empire = yes
						is_gestalt  = yes
					}
				NOT = { has_civic = civic_shroud_cult }
			}
			remove_modifier = god_voices 
			add_modifier = { modifier = ancient_god_defeated days = 1500 }
			country_event = { id = shroud_rising_invasion.108 }
		}
		every_playable_country = {
				limit = {
					NOR = { 
						is_same_value = from
						has_civic = civic_shroud_cult
						}
					OR = {	
						is_regular_empire = yes
						is_gestalt  = yes
					}
				}
				
				add_opinion_modifier = {
					who = event_target:ancient_god_destroyer
					modifier = opinion_defeated_ancient_god
				}
		}
	}
}

# God defeated
country_event = {
	id = shroud_rising_invasion.108
	title = "shroud_rising_invasion.108.name"
	desc = "shroud_rising_invasion.108.desc"
	picture = GFX_evt_crisis_defeated
	show_sound = event_celebration

	is_triggered_only = yes

	option = {
		name = shroud_rising_invasion.108.a
		custom_tooltip = shroud_rising_invasion.108.a.tooltip
	}
}

# Chance of Ancient God Spawns every 10 years after endgame
event = {
	id = shroud_rising_invasion.109
	hide_window = yes

	is_triggered_only = yes

	trigger = {	
		end_game_years_passed >= 1
		has_global_flag = eye_of_terror_open	
		NOT = { has_global_flag = ancient_god_spawned }
				
			
	}

	immediate = {			
			
			random_list = {
				
				5 = { 	
					every_country = {
						limit = { is_country_type = global_event }
						country_event = { id = shroud_rising_invasion.105 days = 30 random = 100 }		
					}
				}
				
				95 = {}			
			}
		
	}
}