##########################
#
# ARCHAEOLOGY SITE EVENTS
#
##########################

namespace = FHMP

# 1 - 49 Iklaxian Union
# 50 - 99 Ixardian Corporation
# 100 - 149 Werediran Signal
# 150 - 199 Ezentian ___
# 200 - 249 Lartaxan Realm

######################################
# "THE IKLAXIAN UNION" by Metallichydra
######################################

####################################
# "Broken Gateway"
####################################

# Iklaxian Introduction
# via on_survey = {} | this = surveying vessel
#ship_event = {
#	id = FHMP.1
#	title = "FHMP.1.name"
#	desc = "FHMP.1.desc"
#	picture = GFX_evt_crashed_station
#	show_sound = event_default
#	location = from
#
#	fire_only_once = yes
#
#	is_triggered_only = yes
#
#	trigger = {
#		owner = {
#			is_ai = no
#			has_precursor_intro = no
#		}
#		solar_system = {
#			has_star_flag = precursor_iklaxian_1
#			NOR = {
#				is_same_value = root.owner.capital_scope.solar_system
#				has_star_flag = sol_system
#			}
#			has_star_flag = abandoned_gateway
#			any_system_megastructure = { is_megastructure_type = gateway_ruined }
#		}
#		NOT = { has_global_flag = iklaxian_started }
#		FROM = {
#			has_anomaly = no
#			is_star = no
#			NOT = { exists = archaeological_site }
#			NOT = { has_planet_flag = suppress_archaeological_sites }
#			NOR = {
#				is_planet_class = pc_gas_giant
#				is_planet_class = pc_molten
#				is_planet_class = pc_toxic
#				is_planet_class = pc_shattered
#			}
#		}
#	}
#	weight_multiplier = {
#		factor = 1
#		modifier = {
#			factor = @origin_shoulders_multiplier
#			owner = {
#				has_origin = origin_shoulders_of_giants
#				has_country_flag = origin_shoulders_closure
#			}
#		}
#	}
#
#	immediate = {
#		set_global_flag = iklaxian_started
#		owner = { set_country_flag = iklaxian_intro }
#		owner = { set_country_flag = vultaum_intro }
#		solar_system = { set_star_flag = first_iklaxian_site@root.owner }
#	}
#
#	option = {
#		name = CURIOUS
#		hidden_effect = {
#			owner = { country_event = { id = story.5 days = 30 } }
#			# from = { create_archaeological_site = iklaxian_digsite_1 }
#		}
#	}
#}

##############################################
# "The Ixardian Corporation" by Metallichydra
##############################################

####################################
# "Abnormal Ruins"
####################################

# Ixardian Introduction
# via on_survey = {} | this = surveying vessel
ship_event = {
	id = FHMP.51
	title = "FHMP.51.name"
	desc = "FHMP.51.desc"
	picture = GFX_evt_relic_world_building
	show_sound = event_default
	location = from

	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
		owner = { scfe_can_find_precursor = yes }
		OR = {
			AND = {
				NOT = { has_global_flag = Precursor_Selection_installed }
				owner = {
					is_ai = no
					has_precursor_intro = no
				}
			}
			AND = {
				has_global_flag = Precursor_Selection_installed
				owner = {
					is_ai = no
					NOT = { has_country_flag = ixardian_intro }
					has_country_flag = picked_ixardian
				}
			}
		}
		solar_system = {
			has_star_flag = precursor_ixardian_1
			NOR = {
				is_same_value = root.owner.capital_scope.solar_system
				has_star_flag = sol_system
			}
		}
		NOT = { has_global_flag = ixardian_started }
		FROM = {
			has_anomaly = no
			is_star = no
			NOT = { exists = archaeological_site }
			NOT = { has_planet_flag = suppress_archaeological_sites }
			FHMP_is_valid_precursor_planet = yes
		}
	}
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = @origin_shoulders_multiplier
			owner = {
				has_origin = origin_shoulders_of_giants
				has_country_flag = origin_shoulders_closure
			}
		}
		modifier = {
			factor = 1000
			owner = {
				has_country_flag = picked_ixardian
			}
		}
		modifier = {
			factor = 0
			owner = {
				has_country_flag = PreSelect_Recent_Discovery
			}
		}
	}

	immediate = {
		set_global_flag = ixardian_started
		owner = { set_country_flag = ixardian_intro }
		owner = { set_timed_country_flag = { flag = PreSelect_Recent_Discovery days = 180 } }
		if = {
			limit = {
				has_PreSelect_active = no
			}
			owner = { set_country_flag = vultaum_intro }
		}
		solar_system = { set_star_flag = first_ixardian_site@root.owner }
	}

	option = {
		name = CURIOUS
		hidden_effect = {
			owner = { country_event = { id = story.5 days = 30 } }
			from = { create_archaeological_site = ixardian_digsite_1 }
		}
	}
}

# Ixardian Digsite Stage 1
fleet_event = {
	id = FHMP.52
	#archaeology_window = yes
	title = "FHMP.52.name"
	desc = "FHMP.52.desc"
	picture = GFX_evt_two_sided_deal
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 2
fleet_event = {
	id = FHMP.53
	#archaeology_window = yes
	title = "FHMP.53.name"
	desc = "FHMP.53.desc"
	picture = GFX_evt_gunrunning
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 3 # Spawn 2nd digsite
fleet_event = {
	id = FHMP.54
	title = "FHMP.54.name"
	desc = "FHMP.54.desc"
	picture = GFX_evt_star_chart
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
		closest_system = {
			limit = {
				has_access_fleet = root.owner
				is_capital_system = no
				NOR = {
					is_same_value = root.solar_system
					has_star_flag = first_ixardian_site@root.owner
					is_same_value = root.owner.capital_scope.solar_system
					has_star_flag = hostile_system
				}
				is_fe_cluster = no
				OR = {
					has_owner = no
					owner = { is_same_value = root.owner }
				}
				num_planets_in_system > 4
				any_system_planet = {
					FHMP_is_valid_precursor_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites #for modders
					}
				}
				root.owner = {
					any_controlled_fleet = {
						is_ship_class = shipclass_science_ship
						can_access_system = prevprev
					}
				}
			}
			min_steps = 2
			max_steps = 4
			root.owner = { set_visited = prev }
			set_star_flag = second_ixardian_site@root.owner
			random_system_planet = {
				limit = {
					FHMP_is_valid_precursor_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites
					}
				}
				create_archaeological_site = ixardian_digsite_2
				root.owner = {
					set_country_flag = ixardian_arc_chain_@prev
				}
				save_event_target_as = new_ixardian_digsite
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:new_ixardian_digsite }
			}
			closest_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = first_ixardian_site@root.owner
						is_same_value = root.owner.capital_scope.solar_system
						has_star_flag = hostile_system
					}
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					num_planets_in_system > 4
					any_system_planet = {
						FHMP_is_valid_precursor_planet = yes
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
				}
				min_steps = 1
				root.owner = { set_visited = prev }
				set_star_flag = second_ixardian_site@root.owner
				random_system_planet = {
					limit = {
						FHMP_is_valid_precursor_planet = yes
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					create_archaeological_site = ixardian_digsite_2
					root.owner = {
						set_country_flag = ixardian_arc_chain_@prev
					}
					save_event_target_as = new_ixardian_digsite
				}
			}
		}
	}

	option = {
		name = "ancrel.2024.a"
		medium_artifact_reward = yes
	}
	
	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

####################################
# "Abandoned Office"
####################################

# Ixardian Digsite Stage 1
fleet_event = {
	id = FHMP.55
	#archaeology_window = yes
	title = "FHMP.55.name"
	desc = "FHMP.55.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_bad_omen
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 2
fleet_event = {
	id = FHMP.56
	#archaeology_window = yes
	title = "FHMP.56.name"
	desc = "FHMP.56.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 3
fleet_event = {
	id = FHMP.57
	title = "FHMP.57.name"
	desc = "FHMP.57.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_ship_bridge
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		from = {
			planet = {
				save_event_target_as = old_ixardian_digsite
			}
		}
		solar_system = {
			random_system_planet = {
				limit = {
					is_star = no
					habitable_planet = no
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites
					}
				}
				create_archaeological_site = ixardian_digsite_3
				root.owner = {
					set_country_flag = ixardian_arc_chain_@prev
				}
				set_planet_flag = FHMP_ixardian_second_planet
				save_event_target_as = new_ixardian_digsite
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:new_ixardian_digsite }
			}
			solar_system = {
				random_system_planet = {
					limit = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					create_archaeological_site = ixardian_digsite_3
					root.owner = {
						set_country_flag = ixardian_arc_chain_@prev
					}
					set_planet_flag = FHMP_ixardian_second_planet
					save_event_target_as = new_ixardian_digsite
				}
			}
		}
	}

	option = {
		name = FHMP.57.a
		owner = {
			country_event = { id = FHMP.58 days = 10 }
		}
	}
	
	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

# Recieve Second Signal
country_event = {
	id = FHMP.58
	title = "FHMP.58.name"
	desc = "FHMP.58.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	is_triggered_only = yes
	
	immediate = {
		event_target:old_ixardian_digsite = {
			solar_system = {
				random_system_planet = {
					limit = { has_planet_flag = FHMP_ixardian_second_planet }
					save_event_target_as = transmitting_planet
				}
			}
		}
	}

	option = {
		name = "FHMP.58.a"
		owner = {
			country_event = { id = FHMP.59 }
		}
	}
}

# Signal Recieved
country_event = {
	id = FHMP.59
	title = "FHMP.59.name"
	desc = "FHMP.59.desc"
	location = this
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "FHMP.59.a"
	}
}

####################################
# "Crashed Starbase"
####################################

# Ixardian Digsite Stage 1
fleet_event = {
	id = FHMP.60
	#archaeology_window = yes
	title = "FHMP.60.name"
	desc = "FHMP.60.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 2
fleet_event = {
	id = FHMP.61
	#archaeology_window = yes
	title = "FHMP.61.name"
	desc = "FHMP.61.desc"
	picture = GFX_evt_star_chart
	show_sound = event_mystic_reveal
	location = from

	specimen = FHMP_ixardian_starbase

	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
		closest_system = {
			limit = {
				has_access_fleet = root.owner
				is_capital_system = no
				NOR = {
					is_same_value = root.solar_system
					has_star_flag = first_ixardian_site@root.owner
					has_star_flag = second_ixardian_site@root.owner
					is_same_value = root.owner.capital_scope.solar_system
					has_star_flag = hostile_system
				}
				is_fe_cluster = no
				OR = {
					has_owner = no
					owner = { is_same_value = root.owner }
				}
				any_system_planet = {
					FHMP_is_valid_precursor_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites #for modders
					}
				}
				root.owner = {
					any_controlled_fleet = {
						is_ship_class = shipclass_science_ship
						can_access_system = prevprev
					}
				}
			}
			min_steps = 2
			max_steps = 4
			root.owner = { set_visited = prev }
			set_star_flag = third_ixardian_site@root.owner
			random_system_planet = {
				limit = {
					FHMP_is_valid_precursor_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites
					}
				}
				create_archaeological_site = ixardian_digsite_4
				root.owner = {
					set_country_flag = ixardian_arc_chain_@prev
				}
				save_event_target_as = new_ixardian_digsite
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:new_ixardian_digsite }
			}
			closest_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = first_ixardian_site@root.owner
						has_star_flag = second_ixardian_site@root.owner
						is_same_value = root.owner.capital_scope.solar_system
						has_star_flag = hostile_system
					}
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					any_system_planet = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
				}
				min_steps = 1
				root.owner = { set_visited = prev }
				set_star_flag = third_ixardian_site@root.owner
				random_system_planet = {
					limit = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					create_archaeological_site = ixardian_digsite_4
					root.owner = {
						set_country_flag = ixardian_arc_chain_@prev
					}
					save_event_target_as = new_ixardian_digsite
				}
			}
		}
	}

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

####################################
# "Ancient Factory"
####################################

# Ixardian Digsite Stage 1
fleet_event = {
	id = FHMP.62
	#archaeology_window = yes
	title = "FHMP.62.name"
	desc = "FHMP.62.desc"
	picture = GFX_evt_gunrunning
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 2
fleet_event = {
	id = FHMP.63
	#archaeology_window = yes
	title = "FHMP.63.name"
	desc = "FHMP.63.desc"
	picture = GFX_evt_fleet_evil
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 3
fleet_event = {
	id = FHMP.64
	#archaeology_window = yes
	title = "FHMP.64.name"
	desc = "FHMP.64.desc"
	picture = GFX_evt_star_chart
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
		closest_system = {
			limit = { has_star_flag = first_ixardian_site@root.owner }
			save_event_target_as = ixardian_first_system
		}
	}
	
	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			hidden_effect = { country_event = { id = FHMP.65 } }
		}
	}
	
	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

# Ixardian home system(hidden)
country_event = {
	id = FHMP.65
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = ixardian_home_system_discovered
		set_country_flag = ixardian_home_system
		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_ixardian_1 }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_ixardian_1 }
				save_event_target_as = ixardian_home_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = ixardian_home_spawn_system
			}
		}
		event_target:ixardian_home_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "ixardian_home_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = FHMP.66 days = 5 }
	}
}

# Ixardian Home System
country_event = {
	id = FHMP.66
	title = "FHMP.66.name"
	desc = "FHMP.66.desc"
	picture = GFX_evt_star_chart
	location = event_target:ixardian_home_system
	show_sound = event_finding_loot

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = ixardian_home_system }
			save_event_target_as = ixardian_home_system
		}
		# observer_event = { id = observer.85 }
		event_target:ixardian_home_system = {
			random_neighbor_system = {
				save_event_target_as = ixardian_home_neighbor
			}
		}
	}

	option = {
		name = "precursor.100.a"
	}
}

###########################
# "Ixardian Headquarters" #
###########################

# Ixardian Digsite Stage 1
fleet_event = {
	id = FHMP.67
	#archaeology_window = yes
	title = "FHMP.67.name"
	desc = "FHMP.67.desc"
	picture = GFX_evt_ancient_databank
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 2
fleet_event = {
	id = FHMP.68
	#archaeology_window = yes
	title = "FHMP.68.name"
	desc = "FHMP.68.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 3
fleet_event = {
	id = FHMP.69
	#archaeology_window = yes
	title = "FHMP.69.name"
	desc = "FHMP.69.desc"
	picture = GFX_evt_burning_city
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Ixardian Digsite Stage 4
fleet_event = {
	id = FHMP.70
	title = "FHMP.70.name"
	desc = "FHMP.70.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "FHMP.70.a"
		owner = {
			set_country_flag = ixardian_world_found
			if = {
				limit = { has_ancrel = yes }
				add_relic = r_ixardian_database
				large_artifact_reward = yes
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 9999
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			add_monthly_resource_mult = {
				resource = energy
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
			if = {
				limit = { has_ancrel = yes }
				custom_tooltip = ixardian_artifact_research_unlocked
			}
			hidden_effect = {
				if = {
					limit = {
						NOT = { is_variable_set = FHMP_ixardian_usage }
					}
					set_variable = {
						which = FHMP_ixardian_usage
						value = 1
					}
				}
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

# Ixardian Artifact Research Complete
country_event = {
	id = FHMP.71
	title = FHMP.71.name
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = FHMP.71.desc.gestalt
	}
	desc = {
		trigger = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		text = FHMP.71.desc.normal
	}

	picture = GFX_evt_financial_instruments
	location = from

	is_triggered_only = yes

	option = {
		exclusive_trigger = {
			owner = {
				AND = {
					NOT = { has_technology = tech_galactic_markets }
					NOT = { has_ethic = ethic_gestalt_consciousness }
				}
			}
		}

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_statecraft }
				}
				add_trait = leader_trait_expertise_statecraft
			}
			else = {
				add_experience = 200
			}
		}

		name = INTERESTING
		owner = {
			give_technology = { tech = tech_galactic_markets }
			add_tech_progress = {
				tech = tech_secrets_ixardian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_ixardian_research_completed # +10% trade value
			days = -1
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				NOT = { has_technology = tech_manifest_destiny }
				has_ethic = ethic_gestalt_consciousness
			}
		}

		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_statecraft }
				}
				add_trait = leader_trait_expertise_statecraft
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			give_technology = { tech = tech_manifest_destiny }
			add_tech_progress = {
				tech = tech_secrets_ixardian_gestalt
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_ixardian_research_completed_gestalt # +2 starbase capacity
			days = -1
		}
	}

	option = {
		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_statecraft }
				}
				add_trait = leader_trait_expertise_statecraft
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			if = {
				limit = { has_ethic = ethic_gestalt_consciousness }
				add_tech_progress = {
					tech = tech_secrets_ixardian_gestalt
					progress = 0.1
				}
			}
			if = {
				limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
				add_tech_progress = {
					tech = tech_secrets_ixardian
					progress = 0.1
				}
			}
		}
		if = {
			limit = { has_ethic = ethic_gestalt_consciousness }
			add_modifier = {
				modifier = artifact_ixardian_research_completed_gestalt # +4 starbase capacity
				days = -1
			}
		}
		if = {
			limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
			add_modifier = {
				modifier = artifact_ixardian_research_completed # +10% trade value
				days = -1
			}
		}
	}
}

# Ixardian Database Activated
country_event = {
	id = FHMP.72
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = { #Backup if you get the relic through some odd way
			limit = {
				NOT = { is_variable_set = FHMP_ixardian_usage }
			}
			set_variable = {
				which = FHMP_ixardian_usage
				value = 1
			}
		}
		else = {
			change_variable = {
				which = FHMP_ixardian_usage
				value = 1
			}
		}
	}
}

###########################################
# "The Werediran Signal" by Metallichydra
###########################################

####################################
# "Weird Transmissions"
####################################

# Werediran Introduction
# via on_survey = {} | this = surveying vessel
ship_event = {
	id = FHMP.101
	title = "FHMP.101.name"
	desc = "FHMP.101.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
		owner = { scfe_can_find_precursor = yes }
		OR = {
			AND = {
				NOT = { has_global_flag = Precursor_Selection_installed }
				owner = {
					is_ai = no
					has_precursor_intro = no
				}
			}
			AND = {
				has_global_flag = Precursor_Selection_installed
				owner = {
					is_ai = no
					NOT = { has_country_flag = werediran_intro }
					has_country_flag = picked_werediran
				}
			}
		}
		solar_system = {
			has_star_flag = precursor_werediran_1
			NOR = {
				is_same_value = root.owner.capital_scope.solar_system
				has_star_flag = sol_system
			}
		}
		NOT = { has_global_flag = werediran_started }
		FROM = {
			has_anomaly = no
			is_star = no
			NOT = { exists = archaeological_site }
			NOT = { has_planet_flag = suppress_archaeological_sites }
			OR = {
				is_planet_class = pc_alpine
				is_planet_class = pc_tropical
				is_planet_class = pc_continental
			}
		}
	}
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = @origin_shoulders_multiplier
			owner = {
				has_origin = origin_shoulders_of_giants
				has_country_flag = origin_shoulders_closure
			}
		}
		modifier = {
			factor = 1000
			owner = {
				has_country_flag = picked_werediran
			}
		}
		#modifier = { # Werediran planets too rare to risk not getting it
		#	factor = 0
		#	owner = {
		#		has_country_flag = PreSelect_Recent_Discovery
		#	}
		#}
	}

	immediate = {
		set_global_flag = werediran_started
		owner = { set_country_flag = werediran_intro }
		owner = { set_timed_country_flag = { flag = PreSelect_Recent_Discovery days = 180 } }
		if = {
			limit = {
				has_PreSelect_active = no
			}
			owner = { set_country_flag = vultaum_intro }
		}
		solar_system = { set_star_flag = first_werediran_site@root.owner }
	}

	option = {
		name = CURIOUS
		hidden_effect = {
			owner = { country_event = { id = story.5 days = 30 } }
			from = { create_archaeological_site = werediran_digsite_1 }
			from = {
				save_global_event_target_as = werediran_planet_1
			}
		}
	}
}

# werediran Digsite Stage 1
fleet_event = {
	id = FHMP.102
	#archaeology_window = yes
	title = "FHMP.102.name"
	desc = "FHMP.102.desc"
	picture = GFX_evt_alien_ruins
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 2
fleet_event = {
	id = FHMP.103
	#archaeology_window = yes
	title = "FHMP.103.name"
	desc = "FHMP.103.desc"
	picture = GFX_evt_baol_ruins
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 3 # Spawn 2nd digsite
fleet_event = {
	id = FHMP.104
	title = "FHMP.104.name"
	desc = "FHMP.104.desc"
	picture = GFX_evt_broken_shackles
	show_sound = event_bad_omen
	location = from

	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		closest_system = {
			limit = {
				has_access_fleet = root.owner
				is_capital_system = no
				NOR = {
					is_same_value = root.solar_system
					has_star_flag = first_werediran_site@root.owner
					is_same_value = root.owner.capital_scope.solar_system
					has_star_flag = hostile_system
				}
				is_fe_cluster = no
				OR = {
					has_owner = no
					owner = { is_same_value = root.owner }
				}
				any_system_planet = {
					FHMP_is_valid_werediran_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites #for modders
					}
				}
				root.owner = {
					any_controlled_fleet = {
						is_ship_class = shipclass_science_ship
						can_access_system = prevprev
					}
				}
			}
			min_steps = 2
			max_steps = 4
			root.owner = { set_visited = prev }
			random_system_planet = {
				limit = {
					FHMP_is_valid_werediran_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites
					}
				}
				create_archaeological_site = werediran_digsite_2
				root.owner = {
					set_country_flag = werediran_arc_chain_@prev
				}
				save_event_target_as = new_werediran_digsite
			}
			set_star_flag = FHMP_werediran_system_2
		}
		if = {
			limit = {
				NOT = { exists = event_target:new_werediran_digsite }
			}
			closest_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = first_werediran_site@root.owner
						is_same_value = root.owner.capital_scope.solar_system
						has_star_flag = hostile_system
					}
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					any_system_planet = {
						FHMP_is_valid_werediran_planet = yes
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
				}
				min_steps = 1
				root.owner = { set_visited = prev }
				random_system_planet = {
					limit = {
						FHMP_is_valid_werediran_planet = yes
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					create_archaeological_site = werediran_digsite_2
					root.owner = {
						set_country_flag = werediran_arc_chain_@prev
					}
					save_event_target_as = new_werediran_digsite
				}
				set_star_flag = FHMP_werediran_system_2
			}
		}
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "FHMP.104.a"
		medium_artifact_reward = yes
		owner = {
			#set_country_flag = FHMP_werediran_strengthened_1
			country_event = { id = FHMP.105 days = 30 }
		}
	}
	
	#option = {
	#	name = "FHMP.104.b"
	#	medium_artifact_reward = yes
	#	owner = {
	#		country_event = { id = FHMP.105 days = 30 }
	#	}
	#}
}

# Recieve Signal
country_event = {
	id = FHMP.105
	title = "FHMP.105.name"
	desc = "FHMP.105.desc"
	picture = GFX_evt_star_chart
	show_sound = event_alien_signal
	location = from
	
	is_triggered_only = yes

	immediate = {
		closest_system = {
			limit = {
				has_star_flag = FHMP_werediran_system_2
			}
			save_event_target_as = FHMP_werediran_system_2
		}
	}

	option = {
		name = "FHMP.105.a"
		owner = {
			set_country_flag = FHMP_werediran_site_2_discovered
			country_event = { id = FHMP.106 }
		}
	}
}

# come
country_event = {
	id = FHMP.106
	title = "FHMP.106.name"
	desc = "FHMP.106.desc"
	location = event_target:new_werediran_digsite
	show_sound = event_fhmp_weredarin
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "DISCONCERTING"
	}
}

####################################
# "Mysterious Signal"
####################################

# werediran Digsite Stage 1
fleet_event = {
	id = FHMP.107
	#archaeology_window = yes
	title = "FHMP.107.name"
	desc = "FHMP.107.desc"
	picture = GFX_evt_alien_ruins
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 2
fleet_event = {
	id = FHMP.108
	#archaeology_window = yes
	title = "FHMP.108.name"
	desc = "FHMP.108.desc"
	picture = GFX_evt_broken_shackles
	show_sound = event_mystic_reveal
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}
# werediran Digsite Stage 3
fleet_event = {
	id = FHMP.109
	#archaeology_window = yes
	title = "FHMP.109.name"
	desc = "FHMP.109.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	specimen = FHMP_werediran_reciever
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 4
fleet_event = {
	id = FHMP.110
	#archaeology_window = yes
	title = "FHMP.110.name"
	desc = "FHMP.110.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		closest_system = {
			limit = {
				has_access_fleet = root.owner
				is_capital_system = no
				NOR = {
					is_same_value = root.solar_system
					has_star_flag = first_werediran_site@root.owner
					is_same_value = root.owner.capital_scope.solar_system
					has_star_flag = hostile_system
				}
				is_fe_cluster = no
				OR = {
					has_owner = no
					owner = { is_same_value = root.owner }
				}
				any_system_planet = {
					FHMP_is_valid_werediran_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites #for modders
					}
				}
				root.owner = {
					any_controlled_fleet = {
						is_ship_class = shipclass_science_ship
						can_access_system = prevprev
					}
				}
			}
			min_steps = 2
			max_steps = 4
			root.owner = { set_visited = prev }
			random_system_planet = {
				limit = {
					FHMP_is_valid_werediran_planet = yes
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites
					}
				}
				create_archaeological_site = werediran_digsite_3
				root.owner = {
					set_country_flag = werediran_arc_chain_@prev
				}
				save_event_target_as = new_werediran_digsite
			}
			save_global_event_target_as = FHMP_werediran_system_3
		}
		if = {
			limit = {
				NOT = { exists = event_target:new_werediran_digsite }
			}
			closest_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = first_werediran_site@root.owner
						is_same_value = root.owner.capital_scope.solar_system
						has_star_flag = hostile_system
					}
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					any_system_planet = {
						FHMP_is_valid_werediran_planet = yes
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
				}
				min_steps = 1
				root.owner = { set_visited = prev }
				random_system_planet = {
					limit = {
						FHMP_is_valid_werediran_planet = yes
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					create_archaeological_site = werediran_digsite_3
					root.owner = {
						set_country_flag = werediran_arc_chain_@prev
					}
					save_event_target_as = new_werediran_digsite
				}
				save_global_event_target_as = FHMP_werediran_system_3
			}
		}
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			owner = {
				country_event = { id = FHMP.111 days = 90 }
			}
		}
	}
}

# Recieve Second Signal
country_event = {
	id = FHMP.111
	title = "FHMP.111.name"
	desc = "FHMP.111.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_alien_signal
	location = from

	is_triggered_only = yes

	immediate = {
		closest_system = {
			limit = {
				has_star_flag = FHMP_werediran_system_3
			}
			save_event_target_as = FHMP_werediran_system_3
		}
	}

	option = {
		name = "FHMP.105.a"
		owner = {
			set_country_flag = FHMP_werediran_site_3_discovered
			country_event = { id = FHMP.112 }
		}
	}
}

# come to me
country_event = {
	id = FHMP.112
	title = "FHMP.112.name"
	desc = "FHMP.112.desc"
	location = event_target:new_werediran_digsite
	show_sound = event_fhmp_weredarin
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "DISCONCERTING"
	}
}

####################################
# "Satellite Dish"
####################################

# werediran Digsite Stage 1
fleet_event = {
	id = FHMP.113
	#archaeology_window = yes
	title = "FHMP.113.name"
	desc = "FHMP.113.desc"
	picture = GFX_evt_archaeology_camp
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 2
fleet_event = {
	id = FHMP.114
	#archaeology_window = yes
	title = "FHMP.114.name"
	desc = "FHMP.114.desc"
	picture = GFX_evt_ancient_databank
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 3
fleet_event = {
	id = FHMP.115
	#archaeology_window = yes
	title = "FHMP.115.name"
	desc = "FHMP.115.desc"
	picture = GFX_evt_mysterious_signal
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 4
fleet_event = {
	id = FHMP.116
	#archaeology_window = yes
	title = "FHMP.116.name"
	desc = "FHMP.116.desc"
	picture = GFX_evt_intelligence_report
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			if = {
				limit = { has_ancrel = yes }
				add_tech_progress = {
					tech = tech_secrets_werediran
					progress = 0.1
				}
			}
			if = {
				limit = { has_ancrel = no }
				add_tech_progress = {
					tech = tech_werediran_tower
					progress = 0.1
				}
			}
			begin_event_chain = {
				event_chain = "FHMP_werediran_chain"
				target = ROOT
			}
			#set_country_flag = FHMP_tower_blueprints
			#country_event = { id = FHMP.117 days = 360 }
			#country_event = { id = FHMP.117 days = 720 }
			#country_event = { id = FHMP.117 days = 1080 }
			#country_event = { id = FHMP.118 days = 1440 }
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = from
        }
	}
}

# Recieve Strengthening Signal
country_event = {
	id = FHMP.117
	title = "FHMP.117.name"
	desc = "FHMP.117.desc"
	show_sound = event_fhmp_weredarin
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_flag = FHMP_recieved_signal }
	}

	picture_event_data = {
		room = no_video_feed_room
	}

	is_triggered_only = yes
	
	immediate = {
		set_country_flag = FHMP_recieved_signal
	}

	option = {
		name = "FHMP.117.a"
	}
}

# The Final Signal
country_event = {
	id = FHMP.118
	title = "FHMP.118.name"
	desc = "FHMP.118.desc"
	show_sound = event_fhmp_weredarin
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = werediran_room
	}

	fire_only_once = yes

	immediate = {
		if = {
			limit = { check_variable = { which = FHMP_tower_build_count value >= 1 } }
			set_country_flag = FHMP_signal_1
		}
		if = {
			limit = { check_variable = { which = FHMP_tower_build_count value >= 2 } }
			set_country_flag = FHMP_signal_2
			remove_country_flag = FHMP_signal_1
		}
		if = {
			limit = { check_variable = { which = FHMP_tower_build_count value >= 3 } }
			set_country_flag = FHMP_signal_3
			remove_country_flag = FHMP_signal_2
		}
		if = {
			limit = { check_variable = { which = FHMP_tower_build_count value >= 4 } }
			set_country_flag = FHMP_signal_4
			remove_country_flag = FHMP_signal_3
		}
		if = {
			limit = { check_variable = { which = FHMP_tower_build_count value > 5 } }
			set_country_flag = FHMP_signal_5
			remove_country_flag = FHMP_signal_4
		}
		set_global_flag = werediran_homeworld_system_discovered
		set_country_flag = werediran_homeworld_system
		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_werediran_1 }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_werediran_1 }
				save_event_target_as = werediran_homeworld_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = werediran_homeworld_spawn_system
			}
		}
		
		event_target:werediran_homeworld_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "werediran_homeworld_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = FHMP.119 days = 5 }
	}

	option = {
		name = "FHMP.118.a"
		end_event_chain = "FHMP_werediran_chain"
	}
}

#The Werediran Home System
country_event = {
	id = FHMP.119
	title = "FHMP.119.name"
	desc = "FHMP.119.desc"
	picture = GFX_evt_star_chart
	location = event_target:werediran_home_system
	show_sound = event_finding_loot

	specimen = FHMP_werediran_signal

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = werediran_home_system }
			save_event_target_as = werediran_home_system
		}
		# observer_event = { id = observer.85 }
		event_target:werediran_home_system = {
			random_neighbor_system = {
				save_event_target_as = werediran_homeworld_neighbor
			}
		}
	}

	option = {
		name = "DISCONCERTING"
	}
}

####################################
# "Organic Planet"
####################################

# werediran Digsite Stage 1
fleet_event = {
	id = FHMP.120
	#archaeology_window = yes
	title = "FHMP.120.name"
	desc = "FHMP.120.desc"
	picture = GFX_evt_archaeology_camp
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 2
fleet_event = {
	id = FHMP.121
	#archaeology_window = yes
	title = "FHMP.121.name"
	desc = "FHMP.121.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 3
fleet_event = {
	id = FHMP.122
	#archaeology_window = yes
	title = "FHMP.122.name"
	desc = {
		trigger = { owner = { has_technology = tech_psionic_theory } }
		text = FHMP.122.desc.psionic
	}
	desc = {
		trigger = {
			NOT = { owner = { has_technology = tech_psionic_theory } }
		}
		text = FHMP.122.desc.unknown
	}
	picture = GFX_evt_mysterious_signal
	show_sound = event_bad_omen
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			if = {
				limit = {
					NOT = { has_technology = tech_psionic_theory }
					is_regular_empire = yes
				}
				add_tech_progress = {
					tech = tech_psionic_theory
					progress = 0.1
				}
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 4
fleet_event = {
	id = FHMP.123
	#archaeology_window = yes
	title = "FHMP.123.name"
	desc = "FHMP.123.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# werediran Digsite Stage 5
fleet_event = {
	id = FHMP.124
	#archaeology_window = yes
	title = "FHMP.124.name"
	desc = "FHMP.124.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_alien_signal
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "FHMP.124.a"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			country_event = { id = FHMP.125 }
		}
	}
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	
	after = {
		from = { set_site_progress_locked = no }
	}
}

# Talking to the planet
country_event = {
	id = FHMP.125
	title = "FHMP.125.name"
	desc = "FHMP.125.desc"
	location = this
	diplomatic_title = BLANK_STRING

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = werediran_orb_room
	}
	
	show_sound = event_fhmp_weredarin

	option = {
		name = "FHMP.125.a"
		response_text = "FHMP.125.a.response"
		is_dialog_only = yes
	}
	option = {
		name = "FHMP.125.b"
		response_text = "FHMP.125.b.response"
		is_dialog_only = yes
	}
	option = {
		name = "FHMP.125.c"
		response_text = "FHMP.125.c.response"
		is_dialog_only = yes
	}
	option = {
		name = "FHMP.125.d"
		owner = {
			owner = {
				if = {
					limit = { has_ancrel = yes }
					add_relic = r_werediran_core
					large_artifact_reward = yes
					set_country_flag = werediran_world_found
				}
				add_monthly_resource_mult = {
					resource = unity
					value = 120
					min = 240
					max = 9999
				}
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
				add_monthly_resource_mult = {
					resource = energy
					value = @tier4materialreward
					min = @tier4materialmin
					max = @tier4materialmax
				}
				if = {
					limit = { has_ancrel = yes }
					custom_tooltip = werediran_artifact_research_unlocked
				}
			}
		}
	}
	
	after = {
		if = {
            limit = { owner = { has_policy_flag = scfe_archaeology_cleanup_active } }
            destroy_archaeological_site = fromfrom
        }
	}
}

# Werediran Artifact Research Complete
country_event = {
	id = FHMP.126
	title = FHMP.126.name
	desc = {
		trigger = { has_technology = tech_sensors_4 }
		text = FHMP.126.desc.sensors
	}
	desc = {
		trigger = {
			NOT = { has_technology = tech_sensors_4 }
		}
		text = FHMP.126.desc.hostile
	}

	picture = GFX_evt_mysterious_signal
	location = from

	is_triggered_only = yes

	option = {
		exclusive_trigger = {
			NOT = { has_technology = tech_sensors_4 }
		}

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_biology }
				}
				add_trait = leader_trait_expertise_biology
			}
			else = {
				add_experience = 200
			}
		}

		name = INTERESTING
		owner = {
			give_technology = { tech = tech_sensors_4 }
		}
		add_modifier = {
			modifier = artifact_werediran_research_completed # encryption
			days = -1
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				has_technology = tech_sensors_4
				NOT = { has_technology = tech_colonization_3 }
			}
		}

		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_biology }
				}
				add_trait = leader_trait_expertise_biology
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			give_technology = { tech = tech_colonization_3 }
		}
		add_modifier = {
			modifier = artifact_werediran_research_completed # encryption
			days = -1
		}
	}

	option = {
		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_biology }
				}
				add_trait = leader_trait_expertise_biology
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		add_modifier = {
			modifier = artifact_werediran_research_completed # encryption
			days = -1
		}
	}
}

# Werediran Core Activated
country_event = {
	id = FHMP.127
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		add_modifier = {
			modifier = FHMP_werediran_signal
			days = 3600
		}
	}
}

###########################################
# "Ezentian Combine" by Metallichydra
###########################################

####################################
# "Broken Planet"
####################################

# Ezentian Introduction
# via on_survey = {} | this = surveying vessel
ship_event = {
	id = FHMP.151
	title = "FHMP.151.name"
	desc = "FHMP.151.desc"
	picture = GFX_evt_egg_cracked
	show_sound = event_default
	location = from

	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
		owner = { scfe_can_find_precursor = yes }
		OR = {
			AND = {
				NOT = { has_global_flag = Precursor_Selection_installed }
				owner = {
					is_ai = no
					has_precursor_intro = no
				}
			}
			AND = {
				has_global_flag = Precursor_Selection_installed
				owner = {
					is_ai = no
					NOT = { has_country_flag = ezentian_intro }
					has_country_flag = picked_ezentian
				}
			}
		}
		solar_system = {
			has_star_flag = precursor_ezentian_1
			NOR = {
				is_same_value = root.owner.capital_scope.solar_system
				has_star_flag = sol_system
			}
		}
		NOT = { has_global_flag = ezentian_started }
		FROM = {
			has_anomaly = no
			NOT = { exists = archaeological_site }
			NOT = { has_planet_flag = suppress_archaeological_sites }
			OR = {
				is_planet_class = pc_barren
				is_planet_class = pc_barren_cold
			}
			NOT = { has_modifier = terraforming_candidate }
		}
	}
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = @origin_shoulders_multiplier
			owner = {
				has_origin = origin_shoulders_of_giants
				has_country_flag = origin_shoulders_closure
			}
		}
		modifier = {
			factor = 1000
			owner = {
				has_country_flag = picked_ezentian
			}
		}
		modifier = {
			factor = 0
			owner = {
				has_country_flag = PreSelect_Recent_Discovery
			}
		}
	}

	immediate = {
		set_global_flag = ezentian_started
		owner = { set_country_flag = ezentian_intro }
		owner = { set_timed_country_flag = { flag = PreSelect_Recent_Discovery days = 180 } }
		if = {
			limit = {
				has_PreSelect_active = no
			}
			owner = { set_country_flag = vultaum_intro }
		}
		from = {
			change_pc = pc_broken
			set_planet_flag = FHMP_ezentian_planet_1
		}
		solar_system = { set_star_flag = first_ezentian_site@root.owner }
	}

	option = {
		name = CURIOUS
		hidden_effect = {
			owner = { country_event = { id = story.5 days = 30 } }
			from = { create_archaeological_site = ezentian_digsite_1 }
			from = {
				save_global_event_target_as = ezentian_planet_1
			}
		}
	}
}

# Ezentian Digsite Stage 1
fleet_event = {
	id = FHMP.152
	#archaeology_window = yes
	title = "FHMP.152.name"
	desc = "FHMP.152.desc"
	picture = GFX_evt_mining_operations
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 2
fleet_event = {
	id = FHMP.153
	#archaeology_window = yes
	title = "FHMP.153.name"
	desc = "FHMP.153.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = {
					is_star = no
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						has_planet_flag = suppress_archaeological_sites
					}
					NOT = { is_planet_class = pc_gas_giant }
				}
				create_archaeological_site = ezentian_digsite_2
				root.owner = {
					set_country_flag = ezentian_arc_chain_@prev
				}
				save_event_target_as = new_ezentian_digsite
			}
			set_star_flag = FHMP_ezentian_system_2
		}
		if = {
			limit = {
				NOT = { exists = event_target:new_ezentian_digsite }
			}
			closest_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = first_ezentian_site@root.owner
						is_same_value = root.owner.capital_scope.solar_system
						has_star_flag = hostile_system
					}
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					any_system_planet = {
						is_star = no
						NOT = { is_planet_class = pc_gas_giant }
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
				}
				min_steps = 1
				root.owner = { set_visited = prev }
				random_system_planet = {
					limit = {
						is_star = no
						NOT = { is_planet_class = pc_gas_giant }
						has_anomaly = no
						NOR = {
							exists = archaeological_site
							has_planet_flag = hatchling_egg
							has_planet_flag = suppress_archaeological_sites
						}
					}
					create_archaeological_site = ezentian_digsite_2
					root.owner = {
						set_country_flag = ezentian_arc_chain_@prev
					}
					save_event_target_as = new_ezentian_digsite
				}
				set_star_flag = FHMP_ezentian_system_2
			}
		}
	}

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			country_event = { id = FHMP.154 days = 20 random = 10 }
		}
		#from = {
		#	planet = {
		#		hidden_effect = {
		#			planet_event = { id = FHMP.154 days = 20 random = 10 }
		#		}
		#	}
		#}
	}
}

# Survey Finished # Spawn 2nd digsite
country_event = {
	id = FHMP.154
	title = "FHMP.154.name"
	desc = "FHMP.154.desc"
	picture = GFX_evt_crashed_station
	show_sound = event_finding_loot

	is_triggered_only = yes

	option = {
		name = "FHMP.154.a"
		set_country_flag = FHMP_ezentian_site_2_revealed
	}
}

####################################
# "Crashed Ship"
####################################

# Ezentian Second Digsite Stage 1
fleet_event = {
	id = FHMP.155
	#archaeology_window = yes
	title = "FHMP.155.name"
	desc = "FHMP.155.desc"
	picture = GFX_evt_mining_station
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = FHMP_ezentian_planet_1 }
				save_event_target_as = FHMP_first_digsite_planet
			}
		}
	}

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Second Digsite Stage 2
fleet_event = {
	id = FHMP.156
	#archaeology_window = yes
	title = "FHMP.156.name"
	desc = "FHMP.156.desc"
	picture = GFX_evt_planet_beam
	show_sound = event_default
	location = from
	
	specimen = FHMP_ezentian_station
	
	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "FHMP.156.a"
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_pacifist
					has_ethic = ethic_fanatic_pacifist
				}
			}
		}
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	option = {
		name = "FHMP.156.b"
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
				}
			}
		}
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
	
	option = {
		name = "FHMP.156.c"
		trigger = {
			owner = {
				NOT = {
					OR = {
						has_ethic = ethic_militarist
						has_ethic = ethic_fanatic_militarist
						has_ethic = ethic_pacifist
						has_ethic = ethic_fanatic_pacifist
					}
				}
			}
		}
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Search for Ezentian Systems
fleet_event = {
	id = FHMP.157
	title = "FHMP.157.name"
	desc = "FHMP.157.desc"
	picture = GFX_evt_star_chart
	show_sound = event_sensor_ping
	
	location = from
	
	archaeology = yes

	trigger = {
		owner = {
			is_ai = no
		}
	}

	is_triggered_only = yes

	immediate = {
	owner = {
		set_country_flag = FHMP_ezentian_chain_begun
		capital_scope = { save_event_target_as = capital }
		begin_event_chain = {
			event_chain = "FHMP_ezentian_chain"
			target = ROOT
		}
		hidden_effect = {
			random_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					distance = {
						source = event_target:capital
						use_bypasses = no
						min_jumps = 2
						max_jumps = 6
					}
					NOR = {
						has_star_flag = hostile_system
						has_star_flag = FHMP_ezentian_chain_system
					}
					any_system_planet = {
						has_anomaly = no
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						NOT = { has_modifier = terraforming_candidate }
					}
				}
				save_event_target_as = FHMP_ezentian_system_1
				set_star_flag = FHMP_ezentian_chain_system
				set_star_flag = FHMP_ezentian_forge_system
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "abandoned_starbase_01_object"
					location = solar_system
				}
			}
			random_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					distance = {
						source = event_target:capital
						use_bypasses = no
						min_jumps = 4
						max_jumps = 8
					}
					NOR = {
						has_star_flag = hostile_system
						has_star_flag = FHMP_ezentian_chain_system
					}
					any_system_planet = {
						has_anomaly = no
						is_star = no
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						NOT = { has_modifier = terraforming_candidate }
					}
				}
				save_event_target_as = FHMP_ezentian_system_2
				set_star_flag = FHMP_ezentian_chain_system
				set_star_flag = FHMP_ezentian_battle_system
				create_ambient_object = {
					type = "medium_debris_02_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "medium_debris_02_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "medium_debris_02_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "abandoned_starbase_01_object"
					location = solar_system
				}
			}
			random_system = {
				limit = {
					has_access_fleet = root.owner
					is_capital_system = no
					is_fe_cluster = no
					OR = {
						has_owner = no
						owner = { is_same_value = root.owner }
					}
					distance = {
						source = event_target:capital
						use_bypasses = no
						min_jumps = 3
						max_jumps = 7
					}
					NOR = {
						has_star_flag = hostile_system
						has_star_flag = FHMP_ezentian_chain_system
					}
					any_system_planet = {
						has_anomaly = no
						is_star = no
						is_planet_class = pc_barren
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						NOT = { has_modifier = terraforming_candidate }
					}
				}
				save_event_target_as = FHMP_ezentian_system_3
				set_star_flag = FHMP_ezentian_chain_system
				set_star_flag = FHMP_ezentian_harvested_system
				random_system_planet = {
					limit = {
						has_anomaly = no
						is_star = no
						is_planet_class = pc_barren
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						NOT = { has_modifier = terraforming_candidate }
					}
					change_pc = pc_broken
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "small_debris_object"
					location = solar_system
				}
				create_ambient_object = {
					type = "abandoned_starbase_01_object"
					location = solar_system
				}
			}
			if = {
				limit = {
					NOT = { exists = event_target:FHMP_ezentian_system_1 }
				}
				closest_system = {
					limit = {
						has_access_fleet = root.owner
						is_capital_system = no
						is_fe_cluster = no
						OR = {
							has_owner = no
							owner = { is_same_value = root.owner }
						}
						NOR = {
							has_star_flag = hostile_system
							has_star_flag = FHMP_ezentian_chain_system
						}
						any_system_planet = {
							has_anomaly = no
							is_star = no
							NOT = { exists = archaeological_site }
							NOT = { has_planet_flag = suppress_archaeological_sites }
							OR = {
								is_planet_class = pc_barren
								is_planet_class = pc_barren_cold
							}
							NOT = { has_modifier = terraforming_candidate }
						}
					}
					min_steps = 1
					save_event_target_as = FHMP_ezentian_system_1
					set_star_flag = FHMP_ezentian_chain_system
					set_star_flag = FHMP_ezentian_forge_system
					create_ambient_object = {
						type = "small_debris_object"
						location = solar_system
					}
					create_ambient_object = {
						type = "small_debris_object"
						location = solar_system
					}
					create_ambient_object = {
						type = "small_debris_object"
						location = solar_system
					}
					create_ambient_object = {
						type = "abandoned_starbase_01_object"
						location = solar_system
					}
				}
			}
			if = {
				limit = {
					NOT = { exists = event_target:FHMP_ezentian_system_2 }
				}
				closest_system = {
					limit = {
						has_access_fleet = root.owner
						is_capital_system = no
						is_fe_cluster = no
						OR = {
							has_owner = no
							owner = { is_same_value = root.owner }
						}
						NOR = {
							has_star_flag = hostile_system
							has_star_flag = FHMP_ezentian_chain_system
						}
						any_system_planet = {
							has_anomaly = no
							is_star = no
							NOT = { exists = archaeological_site }
							NOT = { has_planet_flag = suppress_archaeological_sites }
							NOT = { has_modifier = terraforming_candidate }
						}
					}
					min_steps = 1
					save_event_target_as = FHMP_ezentian_system_2
					set_star_flag = FHMP_ezentian_chain_system
					set_star_flag = FHMP_ezentian_battle_system
					create_ambient_object = {
						type = "small_debris_object"
						location = solar_system
					}
					create_ambient_object = {
						type = "small_debris_object"
						location = solar_system
					}
					create_ambient_object = {
						type = "small_debris_object"
						location = solar_system
					}
					create_ambient_object = {
						type = "abandoned_starbase_01_object"
						location = solar_system
					}
				}
			}
			if = {
				limit = {
					NOT = { exists = event_target:FHMP_ezentian_system_3 }
				}
				closest_system = {
					limit = {
						has_access_fleet = root.owner
						is_capital_system = no
						is_fe_cluster = no
						OR = {
							has_owner = no
							owner = { is_same_value = root.owner }
						}
						NOR = {
							has_star_flag = hostile_system
							has_star_flag = FHMP_ezentian_chain_system
						}
						any_system_planet = {
							has_anomaly = no
							is_star = no
							NOT = { exists = archaeological_site }
							NOT = { has_planet_flag = suppress_archaeological_sites }
							OR = {
								is_planet_class = pc_barren
							}
							NOT = { has_modifier = terraforming_candidate }
						}
					}
					min_steps = 1
					save_event_target_as = FHMP_ezentian_system_3
					set_star_flag = FHMP_ezentian_chain_system
					set_star_flag = FHMP_ezentian_harvested_system
					random_system_planet = {
						limit = {
							has_anomaly = no
							is_star = no
							is_planet_class = pc_barren
							NOT = { exists = archaeological_site }
							NOT = { has_planet_flag = suppress_archaeological_sites }
							NOT = { has_modifier = terraforming_candidate }
						}
						change_pc = pc_broken
					}
				}
			}
			create_point_of_interest = {
				id = FHMP_ezentian_search_poi.1
				name = "FHMP_ezentian_search_1_poi"
				desc = "FHMP_ezentian_search_1_poi_desc"
				event_chain = "FHMP_ezentian_chain"
				location = event_target:FHMP_ezentian_system_1
			}
			create_point_of_interest = {
				id = FHMP_ezentian_search_poi.2
				name = "FHMP_ezentian_search_2_poi"
				desc = "FHMP_ezentian_search_1_poi_desc"
				event_chain = "FHMP_ezentian_chain"
				location = event_target:FHMP_ezentian_system_2
			}
			create_point_of_interest = {
				id = FHMP_ezentian_search_poi.3
				name = "FHMP_ezentian_search_3_poi"
				desc = "FHMP_ezentian_search_1_poi_desc"
				event_chain = "FHMP_ezentian_chain"
				location = event_target:FHMP_ezentian_system_3
			}
		}
	}
	}

	option = {
		name = "FHMP.157.a"
		custom_tooltip = FHMP.157.a.tooltip
	}
}

# Entering Ezentian System (HIDDEN)
fleet_event = {
	id = FHMP.158
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		owner = {
			has_event_chain = "FHMP_ezentian_chain"
			FROM = {
				OR = {
					is_point_of_interest = {
						id = FHMP_ezentian_search_poi.1
						event_chain = FHMP_ezentian_chain
						owner = root.owner
					}
					is_point_of_interest = {
						id = FHMP_ezentian_search_poi.2
						event_chain = FHMP_ezentian_chain
						owner = root.owner
					}
					is_point_of_interest = {
						id = FHMP_ezentian_search_poi.3
						event_chain = FHMP_ezentian_chain
						owner = root.owner
					}
				}
			}
		}
	}

	immediate = {
		if = {
			limit = { FROM = { has_star_flag = FHMP_ezentian_forge_system } }
			FROM = { remove_star_flag = FHMP_ezentian_forge_system }
			owner = { remove_point_of_interest = FHMP_ezentian_search_poi.1 }
			solar_system = {
				save_global_event_target_as = FHMP_ezentian_battle_planet_target
				random_system_planet = {
					limit = {
						has_anomaly = no
						is_star = no
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						NOT = { has_modifier = terraforming_candidate }
					}
					set_planet_flag = FHMP_ezentian_target_planet
					set_planet_flag = FHMP_ezentian_forge_planet
				}
			}
		}
		if = {
			limit = { FROM = { has_star_flag = FHMP_ezentian_battle_system } }
			FROM = { remove_star_flag = FHMP_ezentian_battle_system }
			owner = { remove_point_of_interest = FHMP_ezentian_search_poi.2 }
			solar_system = {
				random_system_planet = {
					limit = {
						has_anomaly = no
						is_star = no
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						NOT = { has_modifier = terraforming_candidate }
					}
					set_planet_flag = FHMP_ezentian_target_planet
					set_planet_flag = FHMP_ezentian_battle_planet
				}
			}
		}
		if = {
			limit = { FROM = { has_star_flag = FHMP_ezentian_harvested_system } }
			FROM = { remove_star_flag = FHMP_ezentian_harvested_system }
			owner = { remove_point_of_interest = FHMP_ezentian_search_poi.3 }
			solar_system = {
				random_system_planet = {
					limit = {
						is_planet_class = pc_broken
						has_anomaly = no
						is_star = no
						NOT = { exists = archaeological_site }
						NOT = { has_planet_flag = suppress_archaeological_sites }
						NOT = { has_modifier = terraforming_candidate }
					}
					set_planet_flag = FHMP_ezentian_target_planet
					set_planet_flag = FHMP_ezentian_harvested_planet
				}
			}
		}
		random_controlled_ship = {
			random_list = {
				20 = { # Ezentian System Entered
					ship_event = { id = FHMP.159 }
				}
			}
		}
	}
}

# Entering Ezentian System (popup)
ship_event = {
	id = FHMP.159
	title = "FHMP.159.name"
	desc = "FHMP.159.desc"
	picture = GFX_evt_ruined_system
	show_sound = event_mystic_reveal
	location = event_target:FHMP_target_planet
	trackable = yes

	is_triggered_only = yes

	immediate = {
		fleet = {
			solar_system = {
				random_system_planet = {
					limit = { has_planet_flag = FHMP_ezentian_target_planet }
					save_event_target_as = FHMP_target_planet
				}
			}
		}
	}

	option = {
		name = OK
		custom_tooltip = FHMP.159.a.tooltip
		owner = { add_event_chain_counter = { event_chain = FHMP_ezentian_chain counter = ezentian_systems_found amount = 1 } }
		hidden_effect = {
			event_target:FHMP_target_planet = {
				if = {
					limit = { has_planet_flag = FHMP_ezentian_forge_planet }
					create_archaeological_site = ezentian_digsite_3
				}
				if = {
					limit = { has_planet_flag = FHMP_ezentian_battle_planet }
					create_archaeological_site = ezentian_digsite_4
				}
				if = {
					limit = { has_planet_flag = FHMP_ezentian_harvested_planet }
					create_archaeological_site = ezentian_digsite_5
				}
			}
		}
	}
}

####################################
# Ezentian Search Digsites
####################################

# The way they work, is that after the digsite is finished, an event fires, which checks if all digsites have been finished, and if they have, the home system is revealed

# Event For checking:

# Finishing an ezentian digsite (hidden)
country_event = {
	id = FHMP.160
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				NOR = {
					has_global_flag = ezentian_system_discovered
					has_country_flag = ezentian_system
				}
				has_completed_event_chain_counter = {
					event_chain = "FHMP_ezentian_chain"
					counter = "ezentian_digsites_finished"
				}
			}
			country_event = { id = FHMP.161 }
		}
	}
}

# Finishing the last ezentian digsite (hidden) (spawns home system)
country_event = {
	id = FHMP.161
	hide_window = yes

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = ezentian_system_discovered
		set_country_flag = ezentian_system

		if = {
			limit = {
				any_system_within_border = { has_star_flag = precursor_ezentian_1 }
			}
			random_system_within_border = {
				limit = { has_star_flag = precursor_ezentian_1 }
				save_event_target_as = precursor_spawn_system
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = precursor_spawn_system
			}
		}
		event_target:precursor_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "FHMP_ezentian_home_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes
			}
		}
		country_event = { id = FHMP.162 days = 2 }
	}
}

####################################
# "Ezentian Home System Discovered"
####################################

# Ezentian Home System Discovered
country_event = {
	id = FHMP.162
	title = "FHMP.162.name"
	desc = "FHMP.162.desc"
	picture = GFX_evt_federation_fleet
	location = event_target:ezentar

	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = FHMP_ezentian_home_system }
			save_event_target_as = ezentar
			root = { set_visited = prev }
			random_system_planet = {
				limit = { has_planet_flag = FHMP_kantabaan }
				save_event_target_as = kantabaan
			}
		}
		#observer_event = { id = observer.56 }
	}

	option = {
		name = "precursor.100.a"
		end_event_chain = "FHMP_ezentian_chain"
	}
}

####################################
# "Forge World"
####################################

# Ezentian Digsite Stage 1
fleet_event = {
	id = FHMP.170
	#archaeology_window = yes
	title = "FHMP.170.name"
	desc = "FHMP.170.desc"
	picture = GFX_evt_habitable_dig_site
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 2
fleet_event = {
	id = FHMP.171
	#archaeology_window = yes
	title = "FHMP.171.name"
	desc = "FHMP.171.desc"
	picture = GFX_evt_resource_cache
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier3materialreward
				min = @tier3materialmin
				max = @tier3materialmax
			}
		}
	}
}

# Ezentian Digsite Stage 3
fleet_event = {
	id = FHMP.172
	#archaeology_window = yes
	title = "FHMP.172.name"
	desc = "FHMP.172.desc"
	picture = GFX_evt_ship_offloading_cargo
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_event_chain_counter = { event_chain = FHMP_ezentian_chain counter = ezentian_digsites_finished amount = 1 }
			hidden_effect = {
				country_event = { id = FHMP.160 }
			}
		}
	}
}

####################################
# "Signs of Battle"
####################################

# Ezentian Digsite Stage 1
fleet_event = {
	id = FHMP.173
	#archaeology_window = yes
	title = "FHMP.173.name"
	desc = "FHMP.173.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 2
fleet_event = {
	id = FHMP.174
	#archaeology_window = yes
	title = "FHMP.174.name"
	desc = "FHMP.174.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 3
fleet_event = {
	id = FHMP.175
	#archaeology_window = yes
	title = "FHMP.175.name"
	desc = "FHMP.175.desc"
	picture = GFX_evt_ruined_system
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_event_chain_counter = { event_chain = FHMP_ezentian_chain counter = ezentian_digsites_finished amount = 1 }
			hidden_effect = {
				country_event = { id = FHMP.160 }
			}
		}
	}
}

####################################
# "Harvested Planet"
####################################

# Ezentian Digsite Stage 1
fleet_event = {
	id = FHMP.177
	#archaeology_window = yes
	title = "FHMP.177.name"
	desc = "FHMP.177.desc"
	picture = GFX_evt_mining_operations
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 2
fleet_event = {
	id = FHMP.178
	#archaeology_window = yes
	title = "FHMP.178.name"
	desc = "FHMP.178.desc"
	picture = GFX_evt_pirates_attacking_cargo
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 3
fleet_event = {
	id = FHMP.179
	#archaeology_window = yes
	title = "FHMP.179.name"
	desc = "FHMP.179.desc"
	picture = GFX_evt_machine_space_battle
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 4
fleet_event = {
	id = FHMP.180
	#archaeology_window = yes
	title = "FHMP.180.name"
	desc = "FHMP.180.desc"
	picture = GFX_evt_star_chart
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
			add_event_chain_counter = { event_chain = FHMP_ezentian_chain counter = ezentian_digsites_finished amount = 1 }
			hidden_effect = {
				country_event = { id = FHMP.160 }
			}
		}
	}
}

####################################
# "Kantabaan"
####################################

# Ezentian Digsite Stage 1
fleet_event = {
	id = FHMP.181
	#archaeology_window = yes
	title = "FHMP.181.name"
	desc = "FHMP.181.desc"
	picture = GFX_evt_archaeology_camp
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 2
fleet_event = {
	id = FHMP.182
	#archaeology_window = yes
	title = "FHMP.182.name"
	desc = "FHMP.182.desc"
	picture = GFX_evt_ancient_records
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 3
fleet_event = {
	id = FHMP.183
	#archaeology_window = yes
	title = "FHMP.183.name"
	desc = "FHMP.183.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Ezentian Digsite Stage 4
fleet_event = {
	id = FHMP.184
	#archaeology_window = yes
	title = "FHMP.184.name"
	desc = "FHMP.184.desc"
	picture = GFX_evt_fallen_empire
	show_sound = event_default
	location = from

	archaeology = yes

	is_triggered_only = yes

	option = {
		name = "CURIOUS"
		owner = {
			if = {
				limit = { has_ancrel = yes }
				small_artifact_reward = yes
			}
		}
	}
}

# Kantabaan Digsite Stage 5
fleet_event = {
	id = FHMP.185
	title = "FHMP.185.name"
	desc = "FHMP.185.desc"
	picture = GFX_evt_ancient_records
	show_sound = event_finding_loot
	location = from

	archaeology = yes

	specimen = FHMP_ezentian_memorial_stone

	is_triggered_only = yes

	option = {
		name = "FHMP.185.a"
		owner = {
			set_country_flag = ezentian_world_found
			if = {
				limit = { has_ancrel = yes }
				add_relic = r_ezentian_core
				large_artifact_reward = yes
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 9999
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			add_monthly_resource_mult = {
				resource = energy
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
			if = {
				limit = { has_ancrel = yes }
				custom_tooltip = ezentian_artifact_research_unlocked
			}
		}
	}
}

# Ezentian Artifact Research Complete
country_event = {
	id = FHMP.186
	title = FHMP.186.name
	desc = {
		trigger = { has_technology = tech_ship_armor_5 }
		text = FHMP.186.desc.alloys
	}
	desc = {
		trigger = {
			NOT = { has_technology = tech_ship_armor_5 }
		}
		text = FHMP.186.desc.armor
	}

	picture = GFX_evt_ringworld
	location = from

	is_triggered_only = yes

	option = {
		exclusive_trigger = {
			NOT = { has_technology = tech_ship_armor_5 }
		}

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_materials }
				}
				add_trait = leader_trait_expertise_materials
			}
			else = {
				add_experience = 200
			}
		}

		name = INTERESTING
		owner = {
			give_technology = { tech = tech_ship_armor_5 }
			add_tech_progress = {
				tech = tech_secrets_ezentian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_ezentian_research_completed # encryption
			days = -1
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				has_technology = tech_ship_armor_5
				NOT = { has_technology = tech_advanced_metallurgy_2 }
			}
		}

		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_materials }
				}
				add_trait = leader_trait_expertise_materials
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			give_technology = { tech = tech_advanced_metallurgy_2 }
			add_tech_progress = {
				tech = tech_secrets_ezentian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_ezentian_research_completed # encryption
			days = -1
		}
	}

	option = {
		name = INTERESTING

		random_owned_leader = {
			limit = {
				OR = {
					is_councilor_type = councilor_research
					is_councilor_type = councilor_gestalt_cognitive
				}
			}

			if = {
				limit = {
					NOT = { has_trait = leader_trait_expertise_materials }
				}
				add_trait = leader_trait_expertise_materials
			}
			else = {
				add_experience = 200
			}
		}

		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			add_tech_progress = {
				tech = tech_secrets_ezentian
				progress = 0.1
			}
		}
		add_modifier = {
			modifier = artifact_ezentian_research_completed # +10% armor
			days = -1
		}
	}
}
country_event = {
	id = FHMP.187
	title = "FHMP.187.name"
	desc = "FHMP.187.desc"
	picture = GFX_evt_planet_beam
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_owned_planet = {
					has_designation = col_mining
					is_artificial = no
					NOR = {
						is_planet_class = pc_city
						is_planet_class = pc_relic
					}
					NOT = { has_deposit = d_FHMP_colossus_blast }
				}
			}
			ordered_owned_planet = {
				limit = {
					has_designation = col_mining
					is_artificial = no
					NOR = {
						is_planet_class = pc_city
						#is_planet_class = pc_relic
					}
					NOT = { has_deposit = d_FHMP_colossus_blast }
				}
				position = 0
				order_by = trigger:num_pops
				inverse = no

				add_deposit = d_FHMP_colossus_blast
				#spawn_habitat_cracker_effect = yes
				save_event_target_as = targeted_planet
			}
		}
		else = {
			random_owned_planet = {
				limit = {
					has_designation = col_mining
					is_artificial = no
					NOR = {
						is_planet_class = pc_city
						#is_planet_class = pc_relic
					}
				}
				weights = {
					base = 1
					modifier = { factor = trigger:num_pops }
				}
		
				add_deposit = d_FHMP_small_colossus_blast
				#spawn_habitat_cracker_effect = yes
				save_event_target_as = targeted_planet
			}
		}
	}
	
	option = {
		name = OK
	}
}