##########################
## By Pierre du Plessis ##
##########################

namespace = situation

# Mysterious Labyrinth

planet_event = {
	id = situation.5
	title = situation.5.name
	desc = CD_TODO_TOOLTIP #situation.5.desc
	picture = GFX_evt_medieval_alien_civilization
	show_sound = event_wind_ruins
	is_triggered_only = yes
	fire_only_once = yes

	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		situations_feature_is_ready = yes
		NOT = { has_planet_flag = colony_event }
		is_artificial = no
		NOT = { is_planet_class = pc_nuked }
		owner = {
			is_country_type = default
		}
	}

	immediate = {
		set_planet_flag = colony_event
		owner = {
			start_situation = {
				type = situation_mysterious_labyrinth
				target = root
				effect = {
					save_event_target_as = new_situation
				}
			}
		}
	}

	option = {
		name = situation.5.A #investigate it
		event_target:new_situation = {
			set_situation_approach = approach_investigate
		}
		custom_tooltip = situation.5.A.tooltip
	}
	option = {
		name = situation.5.B #we don't have time for this
		event_target:new_situation = {
			set_situation_approach = approach_observe
		}
	}
}

# Labyrinth moves, prompting a rethink
situation_event = {
	id = situation.10
	title = situation.10.name
	desc = {
		text = CD_TODO_TOOLTIP #situation.10.desc
		trigger = {
			owner = { is_gestalt = no }
		}
	}
	# desc = {
	# 	text = situation.10.desc.gestalt
	# 	trigger = {
	# 		owner = { is_gestalt = yes }
	# 	}
	# }

	picture = GFX_evt_news_room
	is_triggered_only = yes
	location = target

	immediate = {
		set_situation_flag = observe_not_an_option
	}

	option = {
		name = situation.10.A
		set_situation_approach = approach_cordon_off
		custom_tooltip = situation.10.A.tooltip
	}
	option = {
		name = situation.10.B
		set_situation_approach = approach_investigate
	}
	option = {
		name = situation.10.C
		set_situation_approach = approach_destroy
		custom_tooltip = situation.10.A.tooltip #deliberate
	}
}

#It's getting harder to ignore.
situation_event = {
	id = situation.15
	title = situation.15.name
	desc = {
		text = CD_TODO_TOOLTIP #situation.15.desc.standard
		trigger = {
			owner = {
				NOR = {
					has_country_flag = human_1
					has_country_flag = human_2
					species_portrait = human
				}
				is_gestalt = no
			}
		}
	}
	# desc = {
	# 	text = situation.15.desc.machine
	# 	trigger = {
	# 		owner = { is_machine_empire = yes }
	# 	}
	# }
	# desc = {
	# 	text = situation.15.desc.hive
	# 	trigger = {
	# 		owner = { is_hive_empire = yes }
	# 	}
	# }
	# desc = {
	# 	text =  situation.15.desc.human
	# 	trigger = {
	# 		owner = {
	# 			OR = {
	# 				has_country_flag = human_1
	# 				has_country_flag = human_2
	# 				species_portrait = human
	# 			}
	# 			is_gestalt = no
	# 		}
	# 	}
	# }
	picture = GFX_evt_galactic_community
	show_sound = event_default
	is_triggered_only = yes
	location = target

	immediate = {
		set_situation_flag = cute_kittens
	}

	option = {
		name = situation.15.A
		custom_tooltip = situation.15.A.tooltip
	}
	#This event is just informative, no need for choices
}

# End event: ignored it
situation_event = {
	id = situation.20
	title = situation.20.name
	desc = CD_TODO_TOOLTIP #situation.20.desc
	picture = GFX_evt_clocks
	is_triggered_only = yes
	location = target
	show_sound = event_mystic_reveal_light

	option = {
		name = FASCINATING
		target = {
			add_deposit = d_space_time_anomaly
		}
	}

	after = {
		destroy_situation = this
	}
}

# End event: destroy it
situation_event = {
	id = situation.25
	title = situation.25.name
	desc = CD_TODO_TOOLTIP #situation.25.desc
	picture = GFX_evt_nuclear_explosion
	is_triggered_only = yes
	location = target
	show_sound = event_collapsing_ruins

	option = {
		name = UNDERSTOOD
		owner = {
			add_resource = {
				sr_dark_matter = 200
				exotic_gases = 800
				volatile_motes = 800
				rare_crystals = 800
			}
		}
	}

	after = {
		destroy_situation = this
	}
}

# End event: ignored it (alternative outcome)
situation_event = {
	id = situation.30
	title = situation.30.name
	desc = CD_TODO_TOOLTIP #situation.30.desc
	picture = GFX_evt_clocks
	is_triggered_only = yes
	location = target
	show_sound = event_mystic_reveal_light

	option = {
		name = situation.30.A

		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
		}
	}

	after = {
		destroy_situation = this
	}
}


# Mid event while studying
situation_event = {
	id = situation.40
	title = situation.40.name
	desc = CD_TODO_TOOLTIP #situation.40.desc
	picture = GFX_evt_clocks
	is_triggered_only = yes
	location = target
	show_sound = event_activating_unknown_technology

	option = {
		name = DISCONCERTING
	}
}

# Another event while studying
situation_event = {
	id = situation.45
	title = situation.45.name
	desc = CD_TODO_TOOLTIP #situation.45.desc
	picture = GFX_evt_clocks
	is_triggered_only = yes
	location = target
	show_sound = event_activating_unknown_technology

	immediate = {
		set_situation_flag = harder_to_study
	}

	option = {
		name = WORRYING
		custom_tooltip = situation.15.A.tooltip #deliberate
	}
}

# End event: fully studied it
situation_event = {
	id = situation.50
	title = situation.50.name
	desc = CD_TODO_TOOLTIP #situation.50.desc
	picture = GFX_evt_clocks
	is_triggered_only = yes
	location = target
	show_sound = event_mysterious_signal

	option = {
		name = situation.50.A

		target = { add_deposit = d_space_time_anomaly }
	}

	after = {
		destroy_situation = this
	}
}

# End event: fully studied it, less good outcome
situation_event = {
	id = situation.55
	title = situation.55.name
	desc = CD_TODO_TOOLTIP #situation.55.desc
	picture = GFX_evt_nuclear_explosion
	is_triggered_only = yes
	location = target
	show_sound = event_ship_explosion

	option = {
		name = situation.50.A

		target = {
			add_blocker = { type = d_active_volcano }
			add_blocker = { type = d_active_volcano }
			add_blocker = { type = d_city_ruins }
			add_blocker = { type = d_deep_sinkhole }
			add_deposit = d_space_time_anomaly
		}
	}

	after = {
		destroy_situation = this
	}
}



# Alien Snow Narrative

planet_event = {
	id = situation.150
	title = situation.150.name
	desc = CD_TODO_TOOLTIP #situation.150.desc
	picture = GFX_evt_outpost
	is_triggered_only = yes
	show_sound = event_default
	fire_only_once = yes

	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		situations_feature_is_ready = yes
		NOT = { has_planet_flag = colony_event }
		is_planet_class = pc_desert
		owner = {
			is_country_type = default
			is_gestalt = no #for now
		}
	}

	immediate = {
		set_planet_flag = colony_event
	}

	option = {
		name = INTERESTING
		owner = {
			start_situation = {
				type = situation_living_snow
				target = root
			}
		}
	}
}

# 25% event
situation_event = {
	id = situation.155
	title = situation.155.name
	desc = CD_TODO_TOOLTIP #situation.155.desc
	picture = GFX_evt_outpost
	is_triggered_only = yes
	show_sound = event_default
	location = target

	option = {
		name = situation.155.A
		set_situation_approach = situation_snow_observation
		custom_tooltip = situation.155.A.tooltip
	}
	option = {
		name = situation.155.B
		set_situation_approach = situation_snow_hostile
		custom_tooltip = situation.155.B.tooltip
	}
}

# Hostile path random event
situation_event = {
	id = situation.160
	title = situation.160.name
	desc = CD_TODO_TOOLTIP #situation.160.desc
	picture = GFX_evt_outpost
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = target

	trigger = {
		current_situation_approach = situation_snow_hostile
		NOR = {
			has_situation_flag = random_event
			current_severity_level = severity_3
		}
	}

	immediate = { set_situation_flag = random_event }

	option = {
		name = situation.160.A
		custom_tooltip = situation.160.A.tooltip
		set_situation_flag = very_hostile
	}
	option = {
		name = situation.160.C
		custom_tooltip = situation.160.C.tooltip
		set_situation_flag = lackadaisical
	}
}

# 80% event
situation_event = {
	id = situation.165
	title = situation.165.name
	desc = CD_TODO_TOOLTIP #situation.165.desc
	picture = GFX_evt_outpost
	show_sound = event_bad_omen
	is_triggered_only = yes
	location = target

	option = {
		name = situation.165.A
		if = {
			limit = {
				NOT = { current_situation_approach = situation_snow_observation }
			}
			set_situation_approach = situation_snow_observation
		}
	}
	option = {
		name = situation.165.B
		if = {
			limit = {
				NOT = { current_situation_approach = situation_snow_hostile }
			}
			set_situation_approach = situation_snow_hostile
		}
	}
	after = {
		custom_tooltip = situation.165.tooltip
		set_situation_flag = path_locked
	}
}

situation_event = {
	id = situation.170
	title = situation.170.name
	desc = CD_TODO_TOOLTIP #situation.170.desc
	picture = GFX_evt_outpost
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = target

	trigger = {
		current_severity_level = severity_2
		NOT = { has_situation_flag = random_event }
	}

	immediate = {
		set_situation_flag = random_event
	}

	option = {
		name = situation.170.A
		custom_tooltip = situation.170.A.tooltip
		set_situation_flag = higher_observe_upkeep
	}
}

situation_event = {
	id = situation.175
	title = situation.175.name
	desc = CD_TODO_TOOLTIP #situation.175.desc
	picture = GFX_evt_outpost
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = target

	trigger = {
		current_severity_level = severity_2
		NOT = { has_situation_flag = random_research_event }
	}

	immediate = {
		set_situation_flag = random_research_event
	}

	weight_multiplier = {
		factor = 1
		modifier = {
			factor = 2
			current_situation_approach = situation_snow_observation
		}
	}

	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				min = @tier3researchmax
			}
		}
	}
}


situation_event = {
	id = situation.180
	title = INCOMING_TRANSMISSION
	diplomatic_title = BLANK_STRING
	desc = CD_TODO_TOOLTIP #situation.185.desc
	show_sound = event_whispering
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	location = target

	option = {
		name = situation.180.A
		custom_tooltip = situation.185.B.tooltip

		hidden_effect = {
			target = {
				create_country = {
					name = "NAME_Living_Snow"
					type = faction
					effect = {
						establish_communications_no_message = root.owner
					}
				}
				while = {
					count = 6
					create_army = {
						name = "NAME_Monstrous_Snow"
						owner = last_created_country
						type = ice_army
					}
				}
			}
		}
	}
	after = { destroy_situation = this }
}

situation_event = {
	id = situation.185
	title = INCOMING_TRANSMISSION
	diplomatic_title = BLANK_STRING
	desc = CD_TODO_TOOLTIP #situation.185.desc
	show_sound = event_whispering
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	location = target

	option = {
		name = situation.185.A
		target = {
			add_deposit = d_living_snow_reserve
		}
		ai_chance = {
			factor = 1
		}
	}
	option = {
		name = situation.185.B
		custom_tooltip = situation.185.B.tooltip

		hidden_effect = {
			target = {
				create_country = {
					name = "NAME_Living_Snow"
					type = faction
					effect = {
						establish_communications_no_message = root.owner
						set_country_flag = living_snow
					}
				}
				while = {
					count = 6
					create_army = {
						name = "NAME_Monstrous_Snow"
						owner = last_created_country
						type = ice_army
					}
				}
			}
		}

		ai_chance = {
			factor = 0
		}
	}
	after = { destroy_situation = this }
}

# Snow took the planet
# This = country, planet owner
# From = country, attack leader
# FromFrom = planet
# on_planet_defenders_lose
country_event = {
	id = situation.190
	title = situation.190.name
	desc = CD_TODO_TOOLTIP #situation.190.desc
	picture = GFX_evt_arctic
	show_sound = event_bad_omen
	location = fromfrom
	show_sound = event_dangerous_animals
	is_triggered_only = yes

	trigger = {
		from = { has_country_flag = living_snow }
	}

	immediate = {
		from = { save_event_target_as = living_snow_country }
		fromfrom = {
			planet_event = { id = situation.195 days = 1800 random = 360 }
		}
	}

	option = {
		name = WORRYING
		custom_tooltip = situation.190.tooltip
	}
}

planet_event = {
	id = situation.195
	title = situation.195.name
	desc = CD_TODO_TOOLTIP #situation.195.desc
	picture = GFX_evt_arctic
	show_sound = event_wind_ruins
	location = root
	show_sound = event_dangerous_animals

	is_triggered_only = yes

	trigger = {
		exists = event_target:living_snow_country
		controller = { is_same_value = event_target:living_snow_country }
	}

	option = {
		name = situation.195.A
		hidden_effect = {
			every_owned_pop = { kill_pop = yes }
		}
		change_pc = pc_frozen
		add_deposit = d_physics_8
		add_deposit = d_society_8

		owner = {
			if = {
				limit = {
					NOT = { has_technology = tech_terrestrial_sculpting }
				}
				add_tech_progress = {
					tech = tech_terrestrial_sculpting
					progress = 0.1
				}
			}
		}
	}
}
