#################################
#
# Leviathan & Enclave Events
# by Maximilian Olbers, Niclas Karlsson,
# Rufus Tronde & Henrik Thyrwall
#
#################################

namespace = leviathans

# Horror Destroyed (HIDDEN)
country_event = {
	id = leviathans.3002
	hide_window = yes

	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = guardian_horror
		OR = {
			has_country_flag = dimensional_horror_country
			has_country_flag = eldritch_horror_country
		}
		FROMFROM = { is_ship_size = dimensional_horror }
	}

	immediate = {
		FROMFROM = {
			remove_star_flag = guardians_horror_system # vfix - to stop triggering leviathans.3000 after it dies, throwing an "undefined event target: dimensional_horror_country" error
			solar_system = { save_event_target_as = guardians_horror_system }
		}
		create_ambient_object = {
			type = "horror_energy_object"
			location = FROMFROM
		}
		last_created_ambient_object = {
			save_event_target_as = horror_energy
			set_ambient_object_flag = horror_energy
		}
		FROM = {
			country_event = { id = leviathans.3003 days = 6 }
		}
		destroy_country = yes
		every_country = {
			limit = {
				is_country_type = default
				has_modifier = dimensional_horror_weak_points
			}
			remove_modifier = "dimensional_horror_weak_points"
		}
		every_country = {
			limit = {
				is_country_type = default
				has_event_chain = curator_poi_chain
				event_target:guardians_horror_system = {
					is_point_of_interest = {
						id = curator_poi_horror
						event_chain = curator_poi_chain
						owner = prev
					}
				}
			}
			remove_point_of_interest = curator_poi_horror
			end_curator_chain = yes
		}
	}
}