####################################
# 	Leviathan Events
####################################

namespace = spaceleviathans

### Trader Enclave ###

### Alloys and Consumer Goods ###
# Alloys and Consumer Goods (XuraCorp)
country_event = {
	id = spaceleviathans.1
	title = leviathans.100.name
	desc = spaceleviathans.1.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = spaceleviathans.1.a
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = leviathans.110.a.reply
		add_resource = { energy = -1000 }
		custom_tooltip = opinion5
		add_modifier = {
			modifier = enclave_trade_1_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_xuracorp days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 5
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.2 days = 3600 }
		}
	}
	option = {
		name = spaceleviathans.1.b
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = spaceleviathans.1.b.reply
		add_resource = { energy = -2000 }
		custom_tooltip = opinion10
		add_modifier = {
			modifier = enclave_trade_2_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_xuracorp days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.2 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.c
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 3000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = leviathans.110.c.reply
		add_resource = { energy = -3000 }
		custom_tooltip = opinion15
		add_modifier = {
			modifier = enclave_trade_3_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_xuracorp days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 15
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.2 days = 3600 }
		}
	}
	option = {
		name = spaceleviathans.1.d
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 500 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = leviathans.110.a.reply
		add_resource = { energy = -500 }
		custom_tooltip = opinion5
		add_modifier = {
			modifier = enclave_trade_1_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_xuracorp days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 5
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.2 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.e
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = spaceleviathans.1.b.reply
		add_resource = { energy = -1000 }
		custom_tooltip = opinion10
		add_modifier = {
			modifier = enclave_trade_2_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_xuracorp days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.2 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.f
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 1500 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = leviathans.110.c.reply
		add_resource = { energy = -1500 }
		custom_tooltip = opinion15
		add_modifier = {
			modifier = enclave_trade_3_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_xuracorp days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 15
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.2 days = 3600 }

		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

## Remove XuraCorp Trade Relation Flag (HIDDEN)
country_event = {
	id = spaceleviathans.2
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_relation_flag = {
			who = event_target:traders
			flag = enclave_resource_trade 
		}
		remove_country_flag = goods_trade_xuracorp
		country_event = { id = spaceleviathans.3 }
	}
}

# Continue Trade? (XuraCorp)
country_event = {
	id = spaceleviathans.3
	title = leviathans.100.name
	desc = spaceleviathans.3.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}
	
	trigger = {
		NOR = {
			has_global_flag = xuracorp_destroyed
			has_country_flag = attacked_xuracorp
		}
	}

	
	option = {
		name = leviathans.150.a
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			country_event = { id = spaceleviathans.1 }
		}
	}
	option = {
		name = spaceleviathans.3.b
		custom_gui = "enclave_trader_option"
	}
}

# Alloys and Consumer Goods (Riggan)
country_event = {
	id = spaceleviathans.4
	title = leviathans.103.name
	desc = spaceleviathans.1.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = spaceleviathans.1.a
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = leviathans.110.a.reply
		add_resource = { energy = -1000 }
		custom_tooltip = opinion5
		add_modifier = {
			modifier = enclave_trade_1_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_riggan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 5
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.5 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.b
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = spaceleviathans.1.b.reply
		add_resource = { energy = -2000 }
		custom_tooltip = opinion10
		add_modifier = {
			modifier = enclave_trade_2_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_riggan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.5 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.c
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 3000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = leviathans.110.c.reply
		add_resource = { energy = -3000 }
		custom_tooltip = opinion15
		add_modifier = {
			modifier = enclave_trade_3_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_riggan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 15
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.5 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.d
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 500 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = leviathans.110.a.reply
		add_resource = { energy = -500 }
		custom_tooltip = opinion5
		add_modifier = {
			modifier = enclave_trade_1_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_riggan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 5
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.5 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.e
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = spaceleviathans.1.b.reply
		add_resource = { energy = -1000 }
		custom_tooltip = opinion10
		add_modifier = {
			modifier = enclave_trade_2_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_riggan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.5 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.f
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 1500 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = leviathans.110.c.reply
		add_resource = { energy = -1500 }
		custom_tooltip = opinion15
		add_modifier = {
			modifier = enclave_trade_3_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_riggan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 15
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.5 days = 3600 }

		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

## Remove Riggan Trade Relation Flag (HIDDEN)
country_event = {
	id = spaceleviathans.5
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_relation_flag = {
			who = event_target:traders
			flag = enclave_resource_trade 
		}
		remove_country_flag = goods_trade_riggan
		country_event = { id = spaceleviathans.6 }
	}
}

# Continue Trade? (Riggan)
country_event = {
	id = spaceleviathans.6
	title = leviathans.103.name
	desc = spaceleviathans.6.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}
	
	trigger = {
		NOR = {
			has_global_flag = riggans_destroyed
			has_country_flag = attacked_riggans
		}
	}

	
	option = {
		name = leviathans.150.a
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			country_event = { id = spaceleviathans.4 }
		}
	}
	option = {
		name = spaceleviathans.3.b
		custom_gui = "enclave_trader_option"
	}
}

# Alloys and Consumer Goods (Muutagan)
country_event = {
	id = spaceleviathans.7
	title = leviathans.104.name
	desc = spaceleviathans.1.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = spaceleviathans.1.a
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = leviathans.110.a.reply
		add_resource = { energy = -1000 }
		custom_tooltip = opinion5
		add_modifier = {
			modifier = enclave_trade_1_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_muutagan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 5
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.8 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.b
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = spaceleviathans.1.b.reply
		add_resource = { energy = -2000 }
		custom_tooltip = opinion10
		add_modifier = {
			modifier = enclave_trade_2_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_muutagan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.8 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.c
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 3000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = leviathans.110.c.reply
		add_resource = { energy = -3000 }
		custom_tooltip = opinion15
		add_modifier = {
			modifier = enclave_trade_3_eng_all
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_muutagan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 15
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.8 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.d
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 500 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = leviathans.110.a.reply
		add_resource = { energy = -500 }
		custom_tooltip = opinion5
		add_modifier = {
			modifier = enclave_trade_1_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_muutagan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 5
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.8 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.e
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = spaceleviathans.1.b.reply
		add_resource = { energy = -1000 }
		custom_tooltip = opinion10
		add_modifier = {
			modifier = enclave_trade_2_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_muutagan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.8 days = 3600 }

		}
	}
	option = {
		name = spaceleviathans.1.f
		custom_gui = "enclave_trader_option"
		allow = { 
			resource_stockpile_compare = { resource = energy value >= 1500 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = leviathans.110.c.reply
		add_resource = { energy = -1500 }
		custom_tooltip = opinion15
		add_modifier = {
			modifier = enclave_trade_3_eng_con
			days = 3600
		}
		hidden_effect = {
			set_timed_country_flag = { flag = goods_trade_muutagan days = 3600 }
			event_target:traders = {
				add_trust = {
					who = root
					amount = 15
				}
			}
			set_relation_flag = {
				who = event_target:traders
				flag = enclave_resource_trade
			}
			country_event = { id = spaceleviathans.8 days = 3600 }

		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

## Remove Muutagan Trade Relation Flag (HIDDEN)
country_event = {
	id = spaceleviathans.8
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_relation_flag = {
			who = event_target:traders
			flag = enclave_resource_trade 
		}
		remove_country_flag = goods_trade_muutagan
		country_event = { id = spaceleviathans.9 }
	}
}

# Continue Trade? (Muutagan)
country_event = {
	id = spaceleviathans.9
	title = leviathans.104.name
	desc = spaceleviathans.9.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}
	
	trigger = {
		NOR = {
			has_global_flag = muutagans_destroyed
			has_country_flag = attacked_muutagans
		}
	}

	
	option = {
		name = leviathans.152.a
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			country_event = { id = spaceleviathans.7 }
		}
	}
	option = {
		name = spaceleviathans.3.b
		custom_gui = "enclave_trader_option"
	}
}

### Special Deals ###
# XuraGel
country_event = {
	id = spaceleviathans.10
	title = leviathans.100.name
	desc = spaceleviathans.10.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = spaceleviathans.10.a
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 5000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		response_text = spaceleviathans.10.a.reply
		custom_tooltip = spaceleviathans.10.a.tooltip
		hidden_effect = {
			set_country_flag = purchased_xuragel
		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

# Riggan Spice
country_event = {
	id = spaceleviathans.11
	title = leviathans.103.name
	desc = spaceleviathans.11.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = spaceleviathans.10.a
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 5000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		response_text = spaceleviathans.11.a.reply
		custom_tooltip = spaceleviathans.11.a.tooltip
		hidden_effect = {
			set_country_flag = purchased_riggan_spice
		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

# Muutagan Crystals
country_event = {
	id = spaceleviathans.12
	title = leviathans.104.name
	desc = spaceleviathans.12.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = spaceleviathans.10.a
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 5000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		response_text = spaceleviathans.12.a.reply
		custom_tooltip = spaceleviathans.12.a.tooltip
		hidden_effect = {
			set_country_flag = purchased_muutagans_crystals
		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

# XuraCorp
country_event = {
	id = spaceleviathans.13
	title = leviathans.100.name
	desc = spaceleviathans.13.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
		random_relation = {
			limit = {
				is_country_type = default
				is_homicidal = no
			}
			save_event_target_as = blackmail_target_one
		}
		random_relation = {
			limit = {
				is_country_type = default
				is_homicidal = no
				NOT = { is_same_value = event_target:blackmail_target_one }
			}
			save_event_target_as = blackmail_target_two
		}
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = DEAL
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_xuracorp }
			}
		}
		add_resource = { energy = -2000 }
		locked_random_list = {
			10 = {
				add_resource = { sr_dark_matter = 80 }
			}
			10 = {
				add_resource = { sr_zro = 80 }
				modifier = {
					factor = 0
					is_gestalt = yes
				}
			}
			10 = {
				add_resource = { sr_living_metal = 80 }
				modifier = {
					factor = 0.1
					NOT = { end_game_years_passed >= 0 }
				}
			}
			10 = {
				add_resource = { nanites = 60 }
				modifier = {
					factor = 0
					has_distar = no
				}
				modifier = {
					factor = 0.1
					NOT = { mid_game_years_passed >= 1 }
				}
			}
			10 = {
				add_resource = { minor_artifacts = 4 }
				modifier = {
					factor = 0
					has_ancrel = no
				}
			}
			5 = {
				custom_tooltip = spaceleviathans.13.blackmail
				add_resource = { influence = 100 }
				if = {
					limit = { exists = event_target:blackmail_target_one }
					add_favors = {
						target = event_target:blackmail_target_one
						value = 1
					}
				}
				else = {
					add_resource = { influence = 75 }
				}
				if = {
					limit = { exists = event_target:blackmail_target_two }
					add_favors = {
						target = event_target:blackmail_target_two
						value = 1
					}
				}
				else = {
					add_resource = { influence = 75 }
				}
			}
			5 = {
				modifier = {
					factor = 0
					have_active_precursor_chain = no
				}
				custom_tooltip = fleet1productmod3_tooltip
				collector_surrenders_artifact = yes
				if = {
					limit = { has_ancrel = yes }
					add_resource = { minor_artifacts = 1 }
				}
				else = {
					add_resource = { influence = 50 }
				}
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_mine_exotic_gases
				}
				give_technology = { tech = tech_mine_exotic_gases }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_exotic_gases
				}
				give_technology = { tech = tech_exotic_gases }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_mine_betharian
				}
				give_technology = { tech = tech_mine_betharian }
			}
		}
		response_text = spaceleviathans.13.a.reply
		hidden_effect = {
			set_timed_country_flag = { flag = trader_special_deal_timed_flag days = 3600 }
		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

# Riggan
country_event = {
	id = spaceleviathans.14
	title = leviathans.103.name
	desc = spaceleviathans.13.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = DEAL
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_riggans }
			}
		}
		add_resource = { energy = -2000 }
		locked_random_list = {
			10 = {
				add_resource = { sr_dark_matter = 80 }
			}
			10 = {
				add_resource = { sr_zro = 80 }
				modifier = {
					factor = 0
					is_gestalt = yes
				}
			}
			10 = {
				add_resource = { sr_living_metal = 80 }
				modifier = {
					factor = 0.1
					NOT = { end_game_years_passed >= 0 }
				}
			}
			10 = {
				add_resource = { nanites = 60 }
				modifier = {
					factor = 0
					has_distar = no
				}
				modifier = {
					factor = 0.1
					NOT = { mid_game_years_passed >= 1 }
				}
			}
			10 = {
				add_resource = { minor_artifacts = 4 }
				modifier = {
					factor = 0
					has_ancrel = no
				}
			}
			5 = {
				custom_tooltip = spaceleviathans.13.blackmail
				add_resource = { influence = 100 }
				if = {
					limit = { exists = event_target:blackmail_target_one }
					add_favors = {
						target = event_target:blackmail_target_one
						value = 1
					}
				}
				else = {
					add_resource = { influence = 75 }
				}
				if = {
					limit = { exists = event_target:blackmail_target_two }
					add_favors = {
						target = event_target:blackmail_target_two
						value = 1
					}
				}
				else = {
					add_resource = { influence = 75 }
				}
			}
			5 = {
				modifier = {
					factor = 0
					have_active_precursor_chain = no
				}
				custom_tooltip = fleet1productmod3_tooltip
				collector_surrenders_artifact = yes
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_mine_volatile_motes
				}
				give_technology = { tech = tech_mine_volatile_motes }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_volatile_motes
				}
				give_technology = { tech = tech_volatile_motes }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_mine_betharian
				}
				give_technology = { tech = tech_mine_betharian }
			}
		}
		response_text = spaceleviathans.13.a.reply
		hidden_effect = {
			set_timed_country_flag = { flag = trader_special_deal_timed_flag days = 3600 }
		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}

# Muutagan
country_event = {
	id = spaceleviathans.15
	title = leviathans.104.name
	desc = spaceleviathans.13.desc

	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	force_open = yes

	picture_event_data = {
		portrait = event_target:traders
		room = enclave_trader_room
	}

	immediate = {
		set_country_flag = trader_enclave_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}

	option = {
		name = DEAL
		custom_gui = "enclave_trader_option"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_muutagans }
			}
		}
		add_resource = { energy = -2000 }
		locked_random_list = {
			10 = {
				add_resource = { sr_dark_matter = 80 }
			}
			10 = {
				add_resource = { sr_zro = 80 }
				modifier = {
					factor = 0
					is_gestalt = yes
				}
			}
			10 = {
				add_resource = { sr_living_metal = 80 }
				modifier = {
					factor = 0.1
					NOT = { end_game_years_passed >= 1 }
				}
			}
			10 = {
				add_resource = { nanites = 60 }
				modifier = {
					factor = 0
					has_distar = no
				}
				modifier = {
					factor = 0.1
					NOT = { mid_game_years_passed >= 1 }
				}
			}
			10 = {
				add_resource = { minor_artifacts = 4 }
				modifier = {
					factor = 0
					has_ancrel = no
				}
			}
			5 = {
				custom_tooltip = spaceleviathans.13.blackmail
				add_resource = { influence = 100 }
				if = {
					limit = { exists = event_target:blackmail_target_one }
					add_favors = {
						target = event_target:blackmail_target_one
						value = 1
					}
				}
				else = {
					add_resource = { influence = 75 }
				}
				if = {
					limit = { exists = event_target:blackmail_target_two }
					add_favors = {
						target = event_target:blackmail_target_two
						value = 1
					}
				}
				else = {
					add_resource = { influence = 75 }
				}
			}
			5 = {
				modifier = {
					factor = 0
					have_active_precursor_chain = no
				}
				custom_tooltip = fleet1productmod3_tooltip
				collector_surrenders_artifact = yes
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_mine_rare_crystals
				}
				give_technology = { tech = tech_mine_rare_crystals }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_rare_crystals
				}
				give_technology = { tech = tech_rare_crystals }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_mine_betharian
				}
				give_technology = { tech = tech_mine_betharian }
			}
		}
		response_text = spaceleviathans.13.a.reply
		hidden_effect = {
			set_timed_country_flag = { flag = trader_special_deal_timed_flag days = 3600 }
		}
	}
	option = {
		name = leviathans.110.d
		custom_gui = "enclave_trader_option"
		hidden_effect = {
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_1 } }
				country_event = { id = leviathans.105 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_2 } }
				country_event = { id = leviathans.106 }
			}
			if = {
				limit = { event_target:traders = { has_country_flag = trader_enclave_country_3 } }
				country_event = { id = leviathans.107 }
			}
		}
	}
	option = {
		name = leviathans.110.e
		custom_gui = "enclave_trader_option"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = trader_enclave_diplomacy_engaged
		}
	}
}


### Artist Enclave ###
# Festival Events #
country_event = {
	id = spaceleviathans.100
	title = spaceleviathans.100.name
	desc = spaceleviathans.100.desc
	picture = GFX_evt_metropolis
	show_sound = event_celebration
	location = event_target:pleased_planet
	
	is_triggered_only = yes
	
	trigger = {
		has_modifier = enclave_artist_festival
		NOR = { 
			has_country_flag = enclave_artist_ignores
			has_ethic = ethic_gestalt_consciousness
		}
	}
	
	immediate = {
		random_country = {
			limit = {
				has_country_flag = artist_enclave_country
			}
			save_event_target_as = artist_enclave
		}
		random_owned_planet = {
			limit = {
				is_colony = yes
				num_pops > 9
			}
			save_event_target_as = pleased_planet
		}
	}

	option = {
		name = EXCELLENT
		add_monthly_resource_mult = {
			resource = influence
			value = @tier3influencereward
			min = @tier3influencemin
			max = @tier3influencemax
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
		}
		hidden_effect = {
			random_list = {
				20 = {
					modifier = {
						factor = 2
						event_target:pleased_planet = {
							any_owned_pop = {
								has_ethic = "ethic_xenophile"
							}
						}
					}
					modifier = {
						factor = 2
						event_target:pleased_planet = {
							any_owned_pop = {
								OR = {
									has_trait = trait_rapid_breeders
									has_trait = trait_fertile
									has_trait = trait_rapid_breeders_lithoid
								}
							}
						}
					}
					modifier = {
						factor = 0
						event_target:pleased_planet = {
							NOT = {
								any_owned_pop = {
									species = { is_crossbreeding_possible = yes }
									
									NOT = { has_trait = trait_clone_soldier_infertile }
									NOT = { has_trait = trait_clone_soldier_infertile_full_potential }
								}
							}
						}
					}
					modifier = {
						factor = 0
						has_megacorp = no
					}
					modifier = {
						factor = 0
						xeno_compatibility_enabled = no
					}
					country_event = { id = spaceleviathans.101 days = 200 random = 140}
				}
				10 = {
					#no effect
				}
			}
		}
	}
	
}

country_event = {
	id = spaceleviathans.101
	title = spaceleviathans.101.name
	desc = cara.4041.desc
	picture = GFX_evt_metropolis
	show_sound = event_celebration
	location = event_target:pleased_planet
	
	immediate = {
		random_country = {
			limit = {
				has_country_flag = artist_enclave_country
			}
			species = {
				save_event_target_as = party_host
			}
		}
		event_target:pleased_planet = {
			if = {
				limit = {
					any_owned_pop = {
						is_xenophile = yes	
						species = { is_crossbreeding_possible = yes }
						
						NOT = { has_trait = trait_clone_soldier_infertile }
						NOT = { has_trait = trait_clone_soldier_infertile_full_potential }
					}
				}
				random_owned_pop = {
					limit = {
						is_xenophile = yes	
						species = { is_crossbreeding_possible = yes }
						
						NOT = { has_trait = trait_clone_soldier_infertile }
						NOT = { has_trait = trait_clone_soldier_infertile_full_potential }
					}
					save_event_target_as = party_goer
				}
			}
			else_if = {
				limit = {
					any_owned_pop = {
						is_xenophobe = no
						species = { is_crossbreeding_possible = yes }
						
						NOT = { has_trait = trait_clone_soldier_infertile }
						NOT = { has_trait = trait_clone_soldier_infertile_full_potential }
					}
				}
				random_owned_pop = {
					limit = {
						is_xenophobe = no	
						species = { is_crossbreeding_possible = yes }
						
						NOT = { has_trait = trait_clone_soldier_infertile }
						NOT = { has_trait = trait_clone_soldier_infertile_full_potential }
					}
					save_event_target_as = party_goer
				}
			}
			else = {
				random_owned_pop = {
					limit = {
						species = { is_crossbreeding_possible = yes }
						
						NOT = { has_trait = trait_clone_soldier_infertile }
						NOT = { has_trait = trait_clone_soldier_infertile_full_potential }
					}
					save_event_target_as = party_goer
				}
			}
		}
	
		event_target:pleased_planet = {
			create_half_species = { species_one = event_target:party_host species_two = event_target:party_goer.species }
			while = {
				count = 3
				create_pop = {
					species = last_created_species
				}
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		exclusive_trigger = {
			is_xenophile = yes
		}
		name = cara.4041.phile	
	}
	option = {
		exclusive_trigger = {
			is_xenophobe = yes
		}
		name = cara.4041.phobe
	}
	option = {
		exclusive_trigger = {
			is_xenophile = no
			is_xenophobe = no
		}
		name = cara.4041.a	
	}
	
	
	after = {
		tooltip = {
			event_target:pleased_planet = {
				create_half_species = { species_one = event_target:party_host species_two = event_target:party_goer.species }
				hidden_effect = {
					while = {
						count = 3
						create_pop = {
							species = last_created_species
						}					
					}
				}
			}
		}
	}
}

planet_event = {
	id = spaceleviathans.102
	title = spaceleviathans.102.name
	picture = GFX_evt_metropolis
	show_sound = event_celebration
	location = ROOT
	
	desc = {
		text = spaceleviathans.102.desc.xenophile
		trigger = {
			exists = owner
			owner = { is_xenophile = yes }
		}
	}
	desc = {
		text = spaceleviathans.102.desc.xenophobe
		trigger = {
			exists = owner
			owner = { is_xenophobe = yes }
		}
	}
	desc = {
		text = spaceleviathans.102.desc.spiritualist
		trigger = {
			exists = owner
			owner = { is_spiritualist = yes }
		}
	}
	desc = {
		text = spaceleviathans.102.desc.materialist
		trigger = {
			exists = owner
			owner = { is_materialist = yes }
		}
	}
	desc = {
		text = spaceleviathans.102.desc.authoritarian
		trigger = {
			exists = owner
			owner = {
				OR = {
					is_authoritarian = yes
					has_authority = auth_imperial
					has_authority = auth_dictatorial
				}
			}
		}
	}
	desc = {
		text = spaceleviathans.102.desc.egalitarian
		trigger = {
			exists = owner
			owner = {
				is_xenophobe = no
				OR = {
					is_egalitarian = yes
					has_authority = auth_democratic
				}
			}
		}
	}
	desc = {
		text = spaceleviathans.102.desc.militarist
		trigger = {
			exists = owner
			owner = {
				is_militarist = yes
				NOT = { has_valid_civic = civic_shared_burden }
			}
		}
	}
	desc = {
		text = spaceleviathans.102.desc.revolution
		trigger = {
			exists = owner
			owner = {
				is_militarist = yes
				has_valid_civic = civic_shared_burden
			}
		}
	}
	desc = {
		text = spaceleviathans.102.desc.pacifist
		trigger = {
			exists = owner
			owner = { is_pacifist = yes }
		}
	}
	desc = {
		text = spaceleviathans.102.desc.corp
		trigger = {
			exists = owner
			owner = { is_megacorp = yes }
		}
	}
	desc = {
		text = spaceleviathans.102.desc.music
		trigger = {
			exists = owner
			owner = { is_xenophobe = no }
		}
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			has_modifier = enclave_artist_festival
			NOR = { 
				has_country_flag = enclave_artist_ignores
				has_ethic = ethic_gestalt_consciousness
			}
		}
	}

	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
		}
		add_deposit = d_artist_monument
	}
	
}

# Patronage Events #
#Artwork completed
country_event = {
	id = spaceleviathans.120
	title = spaceleviathans.120.name
	desc = spaceleviathans.120.desc
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"

	picture_event_data = {
		portrait = event_target:artist_enclave_country
		room = enclave_artist_room
	}

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
			has_country_flag = enclave_artist_patron_event_4_mod
		}
	}

	immediate = {
		set_country_flag = enclave_artist_patron_events
		set_country_flag = enclave_artist_patron_event_4_mod
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}
	option = {
		name = spaceleviathans.120.a
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
		}
		add_resource = { influence = 100 }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = spaceleviathans.120.a.phile
		exclusive_trigger = { is_xenophile = yes }
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
		}
		add_resource = { influence = 100 }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = spaceleviathans.120.a.phobe
		exclusive_trigger = { is_xenophobe = yes }
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
		}
		add_resource = { influence = 100 }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = spaceleviathans.120.a.machine
		exclusive_trigger = { is_machine_empire = yes }
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
		}
		add_resource = { influence = 100 }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
}

# Newsletter: Renowned Artist Dies
country_event = {
	id = spaceleviathans.121
	title = leviathans.321.name
	desc = spaceleviathans.121.desc
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"

	picture_event_data = {
		portrait = event_target:artist_enclave_country
		room = enclave_artist_room
	}

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
		}
	}

	immediate = {
		set_country_flag = enclave_artist_patron_events
		set_country_flag = enclave_artist_patron_event_5_mod
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}

	option = {
		name = leviathans.321.a
		add_resource = {
			energy = -500
			influence = 50
		}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 500 }
		}
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = leviathans.321.c
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}	
	option = {
		name = leviathans.321.b
		trigger = { is_ai = no }
		hidden_effect = { set_country_flag = unsubscribed_from_newsletter }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
}

# Newsletter: Enclave attacked
country_event = {
	id = spaceleviathans.122
	title = leviathans.321.name
	desc = {
		text = spaceleviathans.122.desc
		trigger = { NOT = { has_global_flag = artist_enclave_destoyed_station } }
	}
	desc = {
		text = spaceleviathans.122.desc.destroyed
		trigger = { has_global_flag = artist_enclave_destoyed_station }
	}
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"

	picture_event_data = {
		portrait = event_target:artist_enclave_country
		room = enclave_artist_room
	}

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
			has_country_flag = unsubscribed_from_newsletter
		}
	}

	immediate = {
		set_country_flag = enclave_artist_patron_events
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}

	option = {
		name = leviathans.321.a
		add_resource = {
			energy = -500
			influence = 50
		}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 500 }
		}
	}
	option = {
		name = leviathans.321.c
	}	
	option = {
		name = leviathans.321.b
		trigger = { is_ai = no }
		hidden_effect = { set_country_flag = unsubscribed_from_newsletter }
	}
	
	# Not for this event
	#after = {
	#	hidden_effect = {
	#		country_event = { id = leviathans.320 days = 60 random = 30 }
	#	}
	#}
}

# Artist Rebuilds ***on_decade_pulse***
event = {
	id = spaceleviathans.123
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_global_flag = one_artist_enclave_destroyed
		NOT = { has_global_flag = artist_enclave_station_construction }
		NOT = { has_global_flag = artist_enclave_station_construction_timer }
		has_crisis = no
	}
	
	immediate = {
		random_country = {
			limit = { has_country_flag = artist_enclave_country }
			set_global_flag = artist_enclave_station_construction
			country_event = { id = spaceleviathans.124 days = 720 random = 1800 } # 2-7 years
		}
	}
}
country_event = {
	id = spaceleviathans.124
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
	}
	
	immediate = {
		country_event = { id = spaceleviathans.126 days = 360 random = 360 } # announce location
		every_country = {
			limit = {
				has_modifier = enclave_artist_patron
				has_country_flag = artist_patron
				NOR = {
					has_country_flag = enclave_stopped_patronage
					has_country_flag = enclave_artist_ignores
					has_country_flag = unsubscribed_from_newsletter
				}
			}
			country_event = { id = spaceleviathans.125 }
		}
	}
}

# Newsletter: Enclave Rebuilds
country_event = {
	id = spaceleviathans.125
	title = leviathans.321.name
	desc = spaceleviathans.125.desc
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"

	picture_event_data = {
		portrait = event_target:artist_enclave_country
		room = enclave_artist_room
	}

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
			has_country_flag = unsubscribed_from_newsletter
		}
	}

	immediate = {
		set_country_flag = enclave_artist_patron_events
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}

	option = {
		name = spaceleviathans.125.a
		ai_chance = {
			factor = 100
		}
		add_resource = {
			energy = -1000
			influence = 100
		}
		response_text = spaceleviathans.125.a.reply
		hidden_effect = {
			set_country_flag = artist_enclave_offered_protection
		}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 1000 }
			custom_tooltip = {
				text = leviathans.300.c.allow
				event_target:traders = {
					trust = {
						who = root
						value >= 50
					}
				}
			}
			custom_tooltip = {
				fail_text = spaceleviathans.125.a.tooltip
				NOT = {
					event_target:artist_enclave_country = {
						any_controlled_fleet = {
							has_fleet_flag = artist_enclave_station
							solar_system = {
								exists = space_owner
								space_owner = { is_same_value = ROOT }
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = leviathans.321.a
		ai_chance = {
			factor = 1
		}
		add_resource = {
			energy = -1000
			influence = 100
		}
		allow = {
			resource_stockpile_compare = { resource = energy value >= 1000 }
		}
	}
	option = {
		name = leviathans.321.c
		ai_chance = {
			factor = 1
		}
	}	
	option = {
		name = leviathans.321.b
		trigger = { is_ai = no }
		hidden_effect = { set_country_flag = unsubscribed_from_newsletter }
	}
	
	# Not for this event
	#after = {
	#	hidden_effect = {
	#		country_event = { id = leviathans.320 days = 60 random = 30 }
	#	}
	#}
}

# New Enclave Location Chosen
country_event = {
	id = spaceleviathans.126
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
	}
	
	immediate = {
		# select location
		if = {
			limit = {
				any_country = {
					has_country_flag = artist_enclave_offered_protection
					NOT = { has_country_flag = enclave_artist_ignores }
					NOT = {
						event_target:artist_enclave_country = {
							any_controlled_fleet = {
								has_fleet_flag = artist_enclave_station
								solar_system = {
									exists = space_owner
									space_owner = { is_same_value = PREVPREVPREVPREV }
								}
							}
						}
					}
					any_system_within_border = {
						starbase = { has_starbase_size >= starbase_starport }
					}
				}
			}
			random_system = {
				limit = {
					exists = space_owner
					exists = starbase
					starbase = { has_starbase_size >= starbase_starport }
					space_owner = {
						has_country_flag = artist_enclave_offered_protection
						NOT = { has_country_flag = enclave_artist_ignores }
						NOT = {
							event_target:artist_enclave_country = {
								any_controlled_fleet = {
									has_fleet_flag = artist_enclave_station
									solar_system = {
										exists = space_owner
										space_owner = { is_same_value = PREVPREVPREVPREV }
									}
								}
							}
						}
					}
				}
				save_event_target_as = new_artist_enclave_station_system
			}
		}
		else_if = {
			limit = {
				any_system = {
					NOT = { exists = space_owner }
					NOT = { has_star_flag = hostile_system }
				}
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = { has_star_flag = hostile_system }
				}
				save_event_target_as = new_artist_enclave_station_system
			}
		}
		else = {
			random_system = {
				limit = {
					OR = {
						NOT = { exists = space_owner }
						AND = {
							exists = space_owner
							space_owner = {
								is_homicidal = no
								NOR = {
									has_country_flag = enclave_artist_ignores
									is_country_type = fallen_empire
									is_country_type = awakened_fallen_empire
									is_country_type = dormant_marauders
									is_country_type = awakened_marauders
								}
							}
						}
					}
					NOT = { has_star_flag = hostile_system }
				}
				save_event_target_as = new_artist_enclave_station_system
			}
		}
		every_country = {
			limit = { has_country_flag = artist_enclave_offered_protection }
			remove_country_flag = artist_enclave_offered_protection
		}
		country_event = { id = spaceleviathans.128 days = 1800 random = 720 } # construction finished (5-7 years)
		every_country = {
			limit = {
				has_modifier = enclave_artist_patron
				has_country_flag = artist_patron
				NOR = {
					has_country_flag = enclave_stopped_patronage
					has_country_flag = enclave_artist_ignores
					has_country_flag = unsubscribed_from_newsletter
				}
			}
			country_event = { id = spaceleviathans.127 }
		}
	}
}

# Newsletter: New Enclave Location Chosen
country_event = {
	id = spaceleviathans.127
	title = leviathans.321.name
	desc = spaceleviathans.127.desc
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"

	picture_event_data = {
		portrait = event_target:artist_enclave_country
		room = enclave_artist_room
	}

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
			has_country_flag = unsubscribed_from_newsletter
		}
	}

	immediate = {
		set_country_flag = enclave_artist_patron_events
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}

	option = {
		name = leviathans.321.a
		add_resource = {
			alloys = -100
			influence = 50
		}
		allow = {
			resource_stockpile_compare = { resource = alloys value >= 100 }
		}
	}
	option = {
		name = leviathans.321.c
	}	
	option = {
		name = leviathans.321.b
		trigger = { is_ai = no }
		hidden_effect = { set_country_flag = unsubscribed_from_newsletter }
	}
	
	# Not for this event
	#after = {
	#	hidden_effect = {
	#		country_event = { id = leviathans.320 days = 60 random = 30 }
	#	}
	#}
}
country_event = {
	id = spaceleviathans.128
	hide_window = yes
	is_triggered_only = yes
		
	trigger = {
		exists = event_target:artist_enclave_country
	}
	
	immediate = {
		remove_country_flag = artist_enclave_station_construction
		set_timed_country_flag = { flag = artist_enclave_station_construction_timer days = 9000 } #25 year cooldown
		if = {
			limit = { has_global_flag = two_artist_enclave_destroyed }
			remove_global_flag = two_artist_enclave_destroyed
		}
		else = {
			remove_global_flag = one_artist_enclave_destroyed
		}
		event_target:new_artist_enclave_station_system = {
			random_system_planet = {
				create_fleet = {
					name = "NAME_Ars_Artem"
					settings = { spawn_debris = no }
					effect = {
						set_owner = event_target:artist_enclave_country
						create_ship = {
							name = random
							design = "NAME_Artist_Enclave_Station"
							graphical_culture = event_target:artist_enclave_country
						}
						set_location = {
							target = prev
							distance = 90
						}
						set_fleet_flag = artist_enclave_station
					}
				}
			}
		}
		every_country = {
			limit = { is_ai = no }
			country_event = { id = spaceleviathans.129 }
		}
	}
}
# Everyone told of Enclave Starion built
country_event = {
	id = spaceleviathans.129
	title = spaceleviathans.129.name
	desc = spaceleviathans.129.desc
	picture = GFX_evt_space_station
	show_sound = event_radio_chatter
	location = event_target:new_artist_enclave_station_system
	
	is_triggered_only = yes

	option = {
		name = EXCELLENT
		trigger = {
			NOT = { has_country_flag = enclave_artist_ignores }
			is_homicidal = no
		}
	}
	option = {
		name = OK
		trigger = {
			OR = {
				has_country_flag = enclave_artist_ignores
				is_homicidal = yes
			}
		}
	}
}

# Progresson Unity Tech
country_event = {
	id = spaceleviathans.130
	title = spaceleviathans.130.name
	desc = {
		text = spaceleviathans.130.desc
		trigger = { is_gestalt = no }
	}
	desc = {
		text = spaceleviathans.130.desc.hive
		trigger = { is_hive_empire = yes }
	}
	desc = {
		text = spaceleviathans.130.desc.machine
		trigger = { is_machine_empire = yes }
	}
	picture = GFX_evt_mega_art_installation
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
			has_country_flag = enclave_artist_patron_event_6_mod
		}
		OR = {
			AND = {
				OR = {
					is_regular_empire = yes
					is_machine_empire = yes
					is_hive_empire = yes
				}
				is_spiritualist = no
				NOT = { has_technology = tech_autocurating_vault }
			}
			AND = {
				is_spiritualist = yes
				NOT = { has_technology = tech_transcendent_faith }
			}
		}
	}
	
	immediate = {
		set_country_flag = enclave_artist_patron_events
		set_country_flag = enclave_artist_patron_event_6_mod
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}

	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_regular_empire = yes
				is_machine_empire = yes
			}
			is_spiritualist = no
		}
		if = {
			limit = { NOT = { has_technology = tech_heritage_site } }
			add_research_option = tech_heritage_site
			add_tech_progress = {
				tech = tech_heritage_site
				progress = 0.5
			}
		}
		else_if = {
			limit = { NOT = { has_technology = tech_hypercomms_forum } }
			add_research_option = tech_hypercomms_forum
			add_tech_progress = {
				tech = tech_hypercomms_forum
				progress = 0.2
			}
		}
		else_if = {
			limit = { NOT = { has_technology = tech_autocurating_vault } }
			add_research_option = tech_autocurating_vault
			add_tech_progress = {
				tech = tech_autocurating_vault
				progress = 0.1
			}
		}
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = EXCELLENT
		trigger = {
			is_spiritualist = yes
		}
		if = {
			limit = { NOT = { has_technology = tech_holographic_rituals } }
			add_research_option = tech_holographic_rituals
			add_tech_progress = {
				tech = tech_holographic_rituals
				progress = 0.5
			}
		}
		else_if = {
			limit = { NOT = { has_technology = tech_consecration_fields } }
			add_research_option = tech_consecration_fields
			add_tech_progress = {
				tech = tech_consecration_fields
				progress = 0.2
			}
		}
		else_if = {
			limit = { NOT = { has_technology = tech_transcendent_faith } }
			add_research_option = tech_transcendent_faith
			add_tech_progress = {
				tech = tech_transcendent_faith
				progress = 0.1
			}
		}
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = EXCELLENT
		trigger = {
			is_hive_empire = yes
		}
		if = {
			limit = { NOT = { has_technology = tech_hive_cluster } }
			add_research_option = tech_hive_cluster
			add_tech_progress = {
				tech = tech_hive_cluster
				progress = 0.5
			}
		}
		else_if = {
			limit = { NOT = { has_technology = tech_hive_confluence } }
			add_research_option = tech_hive_confluence
			add_tech_progress = {
				tech = tech_hive_confluence
				progress = 0.2
			}
		}
		else_if = {
			limit = {
				NOT = { has_technology = tech_autocurating_vault }
			}
			add_research_option = tech_autocurating_vault
			add_tech_progress = {
				tech = tech_autocurating_vault
				progress = 0.1
			}
		}
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
}

# Advancement in Holograms
country_event = {
	id = spaceleviathans.131
	title = spaceleviathans.131.name
	desc = spaceleviathans.131.desc
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"

	picture_event_data = {
		portrait = event_target:artist_enclave_country
		room = enclave_artist_room
	}

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:artist_enclave_country
		has_modifier = enclave_artist_patron
		has_country_flag = artist_patron
		NOR = {
			has_country_flag = enclave_stopped_patronage
			has_country_flag = enclave_artist_ignores
			has_modifier = artist_patron_amenities
		}
	}

	immediate = {
		set_country_flag = enclave_artist_patron_events
		random_system = {
			limit = {
				any_system_planet = {
					has_planet_flag = guardians_artists_planet
				}
				root = {
					intel_level = {
						level > none
						system = prev
					}
				}
			}
			save_event_target_as = this_planet
		}
	}

	option = {
		name = DEAL
		allow = { resource_stockpile_compare = { resource = energy value >= 1000 } }
		hidden_effect = { set_country_flag = enclave_artist_patron_event_7_mod }
		add_resource = { energy = -1000 }
		if = {
			limit = {
				NOT = { has_technology = tech_hyper_entertainment_forum }
				is_gestalt = no
			}
			add_research_option = tech_hyper_entertainment_forum
			add_tech_progress = {
				tech = tech_hyper_entertainment_forum
				progress = 0.5
			}
		}
		else_if = {
			limit = {
				NOT = { has_technology = tech_paradise_dome }
				OR = {
					is_gestalt = no
					has_valid_civic = civic_machine_servitor
				}
			}
			add_research_option = tech_paradise_dome
			add_tech_progress = {
				tech = tech_paradise_dome
				progress = 0.125
			}
		}
		else_if = {
			limit = {
				NOT = { has_technology = tech_housing_2 }
				is_hive_empire = yes
			}
			add_research_option = tech_housing_2
			add_tech_progress = {
				tech = tech_housing_2
				progress = 0.125
			}
		}
		else_if = {
			limit = {
				NOT = { has_technology = tech_micro_replicators }
				is_machine_empire = yes
			}
			add_research_option = tech_micro_replicators
			add_tech_progress = {
				tech = tech_micro_replicators
				progress = 0.125
			}
		}
		else = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		add_modifier = { modifier = artist_patron_amenities days = -1 }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		trigger = {
			NOT = { resource_stockpile_compare = { resource = energy value >= 1000 } }
		}
		name = TOOPOOR
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		name = NODEAL
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		trigger = {
			is_ai = no
		}
		name = spaceleviathans.131.a
		custom_tooltip = spaceleviathans.131.a.tooltip
		hidden_effect = { set_country_flag = enclave_artist_patron_event_7_mod }
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
	option = {
		trigger = {
			is_ai = no
		}
		name = spaceleviathans.131.b
		hidden_effect = {
			country_event = { id = leviathans.320 days = 60 random = 30 }
		}
	}
}

### Leviathans ###
# Wraith is born
planet_event = {
	id = spaceleviathans.400
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_modifier = germinating_wraith
	}

	immediate = {
		save_event_target_as = wraith_star
		remove_modifier = germinating_wraith
		create_country = {
			name = "NAME_Wraith"
			type = guardian_wraith
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_5.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"red"
					"red"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			set_country_flag = wraith_country
			save_global_event_target_as = wraith_country
			create_fleet = {
				name = "NAME_Specter"
				settings = {
					spawn_debris = no
					is_boss = yes
				}
				effect = {
					set_owner = event_target:wraith_country
					random_list = {
						33 = {
							create_ship = {
								name = "NAME_Wraith_650THz"
								design = "NAME_Spectral_Wraith_650THz"
								effect = {
									set_ship_flag = wraith_ship
									set_ship_flag = wraith_freq_blue
								}
							}
						}
						33 = {
							create_ship = {
								name = "NAME_Wraith_450THz"
								design = "NAME_Spectral_Wraith_450THz"
								effect = {
									set_ship_flag = wraith_ship
									set_ship_flag = wraith_freq_red
								}
							}
						}
						33 = {
							create_ship = {
								name = "NAME_Wraith_520THz"
								design = "NAME_Spectral_Wraith_520THz"
								effect = {
									set_ship_flag = wraith_ship
									set_ship_flag = wraith_freq_yellow
								}
							}
						}
					}
					save_global_event_target_as = wraith_fleet
					set_location = event_target:wraith_star
					set_fleet_stance = aggressive
					set_aggro_range_measure_from = self
					set_aggro_range = 20
					queue_actions = {
						repeat = {
							find_closest_system = {
								trigger = {
									id = wraith.1.trigger.1
									NOR = {
										exists = space_owner
										any_ship_in_system = {
											fleet = { is_same_value = event_target:wraith_fleet }
										}
										has_star_flag = guardians_wraith_visited
									}
								}
								found_system = {
									move_to = this
									find_closest_planet = {
										trigger = {
											id = wraith.1.trigger.2
											is_star = yes
										}
										found_planet = {
											move_to = this
											#orbit_planet = this
											wait = {
												duration = 10
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		if = {
			limit = { exists = space_owner }
			space_owner = {
				country_event = { id = leviathans.2012 }
			}
		}
	}
}