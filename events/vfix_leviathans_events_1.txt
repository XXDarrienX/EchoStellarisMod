#################################
#
# Leviathan & Enclave Events
# by Maximilian Olbers, Niclas Karlsson,
# Rufus Tronde & Henrik Thyrwall
#
# Revised in 2022 by Gemma Thomson
#
#################################

@festivalDuration = 1800 #days

namespace = leviathans

# A Curator Starbase has been destroyed
# via leviathans.592 | this = all non-aggressor empires | from = Curator Enclave (country)
country_event = {
	id = leviathans.594
	title = "leviathans.593"
	# No Curator Insight, we know the attacker, and the Curators carry on
	desc = {
		text = leviathans.594.a.desc
		trigger = {
			NOT = { has_modifier = curator_insight }
			has_communications = event_target:curator_destroyer
			from = {
				count_controlled_ship = {
					limit = { is_ship_size = enclave_station }
					count > 0
				}
			}
		}
	}
	# No Curator Insight, and we don't know the attacker, but the Curators carry on
	desc = {
		text = leviathans.594.b.desc
		trigger = {
			NOR = {
				has_modifier = curator_insight
				has_communications = event_target:curator_destroyer
			}
			from = {
				count_controlled_ship = {
					limit = { is_ship_size = enclave_station }
					count > 0
				}
			}
		}
	}
	# We have Curator Insight, we know the attacker, and the Curators are no more
	desc = {
		text = leviathans.594.c.desc
		trigger = {
			has_modifier = curator_insight
			from = {
				count_controlled_ship = {
					limit = { is_ship_size = enclave_station }
					count < 1
				}
			}
			has_communications = event_target:curator_destroyer
		}
	}
	# We have Curator Insight, we don't know the attacker, and the Curators are no more
	desc = {
		text = leviathans.594.d.desc
		trigger = {
			has_modifier = curator_insight
			FROM = {
				count_controlled_ship = {
					limit = { is_ship_size = enclave_station }
					count < 1
				}
			}
			NOT = { has_communications = event_target:curator_destroyer }
		}
	}
	picture = GFX_evt_exploding_ship
	location = event_target:curator_system
	show_sound = event_ship_explosion

	is_triggered_only = yes

	immediate = {
		# Remove Curator Insight if the Enclave country is no more
		if = {
			limit = {
				has_modifier = curator_insight
				FROM = {
					count_controlled_ship = {
						limit = { is_ship_size = enclave_station }
						count < 1
					}
				}
			}
			remove_modifier = "curator_insight"
		}
		# (AI) Dislike the attacker if the Curators are wiped out, ending Curator Insight
		if = {
			limit = {
				has_modifier = curator_insight
				FROM = {
					count_controlled_ship = {
						limit = { is_ship_size = enclave_station }
						count < 1
					}
				}
				is_ai = yes
			}
			add_opinion_modifier = {
				who = event_target:curator_destroyer
				modifier = opinion_destroyed_curator_insight
			}
		}
		# (AI) Dislike the attacker if the Curators are wiped out
		if = {
			limit = {
				NOT = { has_modifier = curator_insight }
				is_ai = yes
			}
			add_opinion_modifier = {
				who = event_target:curator_destroyer
				modifier = opinion_destroyed_curator
			}
		}
	}

	option = {
		name = "leviathans.594.a"
		trigger = {
			NOT = { has_modifier = curator_insight }
		}
	}
	option = {
		name = "leviathans.594.b"
		trigger = {
			has_modifier = curator_insight
			# vfix - commented block since it's not really needed and caused an error in log - Fix for "Triggered Event leviathans.594 has no valid options!" - events\leviathans_events_1.txt (line 6774)
			# FROM = {
			# 	count_controlled_ship = {
			# 		limit = { is_ship_size = enclave_station }
			# 		count < 1
			# 	}
			# }
		}
	}
}