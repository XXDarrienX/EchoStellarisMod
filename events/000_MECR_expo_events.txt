namespace = MECR_EXPO
####################################################################################################
####################################################################################################
###################### 银河博览会 ####################### The Galactic EXPO ########################
####################################################################################################
####################################################################################################
@max_single_exhi_score = 106
@max_total_exhi_score = 120

country_event = { #1.【目录】EXPO准备开始
	id = MECR_EXPO.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_active_resolution = resolution_the_galactic_expo
	}

	immediate = {
		remove_global_flag = expo_starting_checking #这是用来修复.450重复触发的bug的
		save_global_event_target_as = expo_organiser
		set_timed_global_flag = {
			flag = flag_expo_preparing
			days = @expo_prepare_total_timer
		}
		country_event = {
			id = MECR_EXPO.100
			days = @expo_prepare_total_timer
		}
		every_country = {
			limit = {
				is_galactic_community_member = yes
			}
			country_event = {
				id = MECR_EXPO.2
			}
		}
	}
}
country_event = { #2.EXPO各国准备开始
	id = MECR_EXPO.2
	title = "MECR_EXPO.2.title"
	desc = {
		text = "MECR_EXPO.2.desc"
		trigger = { NOT = { has_global_flag = flag_first_expo_complete } }
	}
	desc = {
		text = "MECR_EXPO.2.desc.on_1st"
		trigger = {
			has_global_flag = flag_first_expo_complete
			has_global_flag = flag_expo_on_1st
		}
	}
	desc = {
		text = "MECR_EXPO.2.desc.flag_expo_on_queue"
		trigger = {
			has_global_flag = flag_first_expo_complete
			has_global_flag = flag_expo_on_queue
		}
	}
	desc = {
		text = "MECR_EXPO.2.desc.flag_expo_on_random"
		trigger = {
			has_global_flag = flag_first_expo_complete
			has_global_flag = flag_expo_on_random
		}
	}
	picture = "GFX_evt_galactic_community"
	is_triggered_only = yes

	immediate = {
		set_variable = { which = expo_science_result value = 0 }
		set_variable = { which = expo_culture_result value = 0 }
		set_variable = { which = expo_technology_result value = 0 }
		set_variable = { which = expo_history_result value = 0 }
		set_variable = { which = expo_archaeology_result value = 0 }
		add_modifier = { modifier = expo_prepare_timer days = @expo_prepare_total_timer }
		begin_event_chain = {
			event_chain = the_galactic_expo
			target = root
		}

		#科学进步的评分参数
		set_variable = { which = expo_science_estimate_a value = 1.8 }
		set_variable = { which = expo_science_estimate_b value = 1.3 }
		set_variable = { which = expo_science_estimate_c value = 0.8 }
		#工业技术的评分参数
		set_variable = { which = expo_industry_estimate_a value = 18 }
		set_variable = { which = expo_industry_estimate_b value = 13 }
		set_variable = { which = expo_industry_estimate_c value = 8 }
		#考古发现的评分参数
		set_variable = { which = expo_archaeology_estimate_a value = 10 }
		set_variable = { which = expo_archaeology_estimate_b value = 5 }
		set_variable = { which = expo_archaeology_estimate_c value = 2 }
		#历史传统的评分参数
		set_variable = { which = expo_history_estimate_a value = 9 }
		set_variable = { which = expo_history_estimate_b value = 6 }
		set_variable = { which = expo_history_estimate_c value = 3 }

		set_variable = { which = expo_science_lag value = 1 }
		set_variable = { which = expo_culture_lag value = 1 }
		set_variable = { which = expo_industry_lag value = 1 }
	}

	option = {
		name = "MECR_EXPO.2.option.a"
		trigger = { is_same_value = event_target:expo_organiser }
		# 加修正，开启事件链的描述
		tooltip = {
			add_modifier = { modifier = expo_prepare_timer_organiser days = @expo_prepare_total_timer }
			begin_event_chain = {
				event_chain = the_galactic_expo
				target = root
			}
		}
		# 场馆建设
		if = {
			limit = { capital_scope = { NOT = { has_deposit = d_expo_former_exhibition_center } } }
			enable_special_project = { name = GLACTIC_EXPO_CENTER_CONSTRUCTION location = this.capital_scope }
		}
		else = {
			capital_scope = {
				remove_deposit = d_expo_former_exhibition_center
				add_deposit = d_expo_exhibition_center
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = 15
			}
			change_variable = { which = expo_science_result value = 3 }
			change_variable = { which = expo_culture_result value = 3 }
			change_variable = { which = expo_industry_result value = 3 }
			change_variable = { which = expo_archaeology_result value = 3 }
			change_variable = { which = expo_history_result value = 3 }
			change_variable = { which = expo_total_result value = 15 }
		}
		hidden_effect = {
			# 城邦访问
			country_event = {
				id = MECR_EXPO.30
				days = @expo_sponsor_wait_days
				random = @expo_sponsor_wait_random
			}
			country_event = {
				id = MECR_EXPO.40
				days = @expo_curators_wait_days
				random = @expo_curators_wait_random
			}
			# 清除举办前检查的flag
			remove_global_flag = flag_expo_on_1st
			remove_global_flag = flag_expo_on_queue
			remove_global_flag = flag_expo_on_random
			remove_global_flag = flag_expo_war_delay
		}
	}
	option = {
		name = "MECR_EXPO.2.option.b"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		tooltip = {
			add_modifier = { modifier = expo_prepare_timer days = @expo_prepare_total_timer }
			begin_event_chain = {
				event_chain = the_galactic_expo
				target = root
			}
		}
	}
	after = {
		hidden_effect = {
			set_country_flag = expo_prepare_stage_complete
			country_event = {
				id = MECR_EXPO.3
			}
		}
	}
}
country_event = { #3.开启的准备新阶段，最快每半年一次[on_monthly_pulse_country]
	id = MECR_EXPO.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = flag_expo_preparing
		has_country_flag = expo_prepare_stage_complete
		NOT = { has_country_flag = flag_expo_prepare_stage_timer }
	}
	
	immediate = {
		remove_country_flag = expo_prepare_stage_complete
		enable_special_project = { name = GLACTIC_EXPO_PREPARE_SCIENCE location = this.capital_scope }
		enable_special_project = { name = GLACTIC_EXPO_PREPARE_CULTURE location = this.capital_scope }
		enable_special_project = { name = GLACTIC_EXPO_PREPARE_INDUSTRY location = this.capital_scope }
		if = {
			limit = { NOT = { has_country_flag = flag_expo_archaeology_complete } }
			enable_special_project = { name = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY location = this.capital_scope }
		}
		if = {
			limit = { NOT = { has_country_flag = flag_expo_history_complete } }
			enable_special_project = { name = GLACTIC_EXPO_PREPARE_HISTORY location = this.capital_scope }
		}
		create_message = {
			type = MESSAGE_TYPE_EXPO_PREPARE_REFRESH
			localization = "MESSAGE_TYPE_EXPO_PREPARE_REFRESH_DESC"
			days = 30
			target = capital_scope
		}
		set_timed_country_flag = { flag = flag_expo_prepare_stage_timer days = @expo_prepare_stage_refresh }
	}
}

# 场馆建设
planet_event = { #4.场馆完工
	id = MECR_EXPO.4
	title = "MECR_EXPO.4.title"
	desc = "MECR_EXPO.4.desc"
	picture = "GFX_evt_arena"
	is_triggered_only = yes
	
	option = {
		name = "EXCELLENT"
		add_deposit = d_expo_exhibition_center
		owner = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = 3
			}
		}
		hidden_effect = {
			remove_deposit = d_expo_exhibition_center_constructing
			save_global_event_target_as = expo_exhibition_center
			owner = {
				change_variable = { which = expo_science_result value = 3 }
				change_variable = { which = expo_culture_result value = 3 }
				change_variable = { which = expo_industry_result value = 3 }
				change_variable = { which = expo_archaeology_result value = 3 }
				change_variable = { which = expo_history_result value = 3 }
				change_variable = { which = expo_total_result value = 15 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 15
				}
			}
		}
	}
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
	abort_effect = {
		hidden_effect = {
			remove_deposit = d_expo_exhibition_center_constructing
			add_deposit = d_expo_exhibition_center
			save_global_event_target_as = expo_exhibition_center
			owner = {
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_science_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_culture_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_industry_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_archaeology_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_history_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 15
				}
				change_variable = { which = expo_science_result value = 3 }
				change_variable = { which = expo_culture_result value = 3 }
				change_variable = { which = expo_industry_result value = 3 }
				change_variable = { which = expo_archaeology_result value = 3 }
				change_variable = { which = expo_history_result value = 3 }
				change_variable = { which = expo_total_result value = 15 }
			}
		}
	}
}
planet_event = { #5.开会时场馆未完成，赶工
	id = MECR_EXPO.5
	title = "MECR_EXPO.5.title"
	desc = "MECR_EXPO.5.desc"
	picture = "GFX_evt_mining_operations"
	is_triggered_only = yes
	immediate = {
		remove_deposit = d_expo_exhibition_center_constructing
		add_deposit = d_expo_exhibition_center
		save_global_event_target_as = expo_exhibition_center
	}

	option = {
		name = "TERRIBLE"
		tooltip = { add_deposit = d_expo_exhibition_center }
		owner = {
			add_resource = {
				minerals = -1000
				unity = -1000
				influence = -200
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = 2
			}
			hidden_effect = {
				change_variable = { which = expo_science_result value = 2 }
				change_variable = { which = expo_culture_result value = 2 }
				change_variable = { which = expo_industry_result value = 2 }
				change_variable = { which = expo_archaeology_result value = 2 }
				change_variable = { which = expo_history_result value = 2 }
				change_variable = { which = expo_total_result value = 10 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 10
				}
			}
		}
	}
}
planet_event = { #6.场馆被夺取，立即改为前场馆
	id = MECR_EXPO.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_deposit = d_expo_exhibition_center
		NOT = { has_global_flag = flag_expo_ongoing }
		owner = { NOT = { is_same_value = event_target:expo_organiser } }
	}
	immediate = {
		remove_deposit = d_expo_exhibition_center
		add_deposit = d_expo_former_exhibition_center
		event_target:expo_organiser = {
			country_event = {
				id = MECR_EXPO.7
			}
		}
	}
}
country_event = { #7.场馆建设发生变故，寻找新的首都重新开始建设
	id = MECR_EXPO.7
	title = "MECR_EXPO.7.title"
	desc = "MECR_EXPO.7.desc"
	picture = "GFX_evt_burning_city"
	is_triggered_only = yes
	immediate = {
		clear_global_event_target = expo_exhibition_center
	}

	option = {
		name = "CURSES"
		enable_special_project = { name = GLACTIC_EXPO_CENTER_CONSTRUCTION location = this.capital_scope }
	}
}
planet_event = { #8.定时移除场馆建设修正，防止遗留
	id = MECR_EXPO.8
	hide_window = yes
	is_triggered_only = yes

	trigger = { has_deposit = d_expo_exhibition_center_constructing }
	immediate = { remove_deposit = d_expo_exhibition_center_constructing }
}

country_event = { #30.选择请求成为赞助商的贸易城邦
	id = MECR_EXPO.30
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_country = {
					has_country_flag = trader_enclave_country_1
					has_communications = root
				}
				NOT = { has_country_flag = attacked_xuracorp }
			}
			random_country = {
				limit = { has_country_flag = trader_enclave_country_1 }
				set_country_flag = expo_sponsor_candidate
			}
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = trader_enclave_country_2
					has_communications = root
				}
				NOT = { has_country_flag = attacked_riggans }
			}
			random_country = {
				limit = { has_country_flag = trader_enclave_country_2 }
				set_country_flag = expo_sponsor_candidate
			}
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = trader_enclave_country_3
					has_communications = root
				}
				NOT = { has_country_flag = attacked_muutagans }
			}
			random_country = {
				limit = { has_country_flag = trader_enclave_country_3 }
				set_country_flag = expo_sponsor_candidate
			}
		}
		random_country = {
			limit = { has_country_flag = expo_sponsor_candidate }
			save_event_target_as = expo_sponsor_candidate_bidding
			random_owned_fleet = {
				solar_system = { save_event_target_as = expo_sponsor_candidate_bidding_home_system }
			}
		}
		if = {
			limit = { exists = event_target:expo_sponsor_candidate_bidding }
			country_event = {
				id = MECR_EXPO.31
				days = @expo_sponsor_wait_days
				random = @expo_sponsor_wait_random
			}
		}
	}
}
country_event = { #31.检查赞助商的贸易城邦是否还存在
	id = MECR_EXPO.31
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { exists = event_target:expo_sponsor_candidate_bidding }
			country_event = {
				id = MECR_EXPO.32
			}
		}
		else_if = {
			limit = { any_country = { has_country_flag = expo_sponsor_candidate } }
			random_country = {
				limit = { has_country_flag = expo_sponsor_candidate }
				save_event_target_as = expo_sponsor_candidate_bidding
				random_owned_fleet = {
					solar_system = { save_event_target_as = expo_sponsor_candidate_bidding_home_system }
				}
			}
			country_event = {
				id = MECR_EXPO.31
			}
		}
	}
}
country_event = { #32.贸易城邦请求成为赞助商
	id = MECR_EXPO.32
	title = "MECR_EXPO.32.title"
	desc = {
		text = "MECR_EXPO.32.desc.xura"
		trigger = {
			event_target:expo_sponsor_candidate_bidding = {
				has_country_flag = trader_enclave_country_1
			}
		}
	}
	desc = {
		text = "MECR_EXPO.32.desc.riggan"
		trigger = {
			event_target:expo_sponsor_candidate_bidding = {
				has_country_flag = trader_enclave_country_2
			}
		}
	}
	desc = {
		text = "MECR_EXPO.32.desc.muutagan"
		trigger = {
			event_target:expo_sponsor_candidate_bidding = {
				has_country_flag = trader_enclave_country_3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	picture_event_data = {
		portrait = event_target:expo_sponsor_candidate_bidding
		room = enclave_trader_room
	}

	option = { # 同意
		name = "DEAL"
		custom_gui = "enclave_trader_option"
		allow = {
			OR = {
				is_ai = yes
				resource_stockpile_compare = { resource = influence value >= 75 }
			}
			NOT = { has_event_chain = the_galactic_expo_ongoing }
		}
		custom_tooltip = "MECR_EXPO.32.option.deal"
		event_target:expo_sponsor_candidate_bidding = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							influence = -75
							exotic_gases = 500
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							influence = -75
							volatile_motes = 500
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							influence = -75
							rare_crystals = 500
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 30
			}
		}
		hidden_effect = {
			event_target:expo_sponsor_candidate_bidding = {
				save_global_event_target_as = expo_sponsor
				random_owned_fleet = {
					solar_system = { save_global_event_target_as = expo_sponsor_home_system }
				}
			}
			every_country = {
				limit = { has_country_flag = expo_sponsor_candidate }
				remove_country_flag = expo_sponsor_candidate
			}
		}
		ai_chance = {
			factor = 150
			modifier = {
				factor = 0.5
				event_target:expo_sponsor_candidate_bidding = {
					NOT = { has_country_flag = trader_enclave_country_1 }
				}
				root = {
					NOT = { has_country_flag = attacked_xuracorp }
				}
				any_country = {
					has_country_flag = trader_enclave_country_1
					has_communications = root
				}
			}
			modifier = {
				factor = 2
				event_target:expo_sponsor_candidate_bidding = {
					has_country_flag = trader_enclave_country_1
				}
			}
		}
	}
	option = { # 拒绝
		name = "NODEAL"
		custom_gui = "enclave_trader_option"
		allow = {
		}
		hidden_effect = {
			event_target:expo_sponsor_candidate_bidding = {
				remove_country_flag = expo_sponsor_candidate
			}
			if = {
				limit = { any_country = { has_country_flag = expo_sponsor_candidate } }
				random_country = {
					limit = { has_country_flag = expo_sponsor_candidate }
					save_event_target_as = expo_sponsor_candidate_bidding
					random_owned_fleet = {
						solar_system = { save_event_target_as = expo_sponsor_candidate_bidding_home_system }
					}
				}
				country_event = {
					id = MECR_EXPO.31
					days = @expo_sponsor_wait_days
					random = @expo_sponsor_wait_random
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = {
					any_country = {
						has_country_flag = expo_sponsor_candidate
						NOT = { is_same_value = event_target:expo_sponsor_candidate_bidding }
					}
				}
			}
		}
	}
	option = {
		name = leviathans.105.d
		default_hide_option = yes
		custom_gui = "enclave_trader_option"
	}
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

country_event = { #40.检查策展人申请参加博览会
	id = MECR_EXPO.40
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_country = {
					has_country_flag = curator_enclave_country
				}
			}
			random_country = {
				limit = { has_country_flag = curator_enclave_country }
				set_country_flag = expo_curators
				save_global_event_target_as = expo_curators
			}
			if = {
				limit = { NOT = { has_country_flag = attacked_curators } }
				event_target:expo_curators = {
					if = {
						limit = { NOT = { has_communications = root } }
						establish_communications = root
					}
				}
				country_event = {
					id = MECR_EXPO.41
					days = @expo_curators_wait_days
					random = @expo_curators_wait_random
				}
			}
			#else = {
			#	random_galcom_member = {
			#		limit = { has_communications = event_target:expo_curators }
			#		country_event = {
			#			id = MECR_EXPO.42
			#			days = 90
			#			random = 120
			#		}
			#	}
			#}
		}
	}
}
country_event = { #41.策展人申请参加博览会
	id = MECR_EXPO.41
	title = "MECR_EXPO.41.title"
	desc = "MECR_EXPO.41.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_curator_window"
	picture_event_data = {
		portrait = event_target:expo_curators
		room = enclave_curator_room
	}

	trigger = {
		exists = event_target:expo_curators
		NOT = { has_country_flag = attacked_curators }
	}

	option = { # 同意
		name = "MECR_EXPO.41.option.ok"
		custom_gui = "enclave_curator_option"
		allow = {
			OR = {
				is_ai = yes
				resource_stockpile_compare = { resource = influence value >= 25 }
			}
			NOT = { has_event_chain = the_galactic_expo_ongoing }
		}
		custom_tooltip = "MECR_EXPO.41.option.ok.tooltip"
		add_resource = { influence = -25 }
		add_monthly_resource_mult = { resource = physics_research value = 1 }
		add_monthly_resource_mult = { resource = society_research value = 1 }
		add_monthly_resource_mult = { resource = engineering_research value = 1 }
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			set_global_flag = flag_curator_take_part_in_expo
		}
		ai_chance = {
			factor = 1000
		}
	}

	option = { # 拒绝
		name = "MECR_EXPO.41.option.no"
		custom_gui = "enclave_curator_option"
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = -10
			}
		}
		trigger = {
			OR = {
				is_ai = no
				has_event_chain = the_galactic_expo_ongoing
			}
		}
	}

	option = {
		name = leviathans.500.e
		default_hide_option = yes
		custom_gui = "enclave_curator_option"
		ai_chance = {
			factor = 0
		}
	}

	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

# 准备展览
country_event = { #100.【目录】EXPO准备阶段结束
	id = MECR_EXPO.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
		NOT = {
			has_global_flag = debug_expo_preparation_ends_event
		}
	}

	immediate = {
		set_global_flag = debug_expo_preparation_ends_event
		every_country = {
			limit = { has_event_chain = the_galactic_expo }
			if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_SCIENCE }
				change_variable = { which = expo_science_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_science_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_CULTURE }
				change_variable = { which = expo_culture_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_culture_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_INDUSTRY }
				change_variable = { which = expo_industry_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_industry_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
				change_variable = { which = expo_archaeology_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_archaeology_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_HISTORY }
				change_variable = { which = expo_history_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_history_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
			if = {
				limit = { NOT = { any_owned_planet = { has_deposit = d_expo_exhibition_center } } }
				abort_special_project = { type = GLACTIC_EXPO_CENTER_CONSTRUCTION }
				every_owned_planet = {
					limit = { has_deposit = d_expo_exhibition_center_constructing }
					remove_deposit = d_expo_exhibition_center_constructing
				}
				capital_scope = {
					planet_event = { #场馆赶工
						id = MECR_EXPO.5
					}
				}
			}
			remove_country_flag = flag_expo_science_complete
			remove_country_flag = flag_expo_culture_complete
			remove_country_flag = flag_expo_industry_complete
			remove_country_flag = flag_expo_archaeology_complete
			remove_country_flag = flag_expo_history_complete
			remove_country_flag = expo_prepare_stage_complete
			remove_country_flag = flag_expo_prepare_stage_timer

			#科学进步的评分参数
			set_variable = { which = expo_science_estimate_a value = 1.8 }
			set_variable = { which = expo_science_estimate_b value = 1.3 }
			set_variable = { which = expo_science_estimate_c value = 0.8 }
			#工业技术的评分参数
			set_variable = { which = expo_industry_estimate_a value = 18 }
			set_variable = { which = expo_industry_estimate_b value = 13 }
			set_variable = { which = expo_industry_estimate_c value = 8 }
			#考古发现的评分参数
			set_variable = { which = expo_archaeology_estimate_a value = 10 }
			set_variable = { which = expo_archaeology_estimate_b value = 5 }
			set_variable = { which = expo_archaeology_estimate_c value = 2 }
			#历史传统的评分参数
			set_variable = { which = expo_history_estimate_a value = 9 }
			set_variable = { which = expo_history_estimate_b value = 6 }
			set_variable = { which = expo_history_estimate_c value = 3 }
			clear_variable = expo_science_estimate_a
			clear_variable = expo_science_estimate_b
			clear_variable = expo_science_estimate_c
			clear_variable = expo_industry_estimate_a
			clear_variable = expo_industry_estimate_b
			clear_variable = expo_industry_estimate_c
			clear_variable = expo_archaeology_estimate_a
			clear_variable = expo_archaeology_estimate_b
			clear_variable = expo_archaeology_estimate_c
			clear_variable = expo_history_estimate_a
			clear_variable = expo_history_estimate_b
			clear_variable = expo_history_estimate_c
			clear_variable = expo_science_lag
			clear_variable = expo_culture_lag
			clear_variable = expo_industry_lag
		}
		country_event = {
			id = MECR_EXPO.200
			days = 1
		}
	}
}

country_event = { #110.科学进步：评分
	id = MECR_EXPO.110
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }

		# 掷骰
		reroll_random = yes
		random_list = {
			100 = {
				multiply = value:expo_science_advantage
				set_variable = { which = expo_science_gain value = 3 }
			}
			60 = {
				set_variable = { which = expo_science_gain value = 2 }
			}
			80 = {
				multiply = value:expo_science_disadvantage
				set_variable = { which = expo_science_gain value = 1 }
			}
		}

		if = {
			limit = { NOT = { has_country_flag = flag_expo_science_complete } }
			set_country_flag = flag_expo_science_complete
		}
		multiply_variable = { which = expo_science_lag value = 2 }

		country_event = {
			id = MECR_EXPO.111
		}
	}
}
country_event = { #111.科学进步：评分结果
	id = MECR_EXPO.111
	title = "MECR_EXPO.111.title"
	desc = {
		text = "MECR_EXPO.111.desc.a.1"
		trigger = { check_variable = { which = expo_science_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.a.2"
		trigger = { check_variable = { which = expo_science_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.a.3"
		trigger = { check_variable = { which = expo_science_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.b.1"
		trigger = { check_variable = { which = expo_science_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.b.2"
		trigger = { check_variable = { which = expo_science_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.b.3"
		trigger = { check_variable = { which = expo_science_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.c.1"
		trigger = { check_variable = { which = expo_science_gain value = 1 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.c.2"
		trigger = { check_variable = { which = expo_science_gain value = 1 } }
	}
	picture = "GFX_evt_physics_research"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_science_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		random_list = {
			10 = { change_variable = { which = expo_gain_amount value = 1 } }
			10 = { change_variable = { which = expo_gain_amount value = -1 } }
			20 = {}
		}
		random_owned_leader = {
			limit = { is_researching_area = physics }
			save_event_target_as = physics_leader
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_science_result value = expo_gain_amount }
	}

	option = {
		name = {
			text = "EXCELLENT"
			trigger = { check_variable = { which = expo_science_gain value = 3 } }
		}
		name = {
			text = "GOOD"
			trigger = { check_variable = { which = expo_science_gain value = 2 } }
		}
		name = {
			text = "OOPS"
			trigger = { check_variable = { which = expo_science_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_science_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_science_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

country_event = { #120.文化艺术：评分
	id = MECR_EXPO.120
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		
		# 第一次给2次掷骰，此后只给1次掷骰
		if = {
			limit = { NOT = { has_country_flag = flag_expo_culture_complete } }
			change_variable = { which = expo_culture_scoring_dices value = 2 }
		}
		else = {
			change_variable = { which = expo_culture_scoring_dices value = 1 }
		}
		# 奖励骰
		if = {
			limit = { has_modifier = enclave_artist_patron }
			multiply_variable = { which = expo_culture_scoring_dices value = 1 }
		}
		# 掷骰
		set_variable = { which = expo_culture_gain value = 0 }
		set_variable = { which = expo_culture_scoring_inspiration value = 0 }
		while = {
			count = expo_culture_scoring_dices
			reroll_random = yes
			random_list = {
				2 = {
					add = expo_culture_scoring_inspiration
					set_variable = { which = expo_culture_scoring value = 3 }
				}
				3 = {
					set_variable = { which = expo_culture_scoring value = 2 }
				}
				7 = {
					set_variable = { which = expo_culture_scoring value = 1 }
				}
			}
			change_variable = { which = expo_culture_scoring_inspiration value = 0.5 }
			if = {
				limit = { check_variable = { which = expo_culture_gain value < expo_culture_scoring } }
				set_variable = { which = expo_culture_gain value = expo_culture_scoring }
			}
		}

		clear_variable = expo_culture_scoring
		clear_variable = expo_culture_scoring_dices
		clear_variable = expo_culture_scoring_inspiration

		if = {
			limit = { NOT = { has_country_flag = flag_expo_culture_complete } }
			set_country_flag = flag_expo_culture_complete
		}
		multiply_variable = { which = expo_culture_lag value = 2 }

		country_event = {
			id = MECR_EXPO.121
		}
	}
}
country_event = { #121.文化艺术：评分结果
	id = MECR_EXPO.121
	title = "MECR_EXPO.121.title"
	desc = {
		text = "MECR_EXPO.121.desc.a.1"
		trigger = { check_variable = { which = expo_culture_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.a.2"
		trigger = { check_variable = { which = expo_culture_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.a.3"
		trigger = { check_variable = { which = expo_culture_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.b.1"
		trigger = { check_variable = { which = expo_culture_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.b.2"
		trigger = { check_variable = { which = expo_culture_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.b.3"
		trigger = { check_variable = { which = expo_culture_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.c.1"
		trigger = { check_variable = { which = expo_culture_gain value = 1 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.c.2"
		trigger = { check_variable = { which = expo_culture_gain value = 1 } }
	}
	picture = "GFX_evt_analyzing_artifacts"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_culture_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		random_list = {
			10 = { change_variable = { which = expo_gain_amount value = 1 } }
			10 = { change_variable = { which = expo_gain_amount value = -1 } }
			20 = {}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_culture_result value = expo_gain_amount }
	}

	option = {
		name = {
			text = "SPLENDID"
			trigger = { check_variable = { which = expo_culture_gain value = 3 } }
		}
		name = {
			text = "INTRIGUING"
			trigger = { check_variable = { which = expo_culture_gain value = 2 } }
		}
		name = {
			text = "UNFORTUNATE"
			trigger = { check_variable = { which = expo_culture_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_culture_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_culture_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}
country_event = { #122.文化艺术：追加投资
	id = MECR_EXPO.122
	title = "MECR_EXPO.122.title"
	desc = "MECR_EXPO.122.desc"
	picture = "GFX_evt_analyzing_artifacts"
	is_triggered_only = yes

	option = {
		name = "MAKE_IT_SO"
		custom_tooltip = "MECR_EXPO.122.option.tooltip.a"
		trigger = { 
			resource_stockpile_compare = {
				resource = unity
				value > value:expo_culture_invest
			}
		}
		add_resource = {
			unity = -1
			mult = value:expo_culture_invest
		}
		hidden_effect = {
			change_variable = { which = expo_culture_scoring_dices value = 1 }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = "TOOPOOR"
		custom_tooltip = "MECR_EXPO.122.option.tooltip.b"
		ai_chance = {
			factor = 500
			modifier = {
				factor = 0
				resource_stockpile_compare = {
					resource = unity
					value > 2000
				}
			}
		}
	}
}

country_event = { #130.工业技术：评分
	id = MECR_EXPO.130
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		
		set_variable = { which = expo_industry_gain value = 0 }
		#掷骰
		change_variable = { which = expo_industry_scoring_dices value = 2 }
		while = {
			count = expo_industry_scoring_dices
			reroll_random = yes
			random_list = {
				10 = {
					add = value:expo_industry_advantage
					set_variable = { which = expo_industry_scoring value = 3 }
				}
				15 = {
					set_variable = { which = expo_industry_scoring value = 2 }
				}
			}
			if = {
				limit = { check_variable = { which = expo_industry_gain value < expo_industry_scoring } }
				set_variable = { which = expo_industry_gain value = expo_industry_scoring }
			}
		}

		clear_variable = expo_industry_scoring
		clear_variable = expo_industry_scoring_dices

		if = {
			limit = { NOT = { has_country_flag = flag_expo_industry_complete } }
			set_country_flag = flag_expo_industry_complete
		}
		multiply_variable = { which = expo_industry_lag value = 2 }

		country_event = {
			id = MECR_EXPO.131
		}
	}
}
country_event = { #131.工业技术：评分结果
	id = MECR_EXPO.131
	title = "MECR_EXPO.131.title"
	desc = {
		text = "MECR_EXPO.131.desc.a.1"
		trigger = { check_variable = { which = expo_industry_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.a.2"
		trigger = { check_variable = { which = expo_industry_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.a.3"
		trigger = { check_variable = { which = expo_industry_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.b.1"
		trigger = { check_variable = { which = expo_industry_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.b.2"
		trigger = { check_variable = { which = expo_industry_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.b.3"
		trigger = { check_variable = { which = expo_industry_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.c.1"
		trigger = { check_variable = { which = expo_industry_gain value = 1 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.c.2"
		trigger = { check_variable = { which = expo_industry_gain value = 1 } }
	}
	picture = "GFX_evt_cybernetics"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_industry_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		random_list = {
			10 = { change_variable = { which = expo_gain_amount value = 1 } }
			10 = { change_variable = { which = expo_gain_amount value = -1 } }
			20 = {}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_industry_result value = expo_gain_amount }
	}

	option = {
		name = {
			text = "MARVELOUS"
			trigger = { check_variable = { which = expo_industry_gain value = 3 } }
		}
		name = {
			text = "GOOD"
			trigger = { check_variable = { which = expo_industry_gain value = 2 } }
		}
		name = {
			text = "WORRYING"
			trigger = { check_variable = { which = expo_industry_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_industry_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_industry_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}
country_event = { #132.工业技术：追加投资
	id = MECR_EXPO.132
	title = "MECR_EXPO.132.title"
	desc = "MECR_EXPO.132.desc"
	picture = "GFX_evt_cybernetics"
	is_triggered_only = yes

	option = {
		name = "MAKE_IT_SO"
		custom_tooltip = "MECR_EXPO.132.option.tooltip.a"
		trigger = { 
			resource_stockpile_compare = {
				resource = alloys
				value > value:expo_industry_invest
			}
		}
		add_resource = {
			alloys = -1
			mult = value:expo_industry_invest
		}
		hidden_effect = {
			change_variable = { which = expo_industry_scoring_dices value = 1 }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = "TOOPOOR"
		custom_tooltip = "MECR_EXPO.132.option.tooltip.b"
		ai_chance = {
			factor = 500
			modifier = {
				factor = 0
				resource_stockpile_compare = {
					resource = alloys
					value > 1000
				}
			}
		}
	}
}

country_event = { #140.考古发现：评分
	id = MECR_EXPO.140
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		
		change_variable = { which = expo_archaeology_scoring_dices value = 1 }
		if = { #纪念主义额外+1
			limit = {
				OR = {
					has_valid_civic = civic_memorialist
					has_valid_civic = civic_hive_memorialist
					has_valid_civic = civic_machine_memorialist
				}
			}
			change_variable = { which = expo_archaeology_scoring_dices value = 1 }
		}
		#掷骰
		set_variable = { which = expo_archaeology_gain value = 0 }
		while = {
			count = expo_archaeology_scoring_dices
			reroll_random = yes
			random_list = {
				5 = {
					add = value:expo_archaeology_advantage
					set_variable = { which = expo_archaeology_scoring value = 3 }
				}
				5 = {
					set_variable = { which = expo_archaeology_scoring value = 2 }
				}
				7 = {
					modifier = {
						add = 2
						resource_stockpile_compare = { resource = minor_artifacts value = 0 }
					}
					set_variable = { which = expo_archaeology_scoring value = 1 }
				}
			}
			if = {
				limit = { check_variable = { which = expo_archaeology_gain value < expo_archaeology_scoring } }
				set_variable = { which = expo_archaeology_gain value = expo_archaeology_scoring }
			}
		}

		change_variable = { which = expo_archaeology_scoring_boring value = 5 }
		clear_variable = expo_archaeology_scoring
		clear_variable = expo_archaeology_scoring_dices

		if = {
			limit = { NOT = { has_country_flag = flag_expo_archaeology_complete } }
			set_country_flag = flag_expo_archaeology_complete
		}

		country_event = {
			id = MECR_EXPO.141
		}
	}
}
country_event = { #141.考古发现：评分结果
	id = MECR_EXPO.141
	title = "MECR_EXPO.141.title"
	desc = {
		text = "MECR_EXPO.141.desc.a.1"
		trigger = { check_variable = { which = expo_archaeology_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.a.2"
		trigger = { check_variable = { which = expo_archaeology_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.b.1"
		trigger = { check_variable = { which = expo_archaeology_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.b.2"
		trigger = { check_variable = { which = expo_archaeology_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.c.1"
		trigger = { check_variable = { which = expo_archaeology_gain value = 1 } }
	}
	picture = "GFX_evt_habitable_dig_site"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_archaeology_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		random_list = {
			10 = { change_variable = { which = expo_gain_amount value = 1 } }
			10 = { change_variable = { which = expo_gain_amount value = -1 } }
			20 = {}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_archaeology_result value = expo_gain_amount }
	}

	option = {
		name = {
			text = "FASCINATING"
			trigger = { check_variable = { which = expo_archaeology_gain value = 3 } }
		}
		name = {
			text = "AMAZING"
			trigger = { check_variable = { which = expo_archaeology_gain value = 2 } }
		}
		name = {
			text = "OOPS"
			trigger = { check_variable = { which = expo_archaeology_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_archaeology_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_archaeology_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}
country_event = { #142.考古发现：追加投资
	id = MECR_EXPO.142
	title = "MECR_EXPO.142.title"
	desc = "MECR_EXPO.142.desc"
	picture = "GFX_evt_habitable_dig_site"
	is_triggered_only = yes

	option = {
		name = "MAKE_IT_SO"
		custom_tooltip = "MECR_EXPO.142.option.tooltip.a"
		trigger = { 
			resource_stockpile_compare = {
				resource = minor_artifacts
				value > 2
			}
		}
		add_resource = {
			minor_artifacts = -2
		}
		hidden_effect = {
			change_variable = { which = expo_archaeology_scoring_dices value = 1 }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = "TOOPOOR"
		custom_tooltip = "MECR_EXPO.142.option.tooltip.b"
		ai_chance = {
			factor = 300
			modifier = {
				factor = 0
				resource_stockpile_compare = {
					resource = minor_artifacts
					value > 10
				}
			}
		}
	}
}

country_event = { #150.历史传统：评分
	id = MECR_EXPO.150
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }

		# 每次展示传统，都会增加一个惩罚骰：展示得越多，人们越会觉得厌倦
		change_variable = { which = expo_history_scoring_dices value = 1 }
		# 掷骰
		set_variable = { which = expo_history_gain value = 3 }
		while = {
			count = expo_history_scoring_dices
			reroll_random = yes
			random_list = {
				6 = {
					add = value:expo_history_advantage
					set_variable = { which = expo_history_scoring value = 3 }
				}
				5 = {
					set_variable = { which = expo_history_scoring value = 2 }
				}
				2 = {
					set_variable = { which = expo_history_scoring value = 1 }
				}
			}
			if = {
				limit = { check_variable = { which = expo_history_gain value > expo_history_scoring } }
				set_variable = { which = expo_history_gain value = expo_history_scoring }
			}
		}
		# 如果得分太差，下次得到额外分数（教训）
		if = {
			limit = { check_variable = { which = expo_history_gain value = 1 } }
			set_variable = { which = expo_history_next_time_bonus value = 8 }
		}
		else_if = {
			limit = { check_variable = { which = expo_history_gain value = 2 } }
			set_variable = { which = expo_history_next_time_bonus value = 4 }
		}
		else = {
			set_variable = { which = expo_history_next_time_bonus value = 0 }
		}

		#不清除 expo_history_scoring_dices 和 expo_history_next_time_bonus
		clear_variable = expo_history_scoring

		if = {
			limit = { NOT = { has_country_flag = flag_expo_history_complete } }
			set_country_flag = flag_expo_history_complete
		}

		country_event = {
			id = MECR_EXPO.151
		}
	}
}
country_event = { #151.历史传统：评分结果
	id = MECR_EXPO.151
	title = "MECR_EXPO.151.title"
	desc = {
		text = "MECR_EXPO.151.desc.a.1"
		trigger = {
			check_variable = { which = expo_history_gain value = 3 }
			OR = {
				is_gestalt = no
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.a.2"
		trigger = {
			check_variable = { which = expo_history_gain value = 3 }
			OR = {
				is_gestalt = no
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.a.gestalt"
		trigger = {
			check_variable = { which = expo_history_gain value = 3 }
			is_gestalt = yes
			NOT = { has_civic = civic_machine_servitor }
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.b.1"
		trigger = {
			check_variable = { which = expo_history_gain value = 2 }
			OR = {
				is_gestalt = no
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.b.2"
		trigger = {
			check_variable = { which = expo_history_gain value = 2 }
			OR = {
				is_gestalt = no
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.b.gestalt"
		trigger = {
			check_variable = { which = expo_history_gain value = 2 }
			is_gestalt = yes
			NOT = { has_civic = civic_machine_servitor }
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.c.1"
		trigger = { check_variable = { which = expo_history_gain value = 1 } }
	}
	picture = "GFX_evt_tradestation_interior"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_history_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		random_list = {
			10 = { change_variable = { which = expo_gain_amount value = 1 } }
			10 = { change_variable = { which = expo_gain_amount value = -1 } }
			20 = {}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_history_result value = expo_gain_amount }
	}

	option = {
		name = {
			text = "REMARKABLE"
			trigger = { check_variable = { which = expo_history_gain value = 3 } }
		}
		name = {
			text = "GOOD"
			trigger = { check_variable = { which = expo_history_gain value = 2 } }
		}
		name = {
			text = "WORRYING"
			trigger = { check_variable = { which = expo_history_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_history_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_history_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

# 展览阶段开始前，排名
country_event = { #200.【目录】开始排名
	id = MECR_EXPO.200
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = debug_expo_ranking_event
		}
	}

	immediate = {
		remove_global_flag = debug_expo_preparation_ends_event
		set_global_flag = debug_expo_ranking_event
		export_trigger_value_to_variable = {
			trigger = count_country
			parameters = { limit = { is_galactic_community_member = yes } }
			variable = expo_ranking_base
		}
		set_variable = { which = expo_ranking_base_good value = expo_ranking_base }
		divide_variable = { which = expo_ranking_base_good value = 3 }
		set_variable = { which = expo_ranking_base_normal value = expo_ranking_base_good }
		multiply_variable = { which = expo_ranking_base_normal value = 2 }
		country_event = {
			id = MECR_EXPO.201
		}
		country_event = {
			id = MECR_EXPO.202
		}
		country_event = {
			id = MECR_EXPO.203
			days = 1
		}
		country_event = {
			id = MECR_EXPO.204
			days = 1
		}
		country_event = {
			id = MECR_EXPO.205
			days = 1
		}
		country_event = {
			id = MECR_EXPO.206
			days = 2
		}
		country_event = {
			id = MECR_EXPO.300
			days = 3
		}
	}
}
country_event = { #201.【目录】科学进步展览排名
	id = MECR_EXPO.201
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 并列排名
		set_variable = { which = Rexpo_science_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_science_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_science_counter value > 0 }
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_science_result value = root.Rexpo_science_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_science_result value = root.Rexpo_science_counter } }
					set_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker }
				}
				change_variable = { which = Rexpo_science_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_science_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_science_result value = 0 } }
			set_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker }
		}
		# 分配等级
		set_variable = { which = Rexpo_science_ranker value = 1 }
		set_variable = { which = Rexpo_science_stack value = 0 }
		# 好：在好的名额满足之前，同一评级的全部加上
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_science_stack value < expo_ranking_base_good } }
			}
			every_country = {
				limit = { check_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker } }
				root = { change_variable = { which = Rexpo_science_stack value = 1 } }
				set_country_flag = flag_expo_science_grade_good
			}
			change_variable = { which = Rexpo_science_ranker value = 1 }
		}
		# 中：在中的名额满足之前，同一评级的全部加上
		while = {
			limit = { root = { check_variable = { which = Rexpo_science_stack value < expo_ranking_base_normal } } }
			every_country = {
				limit = { check_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker } }
				root = { change_variable = { which = Rexpo_science_stack value = 1 } }
				set_country_flag = flag_expo_science_grade_normal
			}
			change_variable = { which = Rexpo_science_ranker value = 1 }
		}
		# 差：剩下的都是差
		every_country = {
			limit = {
				check_variable = { which = expo_science_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_science_grade_good
					has_country_flag = flag_expo_science_grade_normal
				}
			}
			set_country_flag = flag_expo_science_grade_bad
		}
		every_country = {
			limit = { check_variable = { which = expo_science_result value = 0 } }
			set_country_flag = flag_expo_science_grade_no_parti
		}
		# 分配前三名
		find_expo_champion = {
			category = science
			standard = physics_research
		}
		clear_variable = Rexpo_science_counter
		clear_variable = Rexpo_science_ranker
		clear_variable = Rexpo_science_stack
	}
}
country_event = { #202.【目录】文化艺术展览排名
	id = MECR_EXPO.202
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 并列排名
		set_variable = { which = Rexpo_culture_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_culture_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_culture_counter value > 0 }
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_culture_result value = root.Rexpo_culture_counter } } }
				every_country = {
					limit = { check_variable = { which = expo_culture_result value = root.Rexpo_culture_counter } }
					set_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker }
				}
				change_variable = { which = Rexpo_culture_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_culture_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_culture_result value = 0 } }
			set_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker }
		}
		# 分配等级
		set_variable = { which = Rexpo_culture_ranker value = 1 }
		set_variable = { which = Rexpo_culture_stack value = 0 }
		# 好：在好的名额满足之前，同一评级的全部加上
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_culture_stack value < expo_ranking_base_good } }
			}
			every_country = {
				limit = { check_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker } }
				root = { change_variable = { which = Rexpo_culture_stack value = 1 } }
				set_country_flag = flag_expo_culture_grade_good
			}
			change_variable = { which = Rexpo_culture_ranker value = 1 }
		}
		# 中：在中的名额满足之前，同一评级的全部加上
		while = {
			limit = { root = { check_variable = { which = Rexpo_culture_stack value < expo_ranking_base_normal } } }
			every_country = {
				limit = { check_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker } }
				root = { change_variable = { which = Rexpo_culture_stack value = 1 } }
				set_country_flag = flag_expo_culture_grade_normal
			}
			change_variable = { which = Rexpo_culture_ranker value = 1 }
		}
		# 差：剩下的都是差
		every_country = {
			limit = {
				check_variable = { which = expo_culture_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_culture_grade_good
					has_country_flag = flag_expo_culture_grade_normal
				}
			}
			set_country_flag = flag_expo_culture_grade_bad
		}
		every_country = {
			limit = { check_variable = { which = expo_culture_result value = 0 } }
			set_country_flag = flag_expo_culture_grade_no_parti
		}
		# 分配前三名
		find_expo_champion = {
			category = culture
			standard = unity
		}
		clear_variable = Rexpo_culture_counter
		clear_variable = Rexpo_culture_ranker
		clear_variable = Rexpo_culture_stack
	}
}
country_event = { #203.【目录】工业技术展览排名
	id = MECR_EXPO.203
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 并列排名
		set_variable = { which = Rexpo_industry_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_industry_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_industry_counter value > 0 }
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_industry_result value = root.Rexpo_industry_counter } } }
				every_country = {
					limit = { check_variable = { which = expo_industry_result value = root.Rexpo_industry_counter } }
					set_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker }
				}
				change_variable = { which = Rexpo_industry_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_industry_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_industry_result value = 0 } }
			set_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker }
		}
		# 分配等级
		set_variable = { which = Rexpo_industry_ranker value = 1 }
		set_variable = { which = Rexpo_industry_stack value = 0 }
		# 好：在好的名额满足之前，同一评级的全部加上
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_industry_stack value < expo_ranking_base_good } }
			}
			every_country = {
				limit = { check_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker } }
				root = { change_variable = { which = Rexpo_industry_stack value = 1 } }
				set_country_flag = flag_expo_industry_grade_good
			}
			change_variable = { which = Rexpo_industry_ranker value = 1 }
		}
		# 中：在中的名额满足之前，同一评级的全部加上
		while = {
			limit = { root = { check_variable = { which = Rexpo_industry_stack value < expo_ranking_base_normal } } }
			every_country = {
				limit = { check_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker } }
				root = { change_variable = { which = Rexpo_industry_stack value = 1 } }
				set_country_flag = flag_expo_industry_grade_normal
			}
			change_variable = { which = Rexpo_industry_ranker value = 1 }
		}
		# 差：剩下的都是差
		every_country = {
			limit = {
				check_variable = { which = expo_industry_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_industry_grade_good
					has_country_flag = flag_expo_industry_grade_normal
				}
			}
			set_country_flag = flag_expo_industry_grade_bad
		}
		every_country = {
			limit = { check_variable = { which = expo_industry_result value = 0 } }
			set_country_flag = flag_expo_industry_grade_no_parti
		}
		# 分配前三名
		find_expo_champion = {
			category = industry
			standard = alloys
		}
		clear_variable = Rexpo_industry_counter
		clear_variable = Rexpo_industry_ranker
		clear_variable = Rexpo_industry_stack
	}
}
country_event = { #204.【目录】考古发现展览排名
	id = MECR_EXPO.204
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 并列排名
		set_variable = { which = Rexpo_archaeology_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_archaeology_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_archaeology_counter value > 0 }
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_archaeology_result value = root.Rexpo_archaeology_counter } } }
				every_country = {
					limit = { check_variable = { which = expo_archaeology_result value = root.Rexpo_archaeology_counter } }
					set_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker }
				}
				change_variable = { which = Rexpo_archaeology_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_archaeology_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_archaeology_result value = 0 } }
			set_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker }
		}
		# 分配等级
		set_variable = { which = Rexpo_archaeology_ranker value = 1 }
		set_variable = { which = Rexpo_archaeology_stack value = 0 }
		# 好：在好的名额满足之前，同一评级的全部加上
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_archaeology_stack value < expo_ranking_base_good } }
			}
			every_country = {
				limit = { check_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker } }
				root = { change_variable = { which = Rexpo_archaeology_stack value = 1 } }
				set_country_flag = flag_expo_archaeology_grade_good
			}
			change_variable = { which = Rexpo_archaeology_ranker value = 1 }
		}
		# 中：在中的名额满足之前，同一评级的全部加上
		while = {
			limit = { root = { check_variable = { which = Rexpo_archaeology_stack value < expo_ranking_base_normal } } }
			every_country = {
				limit = { check_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker } }
				root = { change_variable = { which = Rexpo_archaeology_stack value = 1 } }
				set_country_flag = flag_expo_archaeology_grade_normal
			}
			change_variable = { which = Rexpo_archaeology_ranker value = 1 }
		}
		# 差：剩下的都是差
		every_country = {
			limit = {
				check_variable = { which = expo_archaeology_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_archaeology_grade_good
					has_country_flag = flag_expo_archaeology_grade_normal
				}
			}
			set_country_flag = flag_expo_archaeology_grade_bad
		}
		every_country = {
			limit = { check_variable = { which = expo_archaeology_result value = 0 } }
			set_country_flag = flag_expo_archaeology_grade_no_parti
		}
		# 分配前三名
		find_expo_champion = {
			category = archaeology
			standard = unity
		}
		clear_variable = Rexpo_archaeology_counter
		clear_variable = Rexpo_archaeology_ranker
		clear_variable = Rexpo_archaeology_stack
	}
}
country_event = { #205.【目录】历史传统展览排名
	id = MECR_EXPO.205
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 并列排名
		set_variable = { which = Rexpo_history_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_history_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_history_counter value > 0 }
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_history_result value = root.Rexpo_history_counter } } }
				every_country = {
					limit = { check_variable = { which = expo_history_result value = root.Rexpo_history_counter } }
					set_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker }
				}
				change_variable = { which = Rexpo_history_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_history_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_history_result value = 0 } }
			set_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker }
		}
		# 分配等级
		set_variable = { which = Rexpo_history_ranker value = 1 }
		set_variable = { which = Rexpo_history_stack value = 0 }
		# 好：在好的名额满足之前，同一评级的全部加上
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_history_stack value < expo_ranking_base_good } }
			}
			every_country = {
				limit = { check_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker } }
				root = { change_variable = { which = Rexpo_history_stack value = 1 } }
				set_country_flag = flag_expo_history_grade_good
			}
			change_variable = { which = Rexpo_history_ranker value = 1 }
		}
		# 中：在中的名额满足之前，同一评级的全部加上
		while = {
			limit = { root = { check_variable = { which = Rexpo_history_stack value < expo_ranking_base_normal } } }
			every_country = {
				limit = { check_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker } }
				root = { change_variable = { which = Rexpo_history_stack value = 1 } }
				set_country_flag = flag_expo_history_grade_normal
			}
			change_variable = { which = Rexpo_history_ranker value = 1 }
		}
		# 差：剩下的都是差
		every_country = {
			limit = {
				check_variable = { which = expo_history_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_history_grade_good
					has_country_flag = flag_expo_history_grade_normal
				}
			}
			set_country_flag = flag_expo_history_grade_bad
		}
		every_country = {
			limit = { check_variable = { which = expo_history_result value = 0 } }
			set_country_flag = flag_expo_history_grade_no_parti
		}
		# 分配前三名
		find_expo_champion = {
			category = history
			standard = influence
		}
		clear_variable = Rexpo_history_counter
		clear_variable = Rexpo_history_ranker
		clear_variable = Rexpo_history_stack
	}
}
country_event = { #206.【目录】总分排名
	id = MECR_EXPO.206
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 并列排名
		set_variable = { which = Rexpo_total_counter value = @max_total_exhi_score }
		set_variable = { which = Rexpo_total_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_total_counter value > 0 }
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_total_result value = root.Rexpo_total_counter } } }
				every_country = {
					limit = { check_variable = { which = expo_total_result value = root.Rexpo_total_counter } }
					set_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker }
				}
				change_variable = { which = Rexpo_total_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_total_counter value = 1 }
		}
		# 分配等级
		set_variable = { which = Rexpo_total_ranker value = 1 }
		set_variable = { which = Rexpo_total_stack value = 0 }
		# 好：在好的名额满足之前，同一评级的全部加上
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_total_stack value < expo_ranking_base_good } }
			}
			every_country = {
				limit = { check_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker } }
				root = { change_variable = { which = Rexpo_total_stack value = 1 } }
				set_country_flag = flag_expo_total_grade_good
			}
			change_variable = { which = Rexpo_total_ranker value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_total_result value = 0 } }
			set_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker }
		}
		# 中：在中的名额满足之前，同一评级的全部加上
		while = {
			limit = { root = { check_variable = { which = Rexpo_total_stack value < expo_ranking_base_normal } } }
			every_country = {
				limit = { check_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker } }
				root = { change_variable = { which = Rexpo_total_stack value = 1 } }
				set_country_flag = flag_expo_total_grade_normal
			}
			change_variable = { which = Rexpo_total_ranker value = 1 }
		}
		# 差：剩下的都是差
		every_country = {
			limit = {
				check_variable = { which = expo_total_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_total_grade_good
					has_country_flag = flag_expo_total_grade_normal
				}
			}
			set_country_flag = flag_expo_total_grade_bad
		}
		every_country = {
			limit = { check_variable = { which = expo_total_result value = 0 } }
			set_country_flag = flag_expo_total_grade_no_parti
		}
		# 分配前三名
		find_expo_champion_diplo_weight = {
			category = total
		}
		clear_variable = Rexpo_total_counter
		clear_variable = Rexpo_total_ranker
		clear_variable = Rexpo_total_stack
	}
}

# 展览阶段
country_event = { #300.【目录】开幕
	id = MECR_EXPO.300
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = debug_expo_openning_event
		}
	}

	immediate = {
		remove_global_flag = debug_expo_ranking_event
		set_global_flag = debug_expo_openning_event
		# 艺术团的设置
		if = {
			limit = {
				any_country = { has_country_flag = artist_enclave_country }
			}
			random_country = {
				limit = { has_country_flag = artist_enclave_country }
				save_global_event_target_as = expo_artists
			}
		}
		set_timed_global_flag = {
			flag = flag_expo_ongoing
			days = @expo_ongoing_timer
		}
		every_galcom_member = {
			country_event = {
				id = MECR_EXPO.301
			}
		}
		country_event = {
			id = MECR_EXPO.400
			days = @expo_ongoing_timer
		}
	}
}
country_event = { #301.开幕
	id = MECR_EXPO.301
	title = "MECR_EXPO.301.title"
	desc = "MECR_EXPO.301.desc"
	picture = GFX_evt_diplomatic_visit
	is_triggered_only = yes

	immediate = {
		enable_special_project = { name = GLACTIC_EXPO_SCIENCE_ON_EXHI location = capital_scope }
		enable_special_project = { name = GLACTIC_EXPO_CULTURE_ON_EXHI location = capital_scope }
		enable_special_project = { name = GLACTIC_EXPO_INDUSTRY_ON_EXHI location = capital_scope }
		enable_special_project = { name = GLACTIC_EXPO_ARCHAEOLOGY_ON_EXHI location = capital_scope }
		enable_special_project = { name = GLACTIC_EXPO_HISTORY_ON_EXHI location = capital_scope }
		end_event_chain = the_galactic_expo
		begin_event_chain = {
			event_chain = the_galactic_expo_ongoing
			target = root
		}
		clear_variable = expo_ranking_base
		clear_variable = expo_ranking_base_good
		clear_variable = expo_ranking_base_normal
		if = {
			limit = { exists = event_target:expo_sponsor }
			if = {
				limit = { NOT = { has_communications = event_target:expo_sponsor } }
				establish_communications = event_target:expo_sponsor
			}
			country_event = {
				id = MECR_EXPO.370
				days = @expo_sponsor_wait_days
				random = @expo_sponsor_wait_random
			}
		}
		if = {
			limit = { exists = event_target:expo_curators }
			if = {
				limit = { NOT = { has_communications = event_target:expo_curators } }
				establish_communications = event_target:expo_curators
			}
			country_event = {
				id = MECR_EXPO.380
				days = @expo_curators_wait_days
				random = @expo_curators_wait_random
			}
		}
		if = {
			limit = { exists = event_target:expo_artists }
			country_event = {
				id = MECR_EXPO.390
				days = @expo_artists_wait_days
				random = @expo_artists_wait_random
			}
		}
	}

	option = {
		name = "MECR_EXPO.301.option.a"
		add_modifier = { modifier = expo_ongoing_happiness days = @expo_ongoing_timer }
		add_monthly_resource_mult = { resource = unity value = 1 }
		trigger = {
			OR = {
				is_gestalt = no
				has_civic = civic_machine_servitor
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 1.5
				is_xenophile = yes
			}
			modifier = {
				factor = 1.5
				is_pacifist = yes
			}
			modifier = {
				factor = 0.5
				is_xenophobe = yes
			}
			modifier = {
				factor = 0.5
				is_militarist = yes
			}
			modifier = {
				factor = 2
				has_civic = civic_machine_servitor
			}
		}
	}
	option = {
		name = "MECR_EXPO.301.option.a.gestalt"
		add_modifier = { modifier = expo_ongoing_upkeep days = @expo_ongoing_timer }
		add_monthly_resource_mult = { resource = unity value = 1 }
		trigger = {
			is_gestalt = yes
			NOT = {
				has_civic = civic_machine_servitor
			}
		}
		ai_chance = {
			factor = 200
		}
	}
	option = {
		name = "MECR_EXPO.301.option.b"
		add_modifier = { modifier = expo_ongoing_diplomacy days = @expo_ongoing_timer }
		add_monthly_resource_mult = { resource = influence value = 1 }
		ai_chance = {
			factor = 100
			modifier = {
				factor = 1.5
				is_xenophobe = yes
			}
			modifier = {
				factor = 1.5
				is_militarist = yes
			}
			modifier = {
				factor = 0.5
				is_xenophile = yes
			}
			modifier = {
				factor = 0.5
				is_pacifist = yes
			}
		}
	}
	after = {
		tooltip = {
			end_event_chain = the_galactic_expo
			begin_event_chain = {
				event_chain = the_galactic_expo_ongoing
				target = root
			}
		}
	}
}

country_event = { #311.改善科学进步展览
	id = MECR_EXPO.311
	title = "MECR_EXPO.311.title"
	desc = {
		text = "MECR_EXPO.311.desc.a"
		trigger = { has_country_flag = flag_expo_science_grade_good }
	}
	desc = {
		text = "MECR_EXPO.311.desc.b"
		trigger = { has_country_flag = flag_expo_science_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.311.desc.c"
		trigger = { has_country_flag = flag_expo_science_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.311.desc.d"
		trigger = { has_country_flag = flag_expo_science_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_science_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_science_grade_normal
			set_country_flag = flag_expo_science_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_science_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_science_grade_bad
			set_country_flag = flag_expo_science_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_science_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_science_grade_no_parti
			set_country_flag = flag_expo_science_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #312.改善文化艺术展览
	id = MECR_EXPO.312
	title = "MECR_EXPO.312.title"
	desc = {
		text = "MECR_EXPO.312.desc.a"
		trigger = { has_country_flag = flag_expo_culture_grade_good }
	}
	desc = {
		text = "MECR_EXPO.312.desc.b"
		trigger = { has_country_flag = flag_expo_culture_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.312.desc.c"
		trigger = { has_country_flag = flag_expo_culture_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.312.desc.d"
		trigger = { has_country_flag = flag_expo_culture_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_culture_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_culture_grade_normal
			set_country_flag = flag_expo_culture_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_culture_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_culture_grade_bad
			set_country_flag = flag_expo_culture_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_culture_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_culture_grade_no_parti
			set_country_flag = flag_expo_culture_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #313.改善工业技术展览
	id = MECR_EXPO.313
	title = "MECR_EXPO.313.title"
	desc = {
		text = "MECR_EXPO.313.desc.a"
		trigger = { has_country_flag = flag_expo_industry_grade_good }
	}
	desc = {
		text = "MECR_EXPO.313.desc.b"
		trigger = { has_country_flag = flag_expo_industry_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.313.desc.c"
		trigger = { has_country_flag = flag_expo_industry_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.313.desc.d"
		trigger = { has_country_flag = flag_expo_industry_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_industry_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_industry_grade_normal
			set_country_flag = flag_expo_industry_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_industry_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_industry_grade_bad
			set_country_flag = flag_expo_industry_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_industry_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_industry_grade_no_parti
			set_country_flag = flag_expo_industry_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #314.改善考古发现展览
	id = MECR_EXPO.314
	title = "MECR_EXPO.314.title"
	desc = {
		text = "MECR_EXPO.314.desc.a"
		trigger = { has_country_flag = flag_expo_archaeology_grade_good }
	}
	desc = {
		text = "MECR_EXPO.314.desc.b"
		trigger = { has_country_flag = flag_expo_archaeology_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.314.desc.c"
		trigger = { has_country_flag = flag_expo_archaeology_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.314.desc.d"
		trigger = { has_country_flag = flag_expo_archaeology_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_archaeology_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_archaeology_grade_normal
			set_country_flag = flag_expo_archaeology_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_archaeology_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_archaeology_grade_bad
			set_country_flag = flag_expo_archaeology_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_archaeology_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_archaeology_grade_no_parti
			set_country_flag = flag_expo_archaeology_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #315.改善历史传统展览
	id = MECR_EXPO.315
	title = "MECR_EXPO.315.title"
	desc = {
		text = "MECR_EXPO.315.desc.a"
		trigger = { has_country_flag = flag_expo_history_grade_good }
	}
	desc = {
		text = "MECR_EXPO.315.desc.b"
		trigger = { has_country_flag = flag_expo_history_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.315.desc.c"
		trigger = { has_country_flag = flag_expo_history_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.315.desc.d"
		trigger = { has_country_flag = flag_expo_history_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_history_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_history_grade_normal
			set_country_flag = flag_expo_history_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_history_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_history_grade_bad
			set_country_flag = flag_expo_history_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		trigger = { has_country_flag = flag_expo_history_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_history_grade_no_parti
			set_country_flag = flag_expo_history_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}

# 交流事件
#320.交流菜单
#321.科学进步交流（得到彼此的2个月科研产量）
#322.收到科学进步交流申请（得到25影响力）
#323.接受科学进步交流（好感度+40）
#324.拒绝科学进步交流（好感度-40）
#331.文化艺术交流（瓜分双方月凝聚力收入之和，比例随机25%-75%）
#332.收到文化艺术交流申请
#333.接受文化艺术交流
#334.拒绝文化艺术交流
#341.工业技术交流（得到对方拥有而己方没有的一项工业技术的科研选项+10%进度。如果没有满足条件的科技，各自得到一个月工程点）
#342.收到工业技术交流申请
#343.接受工业技术交流
#344.拒绝工业技术交流
#351.考古发现交流（清空彼此的文物行动CD，得到对方拥有而己方没有的考古实验室与奥术解密的科研选项+25%进度）
#352.收到考古发现交流申请
#353.接受考古发现交流
#354.拒绝考古发现交流
#361.历史传统交流（得到对方帝国规模1倍的凝聚力）
#362.收到历史传统交流申请
#363.接受历史传统交流
#364.拒绝历史传统交流


country_event = { #370.贸易城邦赞助商的推销
	id = MECR_EXPO.370
	title = "MECR_EXPO.370.title"
	desc = {
		text = "MECR_EXPO.370.desc.xura"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_1
			}
		}
	}
	desc = {
		text = "MECR_EXPO.370.desc.riggan"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_2
			}
		}
	}
	desc = {
		text = "MECR_EXPO.370.desc.muutagan"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	picture_event_data = {
		portrait = event_target:expo_sponsor
		room = enclave_trader_room
	}

	trigger = {
		NOR = {
			AND = {
				has_country_flag = attacked_xuracorp
				event_target:expo_sponsor = { has_country_flag = trader_enclave_country_1 }
			}
			AND = {
				has_country_flag = attacked_riggans
				event_target:expo_sponsor = { has_country_flag = trader_enclave_country_2 }
			}
			AND = {
				has_country_flag = attacked_muutagans
				event_target:expo_sponsor = { has_country_flag = trader_enclave_country_3 }
			}
		}
	}

	option = { # +1000
		name = "MECR_EXPO.370.buy_1000"
		custom_gui = "enclave_trader_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 13000 } }
		event_target:expo_sponsor = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							energy = -13000
							exotic_gases = 1000
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							energy = -13000
							volatile_motes = 1000
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							energy = -13000
							rare_crystals = 1000
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 20
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.371
			}
			event_target:expo_organiser = {
				add_resource = { energy = 1000 }
				create_message = {
					type = MESSAGE_TYPE_EXPO_SPONSOR_BONUS
					localization = "MESSAGE_TYPE_EXPO_SPONSOR_BONUS_DESC_1000"
					days = 30
					target = capital_scope
				}
			}
		}
	}
	option = { # +500
		name = "MECR_EXPO.370.buy_500"
		custom_gui = "enclave_trader_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 6750 } }
		event_target:expo_sponsor = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							energy = -6750
							exotic_gases = 500
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							energy = -6750
							volatile_motes = 500
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							energy = -6750
							rare_crystals = 500
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.371
			}
			event_target:expo_organiser = {
				add_resource = { energy = 500 }
				create_message = {
					type = MESSAGE_TYPE_EXPO_SPONSOR_BONUS
					localization = "MESSAGE_TYPE_EXPO_SPONSOR_BONUS_DESC_500"
					days = 30
					target = capital_scope
				}
			}
		}
	}
	option = { # +200
		name = "MECR_EXPO.370.buy_200"
		custom_gui = "enclave_trader_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2800 } }
		event_target:expo_sponsor = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							energy = -2800
							exotic_gases = 200
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							energy = -2800
							volatile_motes = 200
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							energy = -2800
							rare_crystals = 200
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 5
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.371
			}
			event_target:expo_organiser = {
				add_resource = { energy = 200 }
				create_message = {
					type = MESSAGE_TYPE_EXPO_SPONSOR_BONUS
					localization = "MESSAGE_TYPE_EXPO_SPONSOR_BONUS_DESC_200"
					days = 30
					target = capital_scope
				}
			}
		}
	}
	option = { # 拒绝
		name = "NODEAL"
		custom_gui = "enclave_trader_option"
	}
	option = {
		name = leviathans.105.d
		default_hide_option = yes
		custom_gui = "enclave_trader_option"
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #371.贸易城邦赞助商回应
	id = MECR_EXPO.371
	title = "MECR_EXPO.370.title"
	desc = {
		text = "leviathans.130.a.reply"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_1
			}
		}
	}
	desc = {
		text = "leviathans.131.a.reply"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_2
			}
		}
	}
	desc = {
		text = "leviathans.132.a.reply"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	picture_event_data = {
		portrait = event_target:expo_sponsor
		room = enclave_trader_room
	}
	
	option = {
		name = "GOOD"
		custom_gui = "enclave_trader_option"
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #380.策展人的帮助
	id = MECR_EXPO.380
	title = "MECR_EXPO.380.title"
	desc = "MECR_EXPO.380.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_curator_window"
	picture_event_data = {
		portrait = event_target:expo_curators
		room = enclave_curator_room
	}

	trigger = {
		NOT = {
			has_country_flag = attacked_curators
		}
	}

	option = { # 物理
		name = "MECR_EXPO.380.physics"
		custom_gui = "enclave_curator_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_random_research_option = {
			add_progress = 25
			area = physics
			fail_effects = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = 1
				}
			}
		}
		add_resource = {
			energy = -2000
		}
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.381
			}
		}
	}
	option = { # 社会
		name = "MECR_EXPO.380.society"
		custom_gui = "enclave_curator_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_random_research_option = {
			add_progress = 25
			area = society
			fail_effects = {
				add_monthly_resource_mult = {
					resource = society_research
					value = 1
				}
			}
		}
		add_resource = {
			energy = -2000
		}
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.381
			}
		}
	}
	option = { # 工程
		name = "MECR_EXPO.380.engineering"
		custom_gui = "enclave_curator_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_random_research_option = {
			add_progress = 25
			area = engineering
			fail_effects = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = 1
				}
			}
		}
		add_resource = {
			energy = -2000
		}
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.381
			}
		}
	}
	option = { # 拒绝
		name = "MECR_EXPO.380.no"
		custom_gui = "enclave_curator_option"
	}
	option = {
		name = leviathans.500.e
		default_hide_option = yes
		custom_gui = "enclave_curator_option"
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #381.策展人回应
	id = MECR_EXPO.381
	title = "MECR_EXPO.380.title"
	desc = "MECR_EXPO.381.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_curator_window"
	picture_event_data = {
		portrait = event_target:expo_curators
		room = enclave_curator_room
	}

	trigger = {
		NOT = {
			has_country_flag = attacked_curators
		}
	}

	option = {
		name = "GOOD"
		custom_gui = "enclave_curator_option"
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #390.出现艺术团的判断
	id = MECR_EXPO.390
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			10 = {
				if = {
					limit = {
						exists = event_target:expo_artists
						NOT = { has_country_flag = enclave_artist_ignores }
					}
					if = {
						limit = { NOT = { has_communications = event_target:expo_artists } }
						establish_communications = event_target:expo_artists
					}
					country_event = {
						id = MECR_EXPO.391
					}
				}
			}
			10 = {
				country_event = {
					id = MECR_EXPO.390
					days = @expo_artists_wait_days
					random = @expo_artists_wait_random
				}
			}
		}
	}
}
country_event = { #391.艺术团的不请自来
	id = MECR_EXPO.391
	title = "MECR_EXPO.391.title"
	desc = "MECR_EXPO.391.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"
	picture_event_data = {
		portrait = event_target:expo_artists
		room = enclave_artist_room
	}

	trigger = {
	}

	option = { #凝聚力
		name = "MECR_EXPO.391.a"
		allow = { resource_stockpile_compare = { resource = influence value >= 50 } }
		add_resource = {
			influence = -50
		}
		add_monthly_resource_mult = {
			resource = unity
			value = 4
		}
		hidden_effect = {
			set_country_flag = flag_me391a
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = { #纪念碑
		name = "MECR_EXPO.391.b"
		allow = { resource_stockpile_compare = { resource = influence value >= 50 } }
		add_resource = {
			influence = -50
		}
		custom_tooltip = "MECR_EXPO.391.b.tooltip"
		hidden_effect = { subtract_variable = { which = artist_monument_erected value = 1 } }
		hidden_effect = {
			set_country_flag = flag_me391b
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = { #文物
		name = "MECR_EXPO.391.c"
		allow = { resource_stockpile_compare = { resource = influence value >= 50 } }
		add_resource = {
			influence = -50
		}
		add_resource = {
			minor_artifacts = 3
		}
		hidden_effect = {
			set_country_flag = flag_me391c
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = { #拒绝
		name = "MECR_EXPO.391.no"
		custom_tooltip = "MECR_EXPO.391.no.tooltip"
	}
	option = { #全都要
		name = "MECR_EXPO.391.all"
		allow = { resource_stockpile_compare = { resource = energy value >= 20000 } }
		add_resource = {
			energy = -20000
		}
		add_monthly_resource_mult = {
			resource = unity
			value = 4
		}
		custom_tooltip = "MECR_EXPO.391.b.tooltip"
		hidden_effect = { subtract_variable = { which = artist_monument_erected value = 1 } }
		add_resource = {
			minor_artifacts = 3
		}
		hidden_effect = {
			set_country_flag = flag_me391all
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = {
		name = GOODBYE
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}
country_event = { #392.艺术团回应
	id = MECR_EXPO.392
	title = "MECR_EXPO.391.title"
	desc = {
		text = "MECR_EXPO.392.desc.a"
		trigger = {
			OR = {
				has_country_flag = flag_me391a
				has_country_flag = flag_me391b
				has_country_flag = flag_me391c
			}
		}
	}
	desc = {
		text = "MECR_EXPO.392.desc.b"
		trigger = {
			has_country_flag = flag_me391all
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"
	picture_event_data = {
		portrait = event_target:expo_artists
		room = enclave_artist_room
	}

	trigger = {
	}

	option = { #三选一
		name = "MECR_EXPO.392.a"
		trigger = {
			OR = {
				has_country_flag = flag_me391a
				has_country_flag = flag_me391b
				has_country_flag = flag_me391c
			}
		}
		event_target:expo_artists = {
			add_trust = {
				who = root
				amount = -10
			}
		}
		hidden_effect = {
			remove_country_flag = flag_me391a
			remove_country_flag = flag_me391b
			remove_country_flag = flag_me391c
		}
	}
	option = { #全都要
		name = "MECR_EXPO.392.b"
		trigger = {
			has_country_flag = flag_me391all
		}
		event_target:expo_artists = {
			add_trust = {
				who = root
				amount = 30
			}
		}
		hidden_effect = {
			remove_country_flag = flag_me391all
		}
	}
	option = {
		name = GOODBYE
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_country_flag = flag_expo_ongoing
		}
	}
}

# 闭幕阶段
country_event = { #400.【目录】闭幕
	id = MECR_EXPO.400
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = debug_expo_ending_event
		}
	}

	immediate = {
		remove_global_flag = debug_expo_openning_event
		set_global_flag = debug_expo_ending_event
		every_galcom_member = {
			set_country_flag = expo_ending_ongoing
			country_event = {
				id = MECR_EXPO.401
			}
		}
		event_target:global_event_country = {
			country_event = {
				id = MECR_EXPO.421
				days = 1
			}
		}
		########################## 奖励列表 （buff类的持续时间为十年）
		########## 科研
		#后1/3：科研选项+1
		#中1/3：科研选项+1 领袖经验获得+25%
		#前1/3：科研选项+1 领袖经验获得+25% 研究员维护费-10%
		#季军+：4个月科研
		#亚军+：6个月科研
		#冠军+：6个月科研 一艘卓越的科研船
		########## 文化
		#后1/3：法令维护费-10%
		#中1/3：法令维护费-10% 来自人口的帝国规模-5%
		#前1/3：法令维护费-10% 来自人口的帝国规模-5% 每40人口+1文化工作者(评估者/突触工蜂)岗位
		#季军+：2个额外的纪念碑
		#亚军+：3个额外的纪念碑
		#冠军+：3个额外的纪念碑 1个免费的圣遗物（保证不空）
		########## 工业
		#后1/3：行星建设费用-10%
		#中1/3：行星建设费用-10% 技工与矿工产出+10%
		#前1/3：行星建设费用-10% 技工与矿工产出+10% 冶金师与工匠产出+5%
		#季军+：工业材料学研究速度+15%
		#亚军+：工业材料学研究速度+15% 巨构建造速度+25%
		#冠军+：工业材料学研究速度+15% 巨构建造速度+25% 一次行星工业整合计划决议
		########## 考古
		#后1/3：考古速度+35%
		#中1/3：考古速度+35% 文物行动花费-20%
		#前1/3：考古速度+35% 文物行动花费-20% 治国术研究速度+15%
		#季军+：小份文物奖励
		#亚军+：中份文物奖励
		#冠军+：2*中份文物奖励
		########## 传统
		#后1/3：凝聚力产出+5%
		#中1/3：凝聚力产出+5% 主流思潮吸引力+35%
		#前1/3：凝聚力产出+5% 主流思潮吸引力+35% 行星稳定度+5
		#季军+：4个月凝聚力
		#亚军+：6个月凝聚力
		#冠军+：6个月凝聚力 一次免费的政府改革
		########## 总展览
		#后1/3：外交维护费-25%
		#中1/3：外交维护费-25% 信赖增长+0.25
		#前1/3：外交维护费-25% 信赖增长+0.25 外交权重+25%
		#季军+：所有共同体成员好感度+40（不可叠加）
		#亚军+：所有共同体成员好感度+70（不可叠加）
		#冠军+：所有共同体成员好感度+100（不可叠加）
	}
}
country_event = { #401.颁奖典礼
	id = MECR_EXPO.401
	title = "MECR_EXPO.401.title"
	desc = "MECR_EXPO.401.desc"
	picture = GFX_evt_galactic_community
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_SCIENCE_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_CULTURE_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_INDUSTRY_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_ARCHAEOLOGY_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_HISTORY_ON_EXHI }
		set_country_flag = flag_wait_for_expo_bidding
	}
	option = {
		name = "MECR_EXPO.401.option"
		custom_tooltip = "MECR_EXPO.401.option.tooltip"
		hidden_effect = {
			if = {
				limit = { check_variable = { which = expo_science_result value > 0 } }
				country_event = { id = MECR_EXPO.402 }
			}
			else_if = {
				limit = { check_variable = { which = expo_culture_result value > 0 } }
				country_event = { id = MECR_EXPO.403 }
			}
			else_if = {
				limit = { check_variable = { which = expo_industry_result value > 0 } }
				country_event = { id = MECR_EXPO.404 }
			}
			else_if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #402.颁奖：科学进步
	id = MECR_EXPO.402
	title = "MECR_EXPO.402.title"
	desc = "MECR_EXPO.402.desc"
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes

	option = {
		name = "EXCELLENT"
		custom_tooltip = "MECR_EXPO.402.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_science_grade_good = {
				add_modifier = { modifier = expo_science_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_science_grade_good }
			}
			flag_expo_science_grade_normal = {
				add_modifier = { modifier = expo_science_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_science_grade_normal }
			}
			flag_expo_science_grade_bad = {
				add_modifier = { modifier = expo_science_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_science_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_science_ranking_1st = {
				add_monthly_resource_mult = { resource = physics_research value = 6 }
				add_monthly_resource_mult = { resource = society_research value = 6 }
				add_monthly_resource_mult = { resource = engineering_research value = 6 }
				custom_tooltip = "expo_science_rank_1_award"
				hidden_effect = {
					create_fleet = {
						name = "NAME_expo_frontier"
						effect = {
							set_owner = root
							create_ship = {
								name = "NAME_expo_frontier"
								design = "NAME_expo_frontier"
								graphical_culture = "fallen_machine_empire_01"
								prefix = yes
								upgradable = no
							}
							set_location = root.capital_scope
						}
					}
				}
				hidden_effect = { remove_country_flag = flag_expo_science_ranking_1st clear_global_event_target = expo_science_ranking_1st }
			}
			flag_expo_science_ranking_2nd = {
				add_monthly_resource_mult = { resource = physics_research value = 6 }
				add_monthly_resource_mult = { resource = society_research value = 6 }
				add_monthly_resource_mult = { resource = engineering_research value = 6 }
				hidden_effect = { remove_country_flag = flag_expo_science_ranking_2nd clear_global_event_target = expo_science_ranking_2nd }
			}
			flag_expo_science_ranking_3rd = {
				add_monthly_resource_mult = { resource = physics_research value = 4 }
				add_monthly_resource_mult = { resource = society_research value = 4 }
				add_monthly_resource_mult = { resource = engineering_research value = 4 }
				hidden_effect = { remove_country_flag = flag_expo_science_ranking_3rd clear_global_event_target = expo_science_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_science_result
			clear_variable = expo_science_ranking
		}
		hidden_effect = {
			if = {
				limit = { check_variable = { which = expo_culture_result value > 0 } }
				country_event = { id = MECR_EXPO.403 }
			}
			else_if = {
				limit = { check_variable = { which = expo_industry_result value > 0 } }
				country_event = { id = MECR_EXPO.404 }
			}
			else_if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #403.颁奖：文化艺术
	id = MECR_EXPO.403
	title = "MECR_EXPO.403.title"
	desc = "MECR_EXPO.403.desc"
	picture = GFX_evt_baol_datacrystals
	is_triggered_only = yes

	option = {
		name = "FASCINATING"
		custom_tooltip = "MECR_EXPO.403.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_culture_grade_good = {
				if = {
					limit = { is_gestalt = no }
					add_modifier = { modifier = expo_culture_award_good years = 15 }
				}
				else_if = {
					limit = { is_machine_empire = yes }
					add_modifier = { modifier = expo_culture_award_good_machine years = 15 }
				}
				else_if = {
					limit = { is_hive_empire = yes }
					add_modifier = { modifier = expo_culture_award_good_hive years = 15 }
				}
				hidden_effect = { remove_country_flag = flag_expo_culture_grade_good }
			}
			flag_expo_culture_grade_normal = {
				add_modifier = { modifier = expo_culture_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_culture_grade_normal }
			}
			flag_expo_culture_grade_bad = {
				add_modifier = { modifier = expo_culture_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_culture_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_culture_ranking_1st = {
				if = {
					limit = { exists = event_target:caravaneer_home_system }
					custom_tooltip = "expo_culture_rank_1_award"
					hidden_effect = {
						subtract_variable = { which = artist_monument_erected value = 3 }
						country_event = { id = MECR_EXPO.1001 days = 1 }
					}
				}
				else = {
					custom_tooltip = "expo_culture_rank_1_award_no_cara"
					hidden_effect = { subtract_variable = { which = artist_monument_erected value = 4 } }
				}
				hidden_effect = { remove_country_flag = flag_expo_culture_ranking_1st clear_global_event_target = expo_culture_ranking_1st }
			}
			flag_expo_culture_ranking_2nd = {
				custom_tooltip = "expo_culture_rank_2_award"
				hidden_effect = { subtract_variable = { which = artist_monument_erected value = 3 } }
				hidden_effect = { remove_country_flag = flag_expo_culture_ranking_2nd clear_global_event_target = expo_culture_ranking_2nd }
			}
			flag_expo_culture_ranking_3rd = {
				custom_tooltip = "expo_culture_rank_3_award"
				hidden_effect = { subtract_variable = { which = artist_monument_erected value = 2 } }
				hidden_effect = { remove_country_flag = flag_expo_culture_ranking_3rd clear_global_event_target = expo_culture_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_culture_result
			clear_variable = expo_culture_ranking
		}
		hidden_effect = {
			if = {
				limit = { check_variable = { which = expo_industry_result value > 0 } }
				country_event = { id = MECR_EXPO.404 }
			}
			else_if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #404.颁奖：工业技术
	id = MECR_EXPO.404
	title = "MECR_EXPO.404.title"
	desc = "MECR_EXPO.404.desc"
	picture = GFX_evt_megastructure_construction
	is_triggered_only = yes

	option = {
		name = "MARVELOUS"
		custom_tooltip = "MECR_EXPO.404.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_industry_grade_good = {
				add_modifier = { modifier = expo_industry_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_grade_good }
			}
			flag_expo_industry_grade_normal = {
				add_modifier = { modifier = expo_industry_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_grade_normal }
			}
			flag_expo_industry_grade_bad = {
				add_modifier = { modifier = expo_industry_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_industry_ranking_1st = {
				custom_tooltip = "expo_industry_rank_1_award"
				hidden_effect = { change_variable = { which = EXPO_award_industry_1st value = 1 } }
				add_modifier = { modifier = expo_industry_award_2nd years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_ranking_1st clear_global_event_target = expo_industry_ranking_1st }
			}
			flag_expo_industry_ranking_2nd = {
				add_modifier = { modifier = expo_industry_award_2nd years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_ranking_2nd clear_global_event_target = expo_industry_ranking_2nd }
			}
			flag_expo_industry_ranking_3rd = {
				add_modifier = { modifier = expo_industry_award_3rd years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_ranking_3rd clear_global_event_target = expo_industry_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_industry_result
			clear_variable = expo_industry_ranking
		}
		hidden_effect = {
			if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #405.颁奖：考古发现
	id = MECR_EXPO.405
	title = "MECR_EXPO.405.title"
	desc = "MECR_EXPO.405.desc"
	picture = GFX_evt_overgrown_city
	is_triggered_only = yes

	option = {
		name = "AMAZING"
		custom_tooltip = "MECR_EXPO.405.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_archaology_grade_good = {
				add_modifier = { modifier = expo_archaology_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_archaology_grade_good }
			}
			flag_expo_archaology_grade_normal = {
				add_modifier = { modifier = expo_archaology_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_archaology_grade_normal }
			}
			flag_expo_archaology_grade_bad = {
				add_modifier = { modifier = expo_archaology_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_archaology_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_archaology_ranking_1st = {
				small_artifact_award = yes
				hidden_effect = { remove_country_flag = flag_expo_archaology_ranking_1st clear_global_event_target = expo_archaology_ranking_1st }
			}
			flag_expo_archaology_ranking_2nd = {
				medium_artifact_award = yes
				hidden_effect = { remove_country_flag = flag_expo_archaology_ranking_2nd clear_global_event_target = expo_archaology_ranking_2nd }
			}
			flag_expo_archaology_ranking_3rd = {
				medium_artifact_award = yes
				medium_artifact_award = yes
				hidden_effect = { remove_country_flag = flag_expo_archaology_ranking_3rd clear_global_event_target = expo_archaology_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_archaology_result
			clear_variable = expo_archaology_ranking
		}
		hidden_effect = {
			if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #406.颁奖：历史传统
	id = MECR_EXPO.406
	title = "MECR_EXPO.406.title"
	desc = "MECR_EXPO.406.desc"
	picture = GFX_evt_medieval_alien_civilization
	is_triggered_only = yes

	option = {
		name = "REMARKABLE"
		custom_tooltip = "MECR_EXPO.405.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_history_grade_good = {
				add_modifier = { modifier = expo_history_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_history_grade_good }
			}
			flag_expo_history_grade_normal = {
				add_modifier = { modifier = expo_history_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_history_grade_normal }
			}
			flag_expo_history_grade_bad = {
				add_modifier = { modifier = expo_history_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_history_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_history_ranking_1st = {
				custom_tooltip = "expo_history_rank_1_award"
				hidden_effect = { change_variable = { which = EXPO_award_history_1st value = 1 } }
				add_monthly_resource_mult = { resource = unity value = 6 }
				hidden_effect = { remove_country_flag = flag_expo_history_ranking_1st clear_global_event_target = expo_history_ranking_1st }
			}
			flag_expo_history_ranking_2nd = {
				add_monthly_resource_mult = { resource = unity value = 6 }
				hidden_effect = { remove_country_flag = flag_expo_history_ranking_2nd clear_global_event_target = expo_history_ranking_2nd }
			}
			flag_expo_history_ranking_3rd = {
				add_monthly_resource_mult = { resource = unity value = 4 }
				hidden_effect = { remove_country_flag = flag_expo_history_ranking_3rd clear_global_event_target = expo_history_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_history_result
			clear_variable = expo_history_ranking
		}
		hidden_effect = {
			country_event = { id = MECR_EXPO.407 }
		}
	}
}
country_event = { #407.颁奖：总奖
	id = MECR_EXPO.407
	title = "MECR_EXPO.407.title"
	desc = "MECR_EXPO.407.desc"
	picture = GFX_evt_arena
	is_triggered_only = yes

	option = {
		name = "MECR_EXPO.407.option"
		custom_tooltip = "expo_award_total"
		switch = {
			trigger = has_country_flag
			flag_expo_total_grade_good = {
				add_modifier = { modifier = expo_total_award_good years = 15 }
			}
			flag_expo_total_grade_normal = {
				add_modifier = { modifier = expo_total_award_normal years = 15 }
			}
			flag_expo_total_grade_bad = {
				add_modifier = { modifier = expo_total_award_bad years = 15 }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_total_ranking_1st = {
				add_resource = { influence = 300 }
				custom_tooltip = "expo_total_rank_1_award"
				hidden_effect = {
					every_galcom_member = {
						limit = { NOT = { is_same_value = root } }
						remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_1 }
						remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_2 }
						remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_3 }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award_1 }
					}
					set_timed_country_flag = { flag = EXPO_award_opinion_modifier_100_40 years = 20 }
				}
			}
			flag_expo_total_ranking_2nd = {
				add_resource = { influence = 200 }
				custom_tooltip = "expo_total_rank_2_award"
				hidden_effect = {
					every_galcom_member = {
						limit = { NOT = { is_same_value = root } }
						remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_1 }
						remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_2 }
						remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_3 }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award_2 }
					}
					remove_country_flag = EXPO_award_opinion_modifier_100_40
				}
			}
			flag_expo_total_ranking_3rd = {
				add_resource = { influence = 100 }
				custom_tooltip = "expo_total_rank_3_award"
				hidden_effect = {
					if = {
						limit = { NOT = { has_country_flag = EXPO_award_opinion_modifier_100_40 } }
						every_galcom_member = {
							limit = { NOT = { is_same_value = root } }
							remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_1 }
							remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_2 }
							remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_3 }
							add_opinion_modifier = { who = root modifier = opinion_expo_total_award_3 }
						}
					}
					else = {
						every_galcom_member = {
							limit = {
								NOT = { is_same_value = root }
								NOT = { has_opinion_modifier = { who = root modifier = opinion_expo_total_award_1 } }
							}
							remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_2 }
							remove_opinion_modifier = { who = root modifier = opinion_expo_total_award_3 }
							add_opinion_modifier = { who = root modifier = opinion_expo_total_award_3 }
						}
					}
				}
			}
		}
		hidden_effect = {
			clear_variable = expo_total_result
			clear_variable = expo_total_ranking
		}
		hidden_effect = {
			if = {
				limit = { is_active_resolution = resolution_the_galactic_expo }
				country_event = { id = MECR_EXPO.410 }
			}
			else = {
				country_event = { id = MECR_EXPO.420 }
			}
		}
	}
}

country_event = { #410.下次银博会东道主投标
	id = MECR_EXPO.410
	title = "MECR_EXPO.410.title"
	desc = {
		text = "MECR_EXPO.410.desc.organiser"
		trigger = { is_same_value = event_target:expo_organiser }
	}
	desc = {
		text = "MECR_EXPO.410.desc"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
	}
	picture = GFX_evt_galactic_senate
	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = "MECR_EXPO.410.option.a"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 300 } }
		custom_tooltip = "MECR_EXPO.410.option.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
		ai_chance = {
			factor = 40
			modifier = {
				factor = 0.2
				NOR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0
				NOT = { has_country_flag = expo_total_award_good }
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value < 600 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value > 900 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.help"
		trigger = {
			is_ai = no
			NOT = { is_same_value = event_target:expo_organiser }
		}
		allow = { resource_stockpile_compare = { resource = influence value >= 300 } }
		custom_tooltip = "MECR_EXPO.410.option.help.tooltip"
		hidden_effect = {
			country_event = { id = MECR_EXPO.411 }
		}
	}
	option = {
		name = "MECR_EXPO.410.option.b"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 200 } }
		custom_tooltip = "MECR_EXPO.410.option.tooltip"
		add_resource = { influence = -200 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 2 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0.2
				OR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0
				NOT = { has_country_flag = expo_total_award_good }
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value < 400 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value > 900 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.c"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 100 } }
		custom_tooltip = "MECR_EXPO.410.option.tooltip"
		add_resource = { influence = -100 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 3 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				OR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0
				NOT = { has_country_flag = expo_total_award_good }
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value < 200 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value > 900 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.d"
		hidden_effect = {
			clear_variable = expo_bid_ranking
			clear_variable = expo_bid_result
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
			else = {
				country_event = { id = MECR_EXPO.412 days = 2 }
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				OR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0.3
				has_country_flag = expo_total_award_good
			}
			modifier = {
				factor = 2
				has_country_flag = expo_total_award_normal
			}
			modifier = {
				factor = 5
				has_country_flag = expo_total_award_bad
			}
			modifier = {
				factor = 100
				has_country_flag = expo_total_award_no_parti
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value > 500 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value < 300 }
			}
		}
	}
}
country_event = { #411.下次银博会东道主投标-寻求外交援助
	id = MECR_EXPO.411
	title = "MECR_EXPO.410.title"
	desc = "MECR_EXPO.410.desc"
	picture = GFX_evt_galactic_senate
	is_triggered_only = yes
	
	immediate = {
		set_variable = { which = var_count_favor value = 0 }
		while = {
			limit = {
				any_country = {
					NOT = { has_country_flag = flag_expo_favor_counted_@root }
					root = {
						num_favors = {
							target = prev
							value > 0
						}
					}
				}
			}
			random_country = {
				limit = {
					NOT = { has_country_flag = flag_expo_favor_counted_@root }
					root = {
						num_favors = {
							target = prev
							value > 0
						}
					}
				}
				set_country_flag = flag_expo_favor_counted_@root
				root = {
					export_trigger_value_to_variable = {
						trigger = num_favors
						parameters = {
							target = prev
						}
						variable = var_add_favor
					}
					change_variable = {
						which = var_count_favor
						value = var_add_favor
					}
				}
			}
		}
		every_country = {
			limit = { has_country_flag = flag_expo_favor_counted_@root }
			remove_country_flag = flag_expo_favor_counted_@root
		}
		clear_variable = var_add_favor
	}

	option = {
		name = "MECR_EXPO.411.option.a"
		allow = {
			resource_stockpile_compare = { resource = influence value >= 300 }
			custom_tooltip = {
				fail_text = "favors_not_enough"
				check_variable = { which = var_count_favor value >= 10 }
			}
		}
		custom_tooltip = "MECR_EXPO.411.option.a.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			while = {
				count = 10
				random_country = {
					limit = {
						root = {
							num_favors = {
								target = prev
								value > 0
							}
						}
					}
					root = {
						set_variable = {
							which = Rexpo_bid_champion_bonus_got
							value = prev.trigger:diplomacy_weight
						}
						multiply_variable = { which = Rexpo_bid_champion_bonus_got value = 0.2 }
						change_variable = {
							which = Rexpo_bid_champion_bonus
							value = Rexpo_bid_champion_bonus_got
						}
						add_favors = {
							target = prev
							value = -1
						}
					}
				}
			}
			clear_variable = Rexpo_bid_champion_bonus_got
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.b"
		allow = {
			resource_stockpile_compare = { resource = influence value >= 300 }
			custom_tooltip = {
				fail_text = "favors_not_enough"
				check_variable = { which = var_count_favor value >= 6 }
			}
		}
		custom_tooltip = "MECR_EXPO.411.option.b.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			while = {
				count = 6
				random_country = {
					limit = {
						root = {
							num_favors = {
								target = prev
								value > 0
							}
						}
					}
					root = {
						set_variable = {
							which = Rexpo_bid_champion_bonus_got
							value = prev.trigger:diplomacy_weight
						}
						multiply_variable = { which = Rexpo_bid_champion_bonus_got value = 0.2 }
						change_variable = {
							which = Rexpo_bid_champion_bonus
							value = Rexpo_bid_champion_bonus_got
						}
						add_favors = {
							target = prev
							value = -1
						}
					}
				}
			}
			clear_variable = Rexpo_bid_champion_bonus_got
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.c"
		allow = {
			resource_stockpile_compare = { resource = influence value >= 300 }
			custom_tooltip = {
				fail_text = "favors_not_enough"
				check_variable = { which = var_count_favor value >= 3 }
			}
		}
		custom_tooltip = "MECR_EXPO.411.option.c.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			while = {
				count = 3
				random_country = {
					limit = {
						root = {
							num_favors = {
								target = prev
								value > 0
							}
						}
					}
					root = {
						set_variable = {
							which = Rexpo_bid_champion_bonus_got
							value = prev.trigger:diplomacy_weight
						}
						multiply_variable = { which = Rexpo_bid_champion_bonus_got value = 0.2 }
						change_variable = {
							which = Rexpo_bid_champion_bonus
							value = Rexpo_bid_champion_bonus_got
						}
						add_favors = {
							target = prev
							value = -1
						}
					}
				}
			}
			clear_variable = Rexpo_bid_champion_bonus_got
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.d"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 300 } }
		custom_tooltip = "MECR_EXPO.411.option.d.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.return"
		custom_tooltip = "MECR_EXPO.411.option.return.tooltip"
		hidden_effect = {
			country_event = { id = MECR_EXPO.410 }
		}
	}
}
country_event = { #412.【目录】决定东道主中标
	id = MECR_EXPO.412
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = flag_expo_bidding_complete
		}
		NOT = {
			any_country = {
				has_country_flag = flag_wait_for_expo_bidding
			}
		}
	}

	immediate = {
		set_timed_global_flag = {
			flag = flag_expo_bidding_complete
			days = 360
		}
		find_expo_champion_diplo_weight = {
			category = bid
		}
		every_country = {
			limit = { check_variable = { which = expo_bid_result value = 1 } }
			if = {
				limit = { check_variable = { which = expo_bid_ranking value = 3 } }
				add_resource = { influence = 50 }
			}
			else_if = {
				limit = { check_variable = { which = expo_bid_ranking value = 2 } }
				add_resource = { influence = 100 }
			}
			else_if = {
				limit = { NOT = { is_same_value = event_target:expo_bid_ranking_1st } }
				add_resource = { influence = 150 }
			}
		}
		event_target:expo_bid_ranking_1st = {
			remove_country_flag = flag_expo_bid_ranking_1st
		}
		event_target:expo_bid_ranking_2nd = {
			remove_country_flag = flag_expo_bid_ranking_2nd
		}
		event_target:expo_bid_ranking_3rd = {
			remove_country_flag = flag_expo_bid_ranking_3rd
		}
		# 移除总排行标记
		every_country = {
			limit = { has_country_flag = flag_expo_total_grade_good }
			remove_country_flag = flag_expo_total_grade_good
		}
		every_country = {
			limit = { has_country_flag = flag_expo_total_grade_normal }
			remove_country_flag = flag_expo_total_grade_normal
		}
		every_country = {
			limit = { has_country_flag = flag_expo_total_grade_normal }
			remove_country_flag = flag_expo_total_grade_normal
		}
		event_target:expo_total_ranking_1st = {
			remove_country_flag = flag_expo_total_ranking_1st
			clear_global_event_target = expo_total_ranking_1st
		}
		event_target:expo_total_ranking_2nd = {
			remove_country_flag = flag_expo_total_ranking_2nd
			clear_global_event_target = expo_total_ranking_2nd
		}
		event_target:expo_total_ranking_3rd = {
			remove_country_flag = flag_expo_total_ranking_3rd
			clear_global_event_target = expo_total_ranking_3rd
		}

		every_country = {
			limit = { has_country_flag = expo_ending_ongoing }
			country_event = {
				id = MECR_EXPO.420
			}
		}
	}
}
country_event = { #420.闭幕式
	id = MECR_EXPO.420
	title = "MECR_EXPO.420.title"
	desc = {
		text = "MECR_EXPO.420.desc.winner"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			is_same_value = event_target:expo_bid_ranking_1st
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			exists = event_target:expo_bid_ranking_1st
			NOT = { is_same_value = event_target:expo_bid_ranking_1st }
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc.no_winner"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			NOT = { exists = event_target:expo_bid_ranking_1st } 
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc.no_more_expo"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			NOT = { has_country_flag = flag_expo_hater }
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc.no_more_expo_hater"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			has_country_flag = flag_expo_hater
		}
	}
	picture = GFX_evt_crisis_defeated
	is_triggered_only = yes
	
	immediate = {
		remove_country_flag = expo_ending_ongoing
		end_event_chain = the_galactic_expo_ongoing
		remove_modifier = expo_ongoing_happiness
		remove_modifier = expo_ongoing_upkeep
		remove_modifier = expo_ongoing_diplomacy
		every_owned_planet = {
			limit = { has_deposit = d_expo_exhibition_center }
			remove_deposit = d_expo_exhibition_center
			add_deposit = d_expo_former_exhibition_center
		}
		if = {
			limit = { NOT = { is_active_resolution = resolution_the_galactic_expo } }
			clear_variable = expo_bid_result
			clear_variable = expo_bid_ranking
		}
	}

	option = {
		name = "MECR_EXPO.420.option"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			NOT = { has_ethic = ethic_fanatic_xenophobe }
		}
		add_resource = {
			unity = 1000
			influence = 100
		}
	}
	option = {
		name = "MECR_EXPO.420.option.fanatic_xenophobe"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			has_ethic = ethic_fanatic_xenophobe
		}
	}
	option = {
		name = "MECR_EXPO.420.option.no_more_expo"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			NOT = { has_ethic = ethic_fanatic_xenophobe }
		}
	}
	option = {
		name = "MECR_EXPO.420.option.no_more_expo.fanatic_xenophobe"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			has_ethic = ethic_fanatic_xenophobe
		}
	}
	after = {
		tooltip = {
			end_event_chain = the_galactic_expo_ongoing
		}
		hidden_effect = {
			if = {
				limit = { is_same_value = event_target:expo_organiser }
				clear_global_event_target = expo_organiser
				clear_global_event_target = expo_exhibition_center
			}
		}
	}
}
country_event = { #421.【目录】闭幕式后处理任务
	id = MECR_EXPO.421
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_country = {
					has_country_flag = expo_ending_ongoing
				}
			}
			country_event = {
				id = MECR_EXPO.421
				days = 1
			}
		}
		else = {
			remove_global_flag = debug_expo_ending_event
			set_global_flag = flag_first_expo_complete
			clear_global_event_target = expo_sponsor
			clear_global_event_target = expo_sponsor_home_system
			clear_global_event_target = expo_curators
			clear_global_event_target = expo_artists
			if = {
				limit = { is_active_resolution = resolution_the_galactic_expo }
				country_event = {
					id = MECR_EXPO.450
					days = 3600
				}
			}
			else_if = {
				limit = { NOT = { is_active_resolution = resolution_the_galactic_expo } }
				clear_global_event_target = expo_bid_ranking_1st
				clear_global_event_target = expo_bid_ranking_2nd
				clear_global_event_target = expo_bid_ranking_3rd
			}
		}
	}
}

# 下一届银河博览会开始前的准备
country_event = { #450.【目录】判定能否开始
	id = MECR_EXPO.450
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_active_resolution = resolution_the_galactic_expo
		NOT = { has_global_flag = expo_starting_checking } #这是用来修复.450重复触发的bug的
	}

	immediate = {
		set_global_flag = expo_starting_checking #这是用来修复.450重复触发的bug的
		if = {
			limit = { galaxy_is_peace = yes }
			country_event = {
				id = MECR_EXPO.460
			}
		}
		else = {
			set_global_flag = flag_expo_war_delay
			every_galcom_member = {
				country_event = {
					id = MECR_EXPO.451
				}
			}
		}
	}

}
country_event = { #451.银河动荡，银博会延期通知
	id = MECR_EXPO.451
	title = "MECR_EXPO.451.title"
	desc = "MECR_EXPO.451.desc"
	picture = GFX_evt_crisis_defeated
	is_triggered_only = yes

	option = {
		name = "UNFORTUNATE"
	}
}
country_event = { #460.【目录】下一届银河博览会选定举办国
	id = MECR_EXPO.460
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		galaxy_is_peace = yes
	}
	
	immediate = {
		if = {
			limit = { exists = event_target:expo_bid_ranking_1st }
			set_global_flag = flag_expo_on_1st
			event_target:expo_bid_ranking_1st = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = {
			limit = { exists = event_target:expo_bid_ranking_2nd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_2nd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = {
			limit = { exists = event_target:expo_bid_ranking_3rd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_3rd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = {
			limit = { any_galcom_member = { check_variable = { which = expo_bid_result value = 1 } } }
			set_global_flag = flag_expo_on_queue
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 1 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 2 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 2 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_result value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		else = {
			set_global_flag = flag_expo_on_random
			if = {
				limit = { has_galactic_emperor = yes }
				galactic_emperor = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { has_galactic_custodian = yes }
				galactic_custodian = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		every_country = {
			limit = { check_variable = { which = expo_bid_result value = 1 } }
			clear_variable = expo_bid_result
			clear_variable = expo_bid_ranking
		}
	}
}
event = { #461.【目录】银河动荡结束，下一届银河博览会选定举办国
	id = MECR_EXPO.461
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = flag_expo_war_delay
		galaxy_is_peace = yes
		any_galcom_member = { exists = this }
	}
	
	immediate = {
		if = {
			limit = { exists = event_target:expo_bid_ranking_1st }
			set_global_flag = flag_expo_on_1st
			event_target:expo_bid_ranking_1st = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = {
			limit = { exists = event_target:expo_bid_ranking_2nd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_2nd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = {
			limit = { exists = event_target:expo_bid_ranking_3rd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_3rd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = {
			limit = { any_galcom_member = { check_variable = { which = expo_bid_result value = 1 } } }
			set_global_flag = flag_expo_on_queue
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 1 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 2 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 2 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_result value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		else = {
			set_global_flag = flag_expo_on_random
			if = {
				limit = { has_galactic_emperor = yes }
				galactic_emperor = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { has_galactic_custodian = yes }
				galactic_custodian = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		every_country = {
			limit = { check_variable = { which = expo_bid_result value = 1 } }
			clear_variable = expo_bid_result
			clear_variable = expo_bid_ranking
		}
	}
}

# 独立的奖励事件
country_event = { #1001.文化艺术第一，赠送一个免费的圣遗物，保证不会是空的
	id = MECR_EXPO.1001
	title = cara_home_lootbox.title
	desc = {
		trigger = { has_country_flag = recent_empty_lootbox }
		text = openedlootboxdesc1
	}
	desc = {
		trigger = {
			has_country_flag = recent_galatron
			NOT = { has_modifier = galatron_modifier }
		}
		text = lootbox_contents_galatron
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_a }
								text = lootbox_contents_a
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_b }
								text = lootbox_contents_b
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_c }
								text = lootbox_contents_c
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_d }
								text = lootbox_contents_d
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_e }
								text = lootbox_contents_e
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_f }
								text = lootbox_contents_f
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_g }
								text = lootbox_contents_g
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_h }
								text = lootbox_contents_h
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_i }
								text = lootbox_contents_i
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_j }
								text = lootbox_contents_j
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_k }
								text = lootbox_contents_k
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_l }
								text = lootbox_contents_l
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_m }
								text = lootbox_contents_m
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_n }
								text = lootbox_contents_n
	}
	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"
	show_sound = event_lootbox_good

	picture_event_data = {
		portrait = event_target:caravaneer_home_country.ruler
		room = caravaneer_lootbox_room
		planet_background = pc_barren_cold
	}

	immediate = {
		random_list = {
			# Galatron
			1 = {
				modifier = {
					factor = 0
					any_playable_country = {
						has_modifier = galatron_modifier
					}
				}
				set_country_flag = recent_galatron
				set_country_flag = galatron_owner
			}
			# Empty
			#59 = {
			#	modifier = {
			#		factor = 0
			#		has_country_flag = opened_empty_lootbox
			#	}
			#	custom_tooltip = lootbox_contents_empty
			#	set_country_flag = opened_empty_lootbox
			#	set_country_flag = recent_empty_lootbox
			#}
			# Regular contents
			140 = {
				random_list = {
					100 = {
						modifier = {
							factor = 0
							capital_scope = { has_modifier = ancient_trade_route }
						}
						set_country_flag = lootbox_contents_a
					}
					100 = { set_country_flag = lootbox_contents_b }
					#100 = { set_country_flag = lootbox_contents_c }
					100 = { set_country_flag = lootbox_contents_d }
					#100 = { set_country_flag = lootbox_contents_e }
					100 = { set_country_flag = lootbox_contents_f }
					#100 = { set_country_flag = lootbox_contents_g }
					100 = { set_country_flag = lootbox_contents_h }
					100 = { set_country_flag = lootbox_contents_i }
					100 = { set_country_flag = lootbox_contents_j }
					100 = { set_country_flag = lootbox_contents_k }
					1 = {
						modifier = {
							factor = 0
							exists = ruler
							ruler = { has_trait = leader_trait_ruler_psionic }
						}
						modifier = {
							factor = 0
							is_gestalt = yes
						}
						set_country_flag = lootbox_contents_l
					}
					100 = { set_country_flag = lootbox_contents_m }
					100 = { set_country_flag = lootbox_contents_n }
				}
			}
		}
	}

	after = {
		hidden_effect = {
			switch = {
				trigger = has_country_flag
				lootbox_contents_a = { remove_country_flag = lootbox_contents_a }
				lootbox_contents_b = { remove_country_flag = lootbox_contents_b }
				lootbox_contents_c = { remove_country_flag = lootbox_contents_c }
				lootbox_contents_d = { remove_country_flag = lootbox_contents_d }
				lootbox_contents_e = { remove_country_flag = lootbox_contents_e }
				lootbox_contents_f = { remove_country_flag = lootbox_contents_f }
				lootbox_contents_g = { remove_country_flag = lootbox_contents_g }
				lootbox_contents_h = { remove_country_flag = lootbox_contents_h }
				lootbox_contents_i = { remove_country_flag = lootbox_contents_i }
				lootbox_contents_j = { remove_country_flag = lootbox_contents_j }
				lootbox_contents_k = { remove_country_flag = lootbox_contents_k }
				lootbox_contents_l = { remove_country_flag = lootbox_contents_l }
				lootbox_contents_m = { remove_country_flag = lootbox_contents_m }
				lootbox_contents_n = { remove_country_flag = lootbox_contents_n }
				lootbox_contents_p = { remove_country_flag = recent_empty_lootbox }
			}
			if = {
				limit = {
					has_country_flag = recent_galatron
					NOT = { has_modifier = galatron_modifier }
				}
				remove_country_flag = recent_galatron
				country_event = { id = cara.320 }
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = OK

		hidden_effect = {
			if = {
				limit = {
					has_country_flag = recent_galatron
					NOT = { has_modifier = galatron_modifier }
				}
				custom_tooltip = lootbox_contents_galatron
			}
			else_if = {
				limit = { has_country_flag = recent_empty_lootbox }
				custom_tooltip = lootbox_contents_empty
				remove_country_flag = recent_empty_lootbox
			}
			else = {
				switch = {
					trigger = has_country_flag
					lootbox_contents_a = {
						capital_scope = { add_modifier = { modifier = ancient_trade_route days = -1 } }
						tooltip = {
							capital_scope = { add_modifier = { modifier = ancient_trade_route days = -1 } }
						}
					}
					lootbox_contents_b = {
						add_monthly_resource_mult = {
							resource = consumer_goods
							value = 6
							min = 100
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = consumer_goods
								value = 6
								min = 100
							}
						}
					}
					lootbox_contents_c = {
						custom_tooltip = lootbox_contents_c.tooltip
					}
					lootbox_contents_d = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_e = {
						custom_tooltip = lootbox_contents_e.tooltip
					}
					lootbox_contents_f = {
						add_monthly_resource_mult = {
							resource = food
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = food
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_g = {
						custom_tooltip = lootbox_contents_g.tooltip
					}
					lootbox_contents_h = {
						add_monthly_resource_mult = {
							resource = consumer_goods
							value = 8
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = consumer_goods
								value = 8
								min = 2000
							}
						}
					}
					lootbox_contents_i = {
						add_resource = { energy = 4000 }
						add_resource = { minerals = 4000 }
						tooltip = {
							add_resource = { energy = 4000 }
							add_resource = { minerals = 4000 }
						}
					}
					lootbox_contents_j = {
						add_monthly_resource_mult = {
							resource = engineering_research
							value = 25
							min = 2000
							max = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = engineering_research
								value = 25
								min = 2000
								max = 2000
							}
						}
					}
					lootbox_contents_k = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 25
							min = 1000
							max = 1000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 25
								min = 1000
								max = 1000
							}
						}
					}
					lootbox_contents_l = {
						ruler = { add_trait = leader_trait_ruler_psionic }
						tooltip = { ruler = { add_trait = leader_trait_ruler_psionic } }
					}
					lootbox_contents_m = {
						add_monthly_resource_mult = {
							resource = physics_research
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = physics_research
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_n = {
						add_monthly_resource_mult = {
							resource = alloys
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = alloys
								value = 24
								min = 2000
							}
						}
					}
				}
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = cara_home_exit
		trigger = { always = no } # just here to for the X button
		default_hide_option = yes
	}
}
country_event = { #1002.历史传统第一，赠送一次免费的政府改革
	id = MECR_EXPO.1002
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		check_variable = { which = EXPO_award_history_1st value > 0 }
	}

	immediate = {
		subtract_variable = { which = EXPO_award_history_1st value = 1 }
		export_trigger_value_to_variable = {
			trigger = empire_size
			variable = EXPO_award_history_1st_unity
		}
		add_resource = {
			unity = 1
			mult = EXPO_award_history_1st_unity
		}
		clear_variable = EXPO_award_history_1st_unity
	}
}