namespace = country

# Cultist Ships Sighted 1
fleet_event = {
	id = country.204
	title = "country.204.name"
	desc = "country.204.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_red_alert
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			has_country_flag = searching_for_cultists
			NOT = { has_country_flag = cultists_sighted_1 }
		}
		from = { has_star_flag = cultists_1 }
	}

	immediate = {
		owner = {
			save_event_target_as = owner_country
			set_country_flag = cultists_sighted_1
		}
		from = {
			random_system_planet = {
				limit = {
					is_capital = no
					is_asteroid = no
					is_star = no
				}
				save_event_target_as = cultist_marauder_planet
			}
		}
		owner = {
			random_country = {
				limit = { has_country_flag = cultist_rebels_of@root.owner }
				save_event_target_as = radical_cult
				create_leader = {
					class = admiral
					species = owner_main_species
					name = random
					skill = 2
					traits = {
						trait = random_trait
						trait = random_trait
					}
				}
				create_fleet = {
					name = "NAME_Cultist_Marauders"
					effect = {
						set_owner = PREV
						create_ship_design = {
							design = "NAME_Dagger"
						}
						create_ship = {
							name = "NAME_Divine_Vessel"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Sacred_Might"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Heavenly_Portent"
							design = last_created_design
						}
						assign_leader = last_created_leader
						set_location = event_target:cultist_marauder_planet
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 500
						set_fleet_flag = cultist_marauders
					}
				}
			}
		}
	}

	option = {
		name = "BATTLESTATIONS"
	}
}

# Cultist Ships Sighted 2
fleet_event = {
	id = country.205
	title = "country.204.name"
	desc = "country.205.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_red_alert
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			has_country_flag = searching_for_cultists
			NOT = { has_country_flag = cultists_sighted_2 }
		}
		from = { has_star_flag = cultists_2 }
	}

	immediate = {
		owner = {
			save_event_target_as = owner_country
			set_country_flag = cultists_sighted_2
		}
		from = {
			random_system_planet = {
				limit = {
					#is_capital = no
					#is_asteroid = no
					is_star = no
				}
				save_event_target_as = cultist_marauder_planet
			}
		}
		owner = {
			random_country = {
				limit = { has_country_flag = cultist_rebels_of@root.owner }
				save_event_target_as = radical_cult
				create_leader = {
					class = admiral
					species = owner_main_species
					name = random
					skill = 2
					traits = {
						trait = random_trait
						trait = random_trait
					}
				}
				create_fleet = {
					name = "NAME_Cultist_Marauders"
					effect = {
						set_owner = PREV
						create_ship_design = {
							design = "NAME_Dagger"
						}
						create_ship = {
							name = "NAME_Heavenly_Judgment"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Revered_Elder"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Wrath_of_the_Spirits"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Bane_of_the_Heretic"
							design = last_created_design
						}
						assign_leader = last_created_leader
						set_location = event_target:cultist_marauder_planet
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 500
						set_fleet_flag = cultist_marauders
					}
				}
			}
		}
	}

	option = {
		name = "BATTLESTATIONS"
	}
}

# Cult Leader Signals
fleet_event = {
	id = country.211
	title = "country.211.name"
	desc = "country.211.desc"

	diplomatic = yes
	auto_opens = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_country_flag = hunting_cult_flagship }
		from = { has_star_flag = cult_flagship_system }
	}

	picture_event_data = {
		portrait = event_target:radical_cult
		room = ethic_spaceship_room
	}

	immediate = {
		owner = {
			remove_country_flag = hunting_cult_flagship
			save_event_target_as = shipowner
		}
		from = { remove_star_flag = cult_flagship_system }
		hidden_effect = {
			from = {
				random_system_planet = {
					limit = {
						is_capital = no
						is_asteroid = no
						is_star = no
					}
					save_event_target_as = cultist_flagship_planet
				}
			}
			owner = {
				random_country = {
					limit = { has_country_flag = cultist_rebels_of@root.owner }
					save_event_target_as = radical_cult
					create_fleet = {
						name = "NAME_Cultist_Flagship"
						effect = {
							set_owner = PREV
							create_ship_design = {
								design = "NAME_Dagger"
							}
							create_ship = {
								name = "NAME_Glorious_Might"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Righteous_Zealot"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Holy_Protector"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Holy_Defender"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Divine_Justicar"
								design = last_created_design
							}
							create_ship_design = {
								design = "NAME_Divine_Glory"
							}
							create_ship = {
								name = "NAME_Dawn_of_Creation"
								design = last_created_design
								effect = {
									set_ship_flag = cultist_flagship
									set_disable_at_health = 0.05
								}
							}
							set_location = event_target:cultist_flagship_planet
						}
					}
				}
			}
		}
	}

	option = {
		name = "country.211.a"
	}
}

# Entering Rogue Scientist PoI System
fleet_event = {
	id = country.1002
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_event_chain = "rogue_scientist_1_chain" }
		from = {
			OR = {
				has_star_flag = scientist_system_1
				has_star_flag = scientist_system_2
				has_star_flag = scientist_system_3
			}
		}
	}

	immediate = {
		if = {
			limit = {
				from = { has_star_flag = scientist_system_1 }
				owner = { NOT = { has_country_flag = scisys_1 } }
			}
			owner = {
				set_country_flag = scisys_1
				remove_point_of_interest = scientist_poi.1
				add_event_chain_counter = {
					event_chain = "rogue_scientist_1_chain"
					counter = "likely_locations_searched"
					amount = 1
				}
			}
			if = {
				limit = {
					owner = {
						has_completed_event_chain_counter = {
							event_chain = "rogue_scientist_1_chain"
							counter = "likely_locations_searched"
						}
						NOT = { has_country_flag = completed_rogue_scientist }
					}
				}
				owner = { country_event = { id = country.1005 } }
			}
			if = {
				limit = {
					owner = {
						NOT = {
							has_completed_event_chain_counter = {
								event_chain = "rogue_scientist_1_chain"
								counter = "likely_locations_searched"
							}
						}
					}
				}
				owner = { country_event = { id = country.1003 } }
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { has_star_flag = scientist_system_2 }
				owner = { NOT = { has_country_flag = scisys_2 } }
			}
			owner = {
				set_country_flag = scisys_2
				remove_point_of_interest = scientist_poi.2
				add_event_chain_counter = {
					event_chain = "rogue_scientist_1_chain"
					counter = "likely_locations_searched"
					amount = 1
				}
			}
			if = {
				limit = {
					owner = {
						has_completed_event_chain_counter = {
							event_chain = "rogue_scientist_1_chain"
							counter = "likely_locations_searched"
						}
						NOT = { has_country_flag = completed_rogue_scientist }
					}
				}
				owner = { country_event = { id = country.1005 } }
			}
			if = {
				limit = {
					owner = {
						NOT = {
							has_completed_event_chain_counter = {
								event_chain = "rogue_scientist_1_chain"
								counter = "likely_locations_searched"
							}
						}
					}
				}
				owner = { country_event = { id = country.1003 } }
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { has_star_flag = scientist_system_3 }
				owner = { not = { has_country_flag = scisys_3 } }
			}
			owner = {
				set_country_flag = scisys_3
				remove_point_of_interest = scientist_poi.3
				add_event_chain_counter = {
					event_chain = "rogue_scientist_1_chain"
					counter = "likely_locations_searched"
					amount = 1
				}
			}
			if = {
				limit = {
					owner = {
						has_completed_event_chain_counter = {
							event_chain = "rogue_scientist_1_chain"
							counter = "likely_locations_searched"
						}
						NOT = { has_country_flag = completed_rogue_scientist_1 }
					}
				}
				owner = { country_event = { id = country.1005 } }
				break = yes
			}
			if = {
				limit = {
					owner = {
						NOT = {
							has_completed_event_chain_counter = {
								event_chain = "rogue_scientist_1_chain"
								counter = "likely_locations_searched"
							}
						}
					}
				}
				owner = { country_event = { id = country.1003 } }
			}
			break = yes
		}
	}
}

# hidden, fleet entering PoI system, porting to country event for each PoI
fleet_event = {
	id = country.1102
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
			has_event_chain = mass_extinction_chain
		}
		from = {
			any_system_planet = {
				OR = {
					has_planet_flag = massex_1_planet
					has_planet_flag = massex_2_planet
					has_planet_flag = massex_3_planet
					has_planet_flag = massex_4_planet
					has_planet_flag = massex_5_planet
				}
			}
		}
	}

	immediate = {
		if = {
			limit = {
				from = {
					any_system_planet = { has_planet_flag = massex_1_planet }
				}
			}
			owner = { country_event = { id = country.1105 } }
		}
		if = {
			limit = {
				from = {
					any_system_planet = { has_planet_flag = massex_2_planet }
				}
			}
			owner = { country_event = { id = country.1110 } }
		}
		if = {
			limit = {
				from = {
					any_system_planet = { has_planet_flag = massex_3_planet }
				}
			}
			owner = { country_event = { id = country.1115 } }
		}
		if = {
			limit = {
				from = {
					any_system_planet = { has_planet_flag = massex_4_planet }
				}
			}
			owner = { country_event = { id = country.1120 } }
		}
		if = {
			limit = {
				from = {
					any_system_planet = { has_planet_flag = massex_5_planet }
				}
			}
			owner = { country_event = { id = country.1125 } }
		}
	}
}

# Entering Sublight Probe System (HIDDEN)
fleet_event = {
	id = country.2
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			has_event_chain = "sublight_probes_chain"
			FROM = {
				OR = {
					is_point_of_interest = {
						id = probe_search_poi.1
						event_chain = sublight_probes_chain
						owner = root.owner
					}
					is_point_of_interest = {
						id = probe_search_poi.2
						event_chain = sublight_probes_chain
						owner = root.owner
					}
					is_point_of_interest = {
						id = probe_search_poi.3
						event_chain = sublight_probes_chain
						owner = root.owner
					}
					is_point_of_interest = {
						id = probe_search_poi.4
						event_chain = sublight_probes_chain
						owner = root.owner
					}
					#has_star_flag = probe_system_1
					#has_star_flag = probe_system_2
					#has_star_flag = probe_system_3
					#has_star_flag = probe_system_4
				}
			}
		}
	}

	immediate = {
		if = {
			limit = { FROM = { has_star_flag = probe_system_1 } }
			FROM = { remove_star_flag = probe_system_1 }
			owner = { remove_point_of_interest = probe_search_poi.1 }
		}
		if = {
			limit = { FROM = { has_star_flag = probe_system_2 } }
			FROM = { remove_star_flag = probe_system_2 }
			owner = { remove_point_of_interest = probe_search_poi.2 }
		}
		if = {
			limit = { FROM = { has_star_flag = probe_system_3 } }
			FROM = { remove_star_flag = probe_system_3 }
			owner = { remove_point_of_interest = probe_search_poi.3 }
		}
		if = {
			limit = { FROM = { has_star_flag = probe_system_4 } }
			FROM = { remove_star_flag = probe_system_4 }
			owner = { remove_point_of_interest = probe_search_poi.4 }
		}
		random_owned_ship = {
			if = {
				limit = {
					owner = {
						NOR = {
							has_country_flag = probe_salvage_flag
							has_country_flag = probe_subspace_anomaly_flag
							has_country_flag = modified_probe_flag
						}
					}
				}
				random_list = {
					20 = { ship_event = { id = country.3 } }
					20 = { ship_event = { id = country.5 } }
					20 = { ship_event = { id = country.10 } }
					20 = { ship_event = { id = country.12 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = probe_salvage_flag
						NOR = {
							has_country_flag = probe_subspace_anomaly_flag
							has_country_flag = modified_probe_flag
						}
					}
				}
				random_list = {
					40 = { ship_event = { id = country.3 } }
					25 = { ship_event = { id = country.10 } }
					25 = { ship_event = { id = country.12 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = probe_subspace_anomaly_flag
						NOR = {
							has_country_flag = probe_salvage_flag
							has_country_flag = modified_probe_flag
						}
					}
				}
				random_list = {
					40 = { ship_event = { id = country.3 } }
					25 = { ship_event = { id = country.5 } }
					25 = { ship_event = { id = country.12 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = modified_probe_flag
						NOR = {
							has_country_flag = probe_salvage_flag
							has_country_flag = probe_subspace_anomaly_flag
						}
					}
				}
				random_list = {
					40 = { ship_event = { id = country.3 } }
					25 = { ship_event = { id = country.5 } }
					25 = { ship_event = { id = country.10 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = probe_salvage_flag
						has_country_flag = probe_subspace_anomaly_flag
						NOT = { has_country_flag = modified_probe_flag }
					}
				}
				random_list = {
					65 = { ship_event = { id = country.3 } }
					25 = { ship_event = { id = country.12 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = modified_probe_flag
						has_country_flag = probe_subspace_anomaly_flag
						NOT = { has_country_flag = probe_salvage_flag }
					}
				}
				random_list = {
					65 = { ship_event = { id = country.3 } }
					25 = { ship_event = { id = country.5 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = modified_probe_flag
						has_country_flag = probe_salvage_flag
						NOT = { has_country_flag = probe_subspace_anomaly_flag }
					}
				}
				random_list = {
					65 = { ship_event = { id = country.3 } }
					25 = { ship_event = { id = country.10 } }
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = modified_probe_flag
						has_country_flag = probe_salvage_flag
						has_country_flag = probe_subspace_anomaly_flag
					}
				}
				ship_event = { id = country.3 }
			}
		}
	}
}

# Hyacinth Found
fleet_event = {
	id = country.254
	title = "country.254.name"
	desc = "country.254.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_radio_chatter_02
	location = root
	trackable = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
			has_event_chain = "hunting_hyacinth"
		}
		solar_system = { has_star_flag = hyacinth_system }
	}

	immediate = {
		owner = { set_country_flag = hyacinth_system_entered }
		owner = { remove_point_of_interest = hunting_hyacinth_poi.4 }
		solar_system = {
			remove_star_flag = hyacinth_system
			random_system_planet = {
				limit = { has_planet_flag = hyacinth_planet }
				save_event_target_as = hyacinth_planet
				create_ambient_object = {
					type = "hyacinth_object"
					location = THIS
				}
			}
		}
		last_created_ambient_object = {
			save_event_target_as = the_hyacinth
		}
	}

	option = {
		name = "country.254.a"
		enable_special_project = {
			name = "BOARD_HYACINTH"
			location = event_target:the_hyacinth
			owner = root
		}
	}
}