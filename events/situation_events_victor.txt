##########################
## By Victor Haeggman   ##
##########################

namespace = situation


situation_event = {
	id = situation.1005
	title = situation.1005.name
	desc = {
		trigger = {
			switch = {
				trigger = has_situation_flag
				small_unity_reward = { text = CD_TODO_TOOLTIP } #situation.1005.desc.small
				standard_unity_reward = { text = CD_TODO_TOOLTIP } #situation.1005.desc.standard
				large_unity_reward = { text = CD_TODO_TOOLTIP } #situation.1005.desc.large
			}
		}
	}
	picture = GFX_evt_crisis_defeated
	is_triggered_only = yes

	option = {
		trigger = { has_situation_flag = small_unity_reward }
		set_celebration_modifier = yes
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
		name = situation.1005.a
	}
	option = {
		trigger = { has_situation_flag = standard_unity_reward }
		set_celebration_modifier = yes
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
		}
		name = situation.1005.b
	}
	option = {
		trigger = { has_situation_flag = large_unity_reward }
		set_celebration_modifier = yes
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier4unityreward
				min = @tier4unitymin
				max = @tier4unitymax
			}
		}
		name = situation.1005.c
	}
}
#Ether Drake Fang
situation_event = {
	id = situation.1045
	title = situation.1045.name
	desc = CD_TODO_TOOLTIP #situation.1045.desc
	picture = GFX_evt_space_dragon
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_ether_drake
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = { set_situation_flag = 50_percent_event }

	option = { #Be slow
		name = situation.1045.a
		add_situation_progress = -30
		ai_chance = {
			weight = 100
		}
	}
	option = { #Study it
		name = situation.1045.b
		owner = {
			add_modifier = { modifier = studying_decaying_fang days = 7200 }
		}
		custom_tooltip = situation.1045.b.tooltip
		hidden_effect = {
			destroy_situation = this
		}
	}
	option = { #Replace it
		name = situation.1045.c
		if = {
			limit = { NOT = { has_situation_flag = small_unity_reward } }
			custom_tooltip = situation.1045.c.tooltip
		}
		reduce_unity_celebration = yes
	}
}
#Eye of the Shard
situation_event = {
	id = situation.1050
	title = situation.1050.name
	desc = CD_TODO_TOOLTIP #situation.1050.desc
	picture = GFX_evt_space_dragon_blue
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_shard
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = { set_situation_flag = 50_percent_event }


	option = { #Attach it to the starbase
		name = situation.1050.a
		target = {
			add_modifier = { modifier = all_seeing_shard days = -1 }
		}
		custom_tooltip = situation.1050.a.tooltip
		hidden_effect = {
			destroy_situation = this
		}
	}
	option = { #Remove it fast
		name = situation.1050.b
		if = {
			limit = { NOT = { has_situation_flag = small_unity_reward } }
			custom_tooltip = situation.1045.c.tooltip
		}
		reduce_unity_celebration = yes
	}
	option = { #Remove it slow
		name = situation.1050.c
		add_situation_progress = -30
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		ai_chance = {
			weight = 100
		}
	}
}
#Dreadnought Reactor
situation_event = {
	id = situation.1055
	title = situation.1055.name
	desc = CD_TODO_TOOLTIP #situation.1055.desc
	picture = GFX_evt_automated_dreadnought
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_automated_dreadnought
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = { set_situation_flag = 50_percent_event }


	option = { #Power the city
		name = situation.1055.a
		target = {
			add_modifier = { modifier = reactor_overdrive days = -1 }
		}
	}
	option = { #Use it for the parade
		name = situation.1055.b
		random_list = {
			1 = {
				if = {
					limit = { NOT = { has_situation_flag = large_unity_reward } }
					custom_tooltip = situation.1055.b.tooltip
				}
				add_situation_progress = 20
				increase_unity_celebration = yes
			}
			1 = {
				add_situation_progress = -30
			}
		}
	}
	option = { #Turn it off
		name = situation.1055.c
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}
# Tiyanki Matriarch Flagella
situation_event = {
	id = situation.1060
	title = situation.1060.name
	desc = CD_TODO_TOOLTIP #situation.1060.desc
	picture = GFX_evt_ancient_tiyanki
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_tiyanki_matriarch
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = { set_situation_flag = 50_percent_event }


	option = { #Harvest it
		trigger = {
			owner = { country_uses_food = yes }
		}
		name = situation.1060.a
		owner = {
			add_resource = { food = 500 }
		}
		if = {
			limit = { NOT = { has_situation_flag = large_unity_reward } }
			custom_tooltip = situation.1055.b.tooltip
		}
		add_situation_progress = -20
		increase_unity_celebration = yes
		ai_chance = {
			weight = 100
		}
	}
	option = { #Let it grow
		name = situation.1060.b
		target = {
			if = {
				limit = {
					any_owned_pop = {
						NOT = { has_trait = trait_hive_mind }
						is_robot_pop = no
					}
				}
				random_owned_pop = {
					limit = {
						NOT = { has_trait = trait_hive_mind }
						is_robot_pop = no
					}
					root.target = {
						create_pop = {
							species = prev
						}
					}
				}
			}
			else = {
				random_owned_pop = {
					root.target = {
						create_pop = {
							species = prev
						}
					}
				}
			}
		}
	}
	option = { #Burn it
		trigger = { owner = { is_xenophile = no } }
		name = situation.1060.c
		set_situation_flag = burnt_flagella
		if = {
			limit = { NOT = { has_situation_flag = small_unity_reward } }
			custom_tooltip = situation.1045.c.tooltip
		}
		reduce_unity_celebration = yes
	}
}
#Sky-Dragon's Plume
situation_event = {
	id = situation.1065
	title = situation.1065.name
	desc = CD_TODO_TOOLTIP #situation.1065.desc
	picture = GFX_evt_here_be_dragons
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_hrozgar
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = {
		set_situation_flag = 50_percent_event
		create_country = {
			name = "NAME_Clutch_of_Whelps"
			type = clutch_of_whelps
			auto_delete = no
			flag = {
				icon = {
					category = "spherical"
					file = "flag_spherical_6.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"light_blue"
					"light_blue"
					"null"
					"null"
				}
			}
			effect = {
				every_playable_country = {
					establish_communications_no_message = prev
				}
				set_faction_hostility = {
					target = root.owner
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
				create_fleet = {
					name = "NAME_Clutch_of_Whelps"
					settings = {
						#spawns_debris = no
						is_boss = yes
						can_change_leader = no
					}
					effect = {
						set_owner = prev
						while = {
							count = 3
							create_ship = {
								name = "NAME_Sky_Dragon_Baby"
								design = "NAME_Sky_Dragon_Baby"
							}
						}
						set_location = {
							target = root.target
							distance = 300
							angle = 180
						}
					}
				}
				save_event_target_as = clutch_of_whelps
			}
		}
	}


	option = { #Kill the whelps
		trigger = { owner = { values_others = no } }
		name = situation.1065.a
		hidden_effect = {
			event_target:clutch_of_whelps = {
				set_faction_hostility = {
					target = root.owner
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
				random_owned_fleet = {
					set_fleet_stance = aggressive
				}
			}
		}
		if = {
			limit = {
				owner = {
					OR = {
						is_unfriendly = yes
						is_xenophobe = yes
						is_gestalt = yes
					}
				}
			}
			if = {
				limit = { NOT = { has_situation_flag = large_unity_reward } }
				custom_tooltip = situation.1055.b.tooltip
			}
			increase_unity_celebration = yes
		}
		else = {
			if = {
				limit = { NOT = { has_situation_flag = small_unity_reward } }
				custom_tooltip = situation.1045.c.tooltip
			}
			reduce_unity_celebration = yes
		}
	}
	option = { #Find them a home
		trigger = {
			owner = {
				NOR  = {
					is_unfriendly = yes
					is_xenophobe = yes
				}
			}
		}
		name = situation.1065.b
		custom_tooltip = situation.1065.b.tooltip
		hidden_effect = {
			target.solar_system = {
				spawn_planet = {
					class = pc_asteroid
					location = target.solar_system.star
					orbit_distance_offset = 180
					orbit_angle_offset = 5
					size = 2
					init_effect = {
						set_deposit = d_living_metal_deposit
						set_name = "NAME_Drakes_Roost"
						save_event_target_as = drakes_roost
						set_surveyed = {
							surveyed = yes
							surveyor = root.owner
						}
					}
				}
			}
			event_target:clutch_of_whelps = {
				random_owned_fleet = {
					clear_fleet_actions = this
					queue_actions = {
						move_to = event_target:drakes_roost
						orbit_planet = event_target:drakes_roost
					}
				}
			}
			destroy_situation = this
		}
		ai_chance = {
			weight = 100
		}
	}

	option = { #Trap Them
		trigger = {
			owner = {
				NOR = {
					is_egalitarian = yes
					values_others = yes
					is_xenophobe = yes
				}
			}
		}
		name = situation.1065.c
		if = {
			limit = { NOT = { has_situation_flag = large_unity_reward } }
			custom_tooltip = situation.1055.b.tooltip
		}
		increase_unity_celebration = yes
		hidden_effect = {
			event_target:clutch_of_whelps = {
				destroy_country = yes
			}
		}
	}
	option = { #Drive them off
		trigger = { owner = { is_homicidal = no } }
		name = situation.1065.d
		add_situation_progress = -10
		hidden_effect = {
			event_target:clutch_of_whelps = {
				destroy_country = yes
			}
		}
	}
}
# Scavenger Bot's Compactor
situation_event = {
	id = situation.1070
	title = situation.1070.name
	desc = CD_TODO_TOOLTIP #situation.1070.desc
	picture = GFX_evt_scavenger_bot
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_scavenger_bot
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = { set_situation_flag = 50_percent_event }


	option = { #Use it for Construction
		name = situation.1070.a
		owner = {
			add_resource = { alloys = 5000 }
		}
		add_situation_progress = -20
		ai_chance = {
			weight = 100
		}
	}
	option = { #Use it for the parade
		name = situation.1070.b
		if = {
			limit = { NOT = { has_situation_flag = large_unity_reward } }
			custom_tooltip = situation.1055.b.tooltip
		}
		increase_unity_celebration = yes
		add_situation_progress = 20
	}
	option = { #Send the compactor back into orbit
		name = situation.1070.c
		custom_tooltip = situation.1070.c.tooltip
		hidden_effect = {
			destroy_situation = this
			target = {
				solar_system = {
					spawn_planet = {
						class = pc_asteroid
						location = root.target
						orbit_location = yes
						orbit_distance_offset = 10
						orbit_angle_offset = 5
						size = 2
						init_effect = {
							set_name = "NAME_Bot_Compactor"
							set_surveyed = {
								surveyed = yes
								surveyor = root.owner
							}
							set_deposit = d_alloys_10
						}
					}
				}
			}
		}
	}
}
# Spectral Wraith's Disperser Sack
situation_event = {
	id = situation.1075
	title = situation.1075.name
	desc = CD_TODO_TOOLTIP #situation.1075.desc
	picture = GFX_evt_wraith
	is_triggered_only = yes

	trigger = {
		situation_progress >= 50
		has_situation_flag = celebration_spectral_wraith
		NOT = { has_situation_flag = 50_percent_event}
	}

	immediate = { set_situation_flag = 50_percent_event }


	option = { #Infuse the atmosphere
		name = situation.1075.a
		custom_tooltip = situation.1075.a.tooltip
		target = { add_modifier = { modifier = infused_atmosphere } }
		hidden_effect = {
			destroy_situation = this
		}
	}
	option = { #Plug it up
		name = situation.1075.b
	}
	option = { #Use it for the parade
		name = situation.1075.c
		if = {
			limit = { NOT = { has_situation_flag = large_unity_reward } }
			custom_tooltip = situation.1055.b.tooltip
		}
		increase_unity_celebration = yes
		add_situation_progress = -40
	}
}
