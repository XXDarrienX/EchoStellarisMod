namespace = emperor

country_event = { # 51. GDF Becomes Imperial Armada (expand_gdf_3 4 5)
	id = emperor.51
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_playable_country = {
			limit = { is_galactic_emperor = yes }
			save_event_target_as = gal_emperor
		}
		if = {
			limit = {
				is_active_resolution = resolution_custodian_expand_gdf_5
			}
			pass_resolution_no_cooldown = resolution_emperor_imperial_armada
			pass_resolution_no_cooldown = resolution_emperor_expand_ia
			pass_resolution_no_cooldown = resolution_emperor_expand_ia_3
			pass_resolution_no_cooldown = resolution_emperor_expand_ia_4
			pass_resolution_no_cooldown = resolution_emperor_expand_ia_5
			cancel_resolution = "resolution_custodian_expand_gdf_5"
			cancel_resolution = "resolution_custodian_expand_gdf_4"
			cancel_resolution = "resolution_custodian_expand_gdf_3"
			cancel_resolution = "resolution_custodian_expand_gdf"
			cancel_resolution = "resolution_custodian_gdf"
		}
		else_if = {
			limit = {
				is_active_resolution = resolution_custodian_expand_gdf_4
			}
			pass_resolution_no_cooldown = resolution_emperor_imperial_armada
			pass_resolution_no_cooldown = resolution_emperor_expand_ia
			pass_resolution_no_cooldown = resolution_emperor_expand_ia_3
			pass_resolution_no_cooldown = resolution_emperor_expand_ia_4
			cancel_resolution = "resolution_custodian_expand_gdf_4"
			cancel_resolution = "resolution_custodian_expand_gdf_3"
			cancel_resolution = "resolution_custodian_expand_gdf"
			cancel_resolution = "resolution_custodian_gdf"
		}
		else_if = {
			limit = {
				is_active_resolution = resolution_custodian_expand_gdf_3
			}
			pass_resolution_no_cooldown = resolution_emperor_imperial_armada
			pass_resolution_no_cooldown = resolution_emperor_expand_ia
			pass_resolution_no_cooldown = resolution_emperor_expand_ia_3
			cancel_resolution = "resolution_custodian_expand_gdf_3"
			cancel_resolution = "resolution_custodian_expand_gdf"
			cancel_resolution = "resolution_custodian_gdf"
		}
		else_if = {
			limit = {
				is_active_resolution = resolution_custodian_expand_gdf
			}
			pass_resolution_no_cooldown = resolution_emperor_imperial_armada
			pass_resolution_no_cooldown = resolution_emperor_expand_ia
			cancel_resolution = "resolution_custodian_expand_gdf"
			cancel_resolution = "resolution_custodian_gdf"
		}
		else = {
			pass_resolution_no_cooldown = resolution_emperor_imperial_armada
			cancel_resolution = "resolution_custodian_gdf"
		}
		event_target:global_event_country = { clear_variable = gdf_expand_size }
		set_global_flag = flag_MECR_emperor_ia_resolutions_repaired
		every_playable_country = {
			limit = { is_galactic_community_member = yes }
			country_event = { id = emperor.52 }
		}
	}
}

country_event = { # 72. GALPOL Becomes ISD (打击犯罪议案的特殊desc)
	id = emperor.72
	title = "emperor.70.name"
	desc = {
		trigger = {
			NOT = { has_global_flag = flag_crack_down_on_criminal_syndicate }
		}
		text = "emperor.72.desc"
	}
	desc = {
		trigger = {
			has_global_flag = flag_crack_down_on_criminal_syndicate
		}
		text = "emperor.72.desc.crack_down_on_criminal_syndicate"
	}
	picture = GFX_evt_spymaster
	show_sound = event_spymaster

	is_triggered_only = yes

	immediate = {
		random_playable_country = {
			limit = { is_galactic_emperor = yes }
			save_event_target_as = gal_emperor
		}
	}

	option = {
		name = emperor.70.a
		trigger = { is_galactic_emperor = yes }
	}
	option = {
		name = DISCONCERTING
		trigger = { is_galactic_emperor = no }
	}
}

country_event = { # 350.Imperial Crusade Declared - Victim
	id = emperor.350
	title = "emperor.350.name"
	desc = {
		trigger = {
			is_country_type = default
			is_homicidal = no
		}
		text = "emperor.350.a.desc"
	}
	desc = {
		trigger = {
			OR = {
				NOR = { is_country_type = default }
				is_homicidal = yes
			}
		}
		text = "emperor.350.b.desc"
	}
	picture = GFX_evt_galactic_empire
	show_sound = event_announcement

	is_triggered_only = yes

	option = {
		name = emperor.350.a
	}
}

country_event = { # 451.有战损时重新计算帝国军团数量 Tally Imperial Legions
	id = emperor.451
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			OR = {
				army_type = imperial_mega_warform
				army_type = imperial_warrior_drones
				army_type = imperial_vassal_legion #仆从军
				army_type = imperial_vassal_mega_warform
				army_type = imperial_vassal_warrior_drones
			}
		}
	}

	immediate = {
		from = {
			switch = {
				trigger = army_type
				imperial_mega_warform = { root = { change_variable = { which = imperial_legion_soldier_count_mega_warform value = -1 } } }
				imperial_warrior_drones = { root = { change_variable = { which = imperial_legion_soldier_count_warrior_drones value = -1 } } }
				imperial_vassal_legion = { root = { change_variable = { which = imperial_vassal_legion_count value = -1 } } } #仆从军
				imperial_vassal_mega_warform = { root = { change_variable = { which = imperial_vassal_mega_warform_count value = -1 } } }
				imperial_vassal_warrior_drones = { root = { change_variable = { which = imperial_vassal_mega_warform_count value = -1 } } }
			}
		}
	}
}

planet_event = { # 62.Imperial Concession Port Removed
	id = emperor.62
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_branch_office = yes
		OR = {
			branch_office_owner = { has_modifier = imperial_charter }
			has_planet_flag = imp_concession_port
		}
	}

	immediate = {
		if = {
			limit = {
				has_planet_flag = imp_concession_port
				NOT = { has_holding = { holding = building_imperial_concession_port owner = planet.branch_office_owner } }
			}
			remove_planet_flag = imp_concession_port
			random_playable_country = {
				limit = { is_galactic_emperor = yes }
				change_variable = {
					which = imp_concession_ports
					value = -1
				}
				country_event = { id = emperor.65 }
			}
		}
		else_if = {
			limit = {
				branch_office_owner = { has_modifier = imperial_charter }
				last_building_changed = building_imperial_concession_port
			}
			set_planet_flag = imp_concession_port
			random_playable_country = {
				limit = { is_galactic_emperor = yes }
				change_variable = {
					which = imp_concession_ports
					value = 1
				}
				country_event = { id = emperor.65 }
			}
		}
	}
}
country_event = { # 63.Imperial Charter Country Destroyed
	id = emperor.63
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_modifier = imperial_charter
	}

	immediate = {
		remove_global_flag = imperial_charter_granted
		every_galaxy_planet = {
			limit = { has_planet_flag = imp_concession_port }
			remove_planet_flag = imp_concession_port
		}
		random_playable_country = {
			limit = { is_galactic_emperor = yes }
			set_variable = {
				which = "imp_concession_ports"
				value = 0
			}
			add_imp_concession_ports_0 = yes
		}
	}
}
country_event = { # 65.Tally Imperial Concession Ports
	id = emperor.65
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		add_imp_concession_ports_0 = yes
		set_variable = { which = imp_concession_ports_modifier_multiplier value = imp_concession_ports }
		if = {
			limit = {
				has_federation = yes
				federation = { has_federation_perk = imperium_federation_passive }
			}
			federation = {
				switch = {
					trigger = has_federation_perk
					imperium_market_4 = { root = {
						multiply_variable = { which = imp_concession_ports_modifier_multiplier value = 0.2 }
					} }
					imperium_market_3 = { root = {
						multiply_variable = { which = imp_concession_ports_modifier_multiplier value = 0.4 }
					} }
					imperium_market_2 = { root = {
						multiply_variable = { which = imp_concession_ports_modifier_multiplier value = 0.6 }
					} }
					imperium_market = { root = {
						multiply_variable = { which = imp_concession_ports_modifier_multiplier value = 0.8 }
					} }
					default = {}
				}
			}
		}
		add_modifier = {
			modifier = imp_concession_ports_mult
			multiplier = imp_concession_ports_modifier_multiplier
		}
	}
}