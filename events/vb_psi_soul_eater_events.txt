namespace = vb_psi_souleater


country_event = {
    id = vb_psi_souleater.0
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        every_country = {
			limit = { 
				is_ai = no
                NOT = { has_origin = origin_vb_psi_soul_eater }
			}
			country_event = { id = vb_psi_souleater.5 days = 10800 }
		}
    }
}

#Initial setting for soul eaters
country_event = {
    id = vb_psi_souleater.1
    title = vb_psi_souleater.1.name
    desc = vb_psi_souleater.1.desc
    picture = GFX_evt_psionics
	is_triggered_only = yes
	
	trigger = { has_origin = origin_vb_psi_soul_eater }
	
	immediate = {
		add_modifier = {
			modifier = vb_psi_starting_food
			days = 10800
        }
        country_event = {
            id = vb_psi_souleater.6
            days = 10800 
		}
	}
	
    option = {
        name = OK
    }
}

#Soul Diet Harmony
country_event = {
	id = vb_psi_souleater.3
	is_triggered_only = yes
    hide_window = yes
    
    immediate = {
        every_playable_country = {
            limit = { has_origin = origin_vb_psi_soul_eater }
            every_owned_species = {
                limit = {
                    is_robotic_species = no
                    is_soul_eater = no
                    has_slavery_type = { country = from type = slavery_livestock }
                }
                prev = { change_variable = { which = soul_diet_var value = 1 } }
            }
            add_modifier = {
                modifier = soul_diet
                days = 360
                multiplier = soul_diet_var
            }
            clear_variable = soul_diet_var
        }
	}
}

country_event = {
    id = vb_psi_souleater.5
    title = vb_psi_souleater.5.name
	desc = vb_psi_souleater.5.desc
    is_triggered_only = yes
    fire_only_once = yes
    picture = GFX_evt_psionics
    show_sound = event_the_great_awakening

	option = {
		name = OK
	}
}

country_event = {
	id = vb_psi_souleater.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
        every_playable_country = {
            limit = {
                has_origin = origin_vb_psi_soul_eater
            }
            add_modifier = {
                modifier = vb_psi_food_level_1
                days = 3600
            }
        }
	}
}

country_event = {
    id = vb_psi_souleater.7
    title = vb_psi_souleater.7.name
	desc = vb_psi_souleater.7.desc
    is_triggered_only = yes
    fire_only_once = yes
    picture = GFX_evt_psionics
    show_sound = event_the_great_awakening

    trigger = {
        has_origin = origin_vb_psi_soul_eater
    }

	option = {
        name = "Gift 1"
            add_modifier = {
                modifier = strangers_contract_1
                days = -1
            }
            set_country_flag = strangers_contract
    }
    option = {
        name = "Gift 2"
            add_modifier = {
                modifier = strangers_contract_2
                days = -1
            }
            set_country_flag = strangers_contract
    }
    option = {
        name = "Gift 3"
            add_modifier = {
                modifier = strangers_contract_3
                days = -1
            }
            set_country_flag = strangers_contract
    }
    option = {
        name = "Gift 4"
            add_modifier = {
                modifier = strangers_contract_4
                days = -1
            }
            set_country_flag = strangers_contract
    }
}

country_event = {
    id = vb_psi_souleater.9
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        every_playable_country = {
			limit = { 
				is_ai = no
                NOT = { has_origin = origin_vb_psi_soul_eater }
			}
			country_event = { id = vb_psi_souleater.10 }
		}
    }
}

country_event = {
    id = vb_psi_souleater.10
    title = vb_psi_souleater.10.name
	desc = vb_psi_souleater.10.desc
    is_triggered_only = yes
    picture = GFX_evt_psionics
    show_sound = event_the_great_awakening

	option = {
        name = Disconcerting
        trigger = {
            NOT = { has_authority = auth_machine_intelligence }
        }
    }
    option = {
        name = vb_psi_souleater.10.b
        trigger = {
            has_authority = auth_machine_intelligence
        }
    }
}

country_event = {
    id = vb_psi_souleater.11
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        every_playable_country = {
			limit = { 
				is_ai = no
                NOT = { has_origin = origin_vb_psi_soul_eater }
			}
			country_event = { id = vb_psi_souleater.12 }
		}
    }
}

country_event = {
    id = vb_psi_souleater.12
    title = vb_psi_souleater.12.name
	desc = vb_psi_souleater.12.desc
    is_triggered_only = yes
    picture = GFX_evt_psionics
    show_sound = event_the_great_awakening

	option = {
		name = "Understood"
	}
}

#Reanimated Armies: Reanimating the enemy's army as your own
#An army has been killed in ground combat
# This = owner
# From = army
# FromFrom = opponent
# FromFromFrom = planet
country_event = {
	id = vb_psi_souleater.13
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
		fromfrom = {
			has_origin = origin_vb_psi_soul_eater
		}
		from = {
			exists = species
			species = {
				is_robotic = no
			}
		}
		NOT = { is_country_type = "gate_builders" }
	}

	immediate = {
		random_list = {
			0 = { }
			25 = {
				fromfromfrom = {
					create_army = {
						owner = root.fromfrom
						type = husk_army_horde
						species = root.from.species
					}
				}
			}
		}
	}
}

namespace = war_in_heaven

# Ancient Rival awakens
country_event = {
	id = war_in_heaven.1
	title = OK
	desc = OK

	hide_window = yes

	trigger = {
		host_has_dlc = "Leviathans Story Pack"
		is_country_type = fallen_empire
		#is_at_war = no
		fleet_power > 60000
		has_global_flag = sleepers_awake_happened
		NOT = { has_global_flag = sleepers_awake_rival_waking }
		has_country_flag = sleepers_awake_ancient_rival
		any_country = {
			is_country_type = awakened_fallen_empire
			has_country_flag = sleepers_awake_first_sleeper
		}
	}

	mean_time_to_happen = {
		years = 5
		modifier = {
			factor = 0.01
			OR = {
				has_global_flag = war_in_heaven_debug
				NOT = { has_country_flag = timed_ancient_rival }
			}
		}
	}

	immediate = {
		every_country = {
			limit = { is_country_type = default }
			set_timed_country_flag = { flag = ai_no_wars days = 3650 }
		}
		random_country = {
			limit = {
				is_country_type = awakened_fallen_empire
				has_country_flag = sleepers_awake_first_sleeper
			}
			save_global_event_target_as = FirstSleeper
			set_timed_country_flag = { flag = ai_no_wars days = 3650 }
		}
		save_global_event_target_as = SecondSleeper
		set_timed_country_flag = { flag = ai_no_wars days = 3650 }
		set_timed_country_flag = { flag = war_in_heaven_timer days = 730 }
		set_timed_country_flag = { flag = war_in_heaven_timer_2 days = 3650 }
		set_global_flag = sleepers_awake_rival_waking
		set_country_type = awakened_fallen_empire
		change_government = {
			civics = {
				civic = civic_revanchist_fervor
				civic = civic_ancient_caches_of_technology
			}
		}
		# Changing country type resets resources, so give them full stores
		add_awakened_fallen_empire_resources = yes
		add_awakened_fallen_empire_fleet = yes #also some more fleet
		add_awakened_fallen_empire_fleet = yes #also some more fleet

		# Establish communications / notify
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
				}
			}
			if = {
				limit = { NOT = { has_communications = root } }
				establish_communications_no_message = root
				root = { save_event_target_as = contact_empire }
				country_event = { id = action.1 }
			}
			country_event = { id = war_in_heaven.2 }
		}
		observer_event = { id = observer.75 }
	}
}