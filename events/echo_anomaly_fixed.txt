namespace = anomaly

# OLD GODS - THE BENEFACTRESS DISCOVERED, NEEDS SOCIETY
fleet_event = {
	id = anomaly.142
	title = "anomaly.142.name"
	desc = "anomaly.142.desc"
	picture = GFX_evt_ship_travel
	show_sound = event_mystic_reveal
	location = event_target:shrine
	trackable = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_event_chain = "old_gods_chain" }
		FROM = {
			has_star_flag = old_gods_system_1@root.owner
		}
	}

	immediate = {
		FROM = { remove_star_flag = old_gods_system_1@root.owner }
		owner = { remove_point_of_interest = old_gods_shrine_poi.1 }
		create_ambient_object = {
			type = "shrine_object"
			location = solar_system
		}
		last_created_ambient_object = {
			save_event_target_as = shrine
			enable_special_project = {
				name = "OLD_GODS_BENEFACTRESS_PROJECT"
				location = this
				owner = root
			}
		}
		owner = { set_country_flag = old_gods_benefactress }
	}

	option = {
		name = "anomaly.142.a"
	}
}

# OLD GODS - THE UNDAUNTED DISCOVERED, NEEDS ENGINEERING
fleet_event = {
	id = anomaly.143
	title = "anomaly.143.name"
	desc = "anomaly.143.desc"
	picture = GFX_evt_ship_travel
	show_sound = event_mystic_reveal
	location = event_target:shrine
	trackable = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_event_chain = "old_gods_chain" }
		FROM = {
			has_star_flag = old_gods_system_2@root.owner
		}
	}

	immediate = {
		FROM = { remove_star_flag = old_gods_system_2@root.owner }
		owner = { remove_point_of_interest = old_gods_shrine_poi.2 }
		create_ambient_object = {
			type = "shrine_object"
			location = solar_system
		}
		last_created_ambient_object = {
			save_event_target_as = shrine
			enable_special_project = {
				name = "OLD_GODS_UNDAUNTED_PROJECT"
				location = this
				owner = root
			}
		}
		owner = { set_country_flag = old_gods_undaunted }
	}

	option = {
		name = "anomaly.143.a"
	}
}

# OLD GODS - THE PERCIPIENT DISCOVERED, NEEDS PHYSICS
fleet_event = {
	id = anomaly.144
	title = "anomaly.144.name"
	desc = "anomaly.144.desc"
	picture = GFX_evt_ship_travel
	show_sound = event_mystic_reveal
	location = event_target:shrine
	trackable = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_event_chain = "old_gods_chain" }
		FROM = {
			has_star_flag = old_gods_system_3@root.owner
		}
	}

	immediate = {
		FROM = { remove_star_flag = old_gods_system_3@root.owner }
		owner = { remove_point_of_interest = old_gods_shrine_poi.3 }
		create_ambient_object = {
			type = "shrine_object"
			location = solar_system
		}
		last_created_ambient_object = {
			save_event_target_as = shrine
			enable_special_project = {
				name = "OLD_GODS_PERCIPIENT_PROJECT"
				location = this
				owner = root
			}
		}
		owner = { set_country_flag = old_gods_percipient }
	}

	option = {
		name = "anomaly.144.a"
	}
}

# found sol, voyager
fleet_event = {
	id = anomaly.106
	title = anomaly.106.name
	desc = {
		text = anomaly.106.desc.neutral
	}
	desc = {
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		text = anomaly.106.desc.phobe
	}
	desc = {
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_xenophile
				}
			}
		}
		text = anomaly.106.desc.phile
	}
	picture = GFX_evt_ship_in_orbit_3
	show_sound = event_scanner
	location = FROM

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_country_flag = sol_search }
		from = { has_star_flag = sol_target }
	}

	immediate = {
		from = { remove_star_flag = sol_target }
		owner = {
			remove_country_flag = sol_search
			add_event_chain_counter = {
				event_chain = "find_sol_chain"
				counter = "found"
				amount = 1
			}
		}
	}

	option = {
		name = anomaly.106.a.neutral
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
			end_event_chain = "find_sol_chain"
		}
	}

	option = {
		name = anomaly.106.a.phobe
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
			end_event_chain = "find_sol_chain"
		}
	}

	option = {
		name = anomaly.106.a.phile
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_xenophile
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
			end_event_chain = "find_sol_chain"
		}
	}
}

#TRIGGERED WHEN ENTERING ONE OF THE POI SYSTEMS
fleet_event = {
	id = anomaly.4036
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_event_chain = "star_power_chain" }
		FROM = {
			OR = {
				has_star_flag = some_system_1
				has_star_flag = some_system_2
			}
		}
	}
	immediate = {
		random_owned_ship = {
			save_event_target_as = ship_for_fleet_event
		}
		if = {
			limit = { FROM = { has_star_flag = some_system_1 } }
			FROM = { remove_star_flag = some_system_1 }
			owner = {
				remove_point_of_interest = anomaly.4035.poi.1
			}
			random_list = {
				40 = {
					event_target:ship_for_fleet_event = { ship_event = { id = anomaly.4037 } }
					random_system = {
						limit = {
							has_star_flag = some_system_2
						}
						remove_star_flag = some_system_2
					}
					owner = {
						remove_point_of_interest = anomaly.4035.poi.2
						set_country_flag = finished_star_power_chain
					}
				}
				60 = {
					owner = {
						add_event_chain_counter = {
							event_chain = "star_power_chain"
							counter = "systems_visited_poi"
							amount = 1
						}
					}
					if = {
						limit = {
							owner = {
								NOT = {
									has_completed_event_chain_counter = {event_chain = star_power_chain counter = systems_visited_poi}
								}
							}
						}
						event_target:ship_for_fleet_event = { ship_event = { id = anomaly_failure.4037 } }
					}
					if = {
						limit = {
							owner = {
								NOT = {
									has_country_flag = finished_star_power_chain
								}
								has_completed_event_chain_counter = {
									event_chain = star_power_chain
									counter = systems_visited_poi
								}
							}
						}
						owner = {
							set_country_flag = finished_star_power_chain
						}
						event_target:ship_for_fleet_event = { ship_event = { id = anomaly.4037 } }
					}
				}
			}
		}
		if = {
			limit = { FROM = { has_star_flag = some_system_2 } }
			FROM = { remove_star_flag = some_system_2 }
			owner = {
				remove_point_of_interest = anomaly.4035.poi.2
			}
			random_list = {
				40 = {
					event_target:ship_for_fleet_event = { ship_event = { id = anomaly.4037 } }
					random_system = {
						limit = {
							has_star_flag = some_system_1
						}
						remove_star_flag = some_system_1
					}
					owner = {
						remove_point_of_interest = anomaly.4035.poi.1
						set_country_flag = finished_star_power_chain
					}
				}
				60 = {
					owner = {
						add_event_chain_counter = {
							event_chain = "star_power_chain"
							counter = "systems_visited_poi"
							amount = 1
						}
					}
					if = {
						limit = {
							owner = {
								NOT = {
									has_completed_event_chain_counter = {event_chain = star_power_chain counter = systems_visited_poi}
								}
							}
						}
						event_target:ship_for_fleet_event = { ship_event = { id = anomaly_failure.4037 } }
					}
					if = {
						limit = {
							owner = {
								NOT = {
									has_country_flag = finished_star_power_chain
								}
								has_completed_event_chain_counter = {
									event_chain = star_power_chain
									counter = systems_visited_poi
								}
							}
						}
						owner = {
							set_country_flag = finished_star_power_chain
						}
						event_target:ship_for_fleet_event = { ship_event = { id = anomaly.4037 } }
					}
				}
			}
		}
	}
}