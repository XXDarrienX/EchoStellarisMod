@resolution_weight_hated = 3
@resolution_weight_disliked = 4
@resolution_weight_unpopular = 5
@resolution_weight_normal = 6
@resolution_weight_popular = 6.5
@resolution_weight_loved = 7
@resolution_weight_fever = 10

@resolution_cost_t1 = 100
@resolution_cost_t2 = 150
@resolution_cost_t3 = 200
@resolution_cost_t4 = 250
@resolution_cost_t5 = 300
@resolution_cost_denounce = 25

@resolution_cost_t1_half = 50
@resolution_cost_t2_half = 75
@resolution_cost_t3_half = 100
@resolution_cost_t4_half = 125
@resolution_cost_t5_half = 150
@resolution_cost_denounce_half = 12.5

@resolution_flag_timer = 360

################################### resolution_category_term_limits
resolution_custodian_end_custodianship = { # 和平视窗计划生效时不可结束监管人任期
	icon = "GFX_resolution_end_custodianship"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t3
		}
	}
	target = no

	modifier = {
	}

	effect = {
		custom_tooltip = resolution_custodian_end_custodianship_tooltip
		galactic_custodian = {
			add_modifier = {
				modifier = modern_cincinnatus
			}
		}
		hidden_effect = {
			country_event = { id = custodian.14 }
		}
		pass_resolution_modifier = { CATEGORY = general }
	}

	fail_effects = {
		fail_resolution_modifier = { CATEGORY = general }
	}

	potential = {
		has_nemesis = yes
		is_galactic_custodian = yes
		NOT = { is_active_resolution = resolution_custodian_peace_windows_project }
		NOT = { has_global_flag = grand_custodianship_declared }
	}

	active = {
		has_galactic_custodian = yes
	}

	ai_weight = {
		base = @resolution_weight_popular
		
		modifier = {
			factor = 0
			is_galactic_custodian = yes
			desc = gal_com_is_the_custodian
		}
	}
}
################################### resolution_category_galacticreforms
resolution_galacticreforms_nominate_custodian = { # Nominate Custodian: cosmogenesis available
	icon = "GFX_resolution_nominate_custodian"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t5
		}
	}

	target = yes
	harmful = no
	valid_target = {
		is_galactic_community_member = yes
		is_part_of_galactic_council = yes
		NOT = { has_civic = civic_criminal_heritage }
		custom_tooltip = {
			fail_text = "nominate_other_custodian_requires_independence"
			is_subject = no
		}
		custom_tooltip = {
			fail_text = "nominate_other_custodian_not_crisis"
			NOR = {
				has_ascension_perk = ap_become_the_crisis
				#has_ascension_perk = ap_cosmogenesis
				has_technology = tech_cosmogenesis_thesis
				has_valid_civic = civic_pompous_purists
			}
		}
	}

	effect = {
		set_galactic_custodian = yes
		custom_tooltip = resolution_galacticreforms_nominate_custodian_no_crisis_cosmogenesis_level_5
		hidden_effect = {
			country_event = { id = custodian.1 }
			if = {
				limit = { has_global_flag = gdf_active }
				country_event = { id = custodian.35 days = 10 }
			}
		}
	}

	potential = {
		has_nemesis = yes
		is_galactic_council_established = yes
		has_galactic_custodian = no
		has_galactic_emperor = no
	}

	allow = {
		custom_tooltip = {
			fail_text = "nominate_custodian_requires_independence"
			is_subject = no
		}
		custom_tooltip = {
			fail_text = "nominate_custodian_not_crisis"
			NOR = {
				has_ascension_perk = ap_become_the_crisis
				#has_ascension_perk = ap_cosmogenesis
				has_technology = tech_cosmogenesis_thesis
			}
		}
	}

	active = {
		has_galactic_custodian = no
	}

	ai_weight = {
		base = @resolution_weight_normal

		modifier = {
			factor = 12
			any_neighbor_country = { is_crisis_faction = yes }
			desc = gal_com_neighboring_crisis_empire
		}

		modifier = {
			factor = 4
			has_crisis_stage_1 = yes
			desc = gal_com_crisis_stage_1
		}

		modifier = {
			factor = 6
			has_crisis_stage_2 = yes
			desc = gal_com_crisis_stage_2
		}

		modifier = {
			factor = 8
			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}

		modifier = {
			factor = 20
			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}

		modifier = {
			factor = 20
			is_same_value = from
			desc = gal_com_target_is_me
		}

		modifier = {
			factor = 20
			any_playable_country = { has_country_flag = crisis_sphere_revealed }
			desc = gal_com_someone_is_revealed_crisis
		}

		modifier = {
			factor = 8
			any_playable_country = { has_been_declared_crisis = yes }
			desc = gal_com_someone_declared_crisis
		}

		modifier = {
			factor = 8
			has_global_flag = gray_goo_crisis_active
			desc = gal_com_someone_is_revealed_crisis
		}

		modifier = {
			factor = 8
			has_global_flag = marauder_crisis_ongoing
			desc = gal_com_someone_is_revealed_crisis
		}

		modifier = {
			factor = 0.5
			has_ai_personality = xenophobic_isolationists
			desc = personality_xenophobic_isolationists
		}

		modifier = {
			factor = 0
			OR = {
				has_ascension_perk = ap_become_the_crisis
				has_ascension_perk = ap_cosmogenesis
			}
			desc = gal_com_we_have_crisis_perk
		}

		modifier = {
			factor = 0
			is_rival = from
			desc = gal_com_target_is_rival
		}

		modifier = {
			factor = 0
			is_subject = yes
			overlord = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			desc = gal_com_subject_of_fallen_empire
		}

		modifier = {
			factor = 10
			any_country = {
				is_country_type = awakened_fallen_empire
				is_galactic_community_member = no
			}
			desc = gal_com_exists_awakened_fallen_empire
		}

		modifier = {
			factor = 20
			has_global_flag = war_in_heaven_ongoing
			desc = gal_com_ongoing_war_in_heaven
		}
	}
}
resolution_galacticreforms_unseat_custodian = { # 和平视窗计划生效时不可罢免监管人
	icon = "GFX_resolution_end_custodianship"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t3
		}
	}
	target = yes
	harmful = yes
	valid_target = {
		is_galactic_custodian = yes
	}

	modifier = {
	}

	effect = {
		custom_tooltip = resolution_galacticreforms_unseat_custodian_tooltip
		hidden_effect = {
			if = {
				limit = { is_active_resolution = "resolution_custodian_perpetual_custodianship" }
				cancel_resolution = "resolution_custodian_perpetual_custodianship"
			}
			country_event = { id = custodian.16 }
		}
	}

	fail_effects = {
	}

	potential = {
		is_galactic_custodian = no
		NOT = { is_active_resolution = resolution_custodian_peace_windows_project }
	}

	active = {
		has_galactic_custodian = yes
	}

	ai_weight = {
		base = @resolution_weight_unpopular

		modifier = {
			factor = 1.6
			is_xenophobe = yes
			NOT = {
				any_neighbor_country = { is_crisis_faction = yes }
			}
			desc = ethic_xenophobe
		}

		modifier = {
			factor = 0.2
			any_country = { is_crisis_faction = yes }
			desc = gal_com_someone_is_revealed_crisis
		}

		modifier = {
			factor = 0.2
			any_playable_country = { has_been_declared_crisis = yes }
			desc = gal_com_someone_declared_crisis
		}

		modifier = {
			factor = 0.2
			has_global_flag = gray_goo_crisis_active
			desc = gal_com_ongoing_grey_goo_crisis
		}

		modifier = {
			factor = 0.2
			has_global_flag = marauder_crisis_ongoing
			desc = gal_com_ongoing_great_khan_crisis
		}

		modifier = {
			factor = 0.2
			any_neighbor_country = { is_crisis_faction = yes }
			desc = gal_com_neighboring_crisis_empire
		}

		modifier = {
			factor = 0.1
			has_crisis_stage_2 = yes
			desc = gal_com_crisis_stage_2
		}

		modifier = {
			factor = 0
			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}

		modifier = {
			factor = 0
			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}

		modifier = {
			factor = 0
			any_playable_country = { has_country_flag = crisis_sphere_revealed }
			desc = gal_com_crisis_sphere_revealed
		}

		modifier = {
			factor = 20
			OR = {
				has_ascension_perk = ap_become_the_crisis
				has_ascension_perk = ap_cosmogenesis
			}
			desc = gal_com_we_have_crisis_perk
		}

		modifier = {
			factor = 0
			is_galactic_custodian = yes
			desc = gal_com_is_the_custodian
		}

		modifier = {
			factor = 20
			is_subject = yes
			overlord = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			desc = gal_com_subject_of_fallen_empire
		}

		modifier = {
			factor = 20
			is_rival = from
			desc = gal_com_target_is_rival
		}

		modifier = {
			factor = 0.2
			any_country = {
				is_country_type = awakened_fallen_empire
				is_galactic_community_member = no
			}
			desc = gal_com_exists_awakened_fallen_empire
		}

		modifier = {
			factor = 0.2
			has_global_flag = war_in_heaven_ongoing
			desc = gal_com_ongoing_war_in_heaven
		}
	}
}


################################### resolution_category_custodian_reforms
resolution_custodian_galactic_mobilization = {
	icon = "GFX_resolution_galactic_mobilization"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t3
		}
	}
	target = no

	triggered_modifier = {
		potential = { always = yes }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 50000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 100000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 150000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 200000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 300000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 400000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	triggered_modifier = {
		potential = { count_owned_pop_amount = { count >= 500000 } }
		modifier = { resolution_custodian_galactic_mobilization_naval_cap = 1 }
	}
	# 代价
	triggered_modifier = {
		potential = { always = yes }
		modifier = {
			resolution_custodian_galactic_mobilization = 1
		}
	}

	allow = {
		custom_tooltip = {
			fail_text = "resolution_already_active"
			NOT = { is_active_resolution = resolution_custodian_galactic_mobilization }
		}
		custom_tooltip = {
			fail_text = "galaxy_must_be_in_danger"
			galaxy_is_peace = no
		}
	}

	effect = {
		custom_tooltip = "resolution_custodian_galactic_mobilization_tooltip"
		hidden_effect = { set_global_flag = galactic_mobilization_activated }
		pass_resolution_modifier = { CATEGORY = general }
	}

	fail_effects = {
		fail_resolution_modifier = { CATEGORY = general }
	}

	potential = {
		has_nemesis = yes
		is_galactic_custodian = yes
		has_galactic_republic = no	# Expanded Espionage and Diplomacy mod 
	}

	active = {
		has_galactic_custodian = yes
		galaxy_is_peace = no
		has_galactic_republic = no	# Expanded Espionage and Diplomacy mod 
		#NOT = { is_active_resolution = resolution_emperor_galactic_mobilization }
	}

	ai_weight = {
		base = @resolution_weight_hated

		modifier = {
			factor = 1.6
			is_militarist = yes
			desc = ethic_militarist
		}

		modifier = {
			factor = 0.6
			is_pacifist = yes
			NOT = {
				any_neighbor_country = { is_crisis_faction = yes }
			}
			desc = ethic_pacifist
		}

		modifier = {
			factor = 12
			any_neighbor_country = { is_crisis_faction = yes }
			desc = gal_com_neighboring_crisis_empire
		}

		modifier = {
			factor = 4
			has_crisis_stage_1 = yes
			desc = gal_com_crisis_stage_1
		}

		modifier = {
			factor = 6
			has_crisis_stage_2 = yes
			desc = gal_com_crisis_stage_2
		}

		modifier = {
			factor = 8
			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}

		modifier = {
			factor = 20
			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}

		modifier = {
			factor = 20
			any_playable_country = { has_country_flag = crisis_sphere_revealed }
			desc = gal_com_crisis_sphere_revealed
		}

		modifier = {
			factor = 8
			any_playable_country = { has_been_declared_crisis = yes }
			desc = gal_com_someone_declared_crisis
		}

		modifier = {
			factor = 8
			has_global_flag = gray_goo_crisis_active
			desc = gal_com_someone_is_revealed_crisis
		}

		modifier = {
			factor = 8
			has_global_flag = marauder_crisis_ongoing
			desc = gal_com_someone_is_revealed_crisis
		}

		modifier = {
			factor = 0
			OR = {
				has_ascension_perk = ap_become_the_crisis
				is_unrecognized_cosmogenesis = yes
			}
			desc = gal_com_we_have_crisis_perk
		}

		modifier = {
			factor = 4
			is_galactic_custodian = yes
			desc = gal_com_is_the_custodian
		}

		modifier = {
			factor = 20
			is_militarist = yes
			is_galactic_custodian = yes
			desc = gal_com_militarist_custodian
		}

		modifier = {
			factor = 0
			is_subject = yes
			overlord = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			desc = gal_com_subject_of_fallen_empire
		}

		modifier = {
			factor = 10
			any_country = {
				is_country_type = awakened_fallen_empire
				is_galactic_community_member = no
			}
			desc = gal_com_exists_awakened_fallen_empire
		}

		modifier = {
			factor = 20
			has_global_flag = war_in_heaven_ongoing
			desc = gal_com_ongoing_war_in_heaven
		}
	}
}

################################### resolution_category_galactic_defense_force
resolution_custodian_disband_gdf = {
	icon = "GFX_resolution_disband_gdf"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t3
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_3" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_4" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_5" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_6" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_7" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_8" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_9" }
			influence = 75
		}
		cost = {
			trigger = { is_active_resolution = "resolution_custodian_expand_gdf_10" }
			influence = 75
		}
	}
	target = no
	fire_and_forget = yes

	effect = {
		hidden_effect = {
			remove_global_flag = gdf_active
			if = {
				limit = { has_global_flag = independent_gdf }
				remove_global_flag = independent_gdf
			}
			if = {
				limit = { exists = event_target:gdf_country }
				event_target:gdf_country = {
					every_owned_fleet = { delete_fleet = this }
					destroy_country = yes
				}
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf" }
				cancel_resolution = "resolution_custodian_expand_gdf"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_3" }
				cancel_resolution = "resolution_custodian_expand_gdf_3"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_4" }
				cancel_resolution = "resolution_custodian_expand_gdf_4"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_5" }
				cancel_resolution = "resolution_custodian_expand_gdf_5"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_6" }
				cancel_resolution = "resolution_custodian_expand_gdf_6"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_7" }
				cancel_resolution = "resolution_custodian_expand_gdf_7"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_8" }
				cancel_resolution = "resolution_custodian_expand_gdf_8"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_9" }
				cancel_resolution = "resolution_custodian_expand_gdf_9"
			}
			if = {
				limit = { is_active_resolution = "resolution_custodian_expand_gdf_10" }
				cancel_resolution = "resolution_custodian_expand_gdf_10"
			}
			cancel_resolution = "resolution_custodian_gdf"
			every_playable_country = {
				limit = { is_ai = no }
				country_event = { id = custodian.40 }
			}
			event_target:global_event_country = {
				clear_variable = gdf_expand_size
			}
		}
		set_galactic_defense_force = no
		pass_resolution_modifier = { CATEGORY = general }
	}

	fail_effects = {
		fail_resolution_modifier = { CATEGORY = general }
	}

	allow = {
		NOT = { is_active_resolution = resolution_custodian_establish_the_galactic_confederation }
	}

	potential = {
		has_nemesis = yes
		is_active_resolution = "resolution_custodian_gdf"
		has_galactic_emperor = no
		OR = {
			is_galactic_custodian = yes
			and = {
				is_part_of_galactic_council = yes
				NOT = { is_active_resolution = resolution_custodian_expand_gdf }
			}
		}
	}

	ai_weight = {
		base = @resolution_weight_unpopular

		modifier = {
			factor = 2
			is_pacifist = yes
			NOT = {
				any_neighbor_country = { is_crisis_faction = yes }
			}
			desc = ethic_pacifist
		}
		modifier = {
			factor = 1.6
			is_xenophobe = yes
			NOT = {
				any_neighbor_country = { is_crisis_faction = yes }
			}
			desc = ethic_xenophobe
		}
		modifier = {
			factor = 0.8
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = {
			factor = 0.2
			any_country = { is_crisis_faction = yes }
			desc = gal_com_someone_is_revealed_crisis
		}
		modifier = {
			factor = 0.2
			any_playable_country = { has_been_declared_crisis = yes }
			desc = gal_com_someone_is_revealed_crisis
		}
		modifier = {
			factor = 0.2
			has_global_flag = gray_goo_crisis_active
			desc = gal_com_someone_is_revealed_crisis
		}
		modifier = {
			factor = 0.2
			has_global_flag = marauder_crisis_ongoing
			desc = gal_com_someone_is_revealed_crisis
		}
		modifier = {
			factor = 0.2
			any_neighbor_country = { is_crisis_faction = yes }
			desc = gal_com_neighboring_crisis_empire
		}
		modifier = {
			factor = 0.1
			has_crisis_stage_2 = yes
			desc = gal_com_crisis_stage_2
		}
		modifier = {
			factor = 0
			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}
		modifier = {
			factor = 0
			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}
		modifier = {
			factor = 0
			any_playable_country = { has_country_flag = crisis_sphere_revealed }
			desc = gal_com_crisis_sphere_revealed
		}
		modifier = {
			factor = 20
			has_ascension_perk = ap_become_the_crisis
			desc = gal_com_we_have_crisis_perk
		}
		modifier = {
			factor = 0
			is_galactic_custodian = yes
			desc = gal_com_is_the_custodian
		}
		modifier = {
			factor = 20
			is_subject = yes
			overlord = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			desc = gal_com_subject_of_fallen_empire
		}
		modifier = {
			factor = 0.2
			any_country = {
				is_country_type = awakened_fallen_empire
				is_galactic_community_member = no
			}
			desc = gal_com_exists_awakened_fallen_empire
		}
		modifier = {
			factor = 0.2
			has_global_flag = war_in_heaven_ongoing
			desc = gal_com_ongoing_war_in_heaven
		}
	}
}

################################### resolution_category_imperial_council
resolution_emperor_restore_council = { # fire_and_forget
	icon = "GFX_resolution_imperial_council_category"

	potential = {
		has_nemesis = yes
		is_galactic_emperor = yes
		is_galactic_council_established = no
	}

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no
	fire_and_forget = yes

	modifier = {
	}

	allow = {
	}

	active = {
		has_galactic_emperor = yes
	}

	effect = {
		custom_tooltip = resolution_emperor_restore_council_tooltip
		hidden_effect = {
			set_council_size = 3
			set_council_veto = no
			set_global_flag = galactic_community_resolution_passed

			set_global_flag = resolution_with_breach_effect_passed # council denouncement

			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	ai_weight = {
		base = @resolution_weight_loved

		modifier = {
			factor = 2
			OR = {
				has_civic = civic_diplomatic_corps
				has_civic = civic_public_relations_specialists
				has_civic = civic_hive_empath
				has_civic = civic_machine_servitor
			}
			desc = gal_com_supporting_civics
		}

		modifier = {
			factor = 1.5
			OR = {
				galactic_community_rank <= 3
				AND = {
					is_subject = yes
					overlord = {
						opinion_level = { who = prev level >= neutral }
						galactic_community_rank <= 3
					}
				}
			}
			desc = gal_com_they_or_overlord_high_ranked
		}

		modifier = {
			factor = 0.8
			galactic_community_rank > 5
			NAND = {
				is_subject = yes
				overlord = {
					opinion_level = { who = prev level >= neutral }
					galactic_community_rank <= 3
				}
			}
			desc = gal_com_neither_they_or_overlord_high_ranked
		}

		modifier = {
			factor = 1.1
			is_xenophile = yes
			desc = ethic_xenophile
		}
	}
}

################################### resolution_category_foreign_relations

resolution_galactic_empire_imperial_crusade = { #BAN
	icon = "GFX_resolution_imperial_crusade"

	potential = {
		always = no
		has_galactic_emperor = yes
		NOR = { # Only one crusade at a time
			any_war = {
				using_war_goal = {
					type = wg_imperial_crusade
					owner = attacker
				}
			}
			any_war = {
				using_war_goal = {
					type = wg_imperial_crusade_total_war
					owner = attacker
				}
			}
			any_war = { #unused
				using_war_goal = {
					type = wg_imperial_crusade_anti_federation
					owner = attacker
				}
			}
		}
	}

	resources = {
		category = resolutions
		cost = {
			trigger = { NOT = { is_active_resolution = "resolution_emperor_imperial_ministry_of_defence" } }
			influence = @resolution_cost_t1
		}
		cost = {
			trigger = { is_active_resolution = "resolution_emperor_imperial_ministry_of_defence" }
			influence = @resolution_cost_t1_half
		}
	}

	target = yes
	harmful = yes
	valid_target = {
		OR = {
			is_country_type = default
			is_country_type = fallen_empire
			AND = {
				is_country_type = awakened_fallen_empire
				NOT = { has_global_flag = war_in_heaven_ongoing }
			}
		}
		is_galactic_community_member = no
		NOR = {
			has_country_flag = imperial_crusade_target
			has_country_flag = empire_rebel
		}
		has_federation = no
		NOT = { is_at_war_with = galactic_emperor }
	}

	allow = {
		imperial_authority >= 140
	}

	active = {
		has_galactic_emperor = yes
		from = { is_at_war_with = galactic_emperor }
	}

	effect = {
		if = {
			limit = {
				NOT = { has_global_flag = imperial_unification_start }
				is_country_type = default
				is_homicidal = no
			}
			custom_tooltip = resolution_imperial_crusade_tooltip
		}
		else = {
			custom_tooltip = resolution_imperial_crusade_tooltip_total_war
		}
		hidden_effect = {
			save_event_target_as = crusade_target
			galactic_emperor = {
				save_event_target_as = gal_emperor
				if = {
					limit = {
						event_target:crusade_target = {
							is_country_type = default
							is_homicidal = no
						}
					}
					declare_war = {
						target = event_target:crusade_target
						name = "NAME_Imperial_Crusade_War"
						attacker_war_goal = "wg_imperial_crusade"
					}
				}
				else = {
					declare_war = {
						target = event_target:crusade_target
						name = "NAME_Imperial_Crusade_War"
						attacker_war_goal = "wg_imperial_crusade_total_war"
					}
				}
			}
			random_war = {
				limit = {
					OR = {
						using_war_goal = {
							type = wg_imperial_crusade
							owner = galactic_emperor
						}
						using_war_goal = {
							type = wg_imperial_crusade_total_war
							owner = galactic_emperor
						}
					}
				}
				save_event_target_as = imperial_crusade_war
			}
			every_playable_country = {
				limit = {
					is_galactic_emperor = no
					is_galactic_community_member = yes
					NOR = {
						is_in_federation_with = event_target:crusade_target
						AND = {
							exists = overlord
							overlord = { is_same_value = event_target:crusade_target }
						}
					}
				}
				if = {
					limit = {
						any_war = {
							any_war_participant = {
								is_same_value = event_target:crusade_target
							}
						}
					}
					every_war = {
						limit = {
							any_war_participant = {
								is_same_value = event_target:crusade_target
							}
						}
						remove_war_participant = event_target:crusade_target
					}
				}
				join_war_on_side = {
					war = event_target:imperial_crusade_war
					side = galactic_emperor
				}
			}
			event_target:crusade_target = {
				country_event = { id = emperor.350 }
			}
			every_playable_country = {
				limit = {
					is_ai = no
					has_communications = galactic_emperor
					has_communications = event_target:crusade_target
					NOT = { is_same_value = event_target:crusade_target }
				}
				country_event = { id = emperor.351 }
			}
		}
	}

	ai_weight = {
		base = @resolution_weight_normal

		modifier = {
			factor = 0.2
			is_pacifist = yes
			desc = ethic_pacifist
		}
		modifier = {
			factor = 0.6
			is_egalitarian = yes
			desc = ethic_egalitarian
		}
		modifier = {
			factor = 1.4
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = {
			factor = 1.4
			is_part_of_galactic_council = yes
			desc = gal_com_on_galatic_council
		}
		modifier = {
			factor = 2
			is_rival = from
			desc = gal_com_proposer_is_rival
		}
	}
}

################################### resolution_category_imperial_reforms

resolution_emperor_pax_galactica = {
	icon = "GFX_resolution_pax_galactica"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t3
		}
	}
	target = no

	modifier = {
	}

	effect = {
		custom_tooltip = resolution_emperor_pax_galactica_tooltip
		hidden_effect = {
			every_war = {
				limit = {
					NOR = {
						using_war_goal = {
							type = wg_seize_council_seat
							owner = attacker
						}
						using_war_goal = {
							type = wg_seize_council_seat
							owner = defender
						}
						using_war_goal = {
							type = wg_declared_crisis
							owner = attacker
						}
					}
					any_attacker = { is_galactic_community_member = yes }
					any_defender = { is_galactic_community_member = yes }
				}
				every_war_participant = {
					limit = { is_galactic_community_member = yes }
					prev = { remove_war_participant = prev }
					country_event = { id = emperor.360 }
				}
			}
		}
	}

	fail_effects = {
	}

	potential = {
		has_nemesis_or_control_fragment = yes
		is_galactic_emperor = yes
	}

	allow = {
		imperial_authority >= 180
		custom_tooltip = {
			fail_text = "resolution_already_active"
			NOT = { is_active_resolution = "resolution_emperor_pax_galactica" }
		}
	}

	active = {
		has_galactic_emperor = yes
	}

	ai_weight = {
		base = @resolution_weight_unpopular		#基础=5

		modifier = {	#与天灾势力相邻			*4
			factor = 4
			any_neighbor_country = { is_crisis_faction = yes }
			desc = gal_com_neighboring_crisis_empire
		}
		modifier = {	#一级天灾（非高难）		*2
			factor = 2
			MECR_is_difficult_mode_for_emperor = no
			has_crisis_stage_1 = yes
			desc = gal_com_crisis_stage_1
		}
		modifier = {	#二级天灾（非高难）		*3
			factor = 3
			MECR_is_difficult_mode_for_emperor = no
			has_crisis_stage_2 = yes
			desc = gal_com_crisis_stage_2
		}
		modifier = {	#三级天灾（非高难）		*4
			factor = 4
			MECR_is_difficult_mode_for_emperor = no
			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}
		modifier = {	#四级天灾（非高难）		*5
			factor = 5
			MECR_is_difficult_mode_for_emperor = no
			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}
		modifier = {	#存在以太相引擎（非高难）*6
			factor = 6
			MECR_is_difficult_mode_for_emperor = no
			any_playable_country = { has_country_flag = crisis_sphere_revealed }
			desc = gal_com_crisis_sphere_revealed
		}
		modifier = {	#二级天灾（高难）		*1.5
			factor = 1.5
			MECR_is_difficult_mode_for_emperor = yes
			has_crisis_stage_2 = yes
			desc = gal_com_crisis_stage_2
		}
		modifier = {	#三级天灾（高难）		*2
			factor = 2
			MECR_is_difficult_mode_for_emperor = yes
			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}
		modifier = {	#四级天灾（高难）		*2.5
			factor = 2.5
			MECR_is_difficult_mode_for_emperor = yes
			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}
		modifier = {	#存在以太相引擎（高难）	*3
			factor = 3
			MECR_is_difficult_mode_for_emperor = yes
			any_playable_country = { has_country_flag = crisis_sphere_revealed }
			desc = gal_com_crisis_sphere_revealed
		}
		modifier = {	#存在觉醒帝国			*1.25
			factor = 2
			any_country = {
				is_country_type = awakened_fallen_empire
				is_galactic_community_member = no
			}
			desc = gal_com_exists_awakened_fallen_empire
		}
		modifier = {	#正在进行天堂之战		*2
			factor = 2
			has_global_flag = war_in_heaven_ongoing
			desc = gal_com_ongoing_war_in_heaven
		}

		modifier = {	#和平主义				*4
			factor = 4
			is_pacifist = yes
			desc = ethic_pacifist
		}
		modifier = {	#军国主义				*0.25
			factor = 0.25
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = {	#狂热传教士				*0.5	（影响武力传教）
			factor = 0.5
			is_galactic_emperor = no
			has_ai_personality = evangelising_zealots
			desc = personality_evangelising_zealots
		}
		modifier = {	#激进示好者				*0.5
			factor = 0.5
			is_galactic_emperor = no
			has_ai_personality = fanatic_befrienders
			desc = personality_fanatic_befrienders
		}
		modifier = {	#同化斗士				*0.5
			factor = 0.5
			is_galactic_emperor = no
			has_ai_personality = assimilators
			desc = personality_assimilators
		}
	}
}

################################### resolution_category_emperor_imperial_institutions
resolution_emperor_isd = {
	icon = "GFX_resolution_imperial_security_directorate"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t4
		}
	}
	target = no

	modifier = {
		resolution_emperor_isd = 1
	}
	triggered_modifier = {
		potential = {
			is_galactic_emperor = yes
			has_federation = yes
			federation = { has_federation_perk = imperium_federation_passive }
		}
		modifier = {
		}
	}
	triggered_modifier = {
		potential = {
			has_global_flag = flag_crack_down_on_criminal_syndicate
			is_megacorp = no
			NOT = { has_ethic = ethic_gestalt_consciousness }
			any_country = {
				is_criminal_syndicate = yes
				is_galactic_community_member = yes
			}
		}
		modifier = { resolution_custodian_crack_down_on_criminal_syndicate_anti_inner = 1 }
	}
	triggered_modifier = {
		potential = {
			has_global_flag = flag_crack_down_on_criminal_syndicate
			any_owned_planet = {
				has_branch_office = yes
				branch_office_owner = {
					is_criminal_syndicate = yes
					is_galactic_community_member = no
				}
			}
		}
		modifier = { resolution_custodian_crack_down_on_criminal_syndicate_anti_outer = 1 }
	}
	triggered_modifier = {
		potential = {
			has_global_flag = flag_crack_down_on_criminal_syndicate
			is_criminal_syndicate = yes
		}
		modifier = { resolution_custodian_crack_down_on_criminal_syndicate_criminal = 1 }
	}
	triggered_modifier = { #帝国治理点数需求
		potential = { always = yes }
		modifier = { imperial_governance_usage = 250 }
	}

	effect = {
		custom_tooltip = "non_repealable_department"
		galactic_emperor =  {
			add_modifier = { modifier = "imperial_security_directorate" }
		}
		hidden_effect = {
			every_playable_country = {
				limit = { is_galactic_community_member = yes }
				country_event = { id = emperor.70 }
			}
			galactic_emperor = {
				country_event = {
					id = MECR.1992
					days = 1
				}
			}
		}
		pass_resolution_modifier = { CATEGORY = general }
	}

	fail_effects = {
		fail_resolution_modifier = { CATEGORY = general }
	}

	allow = {
		custom_tooltip = {
			fail_text = "resolution_already_active"
			NOT = { is_active_resolution = "resolution_emperor_isd" }
		}
		custom_tooltip = {
			fail_text = "can_support_less_upgraded_institutions_resolution"
			OR = {
				is_active_resolution = resolution_emperor_isd
				NOT = { any_federation = { has_federation_perk = imperium_federation_passive } }
				federation = {
					check_variable = {
						which = imperial_institutions_upgrades_support
						value > value:imperial_institutions_upgrades_used
					}
				}
			}
		}
	}

	potential = {
		has_nemesis = yes
		OR = {
			is_galactic_emperor = yes
			and = {
				has_galactic_emperor = yes
				is_part_of_galactic_council = yes
				is_active_resolution = "resolution_emperor_expand_power_of_council"
			}
			is_country_type = imperial_senator
		}
		NOT = {
			any_country = { has_country_flag = galpol_turned_into_isd }
		}
	}

	breach = {
		custom_tooltip = {
			AND = {
				has_global_flag = flag_crack_down_on_criminal_syndicate
				has_valid_civic = civic_criminal_heritage
			}
		}
		NOT = { has_country_flag = constitutional_immunity }
	}

	active = {
		has_galactic_emperor = yes
	}

	ai_weight = {
		base = @resolution_weight_disliked

		modifier = {
			factor = 2
			any_owned_planet = {
				planet_crime > 40
			}
			desc = gal_com_owns_high_crime_planet
		}
		modifier = {
			factor = 2
			any_owned_planet = {
				has_branch_office = yes
				branch_office_owner = { is_criminal_syndicate = yes }
			}
			desc = gal_com_owns_planet_with_criminal_syndicate_branch_office
		}
		modifier = {
			factor = 0
			is_criminal_syndicate = yes
			desc = gov_criminal_syndicate
		}
		modifier = {
			factor = 0.6
			is_egalitarian = yes
			desc = ethic_egalitarian
		}
		modifier = {
			factor = 1.4
			is_part_of_galactic_council = yes
			desc = gal_com_on_galatic_council
		}
		modifier = {
			factor = 20
			is_galactic_emperor = yes
			desc = galactic_emperor
		}
	}
}
