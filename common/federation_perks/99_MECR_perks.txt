imperium_federation_passive = {
	members_modifier = {
		description = imperium_federation_passive_effect
	}
	leader_modifier = {
		description = imperium_federation_passive_effect_leader
	}
	on_activate = {
		set_diplomacy_action_setting = {
			action = action_leave_federation
			settings = { acceptance_type = leader }
		}
		set_diplomacy_action_setting = {
			action = action_ask_to_join_federation
			settings = { acceptance_type = leader }
		}
		################################ 设定不显示的法律的效果
		# 选举法律
		set_federation_succession_term = years_40
		set_federation_law = succession_power_diplomatic_weight
		# 条约法律
		every_member = { # Clear treaties with non-Federation members 皇帝除外
			limit = { is_federation_leader = no }
			country_event = { id = action.215 }
		}
		# 宣战法律
		set_diplomacy_action_setting = {
			action = action_declare_war
			settings = {
				vote_type = leader
			}
		}
		set_diplomacy_action_setting = {
			action = action_offer_peace
			settings = {
				vote_type = leader
			}
		}
		# 宣战法律
		set_allow_subjects_to_join = yes
		random_member = { # Let all subjects join
			country_event = { id = action.212 }
		}
		# 投票法律
		set_equal_voting_power = no
	}
}

imperium_market = {
	members_modifier = {
		description = imperium_market_effect
		country_resource_max_add = 10000
		country_trade_fee = -0.1
	}
}
imperium_market_2 = {
	members_modifier = {
		description = imperium_market_2_effect
		country_resource_max_add = 10000
		country_trade_fee = -0.05
	}
}
imperium_market_3 = {
	members_modifier = {
		description = imperium_market_3_effect
		country_resource_max_add = 10000
		country_trade_fee = -0.05
	}
}
imperium_market_4 = {
	members_modifier = {
		description = imperium_market_4_effect
		country_resource_max_add = 10000
		country_trade_fee = -0.05
	}
}

members_envoy_1 = {
	members_modifier = {
		envoys_add = 1
	}
}

imperium_gateways = {
	on_activate = {
		custom_tooltip = "imperium_gateways_effect"
		galactic_emperor = {
			country_event = {
				id = MECR.1031
			}
		}
	}
}

imperium_provinces = {
	members_modifier = {
		description = imperium_provinces_effect
	}
	leader_modifier = {
		envoys_add = 2
	}
	on_activate = {
		save_cohesion = yes
		every_member = {
			limit = {
				is_federation_leader = no
				is_country_type = default
				#NAND = {
				#	is_subject = yes
				#	overlord = { is_galactic_emperor = yes }
				#}
			}
			set_subject_of = {
				subject_type = imperial_province
				who = galactic_emperor
			}
			if = { #切换政策
				limit = { is_gestalt = no }
				# ai
				if = {
					limit = {
						federation = { has_federation_law = imperium_ai_policy_ai_outlawed }
						NOT = { has_policy_flag = ai_outlawed }
						NOT = { has_country_flag = synthetic_empire }
						OR = {
							has_ethic = ethic_materialist
							has_ethic = ethic_fanatic_materialist
						}
					}
					if = {
						limit = { has_ethic = ethic_fanatic_materialist }
						country_remove_ethic = ethic_fanatic_materialist
					}
					if = {
						limit = { has_ethic = ethic_materialist }
						country_remove_ethic = ethic_materialist
					}
					set_policy = {
						policy = artificial_intelligence_policy
						option = ai_outlawed
						cooldown = yes
					}
				}
				if = {
					limit = {
						federation = { has_federation_law = imperium_ai_policy_ai_servitude }
						NOT = { has_policy_flag = ai_servitude }
						NOT = { has_country_flag = synthetic_empire }
					}
					set_policy = {
						policy = artificial_intelligence_policy
						option = ai_servitude
						cooldown = yes
					}
				}
				if = {
					limit = {
						federation = { has_federation_law = imperium_ai_policy_ai_full_rights }
						NOT = { has_policy_flag = ai_full_rights }
						OR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_fanatic_spiritualist
							has_policy_flag = robots_outlawed
						}
					}
					if = {
						limit = { has_ethic = ethic_fanatic_spiritualist }
						country_remove_ethic = ethic_fanatic_spiritualist
					}
					if = {
						limit = { has_ethic = ethic_spiritualist }
						country_remove_ethic = ethic_spiritualist
					}
					if = {
						limit = { has_policy_flag = robots_outlawed }
						set_policy = {
							policy = robot_pop_policy
							option = robot_pops_allowed
							cooldown = yes
						}
					}
					set_policy = {
						policy = artificial_intelligence_policy
						option = ai_full_rights
						cooldown = yes
					}
				}
				# 奴隶制
				if = {
					limit = {
						federation = { has_federation_law = imperium_slavery_policy_slavery_not_allowed }
						NOT = { has_policy_flag = slavery_not_allowed }
						OR = {
							has_valid_civic = civic_slaver_guilds
							has_valid_civic = civic_indentured_assets
						}
					}
					if = {
						limit = { has_valid_civic = civic_slaver_guilds }
						force_remove_civic = civic_slaver_guilds
					}
					if = {
						limit = { has_valid_civic = civic_indentured_assets }
						force_remove_civic = civic_indentured_assets
					}
					set_policy = {
						policy = slavery
						option = slavery_not_allowed
						cooldown = yes
					}
				}
				if = {
					limit = {
						federation = { has_federation_law = imperium_slavery_policy_slavery_allowed }
						NOT = { has_policy_flag = slavery_allowed }
						NOR = {
							has_ethic = ethic_authoritarian
							has_ethic = ethic_fanatic_authoritarian
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
					shift_ethic = ethic_authoritarian
					set_policy = {
						policy = slavery
						option = slavery_allowed
						cooldown = yes
					}
				}
			}
			if = {
				limit = { NOT = { is_in_federation_with = galactic_emperor } }
				join_alliance = { who = galactic_emperor override_requirements = yes }
			}
		}
		every_country = {
			limit = {
				is_country_type = default
				is_galactic_community_member = yes
				is_galactic_emperor = no
				is_subject = yes
				NOT = { is_subject_type = imperial_province }
			}
			set_subject_of = {
				subject_type = imperial_province
				who = galactic_emperor
			}
			if = { #切换政策
				limit = { is_gestalt = no }
				# ai
				if = {
					limit = {
						federation = { has_federation_law = imperium_ai_policy_ai_outlawed }
						NOT = { has_policy_flag = ai_outlawed }
						NOT = { has_country_flag = synthetic_empire }
						OR = {
							has_ethic = ethic_materialist
							has_ethic = ethic_fanatic_materialist
						}
					}
					if = {
						limit = { has_ethic = ethic_fanatic_materialist }
						country_remove_ethic = ethic_fanatic_materialist
					}
					if = {
						limit = { has_ethic = ethic_materialist }
						country_remove_ethic = ethic_materialist
					}
					set_policy = {
						policy = artificial_intelligence_policy
						option = ai_outlawed
						cooldown = yes
					}
				}
				if = {
					limit = {
						federation = { has_federation_law = imperium_ai_policy_ai_servitude }
						NOT = { has_policy_flag = ai_servitude }
						NOT = { has_country_flag = synthetic_empire }
					}
					set_policy = {
						policy = artificial_intelligence_policy
						option = ai_servitude
						cooldown = yes
					}
				}
				if = {
					limit = {
						federation = { has_federation_law = imperium_ai_policy_ai_full_rights }
						NOT = { has_policy_flag = ai_full_rights }
						OR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_fanatic_spiritualist
							has_policy_flag = robots_outlawed
						}
					}
					if = {
						limit = { has_ethic = ethic_fanatic_spiritualist }
						country_remove_ethic = ethic_fanatic_spiritualist
					}
					if = {
						limit = { has_ethic = ethic_spiritualist }
						country_remove_ethic = ethic_spiritualist
					}
					if = {
						limit = { has_policy_flag = robots_outlawed }
						set_policy = {
							policy = robot_pop_policy
							option = robot_pops_allowed
							cooldown = yes
						}
					}
					set_policy = {
						policy = artificial_intelligence_policy
						option = ai_full_rights
						cooldown = yes
					}
				}
				# 奴隶制
				if = {
					limit = {
						federation = { has_federation_law = imperium_slavery_policy_slavery_not_allowed }
						NOT = { has_policy_flag = slavery_not_allowed }
						OR = {
							has_valid_civic = civic_slaver_guilds
							has_valid_civic = civic_indentured_assets
						}
					}
					if = {
						limit = { has_valid_civic = civic_slaver_guilds }
						force_remove_civic = civic_slaver_guilds
					}
					if = {
						limit = { has_valid_civic = civic_indentured_assets }
						force_remove_civic = civic_indentured_assets
					}
					set_policy = {
						policy = slavery
						option = slavery_not_allowed
						cooldown = yes
					}
				}
				if = {
					limit = {
						federation = { has_federation_law = imperium_slavery_policy_slavery_allowed }
						NOT = { has_policy_flag = slavery_allowed }
						NOR = {
							has_ethic = ethic_authoritarian
							has_ethic = ethic_fanatic_authoritarian
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
					shift_ethic = ethic_authoritarian
					set_policy = {
						policy = slavery
						option = slavery_allowed
						cooldown = yes
					}
				}
			}
			if = {
				limit = { NOT = { is_in_federation_with = galactic_emperor } }
				join_alliance = { who = galactic_emperor override_requirements = yes }
			}
		}
		imperium_recover_fleet = yes
		every_member = {
			every_federation_ally = {
				remove_opinion_modifier = { modifier = opinion_broke_federation who = prev }
			}
		}
		load_cohesion = yes
		add_federation_experience = 10
	}
	on_deactivate = {
		save_cohesion = yes
		every_country = {
			limit = {
				is_subject = yes
				is_subject_type = imperial_province
			}
			set_subject_of = { who = none }
			join_alliance = { who = root.federation_leader override_requirements = yes }
		}
		every_member = {
			every_federation_ally = {
				remove_opinion_modifier = { modifier = opinion_broke_federation who = prev }
			}
		}
		load_cohesion = yes
	}
}

imperium_unify = {
	federation_modifier = {
		description = "imperium_unify_effect"
	}
	members_modifier = {
		diplomacy_influence_upkeep_mult = -0.15
	}
}

imperium_elite_bureaucrats = {
	federation_modifier = {
		description = imperium_elite_bureaucrats_effect
	}
	members_modifier = {
		empire_size_mult = -0.1
	}
}

hegemony_turn_to_imperium_federation = {
	members_modifier = {
		description = hegemony_federation_passive_effect
	}
	on_activate = {
		set_federation_type = imperium_federation
		hidden_effect = {
			set_federation_flag = special_federation
			set_federation_flag = enable_federation_cooldowns
			save_global_event_target_as = ET_imperium_federation
		}
	}
}
