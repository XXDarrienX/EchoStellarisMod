find_expo_champion = {
	if = {
		limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 1 } check_variable = { which = expo_$category$_result value > 0 } } }
		if = { # 如果第一序列只有一个人：指定他为冠军
			limit = {
				count_country = {
					limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
					count = 1
				}
			}
			####################### 冠军排行
			random_country = {
				limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
				save_global_event_target_as = expo_$category$_ranking_1st
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 2 } check_variable = { which = expo_$category$_result value > 0 } } }
				if = { # 如果第二序列只有一个人：指定他为亚军
					limit = {
						count_country = {
							limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
							count = 1
						}
					}
					####################### 亚军排行
					random_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						save_global_event_target_as = expo_$category$_ranking_2nd
					}
					if = {
						limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 3 } check_variable = { which = expo_$category$_result value > 0 } } }
						if = { # 如果第三序列只有一个人：指定他为季军
							limit = {
								count_country = {
									limit = { check_variable = { which = expo_$category$_ranking value = 3 } }
									count = 1
								}
							}
							####################### 季军排行
							random_country = {
								limit = { check_variable = { which = expo_$category$_ranking value = 3 } }
								save_global_event_target_as = expo_$category$_ranking_3rd
							}
						}
						else = { #第三序列有二人以上
							# 为每个第三序列设置排序分
							every_country = {
								limit = { check_variable = { which = expo_$category$_ranking value = 3 } }
								export_resource_income_to_variable = { resource = $standard$ variable = Rexpo_$category$_champion }
							}
							####################### 季军排行
							# 随机选一个第三序列作为初始季军
							random_country = {
								limit = { is_variable_set = Rexpo_$category$_champion } }
								save_global_event_target_as = expo_$category$_ranking_3rd
							}
							# 如果另一个比较高，取而代之
							while = {
								limit = {
									any_country = {
										check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
									}
								}
								random_country = {
									limit = {
										check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
									}
									save_global_event_target_as = expo_$category$_ranking_3rd
								}
							}
						}
					}
				}
				else = { #第二序列有二人以上
					# 为每个第二序列设置排序分
					every_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						export_resource_income_to_variable = { resource = $standard$ variable = Rexpo_$category$_champion }
					}
					####################### 亚军排行
					# 随机选一个第二序列作为初始亚军
					random_country = {
						limit = { is_variable_set = Rexpo_$category$_champion } }
						save_global_event_target_as = expo_$category$_ranking_2nd
					}
					# 如果另一个比较高，取而代之
					while = {
						limit = {
							any_country = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
							}
						}
						random_country = {
							limit = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
							}
							save_global_event_target_as = expo_$category$_ranking_2nd
						}
					}
					# 亚军退出排序
					event_target:expo_$category$_ranking_2nd = {
						clear_variable = Rexpo_$category$_champion
					}
					####################### 季军排行
					# 随机选一个第二序列作为初始季军
					random_country = {
						limit = { is_variable_set = Rexpo_$category$_champion } }
						save_global_event_target_as = expo_$category$_ranking_3rd
					}
					# 如果另一个比较高，取而代之
					while = {
						limit = {
							any_country = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
						}
						random_country = {
							limit = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
							save_global_event_target_as = expo_$category$_ranking_3rd
						}
					}
				}
			}
		}
		else_if = { # 如果第一序列有两个人
			limit = {
				count_country = {
					limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
					count = 2
				}
			}
			# 为每个第一序列设置排序分
			every_country = {
				limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
				export_resource_income_to_variable = { resource = $standard$ variable = Rexpo_$category$_champion }
			}
			####################### 冠军排行
			# 随机选一个第一序列作为初始冠军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_1st
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_1st
				}
			}
			# 冠军退出排序
			event_target:expo_$category$_ranking_1st = {
				clear_variable = Rexpo_$category$_champion
			}
			####################### 亚军排行
			# 另一个第一序列作为初始亚军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_2nd
			}
			# 亚军退出排序
			event_target:expo_$category$_ranking_2nd = {
				clear_variable = Rexpo_$category$_champion
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 2 } check_variable = { which = expo_$category$_result value > 0 } } }
				if = { # 如果第二序列只有一个人：指定他为季军
					limit = {
						count_country = {
							limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
							count = 1
						}
					}
					####################### 季军排行
					random_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						save_global_event_target_as = expo_$category$_ranking_3rd
					}
				}
				else = { #第二序列有二人以上
					# 为每个第二序列设置排序分
					every_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						export_resource_income_to_variable = { resource = $standard$ variable = Rexpo_$category$_champion }
					}
					####################### 季军排行
					# 随机选一个第二序列作为初始季军
					random_country = {
						limit = { is_variable_set = Rexpo_$category$_champion } }
						save_global_event_target_as = expo_$category$_ranking_3rd
					}
					# 如果另一个比较高，取而代之
					while = {
						limit = {
							any_country = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
						}
						random_country = {
							limit = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
							save_global_event_target_as = expo_$category$_ranking_3rd
						}
					}
				}
			}
		}
		else = { # 第一序列有三人以上
			# 为每个第一序列设置排序分
			every_country = {
				limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
				export_resource_income_to_variable = { resource = $standard$ variable = Rexpo_$category$_champion }
			}
			####################### 冠军排行
			# 随机选一个第一序列作为初始冠军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_1st
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_1st
				}
			}
			# 冠军退出排序
			event_target:expo_$category$_ranking_1st = {
				clear_variable = Rexpo_$category$_champion
			}
			####################### 亚军排行
			# 随机选一个第一序列作为初始亚军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_2nd
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_2nd
				}
			}
			# 亚军退出排序
			event_target:expo_$category$_ranking_2nd = {
				clear_variable = Rexpo_$category$_champion
			}
			####################### 季军排行
			# 随机选一个第一序列作为初始季军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_3rd
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_3rd
				}
			}
		}
	}
	every_country = {
		limit = { is_variable_set = Rexpo_$category$_champion } }
		clear_variable = Rexpo_$category$_champion
	}
	event_target:expo_$category$_ranking_1st = {
		set_country_flag = flag_expo_$category$_ranking_1st
	}
	event_target:expo_$category$_ranking_2nd = {
		set_country_flag = flag_expo_$category$_ranking_2nd
	}
	event_target:expo_$category$_ranking_3rd = {
		set_country_flag = flag_expo_$category$_ranking_3rd
	}
}

find_expo_champion_diplo_weight = {
	if = {
		limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 1 } check_variable = { which = expo_$category$_result value > 0 } } }
		if = { # 如果第一序列只有一个人：指定他为冠军
			limit = {
				count_country = {
					limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
					count = 1
				}
			}
			####################### 冠军排行
			random_country = {
				limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
				save_global_event_target_as = expo_$category$_ranking_1st
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 2 } check_variable = { which = expo_$category$_result value > 0 } } }
				if = { # 如果第二序列只有一个人：指定他为亚军
					limit = {
						count_country = {
							limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
							count = 1
						}
					}
					####################### 亚军排行
					random_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						save_global_event_target_as = expo_$category$_ranking_2nd
					}
					if = {
						limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 3 } check_variable = { which = expo_$category$_result value > 0 } } }
						if = { # 如果第三序列只有一个人：指定他为季军
							limit = {
								count_country = {
									limit = { check_variable = { which = expo_$category$_ranking value = 3 } }
									count = 1
								}
							}
							####################### 季军排行
							random_country = {
								limit = { check_variable = { which = expo_$category$_ranking value = 3 } }
								save_global_event_target_as = expo_$category$_ranking_3rd
							}
						}
						else = { #第三序列有二人以上
							# 为每个第三序列设置排序分
							every_country = {
								limit = { check_variable = { which = expo_$category$_ranking value = 3 } }
								export_trigger_value_to_variable = { trigger = diplomacy_weight variable = Rexpo_$category$_champion }
								change_variable = { which = Rexpo_$category$_champion value = Rexpo_$category$_champion_bonus }
							}
							####################### 季军排行
							# 随机选一个第三序列作为初始季军
							random_country = {
								limit = { is_variable_set = Rexpo_$category$_champion } }
								save_global_event_target_as = expo_$category$_ranking_3rd
							}
							# 如果另一个比较高，取而代之
							while = {
								limit = {
									any_country = {
										check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
									}
								}
								random_country = {
									limit = {
										check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
									}
									save_global_event_target_as = expo_$category$_ranking_3rd
								}
							}
						}
					}
				}
				else = { #第二序列有二人以上
					# 为每个第二序列设置排序分
					every_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						export_trigger_value_to_variable = { trigger = diplomacy_weight variable = Rexpo_$category$_champion }
						change_variable = { which = Rexpo_$category$_champion value = Rexpo_$category$_champion_bonus }
					}
					####################### 亚军排行
					# 随机选一个第二序列作为初始亚军
					random_country = {
						limit = { is_variable_set = Rexpo_$category$_champion } }
						save_global_event_target_as = expo_$category$_ranking_2nd
					}
					# 如果另一个比较高，取而代之
					while = {
						limit = {
							any_country = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
							}
						}
						random_country = {
							limit = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
							}
							save_global_event_target_as = expo_$category$_ranking_2nd
						}
					}
					# 亚军退出排序
					event_target:expo_$category$_ranking_2nd = {
						clear_variable = Rexpo_$category$_champion
					}
					####################### 季军排行
					# 随机选一个第二序列作为初始季军
					random_country = {
						limit = { is_variable_set = Rexpo_$category$_champion } }
						save_global_event_target_as = expo_$category$_ranking_3rd
					}
					# 如果另一个比较高，取而代之
					while = {
						limit = {
							any_country = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
						}
						random_country = {
							limit = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
							save_global_event_target_as = expo_$category$_ranking_3rd
						}
					}
				}
			}
		}
		else_if = { # 如果第一序列有两个人
			limit = {
				count_country = {
					limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
					count = 2
				}
			}
			# 为每个第一序列设置排序分
			every_country = {
				limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
				export_trigger_value_to_variable = { trigger = diplomacy_weight variable = Rexpo_$category$_champion }
				change_variable = { which = Rexpo_$category$_champion value = Rexpo_$category$_champion_bonus }
			}
			####################### 冠军排行
			# 随机选一个第一序列作为初始冠军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_1st
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_1st
				}
			}
			# 冠军退出排序
			event_target:expo_$category$_ranking_1st = {
				clear_variable = Rexpo_$category$_champion
			}
			####################### 亚军排行
			# 另一个第一序列作为初始亚军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_2nd
			}
			# 亚军退出排序
			event_target:expo_$category$_ranking_2nd = {
				clear_variable = Rexpo_$category$_champion
			}
			if = {
				limit = { any_country = { check_variable = { which = expo_$category$_ranking value = 2 } check_variable = { which = expo_$category$_result value > 0 } } }
				if = { # 如果第二序列只有一个人：指定他为季军
					limit = {
						count_country = {
							limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
							count = 1
						}
					}
					####################### 季军排行
					random_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						save_global_event_target_as = expo_$category$_ranking_3rd
					}
				}
				else = { #第二序列有二人以上
					# 为每个第二序列设置排序分
					every_country = {
						limit = { check_variable = { which = expo_$category$_ranking value = 2 } }
						export_trigger_value_to_variable = { trigger = diplomacy_weight variable = Rexpo_$category$_champion }
						change_variable = { which = Rexpo_$category$_champion value = Rexpo_$category$_champion_bonus }
					}
					####################### 季军排行
					# 随机选一个第二序列作为初始季军
					random_country = {
						limit = { is_variable_set = Rexpo_$category$_champion } }
						save_global_event_target_as = expo_$category$_ranking_3rd
					}
					# 如果另一个比较高，取而代之
					while = {
						limit = {
							any_country = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
						}
						random_country = {
							limit = {
								check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
							}
							save_global_event_target_as = expo_$category$_ranking_3rd
						}
					}
				}
			}
		}
		else = { # 第一序列有三人以上
			# 为每个第一序列设置排序分
			every_country = {
				limit = { check_variable = { which = expo_$category$_ranking value = 1 } }
				export_trigger_value_to_variable = { trigger = diplomacy_weight variable = Rexpo_$category$_champion }
				change_variable = { which = Rexpo_$category$_champion value = Rexpo_$category$_champion_bonus }
			}
			####################### 冠军排行
			# 随机选一个第一序列作为初始冠军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_1st
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_1st.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_1st
				}
			}
			# 冠军退出排序
			event_target:expo_$category$_ranking_1st = {
				clear_variable = Rexpo_$category$_champion
			}
			####################### 亚军排行
			# 随机选一个第一序列作为初始亚军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_2nd
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_2nd.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_2nd
				}
			}
			# 亚军退出排序
			event_target:expo_$category$_ranking_2nd = {
				clear_variable = Rexpo_$category$_champion
			}
			####################### 季军排行
			# 随机选一个第一序列作为初始季军
			random_country = {
				limit = { is_variable_set = Rexpo_$category$_champion } }
				save_global_event_target_as = expo_$category$_ranking_3rd
			}
			# 如果另一个比较高，取而代之
			while = {
				limit = {
					any_country = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
					}
				}
				random_country = {
					limit = {
						check_variable = { which = Rexpo_$category$_champion value > event_target:expo_$category$_ranking_3rd.Rexpo_$category$_champion }
					}
					save_global_event_target_as = expo_$category$_ranking_3rd
				}
			}
		}
	}
	every_country = {
		limit = { is_variable_set = Rexpo_$category$_champion } }
		clear_variable = Rexpo_$category$_champion
	}
	event_target:expo_$category$_ranking_1st = {
		set_country_flag = flag_expo_$category$_ranking_1st
	}
	event_target:expo_$category$_ranking_2nd = {
		set_country_flag = flag_expo_$category$_ranking_2nd
	}
	event_target:expo_$category$_ranking_3rd = {
		set_country_flag = flag_expo_$category$_ranking_3rd
	}
}

add_expo_result = {
	add_event_chain_counter = {
		event_chain = "the_galactic_expo"
		counter = "expo_$cat$_result"
		amount = $num$
	}
	add_event_chain_counter = {
		event_chain = "the_galactic_expo"
		counter = "expo_total_result"
		amount = $num$
	}
	change_variable = { which = expo_total_result value = $num$ }
	change_variable = { which = expo_$cat$_result value = $num$ }
}