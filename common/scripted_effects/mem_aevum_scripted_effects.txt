###########
# mem_aevum_scripted_effects
# made by:
# tr33
#
###########
# spawns the system
spawn_mem_aevum = {
	if = {
		limit = {
			NOT = {
				has_global_flag = mem_aevum_system_spawned
			}
		}
		set_global_flag = mem_aevum_system_spawned
		spawn_system = {
			initializer = mem_aevum_orgin_system
		}
	}
	last_created_system = {
		log = "spawned \\[This.GetName\\]"
	}
}

# ends al levents related to him
mem_aevum_endallevents = {
	if = {
		limit = {
			has_event_chain = mem_aevum_buildtemple
		}
		end_event_chain = mem_aevum_buildtemple
	}
	if = {
		limit = {
			has_event_chain = mem_aevum_decoded_messages_chain
		}
		end_event_chain = mem_aevum_decoded_messages_chain
	}
	if = {
		limit = {
			has_special_project = mem_aevum_make_lightshow
		}
		abort_special_project = {
			type = mem_aevum_make_lightshow
		}
	}
	if = {
		limit = {
			has_special_project = mem_aevum_decode_message
		}
		abort_special_project = {
			type = mem_aevum_decode_message
		}
	}
}

# change his portrait depending on age
mem_aevum_setportrait = {
	this = {
		#set_variable = {
		#	which = mem_aevum_death_age
		#	value = this.trigger:leader_age
		#}
		if = {
			limit = {
				event_target:mem_aevum_time_lord = {
					leader_age < 100
				}
			}
			event_target:mem_aevum_time_lord = {
				change_leader_portrait = GFX_mem_aevum_time_lord_stage1
			}
		}
		else_if = {
			limit = {
				event_target:mem_aevum_time_lord = {
					leader_age < 300
				}
			}
			event_target:mem_aevum_time_lord = {
				change_leader_portrait = GFX_mem_aevum_time_lord_stage2
				if = {
					limit = {
						NOT = {
							has_leader_flag = mem_aevum_power_unlocked2
						}
					}
					leader_event = {
						id = mem_aevum.200
					}
					
					set_leader_flag = mem_aevum_power_unlocked2
				}
			}
		}
		else_if = {
			limit = {
				event_target:mem_aevum_time_lord = {
					leader_age < 600
				}
			}
			event_target:mem_aevum_time_lord = {
				change_leader_portrait = GFX_mem_aevum_time_lord_stage3
				if = {
					limit = {
						NOT = {
							has_leader_flag = mem_aevum_power_unlocked3
						}
					}
					leader_event = {
						id = mem_aevum.200
					}
					set_leader_flag = mem_aevum_power_unlocked3
				}
			}
		}
		else_if = {
			limit = {
				event_target:mem_aevum_time_lord = {
					leader_age < 1000
				}
			}
			event_target:mem_aevum_time_lord = {
				change_leader_portrait = GFX_mem_aevum_time_lord
				if = {
					limit = {
						NOT = {
							has_leader_flag = mem_aevum_power_unlocked4
						}
					}
					leader_event = {
						id = mem_aevum.200
					}
					set_leader_flag = mem_aevum_power_unlocked4
				}
			}
		}
		else = {
			event_target:mem_aevum_time_lord = {
				change_leader_portrait = GFX_mem_aevum_time_lord_stageultimate
				if = {
					limit = {
						NOT = {
							has_leader_flag = mem_aevum_power_unlocked5
						}
					}
					leader_event = {
						id = mem_aevum.201
					}
					set_leader_flag = mem_aevum_power_unlocked5
				}
			}
		}
	}
}
