#############
# Resource buildings
#############

building_unity_farm = {
	base_buildtime = 720

	planet_limit = 1
	category = unity

	building_sets = {
		unity
		urban
	}

	potential = {
		exists = owner
		NOT = { has_modifier = slave_colony }
		owner = {
			NOR = {
				is_gestalt = yes
				is_megacorp = yes
				is_memorialist_empire = yes
			}
		}
	}

	can_be_ruined = no
	can_be_disabled = no

	allow = {
		OR = {
			is_active_resolution = "resolution_cultureprotect_monuments"
			is_active_resolution = "resolution_cultureprotect_diversity"
			is_active_resolution = "resolution_cultureprotect_culture"
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			has_modifier = slave_colony
			owner = {
				OR = {
					is_gestalt = yes
					is_megacorp = yes
					is_memorialist_empire = yes
				}
			}
		}
	}

	resources = {
		category = planet_buildings
		produces = {
			trigger = { exists = owner }
			unity = 450
			multiplier = owner.trigger:num_ascension_perks
		}
		cost = {
			minerals = 1000
			energy = 1500
		}
		upkeep = {
            energy = 100
        }
	}

	
	planet_modifier = {
		planet_jobs_unity_produces_mult = 0.2
		job_culture_worker_add = 5
	}

	triggered_desc = {
		text = building_unity_farm_effect
	}

	prerequisites = {
		"tech_cultural_heritage"
	}

}


building_medical_1 = {
	base_buildtime = @b1_time
	planet_limit = 1
	category = amenity
	icon = building_medical_1

	building_sets = {
		government
		urban
	}

	allow = {
		NOR = {
			has_modifier = slave_colony
			has_modifier = penal_colony
		}
		owner = {
			is_regular_empire = yes
			is_individual_machine = no
			NOT = {
				has_valid_civic = civic_dystopian_society
			}
		}
		OR = {
			owner = {
				NOT = { is_ai = yes }
			}
			AND = {
				NOT = { has_available_jobs = entertainer }
				NOT = { has_forbidden_jobs = entertainer }
			}
		}
		NOT = { has_building = building_low_tech_capital }
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_regular_empire = no }
			AND = {
				buildings_stop_pop = yes
				owner = { is_ai = yes }
			}
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}

	inline_script = {
		script = jobs/healthcare_add
		AMOUNT = @building_static_jobs
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_country_flag = clone_army_full_potential
				has_active_tradition = tr_cloning_artificial_population_clone_army
			}
		}
		clone_soldiers_sustained = @clones_sustained_low
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					has_purity_heightened_attributes_tradition = yes
					has_cloning_artificial_population_tradition = yes
					has_mutation_somatic_subversiveness_tradition = yes
				}
			}
		}
		pop_bonus_workforce_mult = @medical_workforce_mult
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { 
				has_policy_flag = medicare_for_all
			}
		}
		modifier = {
			pop_amenities_usage_organic_mult = -0.2
			pop_growth_speed = 0.1
			planet_jobs_consumer_goods_upkeep_mult = 0.04
			trade_value_mult = -0.04
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = public_healthcarep
			}
		}
		modifier = {
			pop_amenities_usage_organic_mult = -0.1
			pop_growth_speed = 0.05
			planet_jobs_consumer_goods_upkeep_mult = 0.02
			trade_value_mult = -0.02
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = private_healthcarep
			}
		}
		modifier = {
			trade_value_mult = 0.02
			planet_jobs_energy_produces_mult = 0.02
			pop_amenities_usage_organic_mult = 0.1
			pop_growth_speed = -0.05
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = pay_to_heal
			}
		}
		modifier = {
			trade_value_mult = 0.04
			planet_jobs_energy_produces_mult = 0.04
			pop_amenities_usage_organic_mult = 0.2
			pop_growth_speed = -0.1
		}
	}

	prerequisites = {
		"tech_basic_health"
	}

	upgrades = {
		building_medical_2
	}
}

building_medical_2 = {
	base_buildtime = @b2_time
	can_build = no

	category = amenity

	building_sets = {
		government
		urban
	}

	potential = {
		exists = owner
		# check the empire is valid
		owner = {
			# rule out gestalts and pre-FTL societies
			is_individual_machine = no
			OR = {
				is_regular_empire = yes
				AND = {
					has_origin = origin_fear_of_the_dark
					is_country_type = primitive
				}
			}
			# rule out AI empires with entirely no access to "Pharma State" Civic, unless the planet is unstable
			OR = {
				is_ai = no
				has_valid_civic = civic_private_healthcare_corporate
				root = {
					has_branch_office = yes
					branch_office_owner = {
						has_valid_civic = civic_private_healthcare_corporate
					}
				}
				root = {
					NOT = { has_available_jobs = entertainer }
					NOT = { has_forbidden_jobs = entertainer }
					planet_stability < 50
					free_amenities < 0
				}
			}
		}
	}

	destroy_trigger = {
		OR = {
			# if the planet is owned by a gestalt or pre-FTL society
			AND = {
				exists = owner
				owner = {
					OR = {
						is_regular_empire = no
						AND = {
							is_country_type = primitive
							NOT = { has_origin = origin_fear_of_the_dark }
						}
					}
				}
			}
			# if this is an AI-controlled empire with entirely no access to "Pharma State" Civic, assuming the planet is now stable
			AND = {
				exists = owner
				owner = {
					is_ai = yes
					NOT = {
						OR = {
							has_valid_civic = civic_private_healthcare_corporate
							prev = {
								has_branch_office = yes
								branch_office_owner = {
									has_valid_civic = civic_private_healthcare_corporate
								}
							}
						}
					}
				}
				planet_stability > 70
				free_amenities > 20
			}
		}
	}

	inline_script = {
		script = jobs/healthcare_add
		AMOUNT = @building_static_jobs
	}

	planet_modifier = {
		planet_doctors_upkeep_mult = -0.20
		pop_amenities_usage_organic_mult = -0.10
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_gene_tailoring
			}
			any_owned_pop_group = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 100
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				game_start_auto_mod_empire = yes
			}
			any_owned_pop_group = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 100
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_country_flag = clone_army_full_potential
				has_active_tradition = tr_cloning_artificial_population_clone_army
			}
		}
		clone_soldiers_sustained = @clones_sustained_low
		mult = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					has_purity_heightened_attributes_tradition = yes
					has_cloning_artificial_population_tradition = yes
					has_mutation_somatic_subversiveness_tradition = yes
				}
			}
		}
		pop_bonus_workforce_mult = @medical_workforce_mult
		mult = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { 
				has_policy_flag = medicare_for_all
			}
		}
		modifier = {
			pop_amenities_usage_organic_mult = -0.4
			pop_growth_speed = 0.2
			planet_jobs_consumer_goods_upkeep_mult = 0.06
			trade_value_mult = -0.06
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = public_healthcarep
			}
		}
		modifier = {
			pop_amenities_usage_organic_mult = -0.2
			pop_growth_speed = 0.1
			planet_jobs_consumer_goods_upkeep_mult = 0.04
			trade_value_mult = -0.04
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = private_healthcarep
			}
		}
		modifier = {
			trade_value_mult = 0.04
			planet_jobs_energy_produces_mult = 0.04
			pop_amenities_usage_organic_mult = 0.2
			pop_growth_speed = -0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = pay_to_heal
			}
		}
		modifier = {
			trade_value_mult = 0.06
			planet_jobs_energy_produces_mult = 0.06
			pop_amenities_usage_organic_mult = 0.4
			pop_growth_speed = -0.2
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			exotic_gases = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
		}
		upkeep = {
			trigger = {
				num_zones = {
					type = zone_payback_enlightenment
					value = 0
				}
			}
			exotic_gases = @b2_rare_upkeep
		}
	}

	prerequisites = {
		"tech_frontier_health"
	}

	on_destroy = {
		owner = {
			if = {
				limit = {
					has_event_chain = payback_out_of_warranty_chain
				}
				end_event_chain = payback_out_of_warranty_chain
			}
		}
	}

	on_repaired = {
		if = {
			limit = {
				planet.owner = {
					has_event_chain = payback_out_of_warranty_chain
				}
			}
			random_list = {
				50 = { # still broken
					planet.owner = {
						country_event = { id = origin.4302 }
					}
					modifier = {
						factor = 0
						planet.owner = { has_technology = tech_frontier_health }
					}
				}
				20 = { # repaired
					planet.owner = {
						country_event = { id = origin.4301 }
					}
					modifier = {
						factor = 2
						planet.owner = { num_research_agreements = 1 }
					}
					modifier = {
						factor = 3
						planet.owner = { num_research_agreements = 2 }
					}
					modifier = {
						factor = 4
						planet.owner = { num_research_agreements >= 3 }
					}
				}
				10 = { # broken beyond repair
					planet = {
						planet_event = { id = origin.4303 }
					}
				}
			}
		}
	}

	upgrades = {
		building_medical_3
	}
}

building_medical_3 = {
	base_buildtime = @b3_time
	can_build = no

	category = amenity

	building_sets = {
		government
		urban
	}

	potential = {
		has_upgraded_capital = yes
		OR = {
			owner = {
				OR = {
					has_valid_civic = civic_private_healthcare_corporate
					is_ai = no
				}
			}
			AND = {
				NOT = { has_available_jobs = entertainer }
				NOT = { has_forbidden_jobs = entertainer }
				planet_stability < 55
				free_amenities < 5
			}
			AND = {
				has_branch_office = yes
				branch_office_owner = {
					has_valid_civic = civic_private_healthcare_corporate
				}
			}
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_regular_empire = no }
			AND = {
				buildings_stop_pop = yes
				owner = { is_ai = yes }
			}
		}
	}

	inline_script = {
		script = jobs/healthcare_add
		AMOUNT = @building_static_jobs
	}

	planet_modifier = {
		planet_doctors_upkeep_mult = -0.20
		pop_amenities_usage_organic_mult = -0.10
		# Modifier implmented in /inline_scripts/output/healthcare_triggered_modifiers.txt
		pop_environment_tolerance = @building_medical_3_environment_tolerance
		job_healthcare_organics_upkeep_mult = @building_medical_3_organics_upkeep
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_gene_tailoring
			}
			any_owned_pop_group = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 200
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				game_start_auto_mod_empire = yes
			}
			any_owned_pop_group = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 200
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_country_flag = clone_army_full_potential
				has_active_tradition = tr_cloning_artificial_population_clone_army
			}
		}
		clone_soldiers_sustained = @clones_sustained_low
		mult = 3
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					has_purity_heightened_attributes_tradition = yes
					has_cloning_artificial_population_tradition = yes
					has_mutation_somatic_subversiveness_tradition = yes
				}
			}
		}
		pop_bonus_workforce_mult = @medical_workforce_mult
		mult = 3
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { 
				has_policy_flag = medicare_for_all
			}
		}
		modifier = {
			pop_amenities_usage_organic_mult = -0.8
			pop_growth_speed = 0.3
			planet_jobs_consumer_goods_upkeep_mult = 0.09
			trade_value_mult = -0.09
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = public_healthcarep
			}
		}
		modifier = {
			pop_amenities_usage_organic_mult = -0.35
			pop_growth_speed = 0.25
			planet_jobs_consumer_goods_upkeep_mult = 0.06
			trade_value_mult = -0.06
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = private_healthcarep
			}
		}
		modifier = {
			trade_value_mult = 0.06
			planet_jobs_energy_produces_mult = 0.06
			pop_amenities_usage_organic_mult = 0.35
			pop_growth_speed = -0.25
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_policy_flag = pay_to_heal
			}
		}
		modifier = {
			trade_value_mult = 0.09
			planet_jobs_energy_produces_mult = 0.09
			pop_amenities_usage_organic_mult = 0.8
			pop_growth_speed = -0.3
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			exotic_gases = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			exotic_gases = @b2_rare_upkeep
		}
	}

	prerequisites = {
		"tech_frontier_hospital"
	}

	show_tech_unlock_if = {
		is_regular_empire = yes
	}
}